var vm=Object.defineProperty;var _m=(i,t,e)=>t in i?vm(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var xm=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var pe=(i,t,e)=>(_m(i,typeof t!="symbol"?t+"":t,e),e);var $b=xm((xp,pl)=>{(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var Ui=(i=>(i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2",i))(Ui||{}),ml=(i=>(i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS",i))(ml||{}),ph=(i=>(i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL",i))(ph||{}),rt=(i=>(i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR",i))(rt||{}),pr=(i=>(i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN",i))(pr||{}),at=(i=>(i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.RG=33319]="RG",i[i.RED=6403]="RED",i[i.RGBA_INTEGER=36249]="RGBA_INTEGER",i[i.RGB_INTEGER=36248]="RGB_INTEGER",i[i.RG_INTEGER=33320]="RG_INTEGER",i[i.RED_INTEGER=36244]="RED_INTEGER",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL",i))(at||{}),an=(i=>(i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",i))(an||{}),Et=(i=>(i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.UNSIGNED_INT=5125]="UNSIGNED_INT",i[i.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",i[i.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",i[i.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",i[i.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",i[i.BYTE=5120]="BYTE",i[i.SHORT=5122]="SHORT",i[i.INT=5124]="INT",i[i.FLOAT=5126]="FLOAT",i[i.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",i[i.HALF_FLOAT=36193]="HALF_FLOAT",i))(Et||{}),gt=(i=>(i[i.FLOAT=0]="FLOAT",i[i.INT=1]="INT",i[i.UINT=2]="UINT",i))(gt||{}),mr=(i=>(i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR",i))(mr||{}),Jr=(i=>(i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",i))(Jr||{}),Ur=(i=>(i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON",i[i.ON_MANUAL=3]="ON_MANUAL",i))(Ur||{}),He=(i=>(i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",i))(He||{}),Dr=(i=>(i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT",i))(Dr||{}),gl=(i=>(i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",i))(gl||{}),ir=(i=>(i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp",i))(ir||{}),_e=(i=>(i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE",i[i.COLOR=4]="COLOR",i))(_e||{}),me=(i=>(i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH",i))(me||{}),kr=(i=>(i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",i))(kr||{});const bm={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")},ft={ADAPTER:bm,RESOLUTION:1,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var Aa=/iPhone/i,Pu=/iPod/i,Ru=/iPad/i,Mu=/\biOS-universal(?:.+)Mac\b/i,Ea=/\bAndroid(?:.+)Mobile\b/i,Iu=/Android/i,ji=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Ns=/Silk/i,jr=/Windows Phone/i,Fu=/\bWindows(?:.+)ARM\b/i,Bu=/BlackBerry/i,Du=/BB10/i,Ou=/Opera Mini/i,Lu=/\b(CriOS|Chrome)(?:.+)Mobile/i,ku=/Mobile(?:.+)Firefox\b/i,Nu=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function Tm(i){return function(t){return t.test(i)}}function Uu(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=Tm(e),s={apple:{phone:n(Aa)&&!n(jr),ipod:n(Pu),tablet:!n(Aa)&&(n(Ru)||Nu(t))&&!n(jr),universal:n(Mu),device:(n(Aa)||n(Pu)||n(Ru)||n(Mu)||Nu(t))&&!n(jr)},amazon:{phone:n(ji),tablet:!n(ji)&&n(Ns),device:n(ji)||n(Ns)},android:{phone:!n(jr)&&n(ji)||!n(jr)&&n(Ea),tablet:!n(jr)&&!n(ji)&&!n(Ea)&&(n(Ns)||n(Iu)),device:!n(jr)&&(n(ji)||n(Ns)||n(Ea)||n(Iu))||n(/\bokhttp\b/i)},windows:{phone:n(jr),tablet:n(Fu),device:n(jr)||n(Fu)},other:{blackberry:n(Bu),blackberry10:n(Du),opera:n(Ou),firefox:n(ku),chrome:n(Lu),device:n(Bu)||n(Du)||n(Ou)||n(ku)||n(Lu)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}const wm=Uu.default??Uu,Lr=wm(globalThis.navigator);ft.RETINA_PREFIX=/@([0-9\.]+)x/;ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Jn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ud(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Am(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var cd={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(u,c,m){this.fn=u,this.context=c,this.once=m||!1}function s(u,c,m,y,v){if(typeof m!="function")throw new TypeError("The listener must be a function");var b=new n(m,y||u,v),T=e?e+c:c;return u._events[T]?u._events[T].fn?u._events[T]=[u._events[T],b]:u._events[T].push(b):(u._events[T]=b,u._eventsCount++),u}function a(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function h(){this._events=new r,this._eventsCount=0}h.prototype.eventNames=function(){var c=[],m,y;if(this._eventsCount===0)return c;for(y in m=this._events)t.call(m,y)&&c.push(e?y.slice(1):y);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(m)):c},h.prototype.listeners=function(c){var m=e?e+c:c,y=this._events[m];if(!y)return[];if(y.fn)return[y.fn];for(var v=0,b=y.length,T=new Array(b);v<b;v++)T[v]=y[v].fn;return T},h.prototype.listenerCount=function(c){var m=e?e+c:c,y=this._events[m];return y?y.fn?1:y.length:0},h.prototype.emit=function(c,m,y,v,b,T){var E=e?e+c:c;if(!this._events[E])return!1;var P=this._events[E],M=arguments.length,D,R;if(P.fn){switch(P.once&&this.removeListener(c,P.fn,void 0,!0),M){case 1:return P.fn.call(P.context),!0;case 2:return P.fn.call(P.context,m),!0;case 3:return P.fn.call(P.context,m,y),!0;case 4:return P.fn.call(P.context,m,y,v),!0;case 5:return P.fn.call(P.context,m,y,v,b),!0;case 6:return P.fn.call(P.context,m,y,v,b,T),!0}for(R=1,D=new Array(M-1);R<M;R++)D[R-1]=arguments[R];P.fn.apply(P.context,D)}else{var N=P.length,Y;for(R=0;R<N;R++)switch(P[R].once&&this.removeListener(c,P[R].fn,void 0,!0),M){case 1:P[R].fn.call(P[R].context);break;case 2:P[R].fn.call(P[R].context,m);break;case 3:P[R].fn.call(P[R].context,m,y);break;case 4:P[R].fn.call(P[R].context,m,y,v);break;default:if(!D)for(Y=1,D=new Array(M-1);Y<M;Y++)D[Y-1]=arguments[Y];P[R].fn.apply(P[R].context,D)}}return!0},h.prototype.on=function(c,m,y){return s(this,c,m,y,!1)},h.prototype.once=function(c,m,y){return s(this,c,m,y,!0)},h.prototype.removeListener=function(c,m,y,v){var b=e?e+c:c;if(!this._events[b])return this;if(!m)return a(this,b),this;var T=this._events[b];if(T.fn)T.fn===m&&(!v||T.once)&&(!y||T.context===y)&&a(this,b);else{for(var E=0,P=[],M=T.length;E<M;E++)(T[E].fn!==m||v&&!T[E].once||y&&T[E].context!==y)&&P.push(T[E]);P.length?this._events[b]=P.length===1?P[0]:P:a(this,b)}return this},h.prototype.removeAllListeners=function(c){var m;return c?(m=e?e+c:c,this._events[m]&&a(this,m)):(this._events=new r,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prefixed=e,h.EventEmitter=h,i.exports=h})(cd);var Em=cd.exports;const _n=ud(Em);var yl={exports:{}};yl.exports=$o;yl.exports.default=$o;function $o(i,t,e){e=e||2;var r=t&&t.length,n=r?t[0]*e:i.length,s=dd(i,0,n,e,!0),a=[];if(!s||s.next===s.prev)return a;var h,u,c,m,y,v,b;if(r&&(s=Mm(i,t,s,e)),i.length>80*e){h=c=i[0],u=m=i[1];for(var T=e;T<n;T+=e)y=i[T],v=i[T+1],y<h&&(h=y),v<u&&(u=v),y>c&&(c=y),v>m&&(m=v);b=Math.max(c-h,m-u),b=b!==0?32767/b:0}return is(s,a,e,h,u,b,0),a}function dd(i,t,e,r,n){var s,a;if(n===yh(i,t,e,r)>0)for(s=t;s<e;s+=r)a=Gu(s,i[s],i[s+1],a);else for(s=e-r;s>=t;s-=r)a=Gu(s,i[s],i[s+1],a);return a&&Wo(a,a.next)&&(ss(a),a=a.next),a}function ki(i,t){if(!i)return i;t||(t=i);var e=i,r;do if(r=!1,!e.steiner&&(Wo(e,e.next)||le(e.prev,e,e.next)===0)){if(ss(e),e=t=e.prev,e===e.next)break;r=!0}else e=e.next;while(r||e!==t);return t}function is(i,t,e,r,n,s,a){if(i){!a&&s&&Om(i,r,n,s);for(var h=i,u,c;i.prev!==i.next;){if(u=i.prev,c=i.next,s?Cm(i,r,n,s):Sm(i)){t.push(u.i/e|0),t.push(i.i/e|0),t.push(c.i/e|0),ss(i),i=c.next,h=c.next;continue}if(i=c,i===h){a?a===1?(i=Pm(ki(i),t,e),is(i,t,e,r,n,s,2)):a===2&&Rm(i,t,e,r,n,s):is(ki(i),t,e,r,n,s,1);break}}}}function Sm(i){var t=i.prev,e=i,r=i.next;if(le(t,e,r)>=0)return!1;for(var n=t.x,s=e.x,a=r.x,h=t.y,u=e.y,c=r.y,m=n<s?n<a?n:a:s<a?s:a,y=h<u?h<c?h:c:u<c?u:c,v=n>s?n>a?n:a:s>a?s:a,b=h>u?h>c?h:c:u>c?u:c,T=r.next;T!==t;){if(T.x>=m&&T.x<=v&&T.y>=y&&T.y<=b&&nn(n,h,s,u,a,c,T.x,T.y)&&le(T.prev,T,T.next)>=0)return!1;T=T.next}return!0}function Cm(i,t,e,r){var n=i.prev,s=i,a=i.next;if(le(n,s,a)>=0)return!1;for(var h=n.x,u=s.x,c=a.x,m=n.y,y=s.y,v=a.y,b=h<u?h<c?h:c:u<c?u:c,T=m<y?m<v?m:v:y<v?y:v,E=h>u?h>c?h:c:u>c?u:c,P=m>y?m>v?m:v:y>v?y:v,M=mh(b,T,t,e,r),D=mh(E,P,t,e,r),R=i.prevZ,N=i.nextZ;R&&R.z>=M&&N&&N.z<=D;){if(R.x>=b&&R.x<=E&&R.y>=T&&R.y<=P&&R!==n&&R!==a&&nn(h,m,u,y,c,v,R.x,R.y)&&le(R.prev,R,R.next)>=0||(R=R.prevZ,N.x>=b&&N.x<=E&&N.y>=T&&N.y<=P&&N!==n&&N!==a&&nn(h,m,u,y,c,v,N.x,N.y)&&le(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;R&&R.z>=M;){if(R.x>=b&&R.x<=E&&R.y>=T&&R.y<=P&&R!==n&&R!==a&&nn(h,m,u,y,c,v,R.x,R.y)&&le(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;N&&N.z<=D;){if(N.x>=b&&N.x<=E&&N.y>=T&&N.y<=P&&N!==n&&N!==a&&nn(h,m,u,y,c,v,N.x,N.y)&&le(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function Pm(i,t,e){var r=i;do{var n=r.prev,s=r.next.next;!Wo(n,s)&&fd(n,r,r.next,s)&&ns(n,s)&&ns(s,n)&&(t.push(n.i/e|0),t.push(r.i/e|0),t.push(s.i/e|0),ss(r),ss(r.next),r=i=s),r=r.next}while(r!==i);return ki(r)}function Rm(i,t,e,r,n,s){var a=i;do{for(var h=a.next.next;h!==a.prev;){if(a.i!==h.i&&Nm(a,h)){var u=pd(a,h);a=ki(a,a.next),u=ki(u,u.next),is(a,t,e,r,n,s,0),is(u,t,e,r,n,s,0);return}h=h.next}a=a.next}while(a!==i)}function Mm(i,t,e,r){var n=[],s,a,h,u,c;for(s=0,a=t.length;s<a;s++)h=t[s]*r,u=s<a-1?t[s+1]*r:i.length,c=dd(i,h,u,r,!1),c===c.next&&(c.steiner=!0),n.push(km(c));for(n.sort(Im),s=0;s<n.length;s++)e=Fm(n[s],e);return e}function Im(i,t){return i.x-t.x}function Fm(i,t){var e=Bm(i,t);if(!e)return t;var r=pd(e,i);return ki(r,r.next),ki(e,e.next)}function Bm(i,t){var e=t,r=i.x,n=i.y,s=-1/0,a;do{if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){var h=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=r&&h>s&&(s=h,a=e.x<e.next.x?e:e.next,h===r))return a}e=e.next}while(e!==t);if(!a)return null;var u=a,c=a.x,m=a.y,y=1/0,v;e=a;do r>=e.x&&e.x>=c&&r!==e.x&&nn(n<m?r:s,n,c,m,n<m?s:r,n,e.x,e.y)&&(v=Math.abs(n-e.y)/(r-e.x),ns(e,i)&&(v<y||v===y&&(e.x>a.x||e.x===a.x&&Dm(a,e)))&&(a=e,y=v)),e=e.next;while(e!==u);return a}function Dm(i,t){return le(i.prev,i,t.prev)<0&&le(t.next,i,i.next)<0}function Om(i,t,e,r){var n=i;do n.z===0&&(n.z=mh(n.x,n.y,t,e,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,Lm(n)}function Lm(i){var t,e,r,n,s,a,h,u,c=1;do{for(e=i,i=null,s=null,a=0;e;){for(a++,r=e,h=0,t=0;t<c&&(h++,r=r.nextZ,!!r);t++);for(u=c;h>0||u>0&&r;)h!==0&&(u===0||!r||e.z<=r.z)?(n=e,e=e.nextZ,h--):(n=r,r=r.nextZ,u--),s?s.nextZ=n:i=n,n.prevZ=s,s=n;e=r}s.nextZ=null,c*=2}while(a>1);return i}function mh(i,t,e,r,n){return i=(i-e)*n|0,t=(t-r)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function km(i){var t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function nn(i,t,e,r,n,s,a,h){return(n-a)*(t-h)>=(i-a)*(s-h)&&(i-a)*(r-h)>=(e-a)*(t-h)&&(e-a)*(s-h)>=(n-a)*(r-h)}function Nm(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!Um(i,t)&&(ns(i,t)&&ns(t,i)&&Gm(i,t)&&(le(i.prev,i,t.prev)||le(i,t.prev,t))||Wo(i,t)&&le(i.prev,i,i.next)>0&&le(t.prev,t,t.next)>0)}function le(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Wo(i,t){return i.x===t.x&&i.y===t.y}function fd(i,t,e,r){var n=Gs(le(i,t,e)),s=Gs(le(i,t,r)),a=Gs(le(e,r,i)),h=Gs(le(e,r,t));return!!(n!==s&&a!==h||n===0&&Us(i,e,t)||s===0&&Us(i,r,t)||a===0&&Us(e,i,r)||h===0&&Us(e,t,r))}function Us(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Gs(i){return i>0?1:i<0?-1:0}function Um(i,t){var e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&fd(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function ns(i,t){return le(i.prev,i,i.next)<0?le(i,t,i.next)>=0&&le(i,i.prev,t)>=0:le(i,t,i.prev)<0||le(i,i.next,t)<0}function Gm(i,t){var e=i,r=!1,n=(i.x+t.x)/2,s=(i.y+t.y)/2;do e.y>s!=e.next.y>s&&e.next.y!==e.y&&n<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next;while(e!==i);return r}function pd(i,t){var e=new gh(i.i,i.x,i.y),r=new gh(t.i,t.x,t.y),n=i.next,s=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function Gu(i,t,e,r){var n=new gh(i,t,e);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function ss(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function gh(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}$o.deviation=function(i,t,e,r){var n=t&&t.length,s=n?t[0]*e:i.length,a=Math.abs(yh(i,0,s,e));if(n)for(var h=0,u=t.length;h<u;h++){var c=t[h]*e,m=h<u-1?t[h+1]*e:i.length;a-=Math.abs(yh(i,c,m,e))}var y=0;for(h=0;h<r.length;h+=3){var v=r[h]*e,b=r[h+1]*e,T=r[h+2]*e;y+=Math.abs((i[v]-i[T])*(i[b+1]-i[v+1])-(i[v]-i[b])*(i[T+1]-i[v+1]))}return a===0&&y===0?0:Math.abs((y-a)/a)};function yh(i,t,e,r){for(var n=0,s=t,a=e-r;s<e;s+=r)n+=(i[a]-i[s])*(i[s+1]+i[a+1]),a=s;return n}$o.flatten=function(i){for(var t=i[0][0].length,e={vertices:[],holes:[],dimensions:t},r=0,n=0;n<i.length;n++){for(var s=0;s<i[n].length;s++)for(var a=0;a<t;a++)e.vertices.push(i[n][s][a]);n>0&&(r+=i[n-1].length,e.holes.push(r))}return e};var Hm=yl.exports;const md=ud(Hm);var wo={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */wo.exports;(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,s=typeof Jn=="object"&&Jn;(s.global===s||s.window===s||s.self===s)&&(e=s);var a,h=2147483647,u=36,c=1,m=26,y=38,v=700,b=72,T=128,E="-",P=/^xn--/,M=/[^\x20-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,R={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},N=u-c,Y=Math.floor,X=String.fromCharCode,K;function q(lt){throw new RangeError(R[lt])}function j(lt,ct){for(var Mt=lt.length,Dt=[];Mt--;)Dt[Mt]=ct(lt[Mt]);return Dt}function st(lt,ct){var Mt=lt.split("@"),Dt="";Mt.length>1&&(Dt=Mt[0]+"@",lt=Mt[1]),lt=lt.replace(D,".");var Gt=lt.split("."),zt=j(Gt,ct).join(".");return Dt+zt}function yt(lt){for(var ct=[],Mt=0,Dt=lt.length,Gt,zt;Mt<Dt;)Gt=lt.charCodeAt(Mt++),Gt>=55296&&Gt<=56319&&Mt<Dt?(zt=lt.charCodeAt(Mt++),(zt&64512)==56320?ct.push(((Gt&1023)<<10)+(zt&1023)+65536):(ct.push(Gt),Mt--)):ct.push(Gt);return ct}function $(lt){return j(lt,function(ct){var Mt="";return ct>65535&&(ct-=65536,Mt+=X(ct>>>10&1023|55296),ct=56320|ct&1023),Mt+=X(ct),Mt}).join("")}function H(lt){return lt-48<10?lt-22:lt-65<26?lt-65:lt-97<26?lt-97:u}function z(lt,ct){return lt+22+75*(lt<26)-((ct!=0)<<5)}function vt(lt,ct,Mt){var Dt=0;for(lt=Mt?Y(lt/v):lt>>1,lt+=Y(lt/ct);lt>N*m>>1;Dt+=u)lt=Y(lt/N);return Y(Dt+(N+1)*lt/(lt+y))}function Pt(lt){var ct=[],Mt=lt.length,Dt,Gt=0,zt=T,Nt=b,Zt,te,de,Qt,se,ue,he,$e,Te;for(Zt=lt.lastIndexOf(E),Zt<0&&(Zt=0),te=0;te<Zt;++te)lt.charCodeAt(te)>=128&&q("not-basic"),ct.push(lt.charCodeAt(te));for(de=Zt>0?Zt+1:0;de<Mt;){for(Qt=Gt,se=1,ue=u;de>=Mt&&q("invalid-input"),he=H(lt.charCodeAt(de++)),(he>=u||he>Y((h-Gt)/se))&&q("overflow"),Gt+=he*se,$e=ue<=Nt?c:ue>=Nt+m?m:ue-Nt,!(he<$e);ue+=u)Te=u-$e,se>Y(h/Te)&&q("overflow"),se*=Te;Dt=ct.length+1,Nt=vt(Gt-Qt,Dt,Qt==0),Y(Gt/Dt)>h-zt&&q("overflow"),zt+=Y(Gt/Dt),Gt%=Dt,ct.splice(Gt++,0,zt)}return $(ct)}function dt(lt){var ct,Mt,Dt,Gt,zt,Nt,Zt,te,de,Qt,se,ue=[],he,$e,Te,br;for(lt=yt(lt),he=lt.length,ct=T,Mt=0,zt=b,Nt=0;Nt<he;++Nt)se=lt[Nt],se<128&&ue.push(X(se));for(Dt=Gt=ue.length,Gt&&ue.push(E);Dt<he;){for(Zt=h,Nt=0;Nt<he;++Nt)se=lt[Nt],se>=ct&&se<Zt&&(Zt=se);for($e=Dt+1,Zt-ct>Y((h-Mt)/$e)&&q("overflow"),Mt+=(Zt-ct)*$e,ct=Zt,Nt=0;Nt<he;++Nt)if(se=lt[Nt],se<ct&&++Mt>h&&q("overflow"),se==ct){for(te=Mt,de=u;Qt=de<=zt?c:de>=zt+m?m:de-zt,!(te<Qt);de+=u)br=te-Qt,Te=u-Qt,ue.push(X(z(Qt+br%Te,0))),te=Y(br/Te);ue.push(X(z(te,0))),zt=vt(Mt,$e,Dt==Gt),Mt=0,++Dt}++Mt,++ct}return ue.join("")}function St(lt){return st(lt,function(ct){return P.test(ct)?Pt(ct.slice(4).toLowerCase()):ct})}function Kt(lt){return st(lt,function(ct){return M.test(ct)?"xn--"+dt(ct):ct})}if(a={version:"1.4.1",ucs2:{decode:yt,encode:$},decode:Pt,encode:dt,toASCII:Kt,toUnicode:St},r&&n)if(i.exports==r)n.exports=a;else for(K in a)a.hasOwnProperty(K)&&(r[K]=a[K]);else e.punycode=a})(Jn)})(wo,wo.exports);var $m=wo.exports,xn=TypeError;const Wm={},Vm=Object.freeze(Object.defineProperty({__proto__:null,default:Wm},Symbol.toStringTag,{value:"Module"})),jm=Am(Vm);var vl=typeof Map=="function"&&Map.prototype,Sa=Object.getOwnPropertyDescriptor&&vl?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Ao=vl&&Sa&&typeof Sa.get=="function"?Sa.get:null,Hu=vl&&Map.prototype.forEach,_l=typeof Set=="function"&&Set.prototype,Ca=Object.getOwnPropertyDescriptor&&_l?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Eo=_l&&Ca&&typeof Ca.get=="function"?Ca.get:null,$u=_l&&Set.prototype.forEach,zm=typeof WeakMap=="function"&&WeakMap.prototype,Qn=zm?WeakMap.prototype.has:null,Xm=typeof WeakSet=="function"&&WeakSet.prototype,ts=Xm?WeakSet.prototype.has:null,Ym=typeof WeakRef=="function"&&WeakRef.prototype,Wu=Ym?WeakRef.prototype.deref:null,qm=Boolean.prototype.valueOf,Km=Object.prototype.toString,Zm=Function.prototype.toString,Jm=String.prototype.match,xl=String.prototype.slice,li=String.prototype.replace,Qm=String.prototype.toUpperCase,Vu=String.prototype.toLowerCase,gd=RegExp.prototype.test,ju=Array.prototype.concat,Or=Array.prototype.join,tg=Array.prototype.slice,zu=Math.floor,vh=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Pa=Object.getOwnPropertySymbols,_h=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,pn=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Oe=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===pn||"symbol")?Symbol.toStringTag:null,yd=Object.prototype.propertyIsEnumerable,Xu=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(i){return i.__proto__}:null);function Yu(i,t){if(i===1/0||i===-1/0||i!==i||i&&i>-1e3&&i<1e3||gd.call(/e/,t))return t;var e=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof i=="number"){var r=i<0?-zu(-i):zu(i);if(r!==i){var n=String(r),s=xl.call(t,n.length+1);return li.call(n,e,"$&_")+"."+li.call(li.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return li.call(t,e,"$&_")}var xh=jm,qu=xh.custom,Ku=xd(qu)?qu:null,vd={__proto__:null,double:'"',single:"'"},eg={__proto__:null,double:/(["\\])/g,single:/(['\\])/g},Vo=function i(t,e,r,n){var s=e||{};if(Xr(s,"quoteStyle")&&!Xr(vd,s.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Xr(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=Xr(s,"customInspect")?s.customInspect:!0;if(typeof a!="boolean"&&a!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Xr(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Xr(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var h=s.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return Td(t,s);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var u=String(t);return h?Yu(t,u):u}if(typeof t=="bigint"){var c=String(t)+"n";return h?Yu(t,c):c}var m=typeof s.depth>"u"?5:s.depth;if(typeof r>"u"&&(r=0),r>=m&&m>0&&typeof t=="object")return bh(t)?"[Array]":"[Object]";var y=_g(s,r);if(typeof n>"u")n=[];else if(bd(n,t)>=0)return"[Circular]";function v(H,z,vt){if(z&&(n=tg.call(n),n.push(z)),vt){var Pt={depth:s.depth};return Xr(s,"quoteStyle")&&(Pt.quoteStyle=s.quoteStyle),i(H,Pt,r+1,n)}return i(H,s,r+1,n)}if(typeof t=="function"&&!Zu(t)){var b=ug(t),T=Hs(t,v);return"[Function"+(b?": "+b:" (anonymous)")+"]"+(T.length>0?" { "+Or.call(T,", ")+" }":"")}if(xd(t)){var E=pn?li.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):_h.call(t);return typeof t=="object"&&!pn?Ln(E):E}if(gg(t)){for(var P="<"+Vu.call(String(t.nodeName)),M=t.attributes||[],D=0;D<M.length;D++)P+=" "+M[D].name+"="+_d(rg(M[D].value),"double",s);return P+=">",t.childNodes&&t.childNodes.length&&(P+="..."),P+="</"+Vu.call(String(t.nodeName))+">",P}if(bh(t)){if(t.length===0)return"[]";var R=Hs(t,v);return y&&!vg(R)?"["+Th(R,y)+"]":"[ "+Or.call(R,", ")+" ]"}if(ng(t)){var N=Hs(t,v);return!("cause"in Error.prototype)&&"cause"in t&&!yd.call(t,"cause")?"{ ["+String(t)+"] "+Or.call(ju.call("[cause]: "+v(t.cause),N),", ")+" }":N.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Or.call(N,", ")+" }"}if(typeof t=="object"&&a){if(Ku&&typeof t[Ku]=="function"&&xh)return xh(t,{depth:m-r});if(a!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(cg(t)){var Y=[];return Hu&&Hu.call(t,function(H,z){Y.push(v(z,t,!0)+" => "+v(H,t))}),Ju("Map",Ao.call(t),Y,y)}if(pg(t)){var X=[];return $u&&$u.call(t,function(H){X.push(v(H,t))}),Ju("Set",Eo.call(t),X,y)}if(dg(t))return Ra("WeakMap");if(mg(t))return Ra("WeakSet");if(fg(t))return Ra("WeakRef");if(og(t))return Ln(v(Number(t)));if(hg(t))return Ln(v(vh.call(t)));if(ag(t))return Ln(qm.call(t));if(sg(t))return Ln(v(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(typeof globalThis<"u"&&t===globalThis||typeof Jn<"u"&&t===Jn)return"{ [object globalThis] }";if(!ig(t)&&!Zu(t)){var K=Hs(t,v),q=Xu?Xu(t)===Object.prototype:t instanceof Object||t.constructor===Object,j=t instanceof Object?"":"null prototype",st=!q&&Oe&&Object(t)===t&&Oe in t?xl.call(mi(t),8,-1):j?"Object":"",yt=q||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",$=yt+(st||j?"["+Or.call(ju.call([],st||[],j||[]),": ")+"] ":"");return K.length===0?$+"{}":y?$+"{"+Th(K,y)+"}":$+"{ "+Or.call(K,", ")+" }"}return String(t)};function _d(i,t,e){var r=e.quoteStyle||t,n=vd[r];return n+i+n}function rg(i){return li.call(String(i),/"/g,"&quot;")}function bh(i){return mi(i)==="[object Array]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function ig(i){return mi(i)==="[object Date]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function Zu(i){return mi(i)==="[object RegExp]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function ng(i){return mi(i)==="[object Error]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function sg(i){return mi(i)==="[object String]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function og(i){return mi(i)==="[object Number]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function ag(i){return mi(i)==="[object Boolean]"&&(!Oe||!(typeof i=="object"&&Oe in i))}function xd(i){if(pn)return i&&typeof i=="object"&&i instanceof Symbol;if(typeof i=="symbol")return!0;if(!i||typeof i!="object"||!_h)return!1;try{return _h.call(i),!0}catch{}return!1}function hg(i){if(!i||typeof i!="object"||!vh)return!1;try{return vh.call(i),!0}catch{}return!1}var lg=Object.prototype.hasOwnProperty||function(i){return i in this};function Xr(i,t){return lg.call(i,t)}function mi(i){return Km.call(i)}function ug(i){if(i.name)return i.name;var t=Jm.call(Zm.call(i),/^function\s*([\w$]+)/);return t?t[1]:null}function bd(i,t){if(i.indexOf)return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1}function cg(i){if(!Ao||!i||typeof i!="object")return!1;try{Ao.call(i);try{Eo.call(i)}catch{return!0}return i instanceof Map}catch{}return!1}function dg(i){if(!Qn||!i||typeof i!="object")return!1;try{Qn.call(i,Qn);try{ts.call(i,ts)}catch{return!0}return i instanceof WeakMap}catch{}return!1}function fg(i){if(!Wu||!i||typeof i!="object")return!1;try{return Wu.call(i),!0}catch{}return!1}function pg(i){if(!Eo||!i||typeof i!="object")return!1;try{Eo.call(i);try{Ao.call(i)}catch{return!0}return i instanceof Set}catch{}return!1}function mg(i){if(!ts||!i||typeof i!="object")return!1;try{ts.call(i,ts);try{Qn.call(i,Qn)}catch{return!0}return i instanceof WeakSet}catch{}return!1}function gg(i){return!i||typeof i!="object"?!1:typeof HTMLElement<"u"&&i instanceof HTMLElement?!0:typeof i.nodeName=="string"&&typeof i.getAttribute=="function"}function Td(i,t){if(i.length>t.maxStringLength){var e=i.length-t.maxStringLength,r="... "+e+" more character"+(e>1?"s":"");return Td(xl.call(i,0,t.maxStringLength),t)+r}var n=eg[t.quoteStyle||"single"];n.lastIndex=0;var s=li.call(li.call(i,n,"\\$1"),/[\x00-\x1f]/g,yg);return _d(s,"single",t)}function yg(i){var t=i.charCodeAt(0),e={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return e?"\\"+e:"\\x"+(t<16?"0":"")+Qm.call(t.toString(16))}function Ln(i){return"Object("+i+")"}function Ra(i){return i+" { ? }"}function Ju(i,t,e,r){var n=r?Th(e,r):Or.call(e,", ");return i+" ("+t+") {"+n+"}"}function vg(i){for(var t=0;t<i.length;t++)if(bd(i[t],`
`)>=0)return!1;return!0}function _g(i,t){var e;if(i.indent==="	")e="	";else if(typeof i.indent=="number"&&i.indent>0)e=Or.call(Array(i.indent+1)," ");else return null;return{base:e,prev:Or.call(Array(t+1),e)}}function Th(i,t){if(i.length===0)return"";var e=`
`+t.prev+t.base;return e+Or.call(i,","+e)+`
`+t.prev}function Hs(i,t){var e=bh(i),r=[];if(e){r.length=i.length;for(var n=0;n<i.length;n++)r[n]=Xr(i,n)?t(i[n],i):""}var s=typeof Pa=="function"?Pa(i):[],a;if(pn){a={};for(var h=0;h<s.length;h++)a["$"+s[h]]=s[h]}for(var u in i)Xr(i,u)&&(e&&String(Number(u))===u&&u<i.length||pn&&a["$"+u]instanceof Symbol||(gd.call(/[^\w$]/,u)?r.push(t(u,i)+": "+t(i[u],i)):r.push(u+": "+t(i[u],i))));if(typeof Pa=="function")for(var c=0;c<s.length;c++)yd.call(i,s[c])&&r.push("["+t(s[c])+"]: "+t(i[s[c]],i));return r}var xg=Vo,bg=xn,jo=function(i,t,e){for(var r=i,n;(n=r.next)!=null;r=n)if(n.key===t)return r.next=n.next,e||(n.next=i.next,i.next=n),n},Tg=function(i,t){if(i){var e=jo(i,t);return e&&e.value}},wg=function(i,t,e){var r=jo(i,t);r?r.value=e:i.next={key:t,next:i.next,value:e}},Ag=function(i,t){return i?!!jo(i,t):!1},Eg=function(i,t){if(i)return jo(i,t,!0)},Sg=function(){var t,e={assert:function(r){if(!e.has(r))throw new bg("Side channel does not contain "+xg(r))},delete:function(r){var n=t&&t.next,s=Eg(t,r);return s&&n&&n===s&&(t=void 0),!!s},get:function(r){return Tg(t,r)},has:function(r){return Ag(t,r)},set:function(r,n){t||(t={next:void 0}),wg(t,r,n)}};return e},Cg=Object,Pg=Error,Rg=EvalError,Mg=RangeError,Ig=ReferenceError,Fg=SyntaxError,Bg=URIError,Dg=Math.abs,Og=Math.floor,Lg=Math.max,kg=Math.min,Ng=Math.pow,Ug=Object.getOwnPropertyDescriptor,uo=Ug;if(uo)try{uo([],"length")}catch{uo=null}var wd=uo,co=Object.defineProperty||!1;if(co)try{co({},"a",{value:1})}catch{co=!1}var Gg=co,Ma,Qu;function Hg(){return Qu||(Qu=1,Ma=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var a=Object.getOwnPropertySymbols(t);if(a.length!==1||a[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var h=Object.getOwnPropertyDescriptor(t,e);if(h.value!==n||h.enumerable!==!0)return!1}return!0}),Ma}var Ia,tc;function $g(){if(tc)return Ia;tc=1;var i=typeof Symbol<"u"&&Symbol,t=Hg();return Ia=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},Ia}var Wg="Function.prototype.bind called on incompatible ",Vg=Object.prototype.toString,jg=Math.max,zg="[object Function]",ec=function(t,e){for(var r=[],n=0;n<t.length;n+=1)r[n]=t[n];for(var s=0;s<e.length;s+=1)r[s+t.length]=e[s];return r},Xg=function(t,e){for(var r=[],n=e||0,s=0;n<t.length;n+=1,s+=1)r[s]=t[n];return r},Yg=function(i,t){for(var e="",r=0;r<i.length;r+=1)e+=i[r],r+1<i.length&&(e+=t);return e},qg=function(t){var e=this;if(typeof e!="function"||Vg.apply(e)!==zg)throw new TypeError(Wg+e);for(var r=Xg(arguments,1),n,s=function(){if(this instanceof n){var m=e.apply(this,ec(r,arguments));return Object(m)===m?m:this}return e.apply(t,ec(r,arguments))},a=jg(0,e.length-r.length),h=[],u=0;u<a;u++)h[u]="$"+u;if(n=Function("binder","return function ("+Yg(h,",")+"){ return binder.apply(this,arguments); }")(s),e.prototype){var c=function(){};c.prototype=e.prototype,n.prototype=new c,c.prototype=null}return n},Kg=qg,zo=Function.prototype.bind||Kg,bl=Function.prototype.call,Fa,rc;function Ad(){return rc||(rc=1,Fa=Function.prototype.apply),Fa}var Zg=typeof Reflect<"u"&&Reflect&&Reflect.apply,Jg=zo,Qg=Ad(),ty=bl,ey=Zg,ry=ey||Jg.call(ty,Qg),iy=zo,ny=xn,sy=bl,oy=ry,Ed=function(t){if(t.length<1||typeof t[0]!="function")throw new ny("a function is required");return oy(iy,sy,t)},Ba,ic;function ay(){if(ic)return Ba;ic=1;var i=Ed,t=wd,e;try{e=[].__proto__===Array.prototype}catch(a){if(!a||typeof a!="object"||!("code"in a)||a.code!=="ERR_PROTO_ACCESS")throw a}var r=!!e&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return Ba=r&&typeof r.get=="function"?i([r.get]):typeof s=="function"?function(h){return s(h==null?h:n(h))}:!1,Ba}var Da,nc;function hy(){if(nc)return Da;nc=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=zo;return Da=e.call(i,t),Da}var jt,Sd=Cg,ly=Pg,uy=Rg,cy=Mg,dy=Ig,mn=Fg,hn=xn,fy=Bg,py=Dg,my=Og,gy=Lg,yy=kg,vy=Ng,Cd=Function,Oa=function(i){try{return Cd('"use strict"; return ('+i+").constructor;")()}catch{}},os=wd,_y=Gg,La=function(){throw new hn},xy=os?function(){try{return arguments.callee,La}catch{try{return os(arguments,"callee").get}catch{return La}}}():La,zi=$g()(),by=ay(),Se=typeof Reflect=="function"&&Reflect.getPrototypeOf||Sd.getPrototypeOf||by,Pd=Ad(),us=bl,Ki={},Ty=typeof Uint8Array>"u"||!Se?jt:Se(Uint8Array),Di={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?jt:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?jt:ArrayBuffer,"%ArrayIteratorPrototype%":zi&&Se?Se([][Symbol.iterator]()):jt,"%AsyncFromSyncIteratorPrototype%":jt,"%AsyncFunction%":Ki,"%AsyncGenerator%":Ki,"%AsyncGeneratorFunction%":Ki,"%AsyncIteratorPrototype%":Ki,"%Atomics%":typeof Atomics>"u"?jt:Atomics,"%BigInt%":typeof BigInt>"u"?jt:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?jt:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?jt:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?jt:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":ly,"%eval%":eval,"%EvalError%":uy,"%Float32Array%":typeof Float32Array>"u"?jt:Float32Array,"%Float64Array%":typeof Float64Array>"u"?jt:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?jt:FinalizationRegistry,"%Function%":Cd,"%GeneratorFunction%":Ki,"%Int8Array%":typeof Int8Array>"u"?jt:Int8Array,"%Int16Array%":typeof Int16Array>"u"?jt:Int16Array,"%Int32Array%":typeof Int32Array>"u"?jt:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":zi&&Se?Se(Se([][Symbol.iterator]())):jt,"%JSON%":typeof JSON=="object"?JSON:jt,"%Map%":typeof Map>"u"?jt:Map,"%MapIteratorPrototype%":typeof Map>"u"||!zi||!Se?jt:Se(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Sd,"%Object.getOwnPropertyDescriptor%":os,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?jt:Promise,"%Proxy%":typeof Proxy>"u"?jt:Proxy,"%RangeError%":cy,"%ReferenceError%":dy,"%Reflect%":typeof Reflect>"u"?jt:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?jt:Set,"%SetIteratorPrototype%":typeof Set>"u"||!zi||!Se?jt:Se(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?jt:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":zi&&Se?Se(""[Symbol.iterator]()):jt,"%Symbol%":zi?Symbol:jt,"%SyntaxError%":mn,"%ThrowTypeError%":xy,"%TypedArray%":Ty,"%TypeError%":hn,"%Uint8Array%":typeof Uint8Array>"u"?jt:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?jt:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?jt:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?jt:Uint32Array,"%URIError%":fy,"%WeakMap%":typeof WeakMap>"u"?jt:WeakMap,"%WeakRef%":typeof WeakRef>"u"?jt:WeakRef,"%WeakSet%":typeof WeakSet>"u"?jt:WeakSet,"%Function.prototype.call%":us,"%Function.prototype.apply%":Pd,"%Object.defineProperty%":_y,"%Math.abs%":py,"%Math.floor%":my,"%Math.max%":gy,"%Math.min%":yy,"%Math.pow%":vy};if(Se)try{null.error}catch(i){var wy=Se(Se(i));Di["%Error.prototype%"]=wy}var Ay=function i(t){var e;if(t==="%AsyncFunction%")e=Oa("async function () {}");else if(t==="%GeneratorFunction%")e=Oa("function* () {}");else if(t==="%AsyncGeneratorFunction%")e=Oa("async function* () {}");else if(t==="%AsyncGenerator%"){var r=i("%AsyncGeneratorFunction%");r&&(e=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var n=i("%AsyncGenerator%");n&&Se&&(e=Se(n.prototype))}return Di[t]=e,e},sc={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},cs=zo,So=hy(),Ey=cs.call(us,Array.prototype.concat),Sy=cs.call(Pd,Array.prototype.splice),oc=cs.call(us,String.prototype.replace),Co=cs.call(us,String.prototype.slice),Cy=cs.call(us,RegExp.prototype.exec),Py=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Ry=/\\(\\)?/g,My=function(t){var e=Co(t,0,1),r=Co(t,-1);if(e==="%"&&r!=="%")throw new mn("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&e!=="%")throw new mn("invalid intrinsic syntax, expected opening `%`");var n=[];return oc(t,Py,function(s,a,h,u){n[n.length]=h?oc(u,Ry,"$1"):a||s}),n},Iy=function(t,e){var r=t,n;if(So(sc,r)&&(n=sc[r],r="%"+n[0]+"%"),So(Di,r)){var s=Di[r];if(s===Ki&&(s=Ay(r)),typeof s>"u"&&!e)throw new hn("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:s}}throw new mn("intrinsic "+t+" does not exist!")},Tl=function(t,e){if(typeof t!="string"||t.length===0)throw new hn("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof e!="boolean")throw new hn('"allowMissing" argument must be a boolean');if(Cy(/^%?[^%]*%?$/,t)===null)throw new mn("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=My(t),n=r.length>0?r[0]:"",s=Iy("%"+n+"%",e),a=s.name,h=s.value,u=!1,c=s.alias;c&&(n=c[0],Sy(r,Ey([0,1],c)));for(var m=1,y=!0;m<r.length;m+=1){var v=r[m],b=Co(v,0,1),T=Co(v,-1);if((b==='"'||b==="'"||b==="`"||T==='"'||T==="'"||T==="`")&&b!==T)throw new mn("property names with quotes must have matching quotes");if((v==="constructor"||!y)&&(u=!0),n+="."+v,a="%"+n+"%",So(Di,a))h=Di[a];else if(h!=null){if(!(v in h)){if(!e)throw new hn("base intrinsic for "+t+" exists, but the property is not available.");return}if(os&&m+1>=r.length){var E=os(h,v);y=!!E,y&&"get"in E&&!("originalValue"in E.get)?h=E.get:h=h[v]}else y=So(h,v),h=h[v];y&&!u&&(Di[a]=h)}}return h},Rd=Tl,Md=Ed,Fy=Md([Rd("%String.prototype.indexOf%")]),Id=function(t,e){var r=Rd(t,!!e);return typeof r=="function"&&Fy(t,".prototype.")>-1?Md([r]):r},By=Tl,ds=Id,Dy=Vo,Oy=xn,ac=By("%Map%",!0),Ly=ds("Map.prototype.get",!0),ky=ds("Map.prototype.set",!0),Ny=ds("Map.prototype.has",!0),Uy=ds("Map.prototype.delete",!0),Gy=ds("Map.prototype.size",!0),Fd=!!ac&&function(){var t,e={assert:function(r){if(!e.has(r))throw new Oy("Side channel does not contain "+Dy(r))},delete:function(r){if(t){var n=Uy(t,r);return Gy(t)===0&&(t=void 0),n}return!1},get:function(r){if(t)return Ly(t,r)},has:function(r){return t?Ny(t,r):!1},set:function(r,n){t||(t=new ac),ky(t,r,n)}};return e},Hy=Tl,Xo=Id,$y=Vo,$s=Fd,Wy=xn,Xi=Hy("%WeakMap%",!0),Vy=Xo("WeakMap.prototype.get",!0),jy=Xo("WeakMap.prototype.set",!0),zy=Xo("WeakMap.prototype.has",!0),Xy=Xo("WeakMap.prototype.delete",!0),Yy=Xi?function(){var t,e,r={assert:function(n){if(!r.has(n))throw new Wy("Side channel does not contain "+$y(n))},delete:function(n){if(Xi&&n&&(typeof n=="object"||typeof n=="function")){if(t)return Xy(t,n)}else if($s&&e)return e.delete(n);return!1},get:function(n){return Xi&&n&&(typeof n=="object"||typeof n=="function")&&t?Vy(t,n):e&&e.get(n)},has:function(n){return Xi&&n&&(typeof n=="object"||typeof n=="function")&&t?zy(t,n):!!e&&e.has(n)},set:function(n,s){Xi&&n&&(typeof n=="object"||typeof n=="function")?(t||(t=new Xi),jy(t,n,s)):$s&&(e||(e=$s()),e.set(n,s))}};return r}:$s,qy=xn,Ky=Vo,Zy=Sg,Jy=Fd,Qy=Yy,t0=Qy||Jy||Zy,e0=function(){var t,e={assert:function(r){if(!e.has(r))throw new qy("Side channel does not contain "+Ky(r))},delete:function(r){return!!t&&t.delete(r)},get:function(r){return t&&t.get(r)},has:function(r){return!!t&&t.has(r)},set:function(r,n){t||(t=t0()),t.set(r,n)}};return e},r0=String.prototype.replace,i0=/%20/g,ka={RFC1738:"RFC1738",RFC3986:"RFC3986"},wl={default:ka.RFC3986,formatters:{RFC1738:function(i){return r0.call(i,i0,"+")},RFC3986:function(i){return String(i)}},RFC1738:ka.RFC1738,RFC3986:ka.RFC3986},n0=wl,Na=Object.prototype.hasOwnProperty,Fi=Array.isArray,Cr=function(){for(var i=[],t=0;t<256;++t)i.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return i}(),s0=function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(Fi(r)){for(var n=[],s=0;s<r.length;++s)typeof r[s]<"u"&&n.push(r[s]);e.obj[e.prop]=n}}},Bd=function(t,e){for(var r=e&&e.plainObjects?{__proto__:null}:{},n=0;n<t.length;++n)typeof t[n]<"u"&&(r[n]=t[n]);return r},o0=function i(t,e,r){if(!e)return t;if(typeof e!="object"&&typeof e!="function"){if(Fi(t))t.push(e);else if(t&&typeof t=="object")(r&&(r.plainObjects||r.allowPrototypes)||!Na.call(Object.prototype,e))&&(t[e]=!0);else return[t,e];return t}if(!t||typeof t!="object")return[t].concat(e);var n=t;return Fi(t)&&!Fi(e)&&(n=Bd(t,r)),Fi(t)&&Fi(e)?(e.forEach(function(s,a){if(Na.call(t,a)){var h=t[a];h&&typeof h=="object"&&s&&typeof s=="object"?t[a]=i(h,s,r):t.push(s)}else t[a]=s}),t):Object.keys(e).reduce(function(s,a){var h=e[a];return Na.call(s,a)?s[a]=i(s[a],h,r):s[a]=h,s},n)},a0=function(t,e){return Object.keys(e).reduce(function(r,n){return r[n]=e[n],r},t)},h0=function(i,t,e){var r=i.replace(/\+/g," ");if(e==="iso-8859-1")return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch{return r}},Ua=1024,l0=function(t,e,r,n,s){if(t.length===0)return t;var a=t;if(typeof t=="symbol"?a=Symbol.prototype.toString.call(t):typeof t!="string"&&(a=String(t)),r==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(b){return"%26%23"+parseInt(b.slice(2),16)+"%3B"});for(var h="",u=0;u<a.length;u+=Ua){for(var c=a.length>=Ua?a.slice(u,u+Ua):a,m=[],y=0;y<c.length;++y){var v=c.charCodeAt(y);if(v===45||v===46||v===95||v===126||v>=48&&v<=57||v>=65&&v<=90||v>=97&&v<=122||s===n0.RFC1738&&(v===40||v===41)){m[m.length]=c.charAt(y);continue}if(v<128){m[m.length]=Cr[v];continue}if(v<2048){m[m.length]=Cr[192|v>>6]+Cr[128|v&63];continue}if(v<55296||v>=57344){m[m.length]=Cr[224|v>>12]+Cr[128|v>>6&63]+Cr[128|v&63];continue}y+=1,v=65536+((v&1023)<<10|c.charCodeAt(y)&1023),m[m.length]=Cr[240|v>>18]+Cr[128|v>>12&63]+Cr[128|v>>6&63]+Cr[128|v&63]}h+=m.join("")}return h},u0=function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var s=e[n],a=s.obj[s.prop],h=Object.keys(a),u=0;u<h.length;++u){var c=h[u],m=a[c];typeof m=="object"&&m!==null&&r.indexOf(m)===-1&&(e.push({obj:a,prop:c}),r.push(m))}return s0(e),t},c0=function(t){return Object.prototype.toString.call(t)==="[object RegExp]"},d0=function(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},f0=function(t,e){return[].concat(t,e)},p0=function(t,e){if(Fi(t)){for(var r=[],n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)},Dd={arrayToObject:Bd,assign:a0,combine:f0,compact:u0,decode:h0,encode:l0,isBuffer:d0,isRegExp:c0,maybeMap:p0,merge:o0},Od=e0,fo=Dd,es=wl,m0=Object.prototype.hasOwnProperty,Ld={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},Br=Array.isArray,g0=Array.prototype.push,kd=function(i,t){g0.apply(i,Br(t)?t:[t])},y0=Date.prototype.toISOString,hc=es.default,ve={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:fo.encode,encodeValuesOnly:!1,filter:void 0,format:hc,formatter:es.formatters[hc],indices:!1,serializeDate:function(t){return y0.call(t)},skipNulls:!1,strictNullHandling:!1},v0=function(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"},Ga={},_0=function i(t,e,r,n,s,a,h,u,c,m,y,v,b,T,E,P,M,D){for(var R=t,N=D,Y=0,X=!1;(N=N.get(Ga))!==void 0&&!X;){var K=N.get(t);if(Y+=1,typeof K<"u"){if(K===Y)throw new RangeError("Cyclic object value");X=!0}typeof N.get(Ga)>"u"&&(Y=0)}if(typeof m=="function"?R=m(e,R):R instanceof Date?R=b(R):r==="comma"&&Br(R)&&(R=fo.maybeMap(R,function(lt){return lt instanceof Date?b(lt):lt})),R===null){if(a)return c&&!P?c(e,ve.encoder,M,"key",T):e;R=""}if(v0(R)||fo.isBuffer(R)){if(c){var q=P?e:c(e,ve.encoder,M,"key",T);return[E(q)+"="+E(c(R,ve.encoder,M,"value",T))]}return[E(e)+"="+E(String(R))]}var j=[];if(typeof R>"u")return j;var st;if(r==="comma"&&Br(R))P&&c&&(R=fo.maybeMap(R,c)),st=[{value:R.length>0?R.join(",")||null:void 0}];else if(Br(m))st=m;else{var yt=Object.keys(R);st=y?yt.sort(y):yt}var $=u?String(e).replace(/\./g,"%2E"):String(e),H=n&&Br(R)&&R.length===1?$+"[]":$;if(s&&Br(R)&&R.length===0)return H+"[]";for(var z=0;z<st.length;++z){var vt=st[z],Pt=typeof vt=="object"&&vt&&typeof vt.value<"u"?vt.value:R[vt];if(!(h&&Pt===null)){var dt=v&&u?String(vt).replace(/\./g,"%2E"):String(vt),St=Br(R)?typeof r=="function"?r(H,dt):H:H+(v?"."+dt:"["+dt+"]");D.set(t,Y);var Kt=Od();Kt.set(Ga,D),kd(j,i(Pt,St,r,n,s,a,h,u,r==="comma"&&P&&Br(R)?null:c,m,y,v,b,T,E,P,M,Kt))}}return j},x0=function(t){if(!t)return ve;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");var e=t.charset||ve.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=es.default;if(typeof t.format<"u"){if(!m0.call(es.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=es.formatters[r],s=ve.filter;(typeof t.filter=="function"||Br(t.filter))&&(s=t.filter);var a;if(t.arrayFormat in Ld?a=t.arrayFormat:"indices"in t?a=t.indices?"indices":"repeat":a=ve.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var h=typeof t.allowDots>"u"?t.encodeDotInKeys===!0?!0:ve.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:ve.addQueryPrefix,allowDots:h,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:ve.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ve.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?ve.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:ve.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:ve.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:ve.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:ve.encodeValuesOnly,filter:s,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:ve.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:ve.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ve.strictNullHandling}},b0=function(i,t){var e=i,r=x0(t),n,s;typeof r.filter=="function"?(s=r.filter,e=s("",e)):Br(r.filter)&&(s=r.filter,n=s);var a=[];if(typeof e!="object"||e===null)return"";var h=Ld[r.arrayFormat],u=h==="comma"&&r.commaRoundTrip;n||(n=Object.keys(e)),r.sort&&n.sort(r.sort);for(var c=Od(),m=0;m<n.length;++m){var y=n[m],v=e[y];r.skipNulls&&v===null||kd(a,_0(v,y,h,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}var b=a.join(r.delimiter),T=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?T+="utf8=%26%2310003%3B&":T+="utf8=%E2%9C%93&"),b.length>0?T+b:""},gn=Dd,wh=Object.prototype.hasOwnProperty,T0=Array.isArray,ce={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:gn.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1},w0=function(i){return i.replace(/&#(\d+);/g,function(t,e){return String.fromCharCode(parseInt(e,10))})},Nd=function(i,t){return i&&typeof i=="string"&&t.comma&&i.indexOf(",")>-1?i.split(","):i},A0="utf8=%26%2310003%3B",E0="utf8=%E2%9C%93",S0=function(t,e){var r={__proto__:null},n=e.ignoreQueryPrefix?t.replace(/^\?/,""):t;n=n.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var s=e.parameterLimit===1/0?void 0:e.parameterLimit,a=n.split(e.delimiter,s),h=-1,u,c=e.charset;if(e.charsetSentinel)for(u=0;u<a.length;++u)a[u].indexOf("utf8=")===0&&(a[u]===E0?c="utf-8":a[u]===A0&&(c="iso-8859-1"),h=u,u=a.length);for(u=0;u<a.length;++u)if(u!==h){var m=a[u],y=m.indexOf("]="),v=y===-1?m.indexOf("="):y+1,b,T;v===-1?(b=e.decoder(m,ce.decoder,c,"key"),T=e.strictNullHandling?null:""):(b=e.decoder(m.slice(0,v),ce.decoder,c,"key"),T=gn.maybeMap(Nd(m.slice(v+1),e),function(P){return e.decoder(P,ce.decoder,c,"value")})),T&&e.interpretNumericEntities&&c==="iso-8859-1"&&(T=w0(String(T))),m.indexOf("[]=")>-1&&(T=T0(T)?[T]:T);var E=wh.call(r,b);E&&e.duplicates==="combine"?r[b]=gn.combine(r[b],T):(!E||e.duplicates==="last")&&(r[b]=T)}return r},C0=function(i,t,e,r){for(var n=r?t:Nd(t,e),s=i.length-1;s>=0;--s){var a,h=i[s];if(h==="[]"&&e.parseArrays)a=e.allowEmptyArrays&&(n===""||e.strictNullHandling&&n===null)?[]:[].concat(n);else{a=e.plainObjects?{__proto__:null}:{};var u=h.charAt(0)==="["&&h.charAt(h.length-1)==="]"?h.slice(1,-1):h,c=e.decodeDotInKeys?u.replace(/%2E/g,"."):u,m=parseInt(c,10);!e.parseArrays&&c===""?a={0:n}:!isNaN(m)&&h!==c&&String(m)===c&&m>=0&&e.parseArrays&&m<=e.arrayLimit?(a=[],a[m]=n):c!=="__proto__"&&(a[c]=n)}n=a}return n},P0=function(t,e,r,n){if(t){var s=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,a=/(\[[^[\]]*])/,h=/(\[[^[\]]*])/g,u=r.depth>0&&a.exec(s),c=u?s.slice(0,u.index):s,m=[];if(c){if(!r.plainObjects&&wh.call(Object.prototype,c)&&!r.allowPrototypes)return;m.push(c)}for(var y=0;r.depth>0&&(u=h.exec(s))!==null&&y<r.depth;){if(y+=1,!r.plainObjects&&wh.call(Object.prototype,u[1].slice(1,-1))&&!r.allowPrototypes)return;m.push(u[1])}if(u){if(r.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");m.push("["+s.slice(u.index)+"]")}return C0(m,e,r,n)}},R0=function(t){if(!t)return ce;if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.decodeDotInKeys<"u"&&typeof t.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(t.decoder!==null&&typeof t.decoder<"u"&&typeof t.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=typeof t.charset>"u"?ce.charset:t.charset,r=typeof t.duplicates>"u"?ce.duplicates:t.duplicates;if(r!=="combine"&&r!=="first"&&r!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var n=typeof t.allowDots>"u"?t.decodeDotInKeys===!0?!0:ce.allowDots:!!t.allowDots;return{allowDots:n,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:ce.allowEmptyArrays,allowPrototypes:typeof t.allowPrototypes=="boolean"?t.allowPrototypes:ce.allowPrototypes,allowSparse:typeof t.allowSparse=="boolean"?t.allowSparse:ce.allowSparse,arrayLimit:typeof t.arrayLimit=="number"?t.arrayLimit:ce.arrayLimit,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:ce.charsetSentinel,comma:typeof t.comma=="boolean"?t.comma:ce.comma,decodeDotInKeys:typeof t.decodeDotInKeys=="boolean"?t.decodeDotInKeys:ce.decodeDotInKeys,decoder:typeof t.decoder=="function"?t.decoder:ce.decoder,delimiter:typeof t.delimiter=="string"||gn.isRegExp(t.delimiter)?t.delimiter:ce.delimiter,depth:typeof t.depth=="number"||t.depth===!1?+t.depth:ce.depth,duplicates:r,ignoreQueryPrefix:t.ignoreQueryPrefix===!0,interpretNumericEntities:typeof t.interpretNumericEntities=="boolean"?t.interpretNumericEntities:ce.interpretNumericEntities,parameterLimit:typeof t.parameterLimit=="number"?t.parameterLimit:ce.parameterLimit,parseArrays:t.parseArrays!==!1,plainObjects:typeof t.plainObjects=="boolean"?t.plainObjects:ce.plainObjects,strictDepth:typeof t.strictDepth=="boolean"?!!t.strictDepth:ce.strictDepth,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:ce.strictNullHandling}},M0=function(i,t){var e=R0(t);if(i===""||i===null||typeof i>"u")return e.plainObjects?{__proto__:null}:{};for(var r=typeof i=="string"?S0(i,e):i,n=e.plainObjects?{__proto__:null}:{},s=Object.keys(r),a=0;a<s.length;++a){var h=s[a],u=P0(h,r[h],e,typeof i=="string");n=gn.merge(n,u,e)}return e.allowSparse===!0?n:gn.compact(n)},I0=b0,F0=M0,B0=wl,D0={formats:B0,parse:F0,stringify:I0},O0=$m;function gr(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var L0=/^([a-z0-9.+-]+:)/i,k0=/:[0-9]*$/,N0=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,U0=["<",">",'"',"`"," ","\r",`
`,"	"],G0=["{","}","|","\\","^","`"].concat(U0),Ah=["'"].concat(G0),lc=["%","/","?",";","#"].concat(Ah),uc=["/","?","#"],H0=255,cc=/^[+a-z0-9A-Z_-]{0,63}$/,$0=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,W0={javascript:!0,"javascript:":!0},Eh={javascript:!0,"javascript:":!0},ln={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},Sh=D0;function Yo(i,t,e){if(i&&typeof i=="object"&&i instanceof gr)return i;var r=new gr;return r.parse(i,t,e),r}gr.prototype.parse=function(i,t,e){if(typeof i!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof i);var r=i.indexOf("?"),n=r!==-1&&r<i.indexOf("#")?"?":"#",s=i.split(n),a=/\\/g;s[0]=s[0].replace(a,"/"),i=s.join(n);var h=i;if(h=h.trim(),!e&&i.split("#").length===1){var u=N0.exec(h);if(u)return this.path=h,this.href=h,this.pathname=u[1],u[2]?(this.search=u[2],t?this.query=Sh.parse(this.search.substr(1)):this.query=this.search.substr(1)):t&&(this.search="",this.query={}),this}var c=L0.exec(h);if(c){c=c[0];var m=c.toLowerCase();this.protocol=m,h=h.substr(c.length)}if(e||c||h.match(/^\/\/[^@/]+@[^@/]+/)){var y=h.substr(0,2)==="//";y&&!(c&&Eh[c])&&(h=h.substr(2),this.slashes=!0)}if(!Eh[c]&&(y||c&&!ln[c])){for(var v=-1,b=0;b<uc.length;b++){var T=h.indexOf(uc[b]);T!==-1&&(v===-1||T<v)&&(v=T)}var E,P;v===-1?P=h.lastIndexOf("@"):P=h.lastIndexOf("@",v),P!==-1&&(E=h.slice(0,P),h=h.slice(P+1),this.auth=decodeURIComponent(E)),v=-1;for(var b=0;b<lc.length;b++){var T=h.indexOf(lc[b]);T!==-1&&(v===-1||T<v)&&(v=T)}v===-1&&(v=h.length),this.host=h.slice(0,v),h=h.slice(v),this.parseHost(),this.hostname=this.hostname||"";var M=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!M)for(var D=this.hostname.split(/\./),b=0,R=D.length;b<R;b++){var N=D[b];if(N&&!N.match(cc)){for(var Y="",X=0,K=N.length;X<K;X++)N.charCodeAt(X)>127?Y+="x":Y+=N[X];if(!Y.match(cc)){var q=D.slice(0,b),j=D.slice(b+1),st=N.match($0);st&&(q.push(st[1]),j.unshift(st[2])),j.length&&(h="/"+j.join(".")+h),this.hostname=q.join(".");break}}}this.hostname.length>H0?this.hostname="":this.hostname=this.hostname.toLowerCase(),M||(this.hostname=O0.toASCII(this.hostname));var yt=this.port?":"+this.port:"",$=this.hostname||"";this.host=$+yt,this.href+=this.host,M&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),h[0]!=="/"&&(h="/"+h))}if(!W0[m])for(var b=0,R=Ah.length;b<R;b++){var H=Ah[b];if(h.indexOf(H)!==-1){var z=encodeURIComponent(H);z===H&&(z=escape(H)),h=h.split(H).join(z)}}var vt=h.indexOf("#");vt!==-1&&(this.hash=h.substr(vt),h=h.slice(0,vt));var Pt=h.indexOf("?");if(Pt!==-1?(this.search=h.substr(Pt),this.query=h.substr(Pt+1),t&&(this.query=Sh.parse(this.query)),h=h.slice(0,Pt)):t&&(this.search="",this.query={}),h&&(this.pathname=h),ln[m]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var yt=this.pathname||"",dt=this.search||"";this.path=yt+dt}return this.href=this.format(),this};function V0(i){return typeof i=="string"&&(i=Yo(i)),i instanceof gr?i.format():gr.prototype.format.call(i)}gr.prototype.format=function(){var i=this.auth||"";i&&(i=encodeURIComponent(i),i=i.replace(/%3A/i,":"),i+="@");var t=this.protocol||"",e=this.pathname||"",r=this.hash||"",n=!1,s="";this.host?n=i+this.host:this.hostname&&(n=i+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(s=Sh.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||s&&"?"+s||"";return t&&t.substr(-1)!==":"&&(t+=":"),this.slashes||(!t||ln[t])&&n!==!1?(n="//"+(n||""),e&&e.charAt(0)!=="/"&&(e="/"+e)):n||(n=""),r&&r.charAt(0)!=="#"&&(r="#"+r),a&&a.charAt(0)!=="?"&&(a="?"+a),e=e.replace(/[?#]/g,function(h){return encodeURIComponent(h)}),a=a.replace("#","%23"),t+n+e+a+r};function j0(i,t){return Yo(i,!1,!0).resolve(t)}gr.prototype.resolve=function(i){return this.resolveObject(Yo(i,!1,!0)).format()};gr.prototype.resolveObject=function(i){if(typeof i=="string"){var t=new gr;t.parse(i,!1,!0),i=t}for(var e=new gr,r=Object.keys(this),n=0;n<r.length;n++){var s=r[n];e[s]=this[s]}if(e.hash=i.hash,i.href==="")return e.href=e.format(),e;if(i.slashes&&!i.protocol){for(var a=Object.keys(i),h=0;h<a.length;h++){var u=a[h];u!=="protocol"&&(e[u]=i[u])}return ln[e.protocol]&&e.hostname&&!e.pathname&&(e.pathname="/",e.path=e.pathname),e.href=e.format(),e}if(i.protocol&&i.protocol!==e.protocol){if(!ln[i.protocol]){for(var c=Object.keys(i),m=0;m<c.length;m++){var y=c[m];e[y]=i[y]}return e.href=e.format(),e}if(e.protocol=i.protocol,!i.host&&!Eh[i.protocol]){for(var R=(i.pathname||"").split("/");R.length&&!(i.host=R.shift()););i.host||(i.host=""),i.hostname||(i.hostname=""),R[0]!==""&&R.unshift(""),R.length<2&&R.unshift(""),e.pathname=R.join("/")}else e.pathname=i.pathname;if(e.search=i.search,e.query=i.query,e.host=i.host||"",e.auth=i.auth,e.hostname=i.hostname||i.host,e.port=i.port,e.pathname||e.search){var v=e.pathname||"",b=e.search||"";e.path=v+b}return e.slashes=e.slashes||i.slashes,e.href=e.format(),e}var T=e.pathname&&e.pathname.charAt(0)==="/",E=i.host||i.pathname&&i.pathname.charAt(0)==="/",P=E||T||e.host&&i.pathname,M=P,D=e.pathname&&e.pathname.split("/")||[],R=i.pathname&&i.pathname.split("/")||[],N=e.protocol&&!ln[e.protocol];if(N&&(e.hostname="",e.port=null,e.host&&(D[0]===""?D[0]=e.host:D.unshift(e.host)),e.host="",i.protocol&&(i.hostname=null,i.port=null,i.host&&(R[0]===""?R[0]=i.host:R.unshift(i.host)),i.host=null),P=P&&(R[0]===""||D[0]==="")),E)e.host=i.host||i.host===""?i.host:e.host,e.hostname=i.hostname||i.hostname===""?i.hostname:e.hostname,e.search=i.search,e.query=i.query,D=R;else if(R.length)D||(D=[]),D.pop(),D=D.concat(R),e.search=i.search,e.query=i.query;else if(i.search!=null){if(N){e.host=D.shift(),e.hostname=e.host;var Y=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;Y&&(e.auth=Y.shift(),e.hostname=Y.shift(),e.host=e.hostname)}return e.search=i.search,e.query=i.query,(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.href=e.format(),e}if(!D.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var X=D.slice(-1)[0],K=(e.host||i.host||D.length>1)&&(X==="."||X==="..")||X==="",q=0,j=D.length;j>=0;j--)X=D[j],X==="."?D.splice(j,1):X===".."?(D.splice(j,1),q++):q&&(D.splice(j,1),q--);if(!P&&!M)for(;q--;q)D.unshift("..");P&&D[0]!==""&&(!D[0]||D[0].charAt(0)!=="/")&&D.unshift(""),K&&D.join("/").substr(-1)!=="/"&&D.push("");var st=D[0]===""||D[0]&&D[0].charAt(0)==="/";if(N){e.hostname=st?"":D.length?D.shift():"",e.host=e.hostname;var Y=e.host&&e.host.indexOf("@")>0?e.host.split("@"):!1;Y&&(e.auth=Y.shift(),e.hostname=Y.shift(),e.host=e.hostname)}return P=P||e.host&&D.length,P&&!st&&D.unshift(""),D.length>0?e.pathname=D.join("/"):(e.pathname=null,e.path=null),(e.pathname!==null||e.search!==null)&&(e.path=(e.pathname?e.pathname:"")+(e.search?e.search:"")),e.auth=i.auth||e.auth,e.slashes=e.slashes||i.slashes,e.href=e.format(),e};gr.prototype.parseHost=function(){var i=this.host,t=k0.exec(i);t&&(t=t[0],t!==":"&&(this.port=t.substr(1)),i=i.substr(0,i.length-t.length)),i&&(this.hostname=i)};var z0=Yo,X0=j0,Y0=V0;const dc={};function Ct(i,t,e=3){if(dc[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${i}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${i}`),console.warn(r))),dc[t]=!0}const q0={get parse(){return Ct("7.3.0","utils.url.parse is deprecated, use native URL API instead."),z0},get format(){return Ct("7.3.0","utils.url.format is deprecated, use native URL API instead."),Y0},get resolve(){return Ct("7.3.0","utils.url.resolve is deprecated, use native URL API instead."),X0}};function lr(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function kn(i){return i.split("?")[0].split("#")[0]}function K0(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Z0(i,t,e){return i.replace(new RegExp(K0(t),"g"),e)}function J0(i,t){let e="",r=0,n=-1,s=0,a=-1;for(let h=0;h<=i.length;++h){if(h<i.length)a=i.charCodeAt(h);else{if(a===47)break;a=47}if(a===47){if(!(n===h-1||s===1))if(n!==h-1&&s===2){if(e.length<2||r!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const u=e.lastIndexOf("/");if(u!==e.length-1){u===-1?(e="",r=0):(e=e.slice(0,u),r=e.length-1-e.lastIndexOf("/")),n=h,s=0;continue}}else if(e.length===2||e.length===1){e="",r=0,n=h,s=0;continue}}t&&(e.length>0?e+="/..":e="..",r=2)}else e.length>0?e+=`/${i.slice(n+1,h)}`:e=i.slice(n+1,h),r=h-n-1;n=h,s=0}else a===46&&s!==-1?++s:s=-1}return e}const be={toPosix(i){return Z0(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){lr(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(lr(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const r=kn(this.toPosix(t??ft.ADAPTER.getBaseUrl())),n=kn(this.toPosix(e??this.rootname(r)));return i=this.toPosix(i),i.startsWith("/")?be.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(r,i)},normalize(i){if(lr(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const r=i.endsWith("/");return i=J0(i,!1),i.length>0&&r&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return lr(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const r=i[e];if(lr(r),r.length>0)if(t===void 0)t=r;else{const n=i[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(lr(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let r=-1,n=!0;const s=this.getProtocol(i),a=i;i=i.slice(s.length);for(let h=i.length-1;h>=1;--h)if(t=i.charCodeAt(h),t===47){if(!n){r=h;break}}else n=!1;return r===-1?e?"/":this.isUrl(a)?s+i:s:e&&r===1?"//":s+i.slice(0,r)},rootname(i){lr(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){lr(i),t&&lr(t),i=kn(this.toPosix(i));let e=0,r=-1,n=!0,s;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let a=t.length-1,h=-1;for(s=i.length-1;s>=0;--s){const u=i.charCodeAt(s);if(u===47){if(!n){e=s+1;break}}else h===-1&&(n=!1,h=s+1),a>=0&&(u===t.charCodeAt(a)?--a===-1&&(r=s):(a=-1,r=h))}return e===r?r=h:r===-1&&(r=i.length),i.slice(e,r)}for(s=i.length-1;s>=0;--s)if(i.charCodeAt(s)===47){if(!n){e=s+1;break}}else r===-1&&(n=!1,r=s+1);return r===-1?"":i.slice(e,r)},extname(i){lr(i),i=kn(this.toPosix(i));let t=-1,e=0,r=-1,n=!0,s=0;for(let a=i.length-1;a>=0;--a){const h=i.charCodeAt(a);if(h===47){if(!n){e=a+1;break}continue}r===-1&&(n=!1,r=a+1),h===46?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||r===-1||s===0||s===1&&t===r-1&&t===e+1?"":i.slice(t,r)},parse(i){lr(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=kn(this.toPosix(i));let e=i.charCodeAt(0);const r=this.isAbsolute(i);let n;t.root=this.rootname(i),r||this.hasProtocol(i)?n=1:n=0;let s=-1,a=0,h=-1,u=!0,c=i.length-1,m=0;for(;c>=n;--c){if(e=i.charCodeAt(c),e===47){if(!u){a=c+1;break}continue}h===-1&&(u=!1,h=c+1),e===46?s===-1?s=c:m!==1&&(m=1):s!==-1&&(m=-1)}return s===-1||h===-1||m===0||m===1&&s===h-1&&s===a+1?h!==-1&&(a===0&&r?t.base=t.name=i.slice(1,h):t.base=t.name=i.slice(a,h)):(a===0&&r?(t.name=i.slice(1,s),t.base=i.slice(1,h)):(t.name=i.slice(a,s),t.base=i.slice(a,h)),t.ext=i.slice(s,h)),t.dir=this.dirname(i),t},sep:"/",delimiter:":",joinExtensions:[".html"]};let Ha;async function Ud(){return Ha??(Ha=(async()=>{var s;const i=document.createElement("canvas").getContext("webgl");if(!i)return He.UNPACK;const t=await new Promise(a=>{const h=document.createElement("video");h.onloadeddata=()=>a(h),h.onerror=()=>a(null),h.autoplay=!1,h.crossOrigin="anonymous",h.preload="auto",h.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",h.load()});if(!t)return He.UNPACK;const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);const r=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,r),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);const n=new Uint8Array(4);return i.readPixels(0,0,1,1,i.RGBA,i.UNSIGNED_BYTE,n),i.deleteFramebuffer(r),i.deleteTexture(e),(s=i.getExtension("WEBGL_lose_context"))==null||s.loseContext(),n[0]<=n[3]?He.PMA:He.UNPACK})()),Ha}function Q0(){Ct("7.0.0","skipHello is deprecated, please use settings.RENDER_OPTIONS.hello")}function tv(){Ct("7.0.0",`sayHello is deprecated, please use Renderer's "hello" option`)}let $a;function Gd(){return typeof $a>"u"&&($a=function(){var t;const i={stencil:!0,failIfMajorPerformanceCaveat:ft.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!ft.ADAPTER.getWebGLRenderingContext())return!1;const e=ft.ADAPTER.createCanvas();let r=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);const n=!!((t=r==null?void 0:r.getContextAttributes())!=null&&t.stencil);if(r){const s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}}()),$a}var ev={grad:.9,turn:360,rad:360/(2*Math.PI)},zr=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},Pe=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},nr=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},Hd=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},fc=function(i){return{r:nr(i.r,0,255),g:nr(i.g,0,255),b:nr(i.b,0,255),a:nr(i.a)}},Wa=function(i){return{r:Pe(i.r),g:Pe(i.g),b:Pe(i.b),a:Pe(i.a,3)}},rv=/^#([0-9a-f]{3,8})$/i,Ws=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},$d=function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=Math.max(t,e,r),a=s-Math.min(t,e,r),h=a?s===t?(e-r)/a:s===e?2+(r-t)/a:4+(t-e)/a:0;return{h:60*(h<0?h+6:h),s:s?a/s*100:0,v:s/255*100,a:n}},Wd=function(i){var t=i.h,e=i.s,r=i.v,n=i.a;t=t/360*6,e/=100,r/=100;var s=Math.floor(t),a=r*(1-e),h=r*(1-(t-s)*e),u=r*(1-(1-t+s)*e),c=s%6;return{r:255*[r,h,a,a,u,r][c],g:255*[u,r,r,h,a,a][c],b:255*[a,a,u,r,r,h][c],a:n}},pc=function(i){return{h:Hd(i.h),s:nr(i.s,0,100),l:nr(i.l,0,100),a:nr(i.a)}},mc=function(i){return{h:Pe(i.h),s:Pe(i.s),l:Pe(i.l),a:Pe(i.a,3)}},gc=function(i){return Wd((e=(t=i).s,{h:t.h,s:(e*=((r=t.l)<50?r:100-r)/100)>0?2*e/(r+e)*100:0,v:r+e,a:t.a}));var t,e,r},rs=function(i){return{h:(t=$d(i)).h,s:(n=(200-(e=t.s))*(r=t.v)/100)>0&&n<200?e*r/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,r,n},iv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,nv=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,sv=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,ov=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ch={string:[[function(i){var t=rv.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?Pe(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?Pe(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=sv.exec(i)||ov.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:fc({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=iv.exec(i)||nv.exec(i);if(!t)return null;var e,r,n=pc({h:(e=t[1],r=t[2],r===void 0&&(r="deg"),Number(e)*(ev[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return gc(n)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,r=i.b,n=i.a,s=n===void 0?1:n;return zr(t)&&zr(e)&&zr(r)?fc({r:Number(t),g:Number(e),b:Number(r),a:Number(s)}):null},"rgb"],[function(i){var t=i.h,e=i.s,r=i.l,n=i.a,s=n===void 0?1:n;if(!zr(t)||!zr(e)||!zr(r))return null;var a=pc({h:Number(t),s:Number(e),l:Number(r),a:Number(s)});return gc(a)},"hsl"],[function(i){var t=i.h,e=i.s,r=i.v,n=i.a,s=n===void 0?1:n;if(!zr(t)||!zr(e)||!zr(r))return null;var a=function(h){return{h:Hd(h.h),s:nr(h.s,0,100),v:nr(h.v,0,100),a:nr(h.a)}}({h:Number(t),s:Number(e),v:Number(r),a:Number(s)});return Wd(a)},"hsv"]]},yc=function(i,t){for(var e=0;e<t.length;e++){var r=t[e][0](i);if(r)return[r,t[e][1]]}return[null,void 0]},av=function(i){return typeof i=="string"?yc(i.trim(),Ch.string):typeof i=="object"&&i!==null?yc(i,Ch.object):[null,void 0]},Va=function(i,t){var e=rs(i);return{h:e.h,s:nr(e.s+100*t,0,100),l:e.l,a:e.a}},ja=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},vc=function(i,t){var e=rs(i);return{h:e.h,s:e.s,l:nr(e.l+100*t,0,100),a:e.a}},Ph=function(){function i(t){this.parsed=av(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return Pe(ja(this.rgba),2)},i.prototype.isDark=function(){return ja(this.rgba)<.5},i.prototype.isLight=function(){return ja(this.rgba)>=.5},i.prototype.toHex=function(){return t=Wa(this.rgba),e=t.r,r=t.g,n=t.b,a=(s=t.a)<1?Ws(Pe(255*s)):"","#"+Ws(e)+Ws(r)+Ws(n)+a;var t,e,r,n,s,a},i.prototype.toRgb=function(){return Wa(this.rgba)},i.prototype.toRgbString=function(){return t=Wa(this.rgba),e=t.r,r=t.g,n=t.b,(s=t.a)<1?"rgba("+e+", "+r+", "+n+", "+s+")":"rgb("+e+", "+r+", "+n+")";var t,e,r,n,s},i.prototype.toHsl=function(){return mc(rs(this.rgba))},i.prototype.toHslString=function(){return t=mc(rs(this.rgba)),e=t.h,r=t.s,n=t.l,(s=t.a)<1?"hsla("+e+", "+r+"%, "+n+"%, "+s+")":"hsl("+e+", "+r+"%, "+n+"%)";var t,e,r,n,s},i.prototype.toHsv=function(){return t=$d(this.rgba),{h:Pe(t.h),s:Pe(t.s),v:Pe(t.v),a:Pe(t.a,3)};var t},i.prototype.invert=function(){return Rr({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),Rr(Va(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),Rr(Va(this.rgba,-t))},i.prototype.grayscale=function(){return Rr(Va(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),Rr(vc(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),Rr(vc(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?Rr({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):Pe(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=rs(this.rgba);return typeof t=="number"?Rr({h:t,s:e.s,l:e.l,a:e.a}):Pe(e.h)},i.prototype.isEqual=function(t){return this.toHex()===Rr(t).toHex()},i}(),Rr=function(i){return i instanceof Ph?i:new Ph(i)},_c=[],hv=function(i){i.forEach(function(t){_c.indexOf(t)<0&&(t(Ph,Ch),_c.push(t))})};function lv(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var n in e)r[e[n]]=n;var s={};i.prototype.toName=function(a){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var h,u,c=r[this.toHex()];if(c)return c;if(a!=null&&a.closest){var m=this.toRgb(),y=1/0,v="black";if(!s.length)for(var b in e)s[b]=new i(e[b]).toRgb();for(var T in e){var E=(h=m,u=s[T],Math.pow(h.r-u.r,2)+Math.pow(h.g-u.g,2)+Math.pow(h.b-u.b,2));E<y&&(y=E,v=T)}return v}},t.string.push([function(a){var h=a.toLowerCase(),u=h==="transparent"?"#0000":e[h];return u?new i(u).toRgb():null},"name"])}hv([lv]);const Zi=class po{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof po)this._value=this.cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set PIXI.Color#value to null");(this._value===null||!this.isSourceEqual(this._value,t))&&(this.normalize(t),this._value=this.cloneSource(t))}}get value(){return this._value}cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}isSourceEqual(t,e){const r=typeof t;if(r!==typeof e)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((n,s)=>n===e[s]);if(t!==null&&e!==null){const n=Object.keys(t),s=Object.keys(e);return n.length!==s.length?!1:n.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,r,n]=this._components;return{r:t,g:e,b:r,a:n}}toRgb(){const[t,e,r]=this._components;return{r:t,g:e,b:r}}toRgbaString(){const[t,e,r]=this.toUint8RgbArray();return`rgba(${t},${e},${r},${this.alpha})`}toUint8RgbArray(t){const[e,r,n]=this._components;return t=t??[],t[0]=Math.round(e*255),t[1]=Math.round(r*255),t[2]=Math.round(n*255),t}toRgbArray(t){t=t??[];const[e,r,n]=this._components;return t[0]=e,t[1]=r,t[2]=n,t}toNumber(){return this._int}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,r,n,s]=po.temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=r,this._components[2]*=n,this._components[3]*=s,this.refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this.refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let r=this._int>>16&255,n=this._int>>8&255,s=this._int&255;return e&&(r=r*t+.5|0,n=n*t+.5|0,s=s*t+.5|0),(t*255<<24)+(r<<16)+(n<<8)+s}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const t=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-t.length)+t}setAlpha(t){return this._components[3]=this._clamp(t),this}round(t){const[e,r,n]=this._components;return this._components[0]=Math.round(e*t)/t,this._components[1]=Math.round(r*t)/t,this._components[2]=Math.round(n*t)/t,this.refreshInt(),this._value=null,this}toArray(t){t=t??[];const[e,r,n,s]=this._components;return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}normalize(t){let e,r,n,s;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const a=t;e=(a>>16&255)/255,r=(a>>8&255)/255,n=(a&255)/255,s=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,r,n,s=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,r,n,s=255]=t,e/=255,r/=255,n/=255,s/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const h=po.HEX_PATTERN.exec(t);h&&(t=`#${h[2]}`)}const a=Rr(t);a.isValid()&&({r:e,g:r,b:n,a:s}=a.rgba,e/=255,r/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=r,this._components[2]=n,this._components[3]=s,this.refreshInt();else throw new Error(`Unable to convert color ${t}`)}refreshInt(){this._clamp(this._components);const[t,e,r]=this._components;this._int=(t*255<<16)+(e*255<<8)+(r*255|0)}_clamp(t,e=0,r=1){return typeof t=="number"?Math.min(Math.max(t,e),r):(t.forEach((n,s)=>{t[s]=Math.min(Math.max(n,e),r)}),t)}};Zi.shared=new Zi,Zi.temp=new Zi,Zi.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let kt=Zi;function uv(i,t=[]){return Ct("7.2.0","utils.hex2rgb is deprecated, use Color#toRgbArray instead"),kt.shared.setValue(i).toRgbArray(t)}function Vd(i){return Ct("7.2.0","utils.hex2string is deprecated, use Color#toHex instead"),kt.shared.setValue(i).toHex()}function cv(i){return Ct("7.2.0","utils.string2hex is deprecated, use Color#toNumber instead"),kt.shared.setValue(i).toNumber()}function jd(i){return Ct("7.2.0","utils.rgb2hex is deprecated, use Color#toNumber instead"),kt.shared.setValue(i).toNumber()}function dv(){const i=[],t=[];for(let r=0;r<32;r++)i[r]=r,t[r]=r;i[rt.NORMAL_NPM]=rt.NORMAL,i[rt.ADD_NPM]=rt.ADD,i[rt.SCREEN_NPM]=rt.SCREEN,t[rt.NORMAL]=rt.NORMAL_NPM,t[rt.ADD]=rt.ADD_NPM,t[rt.SCREEN]=rt.SCREEN_NPM;const e=[];return e.push(t),e.push(i),e}const Al=dv();function El(i,t){return Al[t?1:0][i]}function fv(i,t,e,r=!0){return Ct("7.2.0","utils.premultiplyRgba has moved to Color.premultiply"),kt.shared.setValue(i).premultiply(t,r).toArray(e??new Float32Array(4))}function pv(i,t){return Ct("7.2.0","utils.premultiplyTint has moved to Color.toPremultiplied"),kt.shared.setValue(i).toPremultiplied(t)}function mv(i,t,e,r=!0){return Ct("7.2.0","utils.premultiplyTintToRgba has moved to Color.premultiply"),kt.shared.setValue(i).premultiply(t,r).toArray(e??new Float32Array(4))}const zd=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function Xd(i,t=null){const e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${e}`);for(let r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function qo(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}const gv={Float32Array,Uint32Array,Int32Array,Uint8Array};function yv(i,t){let e=0,r=0;const n={};for(let u=0;u<i.length;u++)r+=t[u],e+=i[u].length;const s=new ArrayBuffer(e*4);let a=null,h=0;for(let u=0;u<i.length;u++){const c=t[u],m=i[u],y=qo(m);n[y]||(n[y]=new gv[y](s)),a=n[y];for(let v=0;v<m.length;v++){const b=(v/c|0)*r+h,T=v%c;a[b+T]=m[v]}h+=c}return new Float32Array(s)}function as(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Rh(i){return!(i&i-1)&&!!i}function Mh(i){let t=(i>65535?1:0)<<4;i>>>=t;let e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Oi(i,t,e){const r=i.length;let n;if(t>=r||e===0)return;e=t+e>r?r-t:e;const s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}function qr(i){return i===0?0:i<0?-1:1}let vv=0;function di(){return++vv}const Ih=class{constructor(i,t,e,r){this.left=i,this.top=t,this.right=e,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};Ih.EMPTY=new Ih(0,0,0,0);let Fh=Ih;const Bh={},ke=Object.create(null),Xe=Object.create(null);function _v(){let i;for(i in ke)ke[i].destroy();for(i in Xe)Xe[i].destroy()}function xv(){let i;for(i in ke)delete ke[i];for(i in Xe)delete Xe[i]}class fs{constructor(t,e,r){this._canvas=ft.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=r||ft.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(this._canvas===null)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function xc(i,t,e){for(let r=0,n=4*e*t;r<t;++r,n+=4)if(i[n+3]!==0)return!1;return!0}function bc(i,t,e,r,n){const s=4*t;for(let a=r,h=r*s+4*e;a<=n;++a,h+=s)if(i[h+3]!==0)return!1;return!0}function Yd(i){const{width:t,height:e}=i,r=i.getContext("2d",{willReadFrequently:!0});if(r===null)throw new TypeError("Failed to get canvas 2D context");const n=r.getImageData(0,0,t,e).data;let s=0,a=0,h=t-1,u=e-1;for(;a<e&&xc(n,t,a);)++a;if(a===e)return Fh.EMPTY;for(;xc(n,t,u);)--u;for(;bc(n,t,s,a,u);)++s;for(;bc(n,t,h,a,u);)--h;return++h,++u,new Fh(s,a,h,u)}function qd(i){const t=Yd(i),{width:e,height:r}=t;let n=null;if(!t.isEmpty()){const s=i.getContext("2d");if(s===null)throw new TypeError("Failed to get canvas 2D context");n=s.getImageData(t.left,t.top,e,r)}return{width:e,height:r,data:n}}function bv(i){const t=zd.exec(i);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}function Kd(i,t=globalThis.location){if(i.startsWith("data:"))return"";t=t||globalThis.location;const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function Gr(i,t=1){var r;const e=(r=ft.RETINA_PREFIX)==null?void 0:r.exec(i);return e?parseFloat(e[1]):t}const Tv=Object.freeze(Object.defineProperty({__proto__:null,BaseTextureCache:Xe,BoundingBox:Fh,CanvasRenderTarget:fs,DATA_URI:zd,EventEmitter:_n,ProgramCache:Bh,TextureCache:ke,clearTextureCache:xv,correctBlendMode:El,createIndicesForQuads:Xd,decomposeDataUri:bv,deprecation:Ct,destroyTextureCache:_v,detectVideoAlphaMode:Ud,determineCrossOrigin:Kd,earcut:md,getBufferType:qo,getCanvasBoundingBox:Yd,getResolutionOfUrl:Gr,hex2rgb:uv,hex2string:Vd,interleaveTypedArrays:yv,isMobile:Lr,isPow2:Rh,isWebGLSupported:Gd,log2:Mh,nextPow2:as,path:be,premultiplyBlendMode:Al,premultiplyRgba:fv,premultiplyTint:pv,premultiplyTintToRgba:mv,removeItems:Oi,rgb2hex:jd,sayHello:tv,sign:qr,skipHello:Q0,string2hex:cv,trimCanvas:qd,uid:di,url:q0},Symbol.toStringTag,{value:"Module"}));var ut=(i=>(i.Renderer="renderer",i.Application="application",i.RendererSystem="renderer-webgl-system",i.RendererPlugin="renderer-webgl-plugin",i.CanvasRendererSystem="renderer-canvas-system",i.CanvasRendererPlugin="renderer-canvas-plugin",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i))(ut||{});const Dh=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},Tc=(i,t)=>Dh(i).priority??t,mt={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(Dh).forEach(t=>{t.type.forEach(e=>{var r,n;return(n=(r=this._removeHandlers)[e])==null?void 0:n.call(r,t)})}),this},add(...i){return i.map(Dh).forEach(t=>{t.type.forEach(e=>{var s,a;const r=this._addHandlers,n=this._queue;r[e]?(s=r[e])==null||s.call(r,t):(n[e]=n[e]||[],(a=n[e])==null||a.push(t))})}),this},handle(i,t,e){var a;const r=this._addHandlers,n=this._removeHandlers;if(r[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);r[i]=t,n[i]=e;const s=this._queue;return s[i]&&((a=s[i])==null||a.forEach(h=>t(h)),delete s[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByList(i,t,e=-1){return this.handle(i,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((n,s)=>Tc(s,e)-Tc(n,e)))},r=>{const n=t.indexOf(r.ref);n!==-1&&t.splice(n,1)})}};class Oh{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const wv=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Av(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function Ev(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);for(;;){const r=wv.replace(/%forloop%/gi,Av(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}const za=0,Xa=1,Ya=2,qa=3,Ka=4,Za=5;class Hr{constructor(){this.data=0,this.blendMode=rt.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<za)}set blend(t){!!(this.data&1<<za)!==t&&(this.data^=1<<za)}get offsets(){return!!(this.data&1<<Xa)}set offsets(t){!!(this.data&1<<Xa)!==t&&(this.data^=1<<Xa)}get culling(){return!!(this.data&1<<Ya)}set culling(t){!!(this.data&1<<Ya)!==t&&(this.data^=1<<Ya)}get depthTest(){return!!(this.data&1<<qa)}set depthTest(t){!!(this.data&1<<qa)!==t&&(this.data^=1<<qa)}get depthMask(){return!!(this.data&1<<Za)}set depthMask(t){!!(this.data&1<<Za)!==t&&(this.data^=1<<Za)}get clockwiseFrontFace(){return!!(this.data&1<<Ka)}set clockwiseFrontFace(t){!!(this.data&1<<Ka)!==t&&(this.data^=1<<Ka)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==rt.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new Hr;return t.depthTest=!1,t.blend=!0,t}}Hr.prototype.toString=function(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`};const Lh=[];function Zd(i,t){if(!i)return null;let e="";if(typeof i=="string"){const r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(let r=Lh.length-1;r>=0;--r){const n=Lh[r];if(n.test&&n.test(i,e))return new n(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}class yr{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,r,n,s,a,h,u){if(arguments.length>8)throw new Error("max arguments reached");const{name:c,items:m}=this;this._aliasCount++;for(let y=0,v=m.length;y<v;y++)m[y][c](t,e,r,n,s,a,h,u);return m===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items.length=0,this._name=""}get empty(){return this.items.length===0}get name(){return this._name}}Object.defineProperties(yr.prototype,{dispatch:{value:yr.prototype.emit},run:{value:yr.prototype.emit}});class hs{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new yr("setRealSize"),this.onUpdate=new yr("update"),this.onError=new yr("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,r){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class Ko extends hs{constructor(t,e){const{width:r,height:n}=e||{};if(!r||!n)throw new Error("BufferResource width or height invalid");super(r,n),this.data=t,this.unpackAlignment=e.unpackAlignment??4}upload(t,e,r){const n=t.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===He.UNPACK);const s=e.realWidth,a=e.realHeight;return r.width===s&&r.height===a?n.texSubImage2D(e.target,0,0,0,s,a,e.format,r.type,this.data):(r.width=s,r.height=a,n.texImage2D(e.target,0,r.internalFormat,s,a,0,e.format,r.type,this.data)),!0}dispose(){this.data=null}static test(t){return t===null||t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}const Sv={scaleMode:mr.NEAREST,alphaMode:He.NPM},kh=class Ji extends _n{constructor(t=null,e=null){super(),e=Object.assign({},Ji.defaultOptions,e);const{alphaMode:r,mipmap:n,anisotropicLevel:s,scaleMode:a,width:h,height:u,wrapMode:c,format:m,type:y,target:v,resolution:b,resourceOptions:T}=e;t&&!(t instanceof hs)&&(t=Zd(t,T),t.internal=!0),this.resolution=b||ft.RESOLUTION,this.width=Math.round((h||0)*this.resolution)/this.resolution,this.height=Math.round((u||0)*this.resolution)/this.resolution,this._mipmap=n,this.anisotropicLevel=s,this._wrapMode=c,this._scaleMode=a,this.format=m,this.type=y,this.target=v,this.alphaMode=r,this.uid=di(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=h>0&&u>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let r;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,r=!0),e!==void 0&&e!==this.mipmap&&(this.mipmap=e,r=!0),r&&this.dirtyStyleId++,this}setSize(t,e,r){return r=r||this.resolution,this.setRealSize(t*r,e*r,r)}setRealSize(t,e,r){return this.resolution=r||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Rh(this.realWidth)&&Rh(this.realHeight)}setResolution(t){const e=this.resolution;return e===t?this:(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT(),this)}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete Xe[this.cacheId],delete ke[this.cacheId],this.cacheId=null),this.valid=!1,this.dispose(),Ji.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,r=ft.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else{if(!t._pixiId){const h=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${di()}`}s=t._pixiId}let a=Xe[s];if(n&&r&&!a)throw new Error(`The cacheId "${s}" does not exist in BaseTextureCache.`);return a||(a=new Ji(t,e),a.cacheId=s,Ji.addToCache(a,s)),a}static fromBuffer(t,e,r,n){t=t||new Float32Array(e*r*4);const s=new Ko(t,{width:e,height:r,...n==null?void 0:n.resourceOptions});let a,h;return t instanceof Float32Array?(a=at.RGBA,h=Et.FLOAT):t instanceof Int32Array?(a=at.RGBA_INTEGER,h=Et.INT):t instanceof Uint32Array?(a=at.RGBA_INTEGER,h=Et.UNSIGNED_INT):t instanceof Int16Array?(a=at.RGBA_INTEGER,h=Et.SHORT):t instanceof Uint16Array?(a=at.RGBA_INTEGER,h=Et.UNSIGNED_SHORT):t instanceof Int8Array?(a=at.RGBA,h=Et.BYTE):(a=at.RGBA,h=Et.UNSIGNED_BYTE),s.internal=!0,new Ji(s,Object.assign({},Sv,{type:h,format:a},n))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),Xe[e]&&Xe[e]!==t&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),Xe[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=Xe[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete Xe[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete Xe[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};kh.defaultOptions={mipmap:Ur.POW2,anisotropicLevel:0,scaleMode:mr.LINEAR,wrapMode:Jr.CLAMP,alphaMode:He.UNPACK,target:an.TEXTURE_2D,format:at.RGBA,type:Et.UNSIGNED_BYTE},kh._globalBatch=0;let Rt=kh;class Nh{constructor(){this.texArray=null,this.blend=0,this.type=pr.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Cv=0,xe=class Jd{constructor(t,e=!0,r=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=Cv++,this.disposeRunner=new yr("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?kr.ELEMENT_ARRAY_BUFFER:kr.ARRAY_BUFFER}get index(){return this.type===kr.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new Jd(t)}};class Po{constructor(t,e=0,r=!1,n=Et.FLOAT,s,a,h,u=1){this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=a,this.instance=h,this.divisor=u}destroy(){this.buffer=null}static from(t,e,r,n,s){return new Po(t,e,r,n,s)}}const Pv={Float32Array,Uint32Array,Int32Array,Uint8Array};function Rv(i,t){let e=0,r=0;const n={};for(let u=0;u<i.length;u++)r+=t[u],e+=i[u].length;const s=new ArrayBuffer(e*4);let a=null,h=0;for(let u=0;u<i.length;u++){const c=t[u],m=i[u],y=qo(m);n[y]||(n[y]=new Pv[y](s)),a=n[y];for(let v=0;v<m.length;v++){const b=(v/c|0)*r+h,T=v%c;a[b+T]=m[v]}h+=c}return new Float32Array(s)}const wc={5126:4,5123:2,5121:1};let Mv=0;const Iv={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class fi{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=Mv++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new yr("disposeGeometry"),this.refCount=0}addAttribute(t,e,r=0,n=!1,s,a,h,u=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof xe||(e instanceof Array&&(e=new Float32Array(e)),e=new xe(e));const c=t.split("|");if(c.length>1){for(let y=0;y<c.length;y++)this.addAttribute(c[y],e,r,n,s);return this}let m=this.buffers.indexOf(e);return m===-1&&(this.buffers.push(e),m=this.buffers.length-1),this.attributes[t]=new Po(m,r,n,s,a,h,u),this.instanced=this.instanced||u,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof xe||(t instanceof Array&&(t=new Uint16Array(t)),t=new xe(t)),t.type=kr.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;const t=[],e=[],r=new xe;let n;for(n in this.attributes){const s=this.attributes[n],a=this.buffers[s.buffer];t.push(a.data),e.push(s.size*wc[s.type]/4),s.buffer=0}for(r.data=Rv(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new fi;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new xe(this.buffers[e].data.slice(0));for(const e in this.attributes){const r=this.attributes[e];t.attributes[e]=new Po(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=kr.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new fi,r=[],n=[],s=[];let a;for(let h=0;h<t.length;h++){a=t[h];for(let u=0;u<a.buffers.length;u++)n[u]=n[u]||0,n[u]+=a.buffers[u].data.length,s[u]=0}for(let h=0;h<a.buffers.length;h++)r[h]=new Iv[qo(a.buffers[h].data)](n[h]),e.buffers[h]=new xe(r[h]);for(let h=0;h<t.length;h++){a=t[h];for(let u=0;u<a.buffers.length;u++)r[u].set(a.buffers[u].data,s[u]),s[u]+=a.buffers[u].data.length}if(e.attributes=a.attributes,a.indexBuffer){e.indexBuffer=e.buffers[a.buffers.indexOf(a.indexBuffer)],e.indexBuffer.type=kr.ELEMENT_ARRAY_BUFFER;let h=0,u=0,c=0,m=0;for(let y=0;y<a.buffers.length;y++)if(a.buffers[y]!==a.indexBuffer){m=y;break}for(const y in a.attributes){const v=a.attributes[y];(v.buffer|0)===m&&(u+=v.size*wc[v.type]/4)}for(let y=0;y<t.length;y++){const v=t[y].indexBuffer.data;for(let b=0;b<v.length;b++)e.indexBuffer.data[b+c]+=h;h+=t[y].buffers[m].data.length/u,c+=v.length}}return e}}class Qd extends fi{constructor(t=!1){super(),this._buffer=new xe(null,t,!1),this._indexBuffer=new xe(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Et.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Et.FLOAT).addAttribute("aColor",this._buffer,4,!0,Et.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Et.FLOAT).addIndex(this._indexBuffer)}}const Ro=Math.PI*2,Fv=180/Math.PI,Bv=Math.PI/180;var ne=(i=>(i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC",i))(ne||{});class Ut{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Ut(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}Ut.prototype.toString=function(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`};const Vs=[new Ut,new Ut,new Ut,new Ut];class It{constructor(t=0,e=0,r=0,n=0){this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=ne.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new It(0,0,0,0)}clone(){return new It(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const q=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=q)return!1;const j=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>j}const r=this.left,n=this.right,s=this.top,a=this.bottom;if(n<=r||a<=s)return!1;const h=Vs[0].set(t.left,t.top),u=Vs[1].set(t.left,t.bottom),c=Vs[2].set(t.right,t.top),m=Vs[3].set(t.right,t.bottom);if(c.x<=h.x||u.y<=h.y)return!1;const y=Math.sign(e.a*e.d-e.b*e.c);if(y===0||(e.apply(h,h),e.apply(u,u),e.apply(c,c),e.apply(m,m),Math.max(h.x,u.x,c.x,m.x)<=r||Math.min(h.x,u.x,c.x,m.x)>=n||Math.max(h.y,u.y,c.y,m.y)<=s||Math.min(h.y,u.y,c.y,m.y)>=a))return!1;const v=y*(u.y-h.y),b=y*(h.x-u.x),T=v*r+b*s,E=v*n+b*s,P=v*r+b*a,M=v*n+b*a;if(Math.max(T,E,P,M)<=v*h.x+b*h.y||Math.min(T,E,P,M)>=v*m.x+b*m.y)return!1;const D=y*(h.y-c.y),R=y*(c.x-h.x),N=D*r+R*s,Y=D*n+R*s,X=D*r+R*a,K=D*n+R*a;return!(Math.max(N,Y,X,K)<=D*h.x+R*h.y||Math.min(N,Y,X,K)>=D*m.x+R*m.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this}ceil(t=1,e=.001){const r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this}}It.prototype.toString=function(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ps{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.radius=r,this.type=ne.CIRC}clone(){return new ps(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const r=this.radius*this.radius;let n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r}getBounds(){return new It(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)}}ps.prototype.toString=function(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`};class ms{constructor(t=0,e=0,r=0,n=0){this.x=t,this.y=e,this.width=r,this.height=n,this.type=ne.ELIP}clone(){return new ms(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1}getBounds(){return new It(this.x-this.width,this.y-this.height,this.width,this.height)}}ms.prototype.toString=function(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`};class ci{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const r=[];for(let n=0,s=e.length;n<s;n++)r.push(e[n].x,e[n].y);e=r}this.points=e,this.type=ne.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new ci(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let r=!1;const n=this.points.length/2;for(let s=0,a=n-1;s<n;a=s++){const h=this.points[s*2],u=this.points[s*2+1],c=this.points[a*2],m=this.points[a*2+1];u>e!=m>e&&t<(c-h)*((e-u)/(m-u))+h&&(r=!r)}return r}}ci.prototype.toString=function(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce((i,t)=>`${i}, ${t}`,"")}]`};class gs{constructor(t=0,e=0,r=0,n=0,s=20){this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=ne.RREC}clone(){return new gs(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+r&&e<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let n=t-(this.x+r),s=e-(this.y+r);const a=r*r;if(n*n+s*s<=a||(n=t-(this.x+this.width-r),n*n+s*s<=a)||(s=e-(this.y+this.height-r),n*n+s*s<=a)||(n=t-(this.x+r),n*n+s*s<=a))return!0}return!1}}gs.prototype.toString=function(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`};class qt{constructor(t=1,e=0,r=0,n=1,s=0,a=0){this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,r,n,s,a){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=a,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,e){e=e||new Ut;const r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e}applyInverse(t,e){e=e||new Ut;const r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,a=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=a*e-this.ty*r,this.ty=a*r+this.ty*e,this}append(t){const e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this}setTransform(t,e,r,n,s,a,h,u,c){return this.a=Math.cos(h+c)*s,this.b=Math.sin(h+c)*s,this.c=-Math.sin(h-u)*a,this.d=Math.cos(h-u)*a,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,r=this.b,n=this.c,s=this.d,a=t.pivot,h=-Math.atan2(-n,s),u=Math.atan2(r,e),c=Math.abs(h+u);return c<1e-5||Math.abs(Ro-c)<1e-5?(t.rotation=u,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=h,t.skew.y=u),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx+(a.x*e+a.y*n),t.position.y=this.ty+(a.x*r+a.y*s),t}invert(){const t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,a=t*n-e*r;return this.a=n/a,this.b=-e/a,this.c=-r/a,this.d=t/a,this.tx=(r*this.ty-n*s)/a,this.ty=-(t*this.ty-e*s)/a,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new qt;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new qt}static get TEMP_MATRIX(){return new qt}}qt.prototype.toString=function(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`};const Si=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ci=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Pi=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Ri=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Uh=[],tf=[],js=Math.sign;function Dv(){for(let i=0;i<16;i++){const t=[];Uh.push(t);for(let e=0;e<16;e++){const r=js(Si[i]*Si[e]+Pi[i]*Ci[e]),n=js(Ci[i]*Si[e]+Ri[i]*Ci[e]),s=js(Si[i]*Pi[e]+Pi[i]*Ri[e]),a=js(Ci[i]*Pi[e]+Ri[i]*Ri[e]);for(let h=0;h<16;h++)if(Si[h]===r&&Ci[h]===n&&Pi[h]===s&&Ri[h]===a){t.push(h);break}}}for(let i=0;i<16;i++){const t=new qt;t.set(Si[i],Ci[i],Pi[i],Ri[i],0,0),tf.push(t)}}Dv();const oe={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Si[i],uY:i=>Ci[i],vX:i=>Pi[i],vY:i=>Ri[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>Uh[i][t],sub:(i,t)=>Uh[i][oe.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?oe.S:oe.N:Math.abs(t)*2<=Math.abs(i)?i>0?oe.E:oe.W:t>0?i>0?oe.SE:oe.SW:i>0?oe.NE:oe.NW,matrixAppendRotationInv:(i,t,e=0,r=0)=>{const n=tf[oe.inv(t)];n.tx=e,n.ty=r,i.append(n)}};class Kr{constructor(t,e,r=0,n=0){this._x=r,this._y=n,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new Kr(t,e,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}Kr.prototype.toString=function(){return`[@pixi/math:ObservablePoint x=${this.x} y=${this.y} scope=${this.scope}]`};const Gh=class{constructor(){this.worldTransform=new qt,this.localTransform=new qt,this.position=new Kr(this.onChange,this,0,0),this.scale=new Kr(this.onChange,this,1,1),this.pivot=new Kr(this.onChange,this,0,0),this.skew=new Kr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const i=this.localTransform;this._localID!==this._currentLocalID&&(i.a=this._cx*this.scale.x,i.b=this._sx*this.scale.x,i.c=this._cy*this.scale.y,i.d=this._sy*this.scale.y,i.tx=this.position.x-(this.pivot.x*i.a+this.pivot.y*i.c),i.ty=this.position.y-(this.pivot.x*i.b+this.pivot.y*i.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(i){const t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==i._worldID){const e=i.worldTransform,r=this.worldTransform;r.a=t.a*e.a+t.b*e.c,r.b=t.a*e.b+t.b*e.d,r.c=t.c*e.a+t.d*e.c,r.d=t.c*e.b+t.d*e.d,r.tx=t.tx*e.a+t.ty*e.c+e.tx,r.ty=t.tx*e.b+t.ty*e.d+e.ty,this._parentID=i._worldID,this._worldID++}}setFromMatrix(i){i.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(i){this._rotation!==i&&(this._rotation=i,this.updateSkew())}};Gh.IDENTITY=new Gh;let Zo=Gh;Zo.prototype.toString=function(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`};var Ov=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Lv=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`;function Ac(i,t,e){const r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function Ja(i){const t=new Array(i);for(let e=0;e<t.length;e++)t[e]=!1;return t}function ef(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Ja(2*t);case"bvec3":return Ja(3*t);case"bvec4":return Ja(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const un=[{test:i=>i.type==="float"&&i.size===1&&!i.isArray,code:i=>`
            if(uv["${i}"] !== ud["${i}"].value)
            {
                ud["${i}"].value = uv["${i}"]
                gl.uniform1f(ud["${i}"].location, uv["${i}"])
            }
            `},{test:(i,t)=>(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray&&(t==null||t.castToBaseTexture!==void 0),code:i=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${i}"], t);

            if(ud["${i}"].value !== t)
            {
                ud["${i}"].value = t;
                gl.uniform1i(ud["${i}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(i,t)=>i.type==="mat3"&&i.size===1&&!i.isArray&&t.a!==void 0,code:i=>`
            gl.uniformMatrix3fv(ud["${i}"].location, false, uv["${i}"].toArray(true));
            `,codeUbo:i=>`
                var ${i}_matrix = uv.${i}.toArray(true);

                data[offset] = ${i}_matrix[0];
                data[offset+1] = ${i}_matrix[1];
                data[offset+2] = ${i}_matrix[2];
        
                data[offset + 4] = ${i}_matrix[3];
                data[offset + 5] = ${i}_matrix[4];
                data[offset + 6] = ${i}_matrix[5];
        
                data[offset + 8] = ${i}_matrix[6];
                data[offset + 9] = ${i}_matrix[7];
                data[offset + 10] = ${i}_matrix[8];
            `},{test:(i,t)=>i.type==="vec2"&&i.size===1&&!i.isArray&&t.x!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${i}"].location, v.x, v.y);
                }`,codeUbo:i=>`
                v = uv.${i};

                data[offset] = v.x;
                data[offset+1] = v.y;
            `},{test:i=>i.type==="vec2"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${i}"].location, v[0], v[1]);
                }
            `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.width!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${i}"].location, v.x, v.y, v.width, v.height)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.x;
                    data[offset+1] = v.y;
                    data[offset+2] = v.width;
                    data[offset+3] = v.height;
                `},{test:(i,t)=>i.type==="vec4"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${i}"].location, v.red, v.green, v.blue, v.alpha)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                    data[offset+3] = v.alpha;
                `},{test:(i,t)=>i.type==="vec3"&&i.size===1&&!i.isArray&&t.red!==void 0,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
    
                    gl.uniform3f(ud["${i}"].location, v.red, v.green, v.blue)
                }`,codeUbo:i=>`
                    v = uv.${i};

                    data[offset] = v.red;
                    data[offset+1] = v.green;
                    data[offset+2] = v.blue;
                `},{test:i=>i.type==="vec4"&&i.size===1&&!i.isArray,code:i=>`
                cv = ud["${i}"].value;
                v = uv["${i}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${i}"].location, v[0], v[1], v[2], v[3])
                }`}],kv={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},Nv={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Uv(i,t){var r;const e=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const n in i.uniforms){const s=t[n];if(!s){((r=i.uniforms[n])==null?void 0:r.group)===!0&&(i.uniforms[n].ubo?e.push(`
                        renderer.shader.syncUniformBufferGroup(uv.${n}, '${n}');
                    `):e.push(`
                        renderer.shader.syncUniformGroup(uv.${n}, syncData);
                    `));continue}const a=i.uniforms[n];let h=!1;for(let u=0;u<un.length;u++)if(un[u].test(s,a)){e.push(un[u].code(n,a)),h=!0;break}if(!h){const u=(s.size===1&&!s.isArray?kv:Nv)[s.type].replace("location",`ud["${n}"].location`);e.push(`
            cu = ud["${n}"];
            cv = cu.value;
            v = uv["${n}"];
            ${u};`)}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}const rf={};let Yi=rf;function Gv(){if(Yi===rf||Yi!=null&&Yi.isContextLost()){const i=ft.ADAPTER.createCanvas();let t;ft.PREFER_ENV>=Ui.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),Yi=t}return Yi}let zs;function Hv(){if(!zs){zs=ir.MEDIUM;const i=Gv();if(i&&i.getShaderPrecisionFormat){const t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);t&&(zs=t.precision?ir.HIGH:ir.MEDIUM)}}return zs}function Ec(i,t){const e=i.getShaderSource(t).split(`
`).map((c,m)=>`${m}: ${c}`),r=i.getShaderInfoLog(t),n=r.split(`
`),s={},a=n.map(c=>parseFloat(c.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(c=>c&&!s[c]?(s[c]=!0,!0):!1),h=[""];a.forEach(c=>{e[c-1]=`%c${e[c-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const u=e.join(`
`);h[0]=u,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}function $v(i,t,e,r){i.getProgramParameter(t,i.LINK_STATUS)||(i.getShaderParameter(e,i.COMPILE_STATUS)||Ec(i,e),i.getShaderParameter(r,i.COMPILE_STATUS)||Ec(i,r),console.error("PixiJS Error: Could not initialize shader."),i.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(t)))}const Wv={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function nf(i){return Wv[i]}let Xs=null;const Sc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function sf(i,t){if(!Xs){const e=Object.keys(Sc);Xs={};for(let r=0;r<e.length;++r){const n=e[r];Xs[i[n]]=Sc[n]}}return Xs[t]}function Cc(i,t,e){if(i.substring(0,9)!=="precision"){let r=t;return t===ir.HIGH&&e!==ir.HIGH&&(r=ir.MEDIUM),`precision ${r} float;
${i}`}else if(e!==ir.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}let Nn;function Vv(){if(typeof Nn=="boolean")return Nn;try{Nn=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Nn=!1}return Nn}let jv=0;const Ys={},Hh=class Qi{constructor(t,e,r="pixi-shader",n={}){this.extra={},this.id=jv++,this.vertexSrc=t||Qi.defaultVertexSrc,this.fragmentSrc=e||Qi.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=n,this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Ys[r]?(Ys[r]++,r+=`-${Ys[r]}`):Ys[r]=1,this.vertexSrc=`#define SHADER_NAME ${r}
${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${r}
${this.fragmentSrc}`,this.vertexSrc=Cc(this.vertexSrc,Qi.defaultVertexPrecision,ir.HIGH),this.fragmentSrc=Cc(this.fragmentSrc,Qi.defaultFragmentPrecision,Hv())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return Lv}static get defaultFragmentSrc(){return Ov}static from(t,e,r){const n=t+e;let s=Bh[n];return s||(Bh[n]=s=new Qi(t,e,r)),s}};Hh.defaultVertexPrecision=ir.HIGH,Hh.defaultFragmentPrecision=Lr.apple.device?ir.HIGH:ir.MEDIUM;let Zr=Hh,zv=0;class vr{constructor(t,e,r){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=zv++,this.static=!!e,this.ubo=!!r,t instanceof xe?(this.buffer=t,this.buffer.type=kr.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new xe(new Float32Array(1)),this.buffer.type=kr.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,r){if(!this.ubo)this.uniforms[t]=new vr(e,r);else throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them")}static from(t,e,r){return new vr(t,e,r)}static uboFrom(t,e){return new vr(t,e??!0,!0)}}class Nr{constructor(t,e){this.uniformBindCount=0,this.program=t,e?e instanceof vr?this.uniformGroup=e:this.uniformGroup=new vr(e):this.uniformGroup=new vr({}),this.disposeRunner=new yr("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const r in e.uniforms){const n=e.uniforms[r];if(n.group===!0&&this.checkUniformExists(t,n))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,r){const n=Zr.from(t,e);return new Nr(n,r)}}class Xv{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=s;this.defaultGroupCache[t]=vr.from({uSamplers:r},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Zr(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new qt,default:this.defaultGroupCache[t]};return new Nr(this.programCache[t],e)}generateSampleSrc(t){let e="";e+=`
`,e+=`
`;for(let r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+=`if(vTextureId < ${r}.5)`),e+=`
{`,e+=`
	color = texture2D(uSamplers[${r}], vTextureCoord);`,e+=`
}`;return e+=`
`,e+=`
`,e}}class $h{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}function Yv(){return!Lr.apple.device}function qv(i){let t=!0;const e=ft.ADAPTER.getNavigator();if(Lr.tablet||Lr.phone){if(Lr.apple.device){const r=e.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)<11&&(t=!1)}if(Lr.android.device){const r=e.userAgent.match(/Android\s([0-9.]*)/);r&&parseInt(r[1],10)<7&&(t=!1)}}return t?i:4}class Jo{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}var Kv=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Zv=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`;const jn=class cr extends Jo{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Qd,this.vertexSize=6,this.state=Hr.for2d(),this.size=cr.defaultBatchSize*4,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??qv(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??Yv(),this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return Ct("7.1.0","BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return Zv}static get defaultFragmentTemplate(){return Kv}setShaderGenerator({vertex:t=cr.defaultVertexSrc,fragment:e=cr.defaultFragmentTemplate}={}){this.shaderGenerator=new Xv(t,e)}contextChange(){const t=this.renderer.gl;ft.PREFER_ENV===Ui.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),cr.defaultMaxTextures),this.maxTextures=Ev(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=cr,r=this.size/4,n=Math.floor(r/this.maxTextures)+1;for(;t.length<r;)t.push(new Nh);for(;e.length<n;)e.push(new $h);for(let s=0;s<this.maxTextures;s++)this._tempBoundTextures[s]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,r=cr._textureArrayPool,n=this.renderer.batch,s=this._tempBoundTextures,a=this.renderer.textureGC.count;let h=++Rt._globalBatch,u=0,c=r[0],m=0;n.copyBoundTextures(s,e);for(let y=0;y<this._bufferSize;++y){const v=t[y];t[y]=null,v._batchEnabled!==h&&(c.count>=e&&(n.boundArray(c,s,h,e),this.buildDrawCalls(c,m,y),m=y,c=r[++u],++h),v._batchEnabled=h,v.touched=a,c.elements[c.count++]=v)}c.count>0&&(n.boundArray(c,s,h,e),this.buildDrawCalls(c,m,this._bufferSize),++u,++h);for(let y=0;y<s.length;y++)s[y]=null;Rt._globalBatch=h}buildDrawCalls(t,e,r){const{_bufferedElements:n,_attributeBuffer:s,_indexBuffer:a,vertexSize:h}=this,u=cr._drawCallPool;let c=this._dcIndex,m=this._aIndex,y=this._iIndex,v=u[c];v.start=this._iIndex,v.texArray=t;for(let b=e;b<r;++b){const T=n[b],E=T._texture.baseTexture,P=Al[E.alphaMode?1:0][T.blendMode];n[b]=null,e<b&&v.blend!==P&&(v.size=y-v.start,e=b,v=u[++c],v.texArray=t,v.start=y),this.packInterleavedGeometry(T,s,a,m,y),m+=T.vertexData.length/2*h,y+=T.indices.length,v.blend=P}e<r&&(v.size=y-v.start,++c),this._dcIndex=c,this._aIndex=m,this._iIndex=y}bindAndClearTexArray(t){const e=this.renderer.texture;for(let r=0;r<t.count;r++)e.bind(t.elements[r],t.ids[r]),t.elements[r]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:r}=this;cr.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(r),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:r}=this.renderer,n=cr._drawCallPool;let s=null;for(let a=0;a<t;a++){const{texArray:h,type:u,size:c,start:m,blend:y}=n[a];s!==h&&(s=h,this.bindAndClearTexArray(h)),this.state.blendMode=y,r.set(this.state),e.drawElements(u,c,e.UNSIGNED_SHORT,m*2)}}flush(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),cr.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=as(Math.ceil(t/8)),r=Mh(e),n=e*8;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._aBuffers[n];return s||(this._aBuffers[n]=s=new Oh(n*this.vertexSize*4)),s}getIndexBuffer(t){const e=as(Math.ceil(t/12)),r=Mh(e),n=e*12;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);let s=this._iBuffers[r];return s||(this._iBuffers[r]=s=new Uint16Array(n)),s}packInterleavedGeometry(t,e,r,n,s){const{uint32View:a,float32View:h}=e,u=n/this.vertexSize,c=t.uvs,m=t.indices,y=t.vertexData,v=t._texture.baseTexture._batchLocation,b=Math.min(t.worldAlpha,1),T=kt.shared.setValue(t._tintRGB).toPremultiplied(b,t._texture.baseTexture.alphaMode>0);for(let E=0;E<y.length;E+=2)h[n++]=y[E],h[n++]=y[E+1],h[n++]=c[E],h[n++]=c[E+1],a[n++]=T,h[n++]=v;for(let E=0;E<m.length;E++)r[s++]=u+m[E]}};jn.defaultBatchSize=4096,jn.extension={name:"batch",type:ut.RendererPlugin},jn._drawCallPool=[],jn._textureArrayPool=[];let Mi=jn;mt.add(Mi);var Jv=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Qv=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const Wh=class zn extends Nr{constructor(t,e,r){const n=Zr.from(t||zn.defaultVertexSrc,e||zn.defaultFragmentSrc);super(n,r),this.padding=0,this.resolution=zn.defaultResolution,this.multisample=zn.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new Hr}apply(t,e,r,n,s){t.applyFilter(this,e,r,n)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return Qv}static get defaultFragmentSrc(){return Jv}};Wh.defaultResolution=1,Wh.defaultMultisample=me.NONE;let Ne=Wh;class Mo{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new kt(0),this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender;const{backgroundColor:e,background:r,backgroundAlpha:n}=t,s=r??e;s!==void 0&&(this.color=s),this.alpha=n}get color(){return this._backgroundColor.value}set color(t){this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get backgroundColor(){return this._backgroundColor}destroy(){}}Mo.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0},Mo.extension={type:[ut.RendererSystem,ut.CanvasRendererSystem],name:"background"};mt.add(Mo);class of{constructor(t){this.renderer=t,this.emptyRenderer=new Jo(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:r}=this.renderer.texture;for(let n=e-1;n>=0;--n)t[n]=r[n]||null,t[n]&&(t[n]._batchLocation=n)}boundArray(t,e,r,n){const{elements:s,ids:a,count:h}=t;let u=0;for(let c=0;c<h;c++){const m=s[c],y=m._batchLocation;if(y>=0&&y<n&&e[y]===m){a[c]=y;continue}for(;u<n;){const v=e[u];if(v&&v._batchEnabled===r&&v._batchLocation===u){u++;continue}a[c]=u,m._batchLocation=u,e[u]=m;break}}}destroy(){this.renderer=null}}of.extension={type:ut.RendererSystem,name:"batch"};mt.add(of);let Pc=0;class Io{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=Pc++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,r=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:r,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=Pc++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;e.addEventListener!==void 0&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let r;if(ft.PREFER_ENV>=Ui.WEBGL2&&(r=t.getContext("webgl2",e)),r)this.webGLVersion=2;else if(this.webGLVersion=1,r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!r)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc")};this.webGLVersion===1?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()},0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,t.removeEventListener!==void 0&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),r="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;r&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=r||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=n,n||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}Io.defaultOptions={context:null,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:"default"},Io.extension={type:ut.RendererSystem,name:"context"};mt.add(Io);class Vh{constructor(t,e){if(this.width=Math.round(t),this.height=Math.round(e),!this.width||!this.height)throw new Error("Framebuffer width or height is zero");this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new yr("disposeFramebuffer"),this.multisample=me.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Rt(null,{scaleMode:mr.NEAREST,resolution:1,mipmap:Ur.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Rt(null,{scaleMode:mr.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Ur.OFF,format:at.DEPTH_COMPONENT,type:Et.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),!t||!e)throw new Error("Framebuffer width and height must not be zero");if(!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let r=0;r<this.colorTextures.length;r++){const n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){const r=this.depthTexture.resolution;this.depthTexture.setSize(t/r,e/r)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Sl extends Rt{constructor(t={}){if(typeof t=="number"){const e=arguments[0],r=arguments[1],n=arguments[2],s=arguments[3];t={width:e,height:r,scaleMode:n,resolution:s}}t.width=t.width??100,t.height=t.height??100,t.multisample??(t.multisample=me.NONE),super(null,t),this.mipmap=Ur.OFF,this.valid=!0,this._clear=new kt([0,0,0,0]),this.framebuffer=new Vh(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}set clearColor(t){this._clear.setValue(t)}get clearColor(){return this._clear.value}get clear(){return this._clear}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class ei extends hs{constructor(t){const e=t,r=e.naturalWidth||e.videoWidth||e.displayWidth||e.width,n=e.naturalHeight||e.videoHeight||e.displayHeight||e.height;super(r,n),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,r){r===void 0&&!e.startsWith("data:")?t.crossOrigin=Kd(e):r!==!1&&(t.crossOrigin=typeof r=="string"?r:"anonymous")}upload(t,e,r,n){const s=t.gl,a=e.realWidth,h=e.realHeight;if(n=n||this.source,typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement){if(!n.complete||n.naturalWidth===0)return!1}else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement&&n.readyState<=1)return!1;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===He.UNPACK),!this.noSubImage&&e.target===s.TEXTURE_2D&&r.width===a&&r.height===h?s.texSubImage2D(s.TEXTURE_2D,0,0,0,e.format,r.type,n):(r.width=a,r.height=h,s.texImage2D(e.target,0,r.internalFormat,e.format,r.type,n)),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,r=t.naturalHeight||t.videoHeight||t.height;this.resize(e,r),super.update()}dispose(){this.source=null}}class af extends ei{constructor(t,e){if(e=e||{},typeof t=="string"){const r=new Image;ei.crossOrigin(r,t,e.crossorigin),r.src=t,t=r}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??ft.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.bitmap=null,this._load=null,e.autoLoad!==!1&&this.load()}load(t){return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise((e,r)=>{const n=this.source;this.url=n.src;const s=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.update(),this._load=null,this.createBitmap?e(this.process()):e(this))};n.complete&&n.src?s():(n.onload=s,n.onerror=a=>{r(a),this.onError.emit(a)})}),this._load)}process(){const t=this.source;if(this._process!==null)return this._process;if(this.bitmap!==null||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,r=!t.crossOrigin||t.crossOrigin==="anonymous";return this._process=fetch(t.src,{mode:r?"cors":"no-cors"}).then(n=>n.blob()).then(n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===He.UNPACK?"premultiply":"none"})).then(n=>this.destroyed?Promise.reject():(this.bitmap=n,this.update(),this._process=null,Promise.resolve(this))),this._process}upload(t,e,r){if(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,r);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,r,this.bitmap),!this.preserveBitmap){let n=!0;const s=e._glTextures;for(const a in s){const h=s[a];if(h!==r&&h.dirtyId!==e.dirtyId){n=!1;break}}n&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return typeof HTMLImageElement<"u"&&(typeof t=="string"||t instanceof HTMLImageElement)}}class Cl{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,r){const n=e.width,s=e.height;if(r){const a=t.width/2/n,h=t.height/2/s,u=t.x/n+a,c=t.y/s+h;r=oe.add(r,oe.NW),this.x0=u+a*oe.uX(r),this.y0=c+h*oe.uY(r),r=oe.add(r,2),this.x1=u+a*oe.uX(r),this.y1=c+h*oe.uY(r),r=oe.add(r,2),this.x2=u+a*oe.uX(r),this.y2=c+h*oe.uY(r),r=oe.add(r,2),this.x3=u+a*oe.uX(r),this.y3=c+h*oe.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}Cl.prototype.toString=function(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`};const Rc=new Cl;function qs(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}class pt extends _n{constructor(t,e,r,n,s,a,h){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new It(0,0,1,1)),t instanceof pt&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=n,this.valid=!1,this.destroyed=!1,this._uvs=Rc,this.uvMatrix=null,this.orig=r||e,this._rotate=Number(s||0),s===!0)this._rotate=2;else if(this._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new Ut(a.x,a.y):new Ut(0,0),this.defaultBorders=h,this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:e}=this.baseTexture;e!=null&&e.url&&ke[e.url]&&pt.removeFromCache(e.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,pt.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0,this.emit("destroyed",this),this.removeAllListeners()}clone(){var n;const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),r=new pt(this.baseTexture,!this.noFrame&&t,e,(n=this.trim)==null?void 0:n.clone(),this.rotate,this.defaultAnchor,this.defaultBorders);return this.noFrame&&(r._frame=t),r}updateUvs(){this._uvs===Rc&&(this._uvs=new Cl),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},r=ft.STRICT_TEXTURE_CACHE){const n=typeof t=="string";let s=null;if(n)s=t;else if(t instanceof Rt){if(!t.cacheId){const h=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${h}-${di()}`,Rt.addToCache(t,t.cacheId)}s=t.cacheId}else{if(!t._pixiId){const h=(e==null?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${h}_${di()}`}s=t._pixiId}let a=ke[s];if(n&&r&&!a)throw new Error(`The cacheId "${s}" does not exist in TextureCache.`);return!a&&!(t instanceof Rt)?(e.resolution||(e.resolution=Gr(t)),a=new pt(new Rt(t,e)),a.baseTexture.cacheId=s,Rt.addToCache(a.baseTexture,s),pt.addToCache(a,s)):!a&&t instanceof Rt&&(a=new pt(t),pt.addToCache(a,s)),a}static fromURL(t,e){const r=Object.assign({autoLoad:!1},e==null?void 0:e.resourceOptions),n=pt.from(t,Object.assign({resourceOptions:r},e),!1),s=n.baseTexture.resource;return n.baseTexture.valid?Promise.resolve(n):s.load().then(()=>Promise.resolve(n))}static fromBuffer(t,e,r,n){return new pt(Rt.fromBuffer(t,e,r,n))}static fromLoader(t,e,r,n){const s=new Rt(t,Object.assign({scaleMode:Rt.defaultOptions.scaleMode,resolution:Gr(e)},n)),{resource:a}=s;a instanceof af&&(a.url=e);const h=new pt(s);return r||(r=e),Rt.addToCache(h.baseTexture,r),pt.addToCache(h,r),r!==e&&(Rt.addToCache(h.baseTexture,e),pt.addToCache(h,e)),h.baseTexture.valid?Promise.resolve(h):new Promise(u=>{h.baseTexture.once("loaded",()=>u(h))})}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),ke[e]&&ke[e]!==t&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),ke[e]=t)}static removeFromCache(t){if(typeof t=="string"){const e=ke[t];if(e){const r=e.textureCacheIds.indexOf(t);return r>-1&&e.textureCacheIds.splice(r,1),delete ke[t],e}}else if(t!=null&&t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)ke[t.textureCacheIds[e]]===t&&delete ke[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:r,width:n,height:s}=t,a=e+n>this.baseTexture.width,h=r+s>this.baseTexture.height;if(a||h){const u=a&&h?"and":"or",c=`X: ${e} + ${n} = ${e+n} > ${this.baseTexture.width}`,m=`Y: ${r} + ${s} = ${r+s} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${c} ${u} ${m}`)}this.valid=n&&s&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return pt._EMPTY||(pt._EMPTY=new pt(new Rt),qs(pt._EMPTY),qs(pt._EMPTY.baseTexture)),pt._EMPTY}static get WHITE(){if(!pt._WHITE){const t=ft.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),pt._WHITE=new pt(Rt.from(t)),qs(pt._WHITE),qs(pt._WHITE.baseTexture)}return pt._WHITE}}class _r extends pt{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,r=!0){const n=this.baseTexture.resolution,s=Math.round(t*n)/n,a=Math.round(e*n)/n;this.valid=s>0&&a>0,this._frame.width=this.orig.width=s,this._frame.height=this.orig.height=a,r&&this.baseTexture.resize(s,a),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new _r(new Sl(t))}}class hf{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,r=me.NONE){const n=new Sl(Object.assign({width:t,height:e,resolution:1,multisample:r},this.textureOptions));return new _r(n)}getOptimalTexture(t,e,r=1,n=me.NONE){let s;t=Math.max(Math.ceil(t*r-1e-6),1),e=Math.max(Math.ceil(e*r-1e-6),1),!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight?(t=as(t),e=as(e),s=((t&65535)<<16|e&65535)>>>0,n>1&&(s+=n*4294967296)):s=n>1?-n:-1,this.texturePool[s]||(this.texturePool[s]=[]);let a=this.texturePool[s].pop();return a||(a=this.createTexture(t,e,n)),a.filterPoolKey=s,a.setResolution(r),a}getFilterTexture(t,e,r){const n=this.getOptimalTexture(t.width,t.height,e||t.resolution,r||me.NONE);return n.filterFrame=t.filterFrame,n}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=t!==!1,t)for(const e in this.texturePool){const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}}setScreenSize(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){this.enableFullScreen=t.width>0&&t.height>0;for(const e in this.texturePool){if(!(Number(e)<0))continue;const r=this.texturePool[e];if(r)for(let n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}hf.SCREEN_KEY=-1;class t_ extends fi{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class lf extends fi{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new xe(this.vertices),this.uvBuffer=new xe(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+e.width/t.width,this.uvs[3]=n,this.uvs[4]=r+e.width/t.width,this.uvs[5]=n+e.height/t.height,this.uvs[6]=r,this.uvs[7]=n+e.height/t.height,r=e.x,n=e.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+e.width,this.vertices[3]=n,this.vertices[4]=r+e.width,this.vertices[5]=n+e.height,this.vertices[6]=r,this.vertices[7]=n+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class e_{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=me.NONE,this.sourceFrame=new It,this.destinationFrame=new It,this.bindingSourceFrame=new It,this.bindingDestinationFrame=new It,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const Ks=[new Ut,new Ut,new Ut,new Ut],Qa=new qt;class uf{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new hf,this.statePool=[],this.quad=new t_,this.quadUv=new lf,this.tempRect=new It,this.activeState={},this.globalUniforms=new vr({outputFrame:new It,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const r=this.renderer,n=this.defaultFilterStack,s=this.statePool.pop()||new e_,a=r.renderTexture;let h,u;if(a.current){const P=a.current;h=P.resolution,u=P.multisample}else h=r.resolution,u=r.multisample;let c=e[0].resolution||h,m=e[0].multisample??u,y=e[0].padding,v=e[0].autoFit,b=e[0].legacy??!0;for(let P=1;P<e.length;P++){const M=e[P];c=Math.min(c,M.resolution||h),m=Math.min(m,M.multisample??u),y=this.useMaxPadding?Math.max(y,M.padding):y+M.padding,v=v&&M.autoFit,b=b||(M.legacy??!0)}n.length===1&&(this.defaultFilterStack[0].renderTexture=a.current),n.push(s),s.resolution=c,s.multisample=m,s.legacy=b,s.target=t,s.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),s.sourceFrame.pad(y);const T=this.tempRect.copyFrom(a.sourceFrame);r.projection.transform&&this.transformAABB(Qa.copyFrom(r.projection.transform).invert(),T),v?(s.sourceFrame.fit(T),(s.sourceFrame.width<=0||s.sourceFrame.height<=0)&&(s.sourceFrame.width=0,s.sourceFrame.height=0)):s.sourceFrame.intersects(T)||(s.sourceFrame.width=0,s.sourceFrame.height=0),this.roundFrame(s.sourceFrame,a.current?a.current.resolution:r.resolution,a.sourceFrame,a.destinationFrame,r.projection.transform),s.renderTexture=this.getOptimalFilterTexture(s.sourceFrame.width,s.sourceFrame.height,c,m),s.filters=e,s.destinationFrame.width=s.renderTexture.width,s.destinationFrame.height=s.renderTexture.height;const E=this.tempRect;E.x=0,E.y=0,E.width=s.sourceFrame.width,E.height=s.sourceFrame.height,s.renderTexture.filterFrame=s.sourceFrame,s.bindingSourceFrame.copyFrom(a.sourceFrame),s.bindingDestinationFrame.copyFrom(a.destinationFrame),s.transform=r.projection.transform,r.projection.transform=null,a.bind(s.renderTexture,s.sourceFrame,E),r.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),r=e.filters;this.activeState=e;const n=this.globalUniforms.uniforms;n.outputFrame=e.sourceFrame,n.resolution=e.resolution;const s=n.inputSize,a=n.inputPixel,h=n.inputClamp;if(s[0]=e.destinationFrame.width,s[1]=e.destinationFrame.height,s[2]=1/s[0],s[3]=1/s[1],a[0]=Math.round(s[0]*e.resolution),a[1]=Math.round(s[1]*e.resolution),a[2]=1/a[0],a[3]=1/a[1],h[0]=.5*a[2],h[1]=.5*a[3],h[2]=e.sourceFrame.width*s[2]-.5*a[2],h[3]=e.sourceFrame.height*s[3]-.5*a[3],e.legacy){const c=n.filterArea;c[0]=e.destinationFrame.width,c[1]=e.destinationFrame.height,c[2]=e.sourceFrame.x,c[3]=e.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();const u=t[t.length-1];if(this.renderer.framebuffer.blit(),r.length===1)r[0].apply(this,e.renderTexture,u.renderTexture,Dr.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let c=e.renderTexture,m=this.getOptimalFilterTexture(c.width,c.height,e.resolution);m.filterFrame=c.filterFrame;let y=0;for(y=0;y<r.length-1;++y){y===1&&e.multisample>1&&(m=this.getOptimalFilterTexture(c.width,c.height,e.resolution),m.filterFrame=c.filterFrame),r[y].apply(this,c,m,Dr.CLEAR,e);const v=c;c=m,m=v}r[y].apply(this,c,u.renderTexture,Dr.BLEND,e),y>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(c),this.returnFilterTexture(m)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=Dr.CLEAR){const{renderTexture:r,state:n}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t==null?void 0:t.filterFrame){const a=this.tempRect;a.x=0,a.y=0,a.width=t.filterFrame.width,a.height=t.filterFrame.height,r.bind(t,t.filterFrame,a)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?r.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const s=n.stateId&1||this.forceClear;(e===Dr.CLEAR||e===Dr.BLIT&&s)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,r,n){const s=this.renderer;s.state.set(t.state),this.bindAndClear(r,n),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,s.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),s.geometry.bind(this.quadUv),s.geometry.draw(pr.TRIANGLES)):(s.geometry.bind(this.quad),s.geometry.draw(pr.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:r,destinationFrame:n}=this.activeState,{orig:s}=e._texture,a=t.set(n.width,0,0,n.height,r.x,r.y),h=e.worldTransform.copyTo(qt.TEMP_MATRIX);return h.invert(),a.prepend(h),a.scale(1/s.width,1/s.height),a.translate(e.anchor.x,e.anchor.y),a}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,r=1,n=me.NONE){return this.texturePool.getOptimalTexture(t,e,r,n)}getFilterTexture(t,e,r){if(typeof t=="number"){const s=t;t=e,e=s}t=t||this.activeState.renderTexture;const n=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,r||me.NONE);return n.filterFrame=t.filterFrame,n}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const r=Ks[0],n=Ks[1],s=Ks[2],a=Ks[3];r.set(e.left,e.top),n.set(e.left,e.bottom),s.set(e.right,e.top),a.set(e.right,e.bottom),t.apply(r,r),t.apply(n,n),t.apply(s,s),t.apply(a,a);const h=Math.min(r.x,n.x,s.x,a.x),u=Math.min(r.y,n.y,s.y,a.y),c=Math.max(r.x,n.x,s.x,a.x),m=Math.max(r.y,n.y,s.y,a.y);e.x=h,e.y=u,e.width=c-h,e.height=m-u}roundFrame(t,e,r,n,s){if(!(t.width<=0||t.height<=0||r.width<=0||r.height<=0)){if(s){const{a,b:h,c:u,d:c}=s;if((Math.abs(h)>1e-4||Math.abs(u)>1e-4)&&(Math.abs(a)>1e-4||Math.abs(c)>1e-4))return}s=s?Qa.copyFrom(s):Qa.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.transformAABB(s,t),t.ceil(e),this.transformAABB(s.invert(),t)}}}uf.extension={type:ut.RendererSystem,name:"filter"};mt.add(uf);class r_{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=me.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const i_=new It;class cf{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Vh(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new It,this.hasMRT=!0,this.writeDepthTexture=!0,this.renderer.context.webGLVersion===1){let e=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;ft.PREFER_ENV===Ui.WEBGL_LEGACY&&(e=null,r=null),e?t.drawBuffers=n=>e.drawBuffersWEBGL(n):(this.hasMRT=!1,t.drawBuffers=()=>{}),r||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,r=0){const{gl:n}=this;if(t){const s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.mipLevel!==r&&(t.dirtyId++,t.dirtyFormat++,s.mipLevel=r),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,s.dirtySize=t.dirtySize,this.updateFramebuffer(t,r)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let a=0;a<t.colorTextures.length;a++){const h=t.colorTextures[a];this.renderer.texture.unbind(h.parentTextureArray||h)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const a=e.width>>r,h=e.height>>r,u=a/e.width;this.setViewport(e.x*u,e.y*u,a,h)}else{const a=t.width>>r,h=t.height>>r;this.setViewport(0,0,a,h)}}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,r,n){const s=this.viewport;t=Math.round(t),e=Math.round(e),r=Math.round(r),n=Math.round(n),(s.width!==r||s.height!==n||s.x!==t||s.y!==e)&&(s.x=t,s.y=e,s.width=r,s.height=n,this.gl.viewport(t,e,r,n))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,r,n,s=ph.COLOR|ph.DEPTH){const{gl:a}=this;a.clearColor(t,e,r,n),a.clear(s)}initFramebuffer(t){const{gl:e}=this,r=new r_(e.createFramebuffer());return r.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=r,this.managedFramebuffers.push(t),t.disposeRunner.add(this),r}resizeFramebuffer(t){const{gl:e}=this,r=t.glFramebuffers[this.CONTEXT_UID];if(r.stencil){e.bindRenderbuffer(e.RENDERBUFFER,r.stencil);let a;this.renderer.context.webGLVersion===1?a=e.DEPTH_STENCIL:t.depth&&t.stencil?a=e.DEPTH24_STENCIL8:t.depth?a=e.DEPTH_COMPONENT24:a=e.STENCIL_INDEX8,r.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,a,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,a,t.width,t.height)}const n=t.colorTextures;let s=n.length;e.drawBuffers||(s=Math.min(s,1));for(let a=0;a<s;a++){const h=n[a],u=h.parentTextureArray||h;this.renderer.texture.bind(u,0),a===0&&r.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,r.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,r.multisample,u._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:r}=this,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures;let a=s.length;r.drawBuffers||(a=Math.min(a,1)),n.multisample>1&&this.canMultisampleFramebuffer(t)?n.msaaBuffer=n.msaaBuffer||r.createRenderbuffer():n.msaaBuffer&&(r.deleteRenderbuffer(n.msaaBuffer),n.msaaBuffer=null,n.blitFramebuffer&&(n.blitFramebuffer.dispose(),n.blitFramebuffer=null));const h=[];for(let u=0;u<a;u++){const c=s[u],m=c.parentTextureArray||c;this.renderer.texture.bind(m,0),u===0&&n.msaaBuffer?(r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,m._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer)):(r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+u,c.target,m._glTextures[this.CONTEXT_UID].texture,e),h.push(r.COLOR_ATTACHMENT0+u))}if(h.length>1&&r.drawBuffers(h),t.depthTexture&&this.writeDepthTexture){const u=t.depthTexture;this.renderer.texture.bind(u,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,u._glTextures[this.CONTEXT_UID].texture,e)}if((t.stencil||t.depth)&&!(t.depthTexture&&this.writeDepthTexture)){n.stencil=n.stencil||r.createRenderbuffer();let u,c;this.renderer.context.webGLVersion===1?(u=r.DEPTH_STENCIL_ATTACHMENT,c=r.DEPTH_STENCIL):t.depth&&t.stencil?(u=r.DEPTH_STENCIL_ATTACHMENT,c=r.DEPTH24_STENCIL8):t.depth?(u=r.DEPTH_ATTACHMENT,c=r.DEPTH_COMPONENT24):(u=r.STENCIL_ATTACHMENT,c=r.STENCIL_INDEX8),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),n.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,c,t.width,t.height):r.renderbufferStorage(r.RENDERBUFFER,c,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,u,r.RENDERBUFFER,n.stencil)}else n.stencil&&(r.deleteRenderbuffer(n.stencil),n.stencil=null)}canMultisampleFramebuffer(t){return this.renderer.context.webGLVersion!==1&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let r=me.NONE;if(t<=1||e===null)return r;for(let n=0;n<e.length;n++)if(e[n]<=t){r=e[n];break}return r===1&&(r=me.NONE),r}blit(t,e,r){const{current:n,renderer:s,gl:a,CONTEXT_UID:h}=this;if(s.context.webGLVersion!==2||!n)return;const u=n.glFramebuffers[h];if(!u)return;if(!t){if(!u.msaaBuffer)return;const m=n.colorTextures[0];if(!m)return;u.blitFramebuffer||(u.blitFramebuffer=new Vh(n.width,n.height),u.blitFramebuffer.addColorTexture(0,m)),t=u.blitFramebuffer,t.colorTextures[0]!==m&&(t.colorTextures[0]=m,t.dirtyId++,t.dirtyFormat++),(t.width!==n.width||t.height!==n.height)&&(t.width=n.width,t.height=n.height,t.dirtyId++,t.dirtySize++)}e||(e=i_,e.width=n.width,e.height=n.height),r||(r=e);const c=e.width===r.width&&e.height===r.height;this.bind(t),a.bindFramebuffer(a.READ_FRAMEBUFFER,u.framebuffer),a.blitFramebuffer(e.left,e.top,e.right,e.bottom,r.left,r.top,r.right,r.bottom,a.COLOR_BUFFER_BIT,c?a.NEAREST:a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,t.glFramebuffers[this.CONTEXT_UID].framebuffer)}disposeFramebuffer(t,e){const r=t.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(!r)return;delete t.glFramebuffers[this.CONTEXT_UID];const s=this.managedFramebuffers.indexOf(t);s>=0&&this.managedFramebuffers.splice(s,1),t.disposeRunner.remove(this),e||(n.deleteFramebuffer(r.framebuffer),r.msaaBuffer&&n.deleteRenderbuffer(r.msaaBuffer),r.stencil&&n.deleteRenderbuffer(r.stencil)),r.blitFramebuffer&&this.disposeFramebuffer(r.blitFramebuffer,e)}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let r=0;r<e.length;r++)this.disposeFramebuffer(e[r],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil&&t.stencil)return;t.stencil=!0;const r=t.width,n=t.height,s=this.gl,a=e.stencil=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,a);let h,u;this.renderer.context.webGLVersion===1?(h=s.DEPTH_STENCIL_ATTACHMENT,u=s.DEPTH_STENCIL):t.depth?(h=s.DEPTH_STENCIL_ATTACHMENT,u=s.DEPTH24_STENCIL8):(h=s.STENCIL_ATTACHMENT,u=s.STENCIL_INDEX8),e.msaaBuffer?s.renderbufferStorageMultisample(s.RENDERBUFFER,e.multisample,u,r,n):s.renderbufferStorage(s.RENDERBUFFER,u,r,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,h,s.RENDERBUFFER,a)}reset(){this.current=this.unknownFramebuffer,this.viewport=new It}destroy(){this.renderer=null}}cf.extension={type:ut.RendererSystem,name:"framebuffer"};mt.add(cf);const th={5126:4,5123:2,5121:1};class df{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,e.webGLVersion!==2){let r=this.renderer.context.extensions.vertexArrayObject;ft.PREFER_ENV===Ui.WEBGL_LEGACY&&(r=null),r?(t.createVertexArray=()=>r.createVertexArrayOES(),t.bindVertexArray=n=>r.bindVertexArrayOES(n),t.deleteVertexArray=n=>r.deleteVertexArrayOES(n)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(e.webGLVersion!==2){const r=t.getExtension("ANGLE_instanced_arrays");r?(t.vertexAttribDivisor=(n,s)=>r.vertexAttribDivisorANGLE(n,s),t.drawElementsInstanced=(n,s,a,h,u)=>r.drawElementsInstancedANGLE(n,s,a,h,u),t.drawArraysInstanced=(n,s,a,h)=>r.drawArraysInstancedANGLE(n,s,a,h)):this.hasInstance=!1}this.canUseUInt32ElementIndex=e.webGLVersion===2||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:r}=this;let n=t.glVertexArrayObjects[this.CONTEXT_UID],s=!1;n||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=n={},s=!0);const a=n[e.program.id]||this.initGeometryVao(t,e,s);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?r.bindVertexArray(a):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];e.update(n)}}checkCompatibility(t,e){const r=t.attributes,n=e.attributeData;for(const s in n)if(!r[s])throw new Error(`shader and geometry incompatible, geometry missing the "${s}" attribute`)}getSignature(t,e){const r=t.attributes,n=e.attributeData,s=["g",t.id];for(const a in r)n[a]&&s.push(a,n[a].location);return s.join("-")}initGeometryVao(t,e,r=!0){const n=this.gl,s=this.CONTEXT_UID,a=this.renderer.buffer,h=e.program;h.glPrograms[s]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,h);const u=this.getSignature(t,h),c=t.glVertexArrayObjects[this.CONTEXT_UID];let m=c[u];if(m)return c[h.id]=m,m;const y=t.buffers,v=t.attributes,b={},T={};for(const E in y)b[E]=0,T[E]=0;for(const E in v)!v[E].size&&h.attributeData[E]?v[E].size=h.attributeData[E].size:v[E].size||console.warn(`PIXI Geometry attribute '${E}' size cannot be determined (likely the bound shader does not have the attribute)`),b[v[E].buffer]+=v[E].size*th[v[E].type];for(const E in v){const P=v[E],M=P.size;P.stride===void 0&&(b[P.buffer]===M*th[P.type]?P.stride=0:P.stride=b[P.buffer]),P.start===void 0&&(P.start=T[P.buffer],T[P.buffer]+=M*th[P.type])}m=n.createVertexArray(),n.bindVertexArray(m);for(let E=0;E<y.length;E++){const P=y[E];a.bind(P),r&&P._glBuffers[s].refCount++}return this.activateVao(t,h),c[h.id]=m,c[u]=m,n.bindVertexArray(null),a.unbind(kr.ARRAY_BUFFER),m}disposeGeometry(t,e){var h;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,s=t.buffers,a=(h=this.renderer)==null?void 0:h.buffer;if(t.disposeRunner.remove(this),!!r){if(a)for(let u=0;u<s.length;u++){const c=s[u]._glBuffers[this.CONTEXT_UID];c&&(c.refCount--,c.refCount===0&&!e&&a.dispose(s[u],e))}if(!e){for(const u in r)if(u[0]==="g"){const c=r[u];this._activeVao===c&&this.unbind(),n.deleteVertexArray(c)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let r=0;r<e.length;r++)this.disposeGeometry(this.managedGeometries[e[r]],t)}activateVao(t,e){const r=this.gl,n=this.CONTEXT_UID,s=this.renderer.buffer,a=t.buffers,h=t.attributes;t.indexBuffer&&s.bind(t.indexBuffer);let u=null;for(const c in h){const m=h[c],y=a[m.buffer],v=y._glBuffers[n];if(e.attributeData[c]){u!==v&&(s.bind(y),u=v);const b=e.attributeData[c].location;if(r.enableVertexAttribArray(b),r.vertexAttribPointer(b,m.size,m.type||r.FLOAT,m.normalized,m.stride,m.start),m.instance)if(this.hasInstance)r.vertexAttribDivisor(b,m.divisor);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,e,r,n){const{gl:s}=this,a=this._activeGeometry;if(a.indexBuffer){const h=a.indexBuffer.data.BYTES_PER_ELEMENT,u=h===2?s.UNSIGNED_SHORT:s.UNSIGNED_INT;h===2||h===4&&this.canUseUInt32ElementIndex?a.instanced?s.drawElementsInstanced(t,e||a.indexBuffer.data.length,u,(r||0)*h,n||1):s.drawElements(t,e||a.indexBuffer.data.length,u,(r||0)*h):console.warn("unsupported index buffer type: uint32")}else a.instanced?s.drawArraysInstanced(t,r,e||a.getSize(),n||1):s.drawArrays(t,r,e||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}df.extension={type:ut.RendererSystem,name:"geometry"};mt.add(df);const Mc=new qt;class Pl{constructor(t,e){this._texture=t,this.mapCoord=new qt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){e===void 0&&(e=t);const r=this.mapCoord;for(let n=0;n<t.length;n+=2){const s=t[n],a=t[n+1];e[n]=s*r.a+a*r.c+r.tx,e[n+1]=s*r.b+a*r.d+r.ty}return e}update(t){const e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);const n=e.orig,s=e.trim;s&&(Mc.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Mc));const a=e.baseTexture,h=this.uClampFrame,u=this.clampMargin/a.resolution,c=this.clampOffset;return h[0]=(e._frame.x+u+c)/a.width,h[1]=(e._frame.y+u+c)/a.height,h[2]=(e._frame.x+e._frame.width-u+c)/a.width,h[3]=(e._frame.y+e._frame.height-u+c)/a.height,this.uClampOffset[0]=c/a.realWidth,this.uClampOffset[1]=c/a.realHeight,this.isSimple=e._frame.width===a.width&&e._frame.height===a.height&&e.rotate===0,!0}}var n_=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,s_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`;class o_ extends Ne{constructor(t,e,r){let n=null;typeof t!="string"&&e===void 0&&r===void 0&&(n=t,t=void 0,e=void 0,r=void 0),super(t||s_,e||n_,r),this.maskSprite=n,this.maskMatrix=new qt}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,r,n){const s=this._maskSprite,a=s._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Pl(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,s).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=s.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,e,r,n))}}class a_{constructor(t=null){this.type=_e.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Ne.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=_e.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class ff{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let r=e;if(!r.isMaskData){const s=this.maskDataPool.pop()||new a_;s.pooled=!0,s.maskObject=e,r=s}const n=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null;if(r.copyCountersOrReset(n),r._colorMask=n?n._colorMask:15,r.autoDetect&&this.detect(r),r._target=t,r.type!==_e.SPRITE&&this.maskStack.push(r),r.enabled)switch(r.type){case _e.SCISSOR:this.renderer.scissor.push(r);break;case _e.STENCIL:this.renderer.stencil.push(r);break;case _e.SPRITE:r.copyCountersOrReset(null),this.pushSpriteMask(r);break;case _e.COLOR:this.pushColorMask(r);break}r.type===_e.SPRITE&&this.maskStack.push(r)}pop(t){const e=this.maskStack.pop();if(!(!e||e._target!==t)){if(e.enabled)switch(e.type){case _e.SCISSOR:this.renderer.scissor.pop(e);break;case _e.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case _e.SPRITE:this.popSpriteMask(e);break;case _e.COLOR:this.popColorMask(e);break}if(e.reset(),e.pooled&&this.maskDataPool.push(e),this.maskStack.length!==0){const r=this.maskStack[this.maskStack.length-1];r.type===_e.SPRITE&&r._filters&&(r._filters[0].maskSprite=r.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=_e.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=_e.SCISSOR:t.type=_e.STENCIL:t.type=_e.COLOR}pushSpriteMask(t){const{maskObject:e}=t,r=t._target;let n=t._filters;n||(n=this.alphaMaskPool[this.alphaMaskIndex],n||(n=this.alphaMaskPool[this.alphaMaskIndex]=[new o_])),n[0].resolution=t.resolution,n[0].multisample=t.multisample,n[0].maskSprite=e;const s=r.filterArea;r.filterArea=e.getBounds(!0),this.renderer.filter.push(r,n),r.filterArea=s,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,r=t._colorMask=e&t.colorMask;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}popColorMask(t){const e=t._colorMask,r=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;r!==e&&this.renderer.gl.colorMask((r&1)!==0,(r&2)!==0,(r&4)!==0,(r&8)!==0)}destroy(){this.renderer=null}}ff.extension={type:ut.RendererSystem,name:"mask"};mt.add(ff);class pf{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,r=this.getStackLength();this.maskStack=t;const n=this.getStackLength();n!==r&&(n===0?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Ic=new qt,Fc=[],mf=class mo extends pf{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:r}=t,{renderer:n}=this,s=n.renderTexture,a=r.getBounds(!0,Fc.pop()??new It);this.roundFrameToPixels(a,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),e&&a.fit(e),t._scissorRectLocal=a}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:r,c:n,d:s}=t;return(Math.abs(r)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(s)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect()||mo.isMatrixRotated(e.worldTransform)||mo.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const r=t._scissorRectLocal;return r.width>0&&r.height>0}roundFrameToPixels(t,e,r,n,s){mo.isMatrixRotated(s)||(s=s?Ic.copyFrom(s):Ic.identity(),s.translate(-r.x,-r.y).scale(n.width/r.width,n.height/r.height).translate(n.x,n.y),this.renderer.filter.transformAABB(s,t),t.fit(n),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Fc.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;this.renderer.renderTexture.current?e=t.y:e=this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};mf.extension={type:ut.RendererSystem,name:"scissor"};let h_=mf;mt.add(h_);class gf extends pf{constructor(t){super(t),this.glConst=ft.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:r}=this.renderer,n=t._stencilCounter;n===0&&(this.renderer.framebuffer.forceStencil(),r.clearStencil(0),r.clear(r.STENCIL_BUFFER_BIT),r.enable(r.STENCIL_TEST)),t._stencilCounter++;const s=t._colorMask;s!==0&&(t._colorMask=0,r.colorMask(!1,!1,!1,!1)),r.stencilFunc(r.EQUAL,n,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,s!==0&&(t._colorMask=s,r.colorMask((s&1)!==0,(s&2)!==0,(s&4)!==0,(s&8)!==0)),this._useCurrent()}pop(t){const e=this.renderer.gl;if(this.getStackLength()===0)e.disable(e.STENCIL_TEST);else{const r=this.maskStack.length!==0?this.maskStack[this.maskStack.length-1]:null,n=r?r._colorMask:15;n!==0&&(r._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,n!==0&&(r._colorMask=n,e.colorMask((n&1)!==0,(n&2)!==0,(n&4)!==0,(n&8)!==0)),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}gf.extension={type:ut.RendererSystem,name:"stencil"};mt.add(gf);class yf{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.extract has moved to renderer.extract"),t.extract}},prepare:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.prepare has moved to renderer.prepare"),t.prepare}},interaction:{enumerable:!1,get(){return Ct("7.0.0","renderer.plugins.interaction has been deprecated, use renderer.events"),t.events}}})}init(){const t=this.rendererPlugins;for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}yf.extension={type:[ut.RendererSystem,ut.CanvasRendererSystem],name:"_plugin"};mt.add(yf);class vf{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new qt,this.transform=null}update(t,e,r,n){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);const s=this.renderer;s.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,s.globalUniforms.update(),s.shader.shader&&s.shader.syncUniformGroup(s.shader.shader.uniforms.globals)}calculateProjection(t,e,r,n){const s=this.projectionMatrix,a=n?-1:1;s.identity(),s.a=1/e.width*2,s.d=a*(1/e.height*2),s.tx=-1-e.x*s.a,s.ty=-a-e.y*s.d}setTransform(t){}destroy(){this.renderer=null}}vf.extension={type:ut.RendererSystem,name:"projection"};mt.add(vf);const l_=new Zo,Bc=new It;class _f{constructor(t){this.renderer=t,this._tempMatrix=new qt}generateTexture(t,e){const{region:r,...n}=e||{},s=(r==null?void 0:r.copyTo(Bc))||t.getLocalBounds(Bc,!0),a=n.resolution||this.renderer.resolution;s.width=Math.max(s.width,1/a),s.height=Math.max(s.height,1/a),n.width=s.width,n.height=s.height,n.resolution=a,n.multisample??(n.multisample=this.renderer.multisample);const h=_r.create(n);this._tempMatrix.tx=-s.x,this._tempMatrix.ty=-s.y;const u=t.transform;return t.transform=l_,this.renderer.render(t,{renderTexture:h,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=u,h}destroy(){}}_f.extension={type:[ut.RendererSystem,ut.CanvasRendererSystem],name:"textureGenerator"};mt.add(_f);const Ai=new It,Un=new It;class xf{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new It,this.destinationFrame=new It,this.viewportFrame=new It}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}bind(t=null,e,r){const n=this.renderer;this.current=t;let s,a,h;t?(s=t.baseTexture,h=s.resolution,e||(Ai.width=t.frame.width,Ai.height=t.frame.height,e=Ai),r||(Un.x=t.frame.x,Un.y=t.frame.y,Un.width=e.width,Un.height=e.height,r=Un),a=s.framebuffer):(h=n.resolution,e||(Ai.width=n._view.screen.width,Ai.height=n._view.screen.height,e=Ai),r||(r=Ai,r.width=e.width,r.height=e.height));const u=this.viewportFrame;u.x=r.x*h,u.y=r.y*h,u.width=r.width*h,u.height=r.height*h,t||(u.y=n.view.height-(u.y+u.height)),u.ceil(),this.renderer.framebuffer.bind(a,u),this.renderer.projection.update(r,e,h,!a),t?this.renderer.mask.setMaskStack(s.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(r)}clear(t,e){const r=this.current?this.current.baseTexture.clear:this.renderer.background.backgroundColor,n=kt.shared.setValue(t||r);(this.current&&this.current.baseTexture.alphaMode>0||!this.current&&this._rendererPremultipliedAlpha)&&n.premultiply(n.alpha);const s=this.destinationFrame,a=this.current?this.current.baseTexture:this.renderer._view.screen,h=s.width!==a.width||s.height!==a.height;if(h){let{x:u,y:c,width:m,height:y}=this.viewportFrame;u=Math.round(u),c=Math.round(c),m=Math.round(m),y=Math.round(y),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(u,c,m,y)}this.renderer.framebuffer.clear(n.red,n.green,n.blue,n.alpha,e),h&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}xf.extension={type:ut.RendererSystem,name:"renderTexture"};mt.add(xf);class u_{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function c_(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES);for(let n=0;n<r;n++){const s=t.getActiveAttrib(i,n);if(s.name.startsWith("gl_"))continue;const a=sf(t,s.type),h={type:a,name:s.name,size:nf(a),location:t.getAttribLocation(i,s.name)};e[s.name]=h}return e}function d_(i,t){const e={},r=t.getProgramParameter(i,t.ACTIVE_UNIFORMS);for(let n=0;n<r;n++){const s=t.getActiveUniform(i,n),a=s.name.replace(/\[.*?\]$/,""),h=!!s.name.match(/\[.*?\]$/),u=sf(t,s.type);e[a]={name:a,index:n,type:u,size:s.size,isArray:h,value:ef(u,s.size)}}return e}function f_(i,t){var h;const e=Ac(i,i.VERTEX_SHADER,t.vertexSrc),r=Ac(i,i.FRAGMENT_SHADER,t.fragmentSrc),n=i.createProgram();i.attachShader(n,e),i.attachShader(n,r);const s=(h=t.extra)==null?void 0:h.transformFeedbackVaryings;if(s&&(typeof i.transformFeedbackVaryings!="function"?console.warn("TransformFeedback is not supported but TransformFeedbackVaryings are given."):i.transformFeedbackVaryings(n,s.names,s.bufferMode==="separate"?i.SEPARATE_ATTRIBS:i.INTERLEAVED_ATTRIBS)),i.linkProgram(n),i.getProgramParameter(n,i.LINK_STATUS)||$v(i,n,e,r),t.attributeData=c_(n,i),t.uniformData=d_(n,i),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertexSrc)){const u=Object.keys(t.attributeData);u.sort((c,m)=>c>m?1:-1);for(let c=0;c<u.length;c++)t.attributeData[u[c]].location=c,i.bindAttribLocation(n,c,u[c]);i.linkProgram(n)}i.deleteShader(e),i.deleteShader(r);const a={};for(const u in t.uniformData){const c=t.uniformData[u];a[u]={location:i.getUniformLocation(n,u),value:ef(c.type,c.size)}}return new u_(n,a)}function p_(i,t,e,r,n){e.buffer.update(n)}const m_={float:`
        data[offset] = v;
    `,vec2:`
        data[offset] = v[0];
        data[offset+1] = v[1];
    `,vec3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

    `,vec4:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];
        data[offset+3] = v[3];
    `,mat2:`
        data[offset] = v[0];
        data[offset+1] = v[1];

        data[offset+4] = v[2];
        data[offset+5] = v[3];
    `,mat3:`
        data[offset] = v[0];
        data[offset+1] = v[1];
        data[offset+2] = v[2];

        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];

        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];
    `,mat4:`
        for(var i = 0; i < 16; i++)
        {
            data[offset + i] = v[i];
        }
    `},bf={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:16*2,mat3:16*3,mat4:16*4};function g_(i){const t=i.map(s=>({data:s,offset:0,dataLen:0,dirty:0}));let e=0,r=0,n=0;for(let s=0;s<t.length;s++){const a=t[s];if(e=bf[a.data.type],a.data.size>1&&(e=Math.max(e,16)*a.data.size),a.dataLen=e,r%e!==0&&r<16){const h=r%e%16;r+=h,n+=h}r+e>16?(n=Math.ceil(n/16)*16,a.offset=n,n+=e,r=e):(a.offset=n,r+=e,n+=e)}return n=Math.ceil(n/16)*16,{uboElements:t,size:n}}function y_(i,t){const e=[];for(const r in i)t[r]&&e.push(t[r]);return e.sort((r,n)=>r.index-n.index),e}function v_(i,t){if(!i.autoManage)return{size:0,syncFunc:p_};const e=y_(i.uniforms,t),{uboElements:r,size:n}=g_(e),s=[`
    var v = null;
    var v2 = null;
    var cv = null;
    var t = 0;
    var gl = renderer.gl
    var index = 0;
    var data = buffer.data;
    `];for(let a=0;a<r.length;a++){const h=r[a],u=i.uniforms[h.data.name],c=h.data.name;let m=!1;for(let y=0;y<un.length;y++){const v=un[y];if(v.codeUbo&&v.test(h.data,u)){s.push(`offset = ${h.offset/4};`,un[y].codeUbo(h.data.name,u)),m=!0;break}}if(!m)if(h.data.size>1){const y=nf(h.data.type),v=Math.max(bf[h.data.type]/16,1),b=y/v,T=(4-b%4)%4;s.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${h.offset/4};

                t = 0;

                for(var i=0; i < ${h.data.size*v}; i++)
                {
                    for(var j = 0; j < ${b}; j++)
                    {
                        data[offset++] = v[t++];
                    }
                    offset += ${T};
                }

                `)}else{const y=m_[h.data.type];s.push(`
                cv = ud.${c}.value;
                v = uv.${c};
                offset = ${h.offset/4};
                ${y};
                `)}}return s.push(`
       renderer.buffer.update(buffer);
    `),{size:n,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join(`
`))}}let __=0;const Zs={textureCount:0,uboCount:0};class Tf{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=__++}systemCheck(){if(!Vv())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const r=t.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),e||(Zs.textureCount=0,Zs.uboCount=0,this.syncUniformGroup(t.uniformGroup,Zs)),n}setUniforms(t){const e=this.shader.program,r=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(r.uniformData,t,this.renderer)}syncUniformGroup(t,e){const r=this.getGlProgram();(!t.static||t.dirtyId!==r.uniformDirtyGroups[t.id])&&(r.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,r,e))}syncUniforms(t,e,r){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,r)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=Uv(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const r=this.getGlProgram();if(!t.static||t.dirtyId!==0||!r.uniformGroups[t.id]){t.dirtyId=0;const n=r.uniformGroups[t.id]||this.createSyncBufferGroup(t,r,e);t.buffer.update(),n(r.uniformData,t.uniforms,this.renderer,Zs,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,r.uniformBufferBindings[e])}createSyncBufferGroup(t,e,r){const{gl:n}=this.renderer;this.renderer.buffer.bind(t.buffer);const s=this.gl.getUniformBlockIndex(e.program,r);e.uniformBufferBindings[r]=this.shader.uniformBindCount,n.uniformBlockBinding(e.program,s,this.shader.uniformBindCount),this.shader.uniformBindCount++;const a=this.getSignature(t,this.shader.program.uniformData,"ubo");let h=this._uboCache[a];if(h||(h=this._uboCache[a]=v_(t,this.shader.program.uniformData)),t.autoManage){const u=new Float32Array(h.size/4);t.buffer.update(u)}return e.uniformGroups[t.id]=h.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,r){const n=t.uniforms,s=[`${r}-`];for(const a in n)s.push(a),e[a]&&s.push(e[a].type);return s.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,r=t.program,n=f_(e,r);return r.glPrograms[this.renderer.CONTEXT_UID]=n,n}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}Tf.extension={type:ut.RendererSystem,name:"shader"};mt.add(Tf);class Fo{constructor(t){this.renderer=t}run(t){const{renderer:e}=this;e.runners.init.emit(e.options),t.hello&&console.log(`PixiJS 7.4.2 - ${e.rendererLogId} - https://pixijs.com`),e.resize(e.screen.width,e.screen.height)}destroy(){}}Fo.defaultOptions={hello:!1},Fo.extension={type:[ut.RendererSystem,ut.CanvasRendererSystem],name:"startup"};mt.add(Fo);function x_(i,t=[]){return t[rt.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.ADD]=[i.ONE,i.ONE],t[rt.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.NONE]=[0,0],t[rt.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[rt.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[rt.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[rt.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[rt.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[rt.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[rt.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[rt.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[rt.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[rt.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[rt.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}const b_=0,T_=1,w_=2,A_=3,E_=4,S_=5,wf=class jh{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=rt.NONE,this._blendEq=!1,this.map=[],this.map[b_]=this.setBlend,this.map[T_]=this.setOffset,this.map[w_]=this.setCullFace,this.map[A_]=this.setDepthTest,this.map[E_]=this.setFrontFace,this.map[S_]=this.setDepthMask,this.checks=[],this.defaultState=new Hr,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=x_(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(jh.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(jh.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};wf.extension={type:ut.RendererSystem,name:"state"};let C_=wf;mt.add(C_);class Af extends _n{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter(n=>t.systems[n]),r=[...e,...Object.keys(t.systems).filter(n=>!e.includes(n))];for(const n of r)this.addSystem(t.systems[n],n)}addRunners(...t){t.forEach(e=>{this.runners[e]=new yr(e)})}addSystem(t,e){const r=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=r,this._systemsHash[e]=r;for(const n in this.runners)this.runners[n].add(r);return this}emitWithCustomOptions(t,e){const r=Object.keys(this._systemsHash);t.items.forEach(n=>{const s=r.find(a=>this._systemsHash[a]===n);n[t.name](e[s])})}destroy(){Object.values(this.runners).forEach(t=>{t.destroy()}),this._systemsHash={}}}const Xn=class go{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=go.defaultMaxIdle,this.checkCountMax=go.defaultCheckCountMax,this.mode=go.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==gl.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let r=!1;for(let n=0;n<e.length;n++){const s=e[n];s.resource&&this.count-s.touched>this.maxIdle&&(t.destroyTexture(s,!0),e[n]=null,r=!0)}if(r){let n=0;for(let s=0;s<e.length;s++)e[s]!==null&&(e[n++]=e[s]);e.length=n}}unload(t){const e=this.renderer.texture,r=t._texture;r&&!r.framebuffer&&e.destroyTexture(r);for(let n=t.children.length-1;n>=0;n--)this.unload(t.children[n])}destroy(){this.renderer=null}};Xn.defaultMode=gl.AUTO,Xn.defaultMaxIdle=60*60,Xn.defaultCheckCountMax=60*10,Xn.extension={type:ut.RendererSystem,name:"textureGC"};let Ii=Xn;mt.add(Ii);class eh{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=Et.UNSIGNED_BYTE,this.internalFormat=at.RGBA,this.samplerType=0}}function P_(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[i.RGB]:gt.FLOAT,[i.RGBA]:gt.FLOAT,[i.ALPHA]:gt.FLOAT,[i.LUMINANCE]:gt.FLOAT,[i.LUMINANCE_ALPHA]:gt.FLOAT,[i.R8]:gt.FLOAT,[i.R8_SNORM]:gt.FLOAT,[i.RG8]:gt.FLOAT,[i.RG8_SNORM]:gt.FLOAT,[i.RGB8]:gt.FLOAT,[i.RGB8_SNORM]:gt.FLOAT,[i.RGB565]:gt.FLOAT,[i.RGBA4]:gt.FLOAT,[i.RGB5_A1]:gt.FLOAT,[i.RGBA8]:gt.FLOAT,[i.RGBA8_SNORM]:gt.FLOAT,[i.RGB10_A2]:gt.FLOAT,[i.RGB10_A2UI]:gt.FLOAT,[i.SRGB8]:gt.FLOAT,[i.SRGB8_ALPHA8]:gt.FLOAT,[i.R16F]:gt.FLOAT,[i.RG16F]:gt.FLOAT,[i.RGB16F]:gt.FLOAT,[i.RGBA16F]:gt.FLOAT,[i.R32F]:gt.FLOAT,[i.RG32F]:gt.FLOAT,[i.RGB32F]:gt.FLOAT,[i.RGBA32F]:gt.FLOAT,[i.R11F_G11F_B10F]:gt.FLOAT,[i.RGB9_E5]:gt.FLOAT,[i.R8I]:gt.INT,[i.R8UI]:gt.UINT,[i.R16I]:gt.INT,[i.R16UI]:gt.UINT,[i.R32I]:gt.INT,[i.R32UI]:gt.UINT,[i.RG8I]:gt.INT,[i.RG8UI]:gt.UINT,[i.RG16I]:gt.INT,[i.RG16UI]:gt.UINT,[i.RG32I]:gt.INT,[i.RG32UI]:gt.UINT,[i.RGB8I]:gt.INT,[i.RGB8UI]:gt.UINT,[i.RGB16I]:gt.INT,[i.RGB16UI]:gt.UINT,[i.RGB32I]:gt.INT,[i.RGB32UI]:gt.UINT,[i.RGBA8I]:gt.INT,[i.RGBA8UI]:gt.UINT,[i.RGBA16I]:gt.INT,[i.RGBA16UI]:gt.UINT,[i.RGBA32I]:gt.INT,[i.RGBA32UI]:gt.UINT,[i.DEPTH_COMPONENT16]:gt.FLOAT,[i.DEPTH_COMPONENT24]:gt.FLOAT,[i.DEPTH_COMPONENT32F]:gt.FLOAT,[i.DEPTH_STENCIL]:gt.FLOAT,[i.DEPTH24_STENCIL8]:gt.FLOAT,[i.DEPTH32F_STENCIL8]:gt.FLOAT}:t={[i.RGB]:gt.FLOAT,[i.RGBA]:gt.FLOAT,[i.ALPHA]:gt.FLOAT,[i.LUMINANCE]:gt.FLOAT,[i.LUMINANCE_ALPHA]:gt.FLOAT,[i.DEPTH_STENCIL]:gt.FLOAT},t}function R_(i){let t;return"WebGL2RenderingContext"in globalThis&&i instanceof globalThis.WebGL2RenderingContext?t={[Et.UNSIGNED_BYTE]:{[at.RGBA]:i.RGBA8,[at.RGB]:i.RGB8,[at.RG]:i.RG8,[at.RED]:i.R8,[at.RGBA_INTEGER]:i.RGBA8UI,[at.RGB_INTEGER]:i.RGB8UI,[at.RG_INTEGER]:i.RG8UI,[at.RED_INTEGER]:i.R8UI,[at.ALPHA]:i.ALPHA,[at.LUMINANCE]:i.LUMINANCE,[at.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Et.BYTE]:{[at.RGBA]:i.RGBA8_SNORM,[at.RGB]:i.RGB8_SNORM,[at.RG]:i.RG8_SNORM,[at.RED]:i.R8_SNORM,[at.RGBA_INTEGER]:i.RGBA8I,[at.RGB_INTEGER]:i.RGB8I,[at.RG_INTEGER]:i.RG8I,[at.RED_INTEGER]:i.R8I},[Et.UNSIGNED_SHORT]:{[at.RGBA_INTEGER]:i.RGBA16UI,[at.RGB_INTEGER]:i.RGB16UI,[at.RG_INTEGER]:i.RG16UI,[at.RED_INTEGER]:i.R16UI,[at.DEPTH_COMPONENT]:i.DEPTH_COMPONENT16},[Et.SHORT]:{[at.RGBA_INTEGER]:i.RGBA16I,[at.RGB_INTEGER]:i.RGB16I,[at.RG_INTEGER]:i.RG16I,[at.RED_INTEGER]:i.R16I},[Et.UNSIGNED_INT]:{[at.RGBA_INTEGER]:i.RGBA32UI,[at.RGB_INTEGER]:i.RGB32UI,[at.RG_INTEGER]:i.RG32UI,[at.RED_INTEGER]:i.R32UI,[at.DEPTH_COMPONENT]:i.DEPTH_COMPONENT24},[Et.INT]:{[at.RGBA_INTEGER]:i.RGBA32I,[at.RGB_INTEGER]:i.RGB32I,[at.RG_INTEGER]:i.RG32I,[at.RED_INTEGER]:i.R32I},[Et.FLOAT]:{[at.RGBA]:i.RGBA32F,[at.RGB]:i.RGB32F,[at.RG]:i.RG32F,[at.RED]:i.R32F,[at.DEPTH_COMPONENT]:i.DEPTH_COMPONENT32F},[Et.HALF_FLOAT]:{[at.RGBA]:i.RGBA16F,[at.RGB]:i.RGB16F,[at.RG]:i.RG16F,[at.RED]:i.R16F},[Et.UNSIGNED_SHORT_5_6_5]:{[at.RGB]:i.RGB565},[Et.UNSIGNED_SHORT_4_4_4_4]:{[at.RGBA]:i.RGBA4},[Et.UNSIGNED_SHORT_5_5_5_1]:{[at.RGBA]:i.RGB5_A1},[Et.UNSIGNED_INT_2_10_10_10_REV]:{[at.RGBA]:i.RGB10_A2,[at.RGBA_INTEGER]:i.RGB10_A2UI},[Et.UNSIGNED_INT_10F_11F_11F_REV]:{[at.RGB]:i.R11F_G11F_B10F},[Et.UNSIGNED_INT_5_9_9_9_REV]:{[at.RGB]:i.RGB9_E5},[Et.UNSIGNED_INT_24_8]:{[at.DEPTH_STENCIL]:i.DEPTH24_STENCIL8},[Et.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[at.DEPTH_STENCIL]:i.DEPTH32F_STENCIL8}}:t={[Et.UNSIGNED_BYTE]:{[at.RGBA]:i.RGBA,[at.RGB]:i.RGB,[at.ALPHA]:i.ALPHA,[at.LUMINANCE]:i.LUMINANCE,[at.LUMINANCE_ALPHA]:i.LUMINANCE_ALPHA},[Et.UNSIGNED_SHORT_5_6_5]:{[at.RGB]:i.RGB},[Et.UNSIGNED_SHORT_4_4_4_4]:{[at.RGBA]:i.RGBA},[Et.UNSIGNED_SHORT_5_5_5_1]:{[at.RGBA]:i.RGBA}},t}class Ef{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Rt,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=R_(t),this.samplerTypes=P_(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let n=0;n<e;n++)this.boundTextures[n]=null;this.emptyTextures={};const r=new eh(t.createTexture());t.bindTexture(t.TEXTURE_2D,r.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=r,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new eh(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let n=0;n<this.boundTextures.length;n++)this.bind(null,n)}bind(t,e=0){const{gl:r}=this;if(t=t==null?void 0:t.castToBaseTexture(),(t==null?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const n=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(t.target,n.texture)),n.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),this.updateTexture(t)):n.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,r.activeTexture(r.TEXTURE0+e)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:r}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(let n=0;n<r.length;n++)r[n]===t&&(this.currentLocation!==n&&(e.activeTexture(e.TEXTURE0+n),this.currentLocation=n),e.bindTexture(t.target,this.emptyTextures[t.target].texture),r[n]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:r,CONTEXT_UID:n}=this;if(r)for(let s=t-1;s>=0;--s){const a=e[s];a&&a._glTextures[n].samplerType!==gt.FLOAT&&this.renderer.texture.unbind(a)}}initTexture(t){const e=new eh(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var r;e.internalFormat=((r=this.internalFormats[t.type])==null?void 0:r[t.format])??t.format,e.samplerType=this.samplerTypes[e.internalFormat]??gt.FLOAT,this.webGLVersion===2&&t.type===Et.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var n;const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const r=this.renderer;if(this.initTextureType(t,e),(n=t.resource)==null?void 0:n.upload(r,t,e))e.samplerType!==gt.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,a=t.realHeight,h=r.gl;(e.width!==s||e.height!==a||e.dirtyId<0)&&(e.width=s,e.height=a,h.texImage2D(t.target,0,e.internalFormat,s,a,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:r}=this;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),r.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const n=this.managedTextures.indexOf(t);n!==-1&&Oi(this.managedTextures,n,1)}}updateTextureStyle(t){var r;const e=t._glTextures[this.CONTEXT_UID];e&&((t.mipmap===Ur.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?e.mipmap=!1:e.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?e.wrapMode=Jr.CLAMP:e.wrapMode=t.wrapMode,(r=t.resource)!=null&&r.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const r=this.gl;if(e.mipmap&&t.mipmap!==Ur.ON_MANUAL&&r.generateMipmap(t.target),r.texParameteri(t.target,r.TEXTURE_WRAP_S,e.wrapMode),r.texParameteri(t.target,r.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===mr.LINEAR?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);const n=this.renderer.context.extensions.anisotropicFiltering;if(n&&t.anisotropicLevel>0&&t.scaleMode===mr.LINEAR){const s=Math.min(t.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(t.target,n.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else r.texParameteri(t.target,r.TEXTURE_MIN_FILTER,t.scaleMode===mr.LINEAR?r.LINEAR:r.NEAREST);r.texParameteri(t.target,r.TEXTURE_MAG_FILTER,t.scaleMode===mr.LINEAR?r.LINEAR:r.NEAREST)}destroy(){this.renderer=null}}Ef.extension={type:ut.RendererSystem,name:"texture"};mt.add(Ef);class Sf{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glTransformFeedbacks[r]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,n)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:r,renderer:n}=this;e&&n.shader.bind(e),r.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:r,CONTEXT_UID:n}=this,s=e.createTransformFeedback();t._glTransformFeedbacks[n]=s,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s);for(let a=0;a<t.buffers.length;a++){const h=t.buffers[a];h&&(r.buffer.update(h),h._glBuffers[n].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,a,h._glBuffers[n].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),s}disposeTransformFeedback(t,e){const r=t._glTransformFeedbacks[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this);const s=this.renderer.buffer;if(s)for(let a=0;a<t.buffers.length;a++){const h=t.buffers[a];if(!h)continue;const u=h._glBuffers[this.CONTEXT_UID];u&&(u.refCount--,u.refCount===0&&!e&&s.dispose(h,e))}r&&(e||n.deleteTransformFeedback(r),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}Sf.extension={type:ut.RendererSystem,name:"transformFeedback"};mt.add(Sf);class Bo{constructor(t){this.renderer=t}init(t){this.screen=new It(0,0,t.width,t.height),this.element=t.view||ft.ADAPTER.createCanvas(),this.resolution=t.resolution||ft.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const r=this.element.width/this.resolution,n=this.element.height/this.resolution;this.screen.width=r,this.screen.height=n,this.autoDensity&&(this.element.style.width=`${r}px`,this.element.style.height=`${n}px`),this.renderer.emit("resize",r,n),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&((e=this.element.parentNode)==null||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}Bo.defaultOptions={width:800,height:600,resolution:void 0,autoDensity:!1},Bo.extension={type:[ut.RendererSystem,ut.CanvasRendererSystem],name:"_view"};mt.add(Bo);ft.PREFER_ENV=Ui.WEBGL2;ft.STRICT_TEXTURE_CACHE=!1;ft.RENDER_OPTIONS={...Io.defaultOptions,...Mo.defaultOptions,...Bo.defaultOptions,...Fo.defaultOptions};Object.defineProperties(ft,{WRAP_MODE:{get(){return Rt.defaultOptions.wrapMode},set(i){Ct("7.1.0","settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Rt.defaultOptions.wrapMode=i}},SCALE_MODE:{get(){return Rt.defaultOptions.scaleMode},set(i){Ct("7.1.0","settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Rt.defaultOptions.scaleMode=i}},MIPMAP_TEXTURES:{get(){return Rt.defaultOptions.mipmap},set(i){Ct("7.1.0","settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Rt.defaultOptions.mipmap=i}},ANISOTROPIC_LEVEL:{get(){return Rt.defaultOptions.anisotropicLevel},set(i){Ct("7.1.0","settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Rt.defaultOptions.anisotropicLevel=i}},FILTER_RESOLUTION:{get(){return Ct("7.1.0","settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),Ne.defaultResolution},set(i){Ne.defaultResolution=i}},FILTER_MULTISAMPLE:{get(){return Ct("7.1.0","settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),Ne.defaultMultisample},set(i){Ne.defaultMultisample=i}},SPRITE_MAX_TEXTURES:{get(){return Mi.defaultMaxTextures},set(i){Ct("7.1.0","settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),Mi.defaultMaxTextures=i}},SPRITE_BATCH_SIZE:{get(){return Mi.defaultBatchSize},set(i){Ct("7.1.0","settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),Mi.defaultBatchSize=i}},CAN_UPLOAD_SAME_BUFFER:{get(){return Mi.canUploadSameBuffer},set(i){Ct("7.1.0","settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),Mi.canUploadSameBuffer=i}},GC_MODE:{get(){return Ii.defaultMode},set(i){Ct("7.1.0","settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),Ii.defaultMode=i}},GC_MAX_IDLE:{get(){return Ii.defaultMaxIdle},set(i){Ct("7.1.0","settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),Ii.defaultMaxIdle=i}},GC_MAX_CHECK_COUNT:{get(){return Ii.defaultCheckCountMax},set(i){Ct("7.1.0","settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),Ii.defaultCheckCountMax=i}},PRECISION_VERTEX:{get(){return Zr.defaultVertexPrecision},set(i){Ct("7.1.0","settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),Zr.defaultVertexPrecision=i}},PRECISION_FRAGMENT:{get(){return Zr.defaultFragmentPrecision},set(i){Ct("7.1.0","settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),Zr.defaultFragmentPrecision=i}}});var Ni=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Ni||{});class rh{constructor(t,e=null,r=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=r,this.once=n}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const Cf=class ze{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new rh(null,null,1/0),this.deltaMS=1/ze.targetFPMS,this.elapsedMS=1/ze.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,r=Ni.NORMAL){return this._addListener(new rh(t,e,r))}addOnce(t,e,r=Ni.NORMAL){return this._addListener(new rh(t,e,r,!0))}_addListener(t){let e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,e){let r=this._head.next;for(;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const s=t-this._lastFrame|0;if(s<this._minElapsedMS)return;this._lastFrame=t-s%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ze.targetFPMS;const r=this._head;let n=r.next;for(;n;)n=n.emit(this.deltaTime);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,ze.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!ze._shared){const t=ze._shared=new ze;t.autoStart=!0,t._protected=!0}return ze._shared}static get system(){if(!ze._system){const t=ze._system=new ze;t.autoStart=!0,t._protected=!0}return ze._system}};Cf.targetFPMS=.06;let qe=Cf;Object.defineProperties(ft,{TARGET_FPMS:{get(){return qe.targetFPMS},set(i){Ct("7.1.0","settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),qe.targetFPMS=i}}});class Pf{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Ni.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?qe.shared:new qe,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Pf.extension=ut.Application;mt.add(Pf);const Rf=[];mt.handleByList(ut.Renderer,Rf);function M_(i){for(const t of Rf)if(t.test(i))return new t(i);throw new Error("Unable to auto-detect a suitable renderer.")}var I_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,F_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`;const B_=I_,Mf=F_;class If{constructor(t){this.renderer=t}contextChange(t){let e;if(this.renderer.context.webGLVersion===1){const r=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,r)}else{const r=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,r)}e>=me.HIGH?this.multisample=me.HIGH:e>=me.MEDIUM?this.multisample=me.MEDIUM:e>=me.LOW?this.multisample=me.LOW:this.multisample=me.NONE}destroy(){}}If.extension={type:ut.RendererSystem,name:"_multisample"};mt.add(If);class D_{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Ff{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);e.bindBuffer(t.type,n.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:r,CONTEXT_UID:n}=this;if(this.boundBufferBases[e]!==t){const s=t._glBuffers[n]||this.createGLBuffer(t);this.boundBufferBases[e]=t,r.bindBufferBase(r.UNIFORM_BUFFER,e,s.buffer)}}bindBufferRange(t,e,r){const{gl:n,CONTEXT_UID:s}=this;r=r||0;const a=t._glBuffers[s]||this.createGLBuffer(t);n.bindBufferRange(n.UNIFORM_BUFFER,e||0,a.buffer,r*256,256)}update(t){const{gl:e,CONTEXT_UID:r}=this,n=t._glBuffers[r]||this.createGLBuffer(t);if(t._updateID!==n.updateID)if(n.updateID=t._updateID,e.bindBuffer(t.type,n.buffer),n.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const s=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;n.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,s)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const r=t._glBuffers[this.CONTEXT_UID],n=this.gl;t.disposeRunner.remove(this),r&&(e||n.deleteBuffer(r.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let r=0;r<e.length;r++)this.dispose(this.managedBuffers[e[r]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:r}=this;return t._glBuffers[e]=new D_(r.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Ff.extension={type:ut.RendererSystem,name:"buffer"};mt.add(Ff);class Bf{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;let n,s,a,h;if(e&&(n=e.renderTexture,s=e.clear,a=e.transform,h=e.skipUpdateTransform),this.renderingToScreen=!n,r.runners.prerender.emit(),r.emit("prerender"),r.projection.transform=a,!r.context.isLost){if(n||(this.lastObjectRendered=t),!h){const u=t.enableTempParent();t.updateTransform(),t.disableTempParent(u)}r.renderTexture.bind(n),r.batch.currentRenderer.start(),(s??r.background.clearBeforeRender)&&r.renderTexture.clear(),t.render(r),r.batch.currentRenderer.flush(),n&&(e.blit&&r.framebuffer.blit(),n.baseTexture.update()),r.runners.postrender.emit(),r.projection.transform=null,r.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Bf.extension={type:ut.RendererSystem,name:"objectRenderer"};mt.add(Bf);const yo=class zh extends Af{constructor(t){super(),this.type=ml.WEBGL,t=Object.assign({},ft.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new vr({projectionMatrix:new qt},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:zh.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(Ct("7.0.0","options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&t.useContextAlpha!=="notMultiplied",t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=zh.__plugins,this.options=t,this.startup.run(this.options)}static test(t){return t!=null&&t.forceCanvas?!1:Gd()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return Ct("7.0.0","renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return Ct("7.0.0","renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return Ct("7.0.0","renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){Ct("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){Ct("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return Ct("7.0.0","renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};yo.extension={type:ut.Renderer,priority:1},yo.__plugins={},yo.__systems={};let Qo=yo;mt.handleByMap(ut.RendererPlugin,Qo.__plugins);mt.handleByMap(ut.RendererSystem,Qo.__systems);mt.add(Qo);class Df extends hs{constructor(t,e){const{width:r,height:n}=e||{};super(r,n),this.items=[],this.itemDirtyIds=[];for(let s=0;s<t;s++){const a=new Rt;this.items.push(a),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let r=0;r<this.length;r++)t[r]&&(t[r].castToBaseTexture?this.addBaseTextureAt(t[r].castToBaseTexture(),r):t[r]instanceof hs?this.addResourceAt(t[r],r):this.addResourceAt(Zd(t[r],e),r))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map(e=>e.resource).filter(e=>e).map(e=>e.load());return this._load=Promise.all(t).then(()=>{const{realWidth:e,realHeight:r}=this.items[0];return this.resize(e,r),this.update(),Promise.resolve(this)}),this._load}}class O_ extends Df{constructor(t,e){const{width:r,height:n}=e||{};let s,a;Array.isArray(t)?(s=t,a=t.length):a=t,super(a,{width:r,height:n}),s&&this.initFromArray(s,e)}addBaseTextureAt(t,e){if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("ArrayResource does not support RenderTexture");return this}bind(t){super.bind(t),t.target=an.TEXTURE_2D_ARRAY}upload(t,e,r){const{length:n,itemDirtyIds:s,items:a}=this,{gl:h}=t;r.dirtyId<0&&h.texImage3D(h.TEXTURE_2D_ARRAY,0,r.internalFormat,this._width,this._height,n,0,e.format,r.type,null);for(let u=0;u<n;u++){const c=a[u];s[u]<c.dirtyId&&(s[u]=c.dirtyId,c.valid&&h.texSubImage3D(h.TEXTURE_2D_ARRAY,0,0,0,u,c.resource.width,c.resource.height,1,e.format,r.type,c.resource.source))}return!0}}class Of extends ei{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return e&&t instanceof e?!0:globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const Lf=class Yn extends Df{constructor(t,e){const{width:r,height:n,autoLoad:s,linkBaseTexture:a}=e||{};if(t&&t.length!==Yn.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:r,height:n});for(let h=0;h<Yn.SIDES;h++)this.items[h].target=an.TEXTURE_CUBE_MAP_POSITIVE_X+h;this.linkBaseTexture=a!==!1,t&&this.initFromArray(t,e),s!==!1&&this.load()}bind(t){super.bind(t),t.target=an.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,r){if(r===void 0&&(r=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,e);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=an.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,r){const n=this.itemDirtyIds;for(let s=0;s<Yn.SIDES;s++){const a=this.items[s];(n[s]<a.dirtyId||r.dirtyId<e.dirtyId)&&(a.valid&&a.resource?(a.resource.upload(t,a,r),n[s]=a.dirtyId):n[s]<-1&&(t.gl.texImage2D(a.target,0,r.internalFormat,e.realWidth,e.realHeight,0,e.format,r.type,null),n[s]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Yn.SIDES}};Lf.SIDES=6;let L_=Lf;class sn extends ei{constructor(t,e){e=e||{};let r,n,s;typeof t=="string"?(r=sn.EMPTY,n=t,s=!0):(r=t,n=null,s=!1),super(r),this.url=n,this.crossOrigin=e.crossOrigin??!0,this.alphaMode=typeof e.alphaMode=="number"?e.alphaMode:null,this.ownsImageBitmap=e.ownsImageBitmap??s,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(async(t,e)=>{if(this.url===null){t(this);return}try{const r=await ft.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await r.blob();if(this.destroyed)return;const s=await createImageBitmap(n,{premultiplyAlpha:this.alphaMode===null||this.alphaMode===He.UNPACK?"premultiply":"none"});if(this.destroyed){s.close();return}this.source=s,this.update(),t(this)}catch(r){if(this.destroyed)return;e(r),this.onError.emit(r)}}),this._load)}upload(t,e,r){return this.source instanceof ImageBitmap?(typeof this.alphaMode=="number"&&(e.alphaMode=this.alphaMode),super.upload(t,e,r)):(this.load(),!1)}dispose(){this.ownsImageBitmap&&this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&typeof ImageBitmap<"u"&&(typeof t=="string"||t instanceof ImageBitmap)}static get EMPTY(){return sn._EMPTY=sn._EMPTY??ft.ADAPTER.createCanvas(0,0),sn._EMPTY}}const Xh=class vo extends ei{constructor(t,e){e=e||{},super(ft.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,e.autoLoad!==!1&&this.load()}load(){return this._load?this._load:(this._load=new Promise(t=>{if(this._resolve=()=>{this.update(),t(this)},vo.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}),this._load)}_loadSvg(){const t=new Image;ei.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,r=t.height;if(!e||!r)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let n=e*this.scale,s=r*this.scale;(this._overrideWidth||this._overrideHeight)&&(n=this._overrideWidth||this._overrideHeight/r*e,s=this._overrideHeight||this._overrideWidth/e*r),n=Math.round(n),s=Math.round(s);const a=this.source;a.width=n,a.height=s,a._pixiId=`canvas_${di()}`,a.getContext("2d").drawImage(t,0,0,e,r,0,0,n,s),this._resolve(),this._resolve=null}}static getSize(t){const e=vo.SVG_SIZE.exec(t),r={};return e&&(r[e[1]]=Math.round(parseFloat(e[3])),r[e[5]]=Math.round(parseFloat(e[7]))),r}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return e==="svg"||typeof t=="string"&&t.startsWith("data:image/svg+xml")||typeof t=="string"&&vo.SVG_XML.test(t)}};Xh.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Xh.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;let Yh=Xh;class k_ extends ei{constructor(t){super(t)}static test(t){return!!globalThis.VideoFrame&&t instanceof globalThis.VideoFrame}}const qh=class Kh extends ei{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const r=document.createElement("video");e.autoLoad!==!1&&r.setAttribute("preload","auto"),e.playsinline!==!1&&(r.setAttribute("webkit-playsinline",""),r.setAttribute("playsinline","")),e.muted===!0&&(r.setAttribute("muted",""),r.muted=!0),e.loop===!0&&r.setAttribute("loop",""),e.autoPlay!==!1&&r.setAttribute("autoplay",""),typeof t=="string"&&(t=[t]);const n=t[0].src||t[0];ei.crossOrigin(r,n,e.crossorigin);for(let s=0;s<t.length;++s){const a=document.createElement("source");let{src:h,mime:u}=t[s];if(h=h||t[s],h.startsWith("data:"))u=h.slice(5,h.indexOf(";"));else if(!h.startsWith("blob:")){const c=h.split("?").shift().toLowerCase(),m=c.slice(c.lastIndexOf(".")+1);u=u||Kh.MIME_TYPES[m]||`video/${m}`}a.src=h,u&&(a.type=u),r.appendChild(a)}t=r}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}update(t=0){if(!this.destroyed){if(this._updateFPS){const e=qe.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}_videoFrameRequestCallback(){this.update(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e,r)=>{this.valid?e(this):(this._resolve=e,this._reject=r,t.load())}),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this._msToNextUpdate=0,this.update(),this._msToNextUpdate=0,!e&&this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._configureAutoUpdate();const t=this.source;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(qe.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(qe.shared.add(this.update,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(qe.shared.remove(this.update,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Kh.TYPES.includes(e)}};qh.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],qh.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let kf=qh;Lh.push(sn,af,Of,kf,k_,Yh,Ko,L_,O_);Rt.prototype.getDrawableSource=function(){const i=this.resource;return i?i.bitmap||i.source:null};Sl.prototype._canvasRenderTarget=null;pt.prototype.patternCache=null;pt.prototype.tintCache=null;let Gn;function Dc(i){const t=ft.ADAPTER.createCanvas(6,1),e=t.getContext("2d");return e.fillStyle=i,e.fillRect(0,0,6,1),t}function Nf(){if(typeof document>"u")return!1;if(Gn!==void 0)return Gn;const i=Dc("#ff00ff"),t=Dc("#ffff00"),e=ft.ADAPTER.createCanvas(6,1).getContext("2d");e.globalCompositeOperation="multiply",e.drawImage(i,0,0),e.drawImage(t,2,0);const r=e.getImageData(2,0,1,1);if(!r)Gn=!1;else{const n=r.data;Gn=n[0]===255&&n[1]===0&&n[2]===0}return Gn}function N_(i=[]){return Nf()?(i[rt.NORMAL]="source-over",i[rt.ADD]="lighter",i[rt.MULTIPLY]="multiply",i[rt.SCREEN]="screen",i[rt.OVERLAY]="overlay",i[rt.DARKEN]="darken",i[rt.LIGHTEN]="lighten",i[rt.COLOR_DODGE]="color-dodge",i[rt.COLOR_BURN]="color-burn",i[rt.HARD_LIGHT]="hard-light",i[rt.SOFT_LIGHT]="soft-light",i[rt.DIFFERENCE]="difference",i[rt.EXCLUSION]="exclusion",i[rt.HUE]="hue",i[rt.SATURATION]="saturation",i[rt.COLOR]="color",i[rt.LUMINOSITY]="luminosity"):(i[rt.NORMAL]="source-over",i[rt.ADD]="lighter",i[rt.MULTIPLY]="source-over",i[rt.SCREEN]="source-over",i[rt.OVERLAY]="source-over",i[rt.DARKEN]="source-over",i[rt.LIGHTEN]="source-over",i[rt.COLOR_DODGE]="source-over",i[rt.COLOR_BURN]="source-over",i[rt.HARD_LIGHT]="source-over",i[rt.SOFT_LIGHT]="source-over",i[rt.DIFFERENCE]="source-over",i[rt.EXCLUSION]="source-over",i[rt.HUE]="source-over",i[rt.SATURATION]="source-over",i[rt.COLOR]="source-over",i[rt.LUMINOSITY]="source-over"),i[rt.NORMAL_NPM]=i[rt.NORMAL],i[rt.ADD_NPM]=i[rt.ADD],i[rt.SCREEN_NPM]=i[rt.SCREEN],i[rt.SRC_IN]="source-in",i[rt.SRC_OUT]="source-out",i[rt.SRC_ATOP]="source-atop",i[rt.DST_OVER]="destination-over",i[rt.DST_IN]="destination-in",i[rt.DST_OUT]="destination-out",i[rt.DST_ATOP]="destination-atop",i[rt.XOR]="xor",i[rt.SUBTRACT]="source-over",i}const U_=new qt;class Uf{constructor(t){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=N_(),this._activeBlendMode=null,this._projTransform=null,this._outerBlend=!1,this.renderer=t}init(){const t=this.renderer.background.alpha<1;if(this.rootContext=this.renderer.view.getContext("2d",{alpha:t}),this.activeContext=this.rootContext,!this.rootContext.imageSmoothingEnabled){const e=this.rootContext;e.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":e.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":e.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":e.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(t,e,r){let n=t;const s=this._projTransform,a=this.activeResolution;r=r||a,s&&(n=U_,n.copyFrom(t),n.prepend(s)),e?this.activeContext.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*a|0,n.ty*a|0):this.activeContext.setTransform(n.a*r,n.b*r,n.c*r,n.d*r,n.tx*a,n.ty*a)}clear(t,e){const{activeContext:r,renderer:n}=this,s=t?kt.shared.setValue(t):this.renderer.background.backgroundColor;r.clearRect(0,0,n.width,n.height),t&&(r.globalAlpha=e??this.renderer.background.alpha,r.fillStyle=s.toHex(),r.fillRect(0,0,n.width,n.height),r.globalAlpha=1)}setBlendMode(t,e){const r=t===rt.SRC_IN||t===rt.SRC_OUT||t===rt.DST_IN||t===rt.DST_ATOP;!e&&r&&(t=rt.NORMAL),this._activeBlendMode!==t&&(this._activeBlendMode=t,this._outerBlend=r,this.activeContext.globalCompositeOperation=this.blendModes[t])}resize(){this.smoothProperty&&(this.rootContext[this.smoothProperty]=Rt.defaultOptions.scaleMode===mr.LINEAR)}invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.activeContext.globalCompositeOperation)}destroy(){this.renderer=null,this.rootContext=null,this.activeContext=null,this.smoothProperty=null}}Uf.extension={type:ut.CanvasRendererSystem,name:"canvasContext"};mt.add(Uf);class Gf{constructor(t){this._foundShapes=[],this.renderer=t}pushMask(t){const e=this.renderer,r=t.maskObject||t;e.canvasContext.activeContext.save();const n=this._foundShapes;if(this.recursiveFindShapes(r,n),n.length>0){const s=e.canvasContext.activeContext;s.beginPath();for(let a=0;a<n.length;a++){const h=n[a],u=h.transform.worldTransform;this.renderer.canvasContext.setContextTransform(u),this.renderGraphicsShape(h)}n.length=0,s.clip()}}recursiveFindShapes(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);const{children:r}=t;if(r)for(let n=0;n<r.length;n++)this.recursiveFindShapes(r[n],e)}renderGraphicsShape(t){t.finishPoly();const e=this.renderer.canvasContext.activeContext,r=t.geometry.graphicsData,n=r.length;if(n!==0)for(let s=0;s<n;s++){const a=r[s],h=a.shape;if(h.type===ne.POLY){let u=h.points;const c=a.holes;let m,y,v,b;e.moveTo(u[0],u[1]);for(let T=1;T<u.length/2;T++)e.lineTo(u[T*2],u[T*2+1]);if(c.length>0){m=0,v=u[0],b=u[1];for(let T=2;T+2<u.length;T+=2)m+=(u[T]-v)*(u[T+3]-b)-(u[T+2]-v)*(u[T+1]-b);for(let T=0;T<c.length;T++)if(u=c[T].shape.points,!!u){y=0,v=u[0],b=u[1];for(let E=2;E+2<u.length;E+=2)y+=(u[E]-v)*(u[E+3]-b)-(u[E+2]-v)*(u[E+1]-b);if(y*m<0){e.moveTo(u[0],u[1]);for(let E=2;E<u.length;E+=2)e.lineTo(u[E],u[E+1])}else{e.moveTo(u[u.length-2],u[u.length-1]);for(let E=u.length-4;E>=0;E-=2)e.lineTo(u[E],u[E+1])}c[T].shape.closeStroke&&e.closePath()}}u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&e.closePath()}else if(h.type===ne.RECT)e.rect(h.x,h.y,h.width,h.height),e.closePath();else if(h.type===ne.CIRC)e.arc(h.x,h.y,h.radius,0,2*Math.PI),e.closePath();else if(h.type===ne.ELIP){const u=h.width*2,c=h.height*2,m=h.x-u/2,y=h.y-c/2,v=.5522848,b=u/2*v,T=c/2*v,E=m+u,P=y+c,M=m+u/2,D=y+c/2;e.moveTo(m,D),e.bezierCurveTo(m,D-T,M-b,y,M,y),e.bezierCurveTo(M+b,y,E,D-T,E,D),e.bezierCurveTo(E,D+T,M+b,P,M,P),e.bezierCurveTo(M-b,P,m,D+T,m,D),e.closePath()}else if(h.type===ne.RREC){const u=h.x,c=h.y,m=h.width,y=h.height;let v=h.radius;const b=Math.min(m,y)/2;v=v>b?b:v,e.moveTo(u,c+v),e.lineTo(u,c+y-v),e.quadraticCurveTo(u,c+y,u+v,c+y),e.lineTo(u+m-v,c+y),e.quadraticCurveTo(u+m,c+y,u+m,c+y-v),e.lineTo(u+m,c+v),e.quadraticCurveTo(u+m,c,u+m-v,c),e.lineTo(u+v,c),e.quadraticCurveTo(u,c,u,c+v),e.closePath()}}}popMask(t){t.canvasContext.activeContext.restore(),t.canvasContext.invalidateBlendMode()}destroy(){}}Gf.extension={type:ut.CanvasRendererSystem,name:"mask"};mt.add(Gf);class Hf{constructor(t){this.renderer=t}render(t,e){const r=this.renderer;if(!r.view)return;const n=r.canvasContext;let s,a,h,u;e&&(s=e.renderTexture,a=e.clear,h=e.transform,u=e.skipUpdateTransform),this.renderingToScreen=!s,r.emit("prerender");const c=r.resolution;s?(s=s.castToBaseTexture(),s._canvasRenderTarget||(s._canvasRenderTarget=new fs(s.width,s.height,s.resolution),s.resource=new Of(s._canvasRenderTarget.canvas),s.valid=!0),n.activeContext=s._canvasRenderTarget.context,r.canvasContext.activeResolution=s._canvasRenderTarget.resolution):(n.activeContext=n.rootContext,n.activeResolution=c);const m=n.activeContext;if(n._projTransform=h||null,s||(this.lastObjectRendered=t),!u){const v=t.enableTempParent();t.updateTransform(),t.disableTempParent(v)}if(m.save(),m.setTransform(1,0,0,1,0,0),m.globalAlpha=1,n._activeBlendMode=rt.NORMAL,n._outerBlend=!1,m.globalCompositeOperation=n.blendModes[rt.NORMAL],a??r.background.clearBeforeRender)if(this.renderingToScreen){m.clearRect(0,0,r.width,r.height);const v=r.background;v.alpha>0&&(m.globalAlpha=v.backgroundColor.alpha,m.fillStyle=v.backgroundColor.toHex(),m.fillRect(0,0,r.width,r.height),m.globalAlpha=1)}else s=s,s._canvasRenderTarget.clear(),s.clear.alpha>0&&(m.globalAlpha=s.clear.alpha,m.fillStyle=s.clear.toHex(),m.fillRect(0,0,s.realWidth,s.realHeight),m.globalAlpha=1);const y=n.activeContext;n.activeContext=m,t.renderCanvas(r),n.activeContext=y,m.restore(),n.activeResolution=c,n._projTransform=null,r.emit("postrender")}destroy(){this.lastObjectRendered=null,this.render=null}}Hf.extension={type:ut.CanvasRendererSystem,name:"objectRenderer"};mt.add(Hf);const{deprecation:De}=Tv,_o=class Zh extends Af{constructor(t){super(),this.type=ml.CANVAS,this.rendererLogId="Canvas",t=Object.assign({},ft.RENDER_OPTIONS,t);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Zh.__systems,priority:["textureGenerator","background","_view","_plugin","startup","mask","canvasContext","objectRenderer"]};this.setup(e),"useContextAlpha"in t&&(De("7.0.0","options.useContextAlpha is deprecated, use options.backgroundAlpha instead"),t.backgroundAlpha=t.useContextAlpha===!1?1:t.backgroundAlpha),this._plugin.rendererPlugins=Zh.__plugins,this.options=t,this.startup.run(this.options)}static test(){return!0}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}reset(){}render(t,e){this.objectRenderer.render(t,e)}clear(){this.canvasContext.clear()}destroy(t){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}resize(t,e){this._view.resizeView(t,e)}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get clearBeforeRender(){return this.background.clearBeforeRender}get blendModes(){return De("7.0.0","renderer.blendModes has been deprecated, please use renderer.canvasContext.blendModes instead"),this.canvasContext.blendModes}get maskManager(){return De("7.0.0","renderer.maskManager has been deprecated, please use renderer.mask instead"),this.mask}get refresh(){return De("7.0.0","renderer.refresh has been deprecated"),!0}get rootContext(){return De("7.0.0","renderer.rootContext has been deprecated, please use renderer.canvasContext.rootContext instead"),this.canvasContext.rootContext}get context(){return De("7.0.0","renderer.context has been deprecated, please use renderer.canvasContext.activeContext instead"),this.canvasContext.activeContext}get smoothProperty(){return De("7.0.0","renderer.smoothProperty has been deprecated, please use renderer.canvasContext.smoothProperty instead"),this.canvasContext.smoothProperty}setBlendMode(t,e){De("7.0.0","renderer.setBlendMode has been deprecated, use renderer.canvasContext.setBlendMode instead"),this.canvasContext.setBlendMode(t,e)}invalidateBlendMode(){De("7.0.0","renderer.invalidateBlendMode has been deprecated, use renderer.canvasContext.invalidateBlendMode instead"),this.canvasContext.invalidateBlendMode()}setContextTransform(t,e,r){De("7.0.0","renderer.setContextTransform has been deprecated, use renderer.canvasContext.setContextTransform instead"),this.canvasContext.setContextTransform(t,e,r)}get backgroundColor(){return De("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){De("7.0.0","renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return De("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha}set backgroundAlpha(t){De("7.0.0","renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get preserveDrawingBuffer(){return De("7.0.0","renderer.preserveDrawingBuffer has been deprecated"),!1}get useContextAlpha(){return De("7.0.0","renderer.useContextAlpha has been deprecated"),!1}};_o.extension={type:ut.Renderer,priority:0},_o.__plugins={},_o.__systems={};let ta=_o;mt.handleByMap(ut.CanvasRendererPlugin,ta.__plugins);mt.handleByMap(ut.CanvasRendererSystem,ta.__systems);mt.add(ta);const Ce={canvas:null,getTintedCanvas:(i,t)=>{const e=i.texture,r=kt.shared.setValue(t).toHex();e.tintCache=e.tintCache||{};const n=e.tintCache[r];let s;if(n){if(n.tintId===e._updateID)return e.tintCache[r];s=e.tintCache[r]}else s=ft.ADAPTER.createCanvas();return Ce.tintMethod(e,t,s),s.tintId=e._updateID,Ce.convertTintToImage||(e.tintCache[r]=s),s},getTintedPattern:(i,t)=>{const e=kt.shared.setValue(t).toHex();i.patternCache=i.patternCache||{};let r=i.patternCache[e];return(r==null?void 0:r.tintId)===i._updateID||(Ce.canvas||(Ce.canvas=ft.ADAPTER.createCanvas()),Ce.tintMethod(i,t,Ce.canvas),r=Ce.canvas.getContext("2d").createPattern(Ce.canvas,"repeat"),r.tintId=i._updateID,i.patternCache[e]=r),r},tintWithMultiply:(i,t,e)=>{const r=e.getContext("2d"),n=i._frame.clone(),s=i.baseTexture.resolution;n.x*=s,n.y*=s,n.width*=s,n.height*=s,e.width=Math.ceil(n.width),e.height=Math.ceil(n.height),r.save(),r.fillStyle=kt.shared.setValue(t).toHex(),r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="multiply";const a=i.baseTexture.getDrawableSource();r.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(a,n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore()},tintWithOverlay:(i,t,e)=>{const r=e.getContext("2d"),n=i._frame.clone(),s=i.baseTexture.resolution;n.x*=s,n.y*=s,n.width*=s,n.height*=s,e.width=Math.ceil(n.width),e.height=Math.ceil(n.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle=`#${`00000${(t|0).toString(16)}`.slice(-6)}`,r.fillRect(0,0,n.width,n.height),r.globalCompositeOperation="destination-atop",r.drawImage(i.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore()},tintWithPerPixel:(i,t,e)=>{const r=e.getContext("2d"),n=i._frame.clone(),s=i.baseTexture.resolution;n.x*=s,n.y*=s,n.width*=s,n.height*=s,e.width=Math.ceil(n.width),e.height=Math.ceil(n.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(i.baseTexture.getDrawableSource(),n.x,n.y,n.width,n.height,0,0,n.width,n.height),r.restore();const[a,h,u]=kt.shared.setValue(t).toArray(),c=r.getImageData(0,0,n.width,n.height),m=c.data;for(let y=0;y<m.length;y+=4)m[y+0]*=a,m[y+1]*=h,m[y+2]*=u;r.putImageData(c,0,0)},roundColor:i=>(Ct("7.3.0","PIXI.canvasUtils.roundColor is deprecated"),kt.shared.setValue(i).round(Ce.cacheStepsPerColorChannel).toNumber()),cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Nf(),tintMethod:null};Ce.tintMethod=Ce.canUseMultiply?Ce.tintWithMultiply:Ce.tintWithPerPixel;class Do{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?It.EMPTY:(t=t||new It(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:r,b:n,c:s,d:a,tx:h,ty:u}=t,c=r*e.x+s*e.y+h,m=n*e.x+a*e.y+u;this.minX=Math.min(this.minX,c),this.maxX=Math.max(this.maxX,c),this.minY=Math.min(this.minY,m),this.maxY=Math.max(this.maxY,m)}addQuad(t){let e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,a=t[0],h=t[1];e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,a=t[2],h=t[3],e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,a=t[4],h=t[5],e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,a=t[6],h=t[7],e=a<e?a:e,r=h<r?h:r,n=a>n?a:n,s=h>s?h:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s}addFrame(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)}addFrameMatrix(t,e,r,n,s){const a=t.a,h=t.b,u=t.c,c=t.d,m=t.tx,y=t.ty;let v=this.minX,b=this.minY,T=this.maxX,E=this.maxY,P=a*e+u*r+m,M=h*e+c*r+y;v=P<v?P:v,b=M<b?M:b,T=P>T?P:T,E=M>E?M:E,P=a*n+u*r+m,M=h*n+c*r+y,v=P<v?P:v,b=M<b?M:b,T=P>T?P:T,E=M>E?M:E,P=a*e+u*s+m,M=h*e+c*s+y,v=P<v?P:v,b=M<b?M:b,T=P>T?P:T,E=M>E?M:E,P=a*n+u*s+m,M=h*n+c*s+y,v=P<v?P:v,b=M<b?M:b,T=P>T?P:T,E=M>E?M:E,this.minX=v,this.minY=b,this.maxX=T,this.maxY=E}addVertexData(t,e,r){let n=this.minX,s=this.minY,a=this.maxX,h=this.maxY;for(let u=e;u<r;u+=2){const c=t[u],m=t[u+1];n=c<n?c:n,s=m<s?m:s,a=c>a?c:a,h=m>h?m:h}this.minX=n,this.minY=s,this.maxX=a,this.maxY=h}addVertices(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)}addVerticesMatrix(t,e,r,n,s=0,a=s){const h=t.a,u=t.b,c=t.c,m=t.d,y=t.tx,v=t.ty;let b=this.minX,T=this.minY,E=this.maxX,P=this.maxY;for(let M=r;M<n;M+=2){const D=e[M],R=e[M+1],N=h*D+c*R+y,Y=m*R+u*D+v;b=Math.min(b,N-s),E=Math.max(E,N+s),T=Math.min(T,Y-a),P=Math.max(P,Y+a)}this.minX=b,this.minY=T,this.maxX=E,this.maxY=P}addBounds(t){const e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s}addBoundsMask(t,e){const r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,a=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=a){const h=this.minX,u=this.minY,c=this.maxX,m=this.maxY;this.minX=r<h?r:h,this.minY=n<u?n:u,this.maxX=s>c?s:c,this.maxY=a>m?a:m}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,a=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=a){const h=this.minX,u=this.minY,c=this.maxX,m=this.maxY;this.minX=r<h?r:h,this.minY=n<u?n:u,this.maxX=s>c?s:c,this.maxY=a>m?a:m}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,r,n,s,a){t-=s,e-=a,r+=s,n+=a,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n}}class ae extends _n{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new Zo,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Do,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let r=0;r<e.length;++r){const n=e[r];Object.defineProperty(ae.prototype,n,Object.getOwnPropertyDescriptor(t,n))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new It),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new It),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Do);const e=this.transform,r=this.parent;this.parent=null,this._tempDisplayObjectParent.worldAlpha=(r==null?void 0:r.worldAlpha)??1,this.transform=this._tempDisplayObjectParent.transform;const n=this._bounds,s=this._boundsID;this._bounds=this._localBounds;const a=this.getBounds(!1,t);return this.parent=r,this.transform=e,this._bounds=n,this._bounds.updateID+=this._boundsID-s,a}toGlobal(t,e,r=!1){return r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,r,n){return e&&(t=e.toGlobal(t,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,r)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;(t=this.parent)==null||t.removeChild(this)}setTransform(t=0,e=0,r=1,n=1,s=0,a=0,h=0,u=0,c=0){return this.position.x=t,this.position.y=e,this.scale.x=r||1,this.scale.y=n||1,this.rotation=s,this.skew.x=a,this.skew.y=h,this.pivot.x=u,this.pivot.y=c,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.eventMode="auto",this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new G_),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*Fv}set angle(t){this.transform.rotation=t*Bv}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex!==t&&(this._zIndex=t,this.parent&&(this.parent.sortDirty=!0))}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount--,e._maskRefCount===0&&(e.renderable=!0,e.isMask=!1))}if(this._mask=t,this._mask){const e=this._mask.isMaskData?this._mask.maskObject:this._mask;e&&(e._maskRefCount===0&&(e.renderable=!1,e.isMask=!0),e._maskRefCount++)}}}}class G_ extends ae{constructor(){super(...arguments),this.sortDirty=null}}ae.prototype.displayObjectUpdateTransform=ae.prototype.updateTransform;const H_=new qt;function $_(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}const $f=class Jh extends ae{constructor(){super(),this.children=[],this.sortableChildren=Jh.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const r=this.getChildIndex(t),n=this.getChildIndex(e);this.children[r]=e,this.children[n]=t,this.onChildrenChange(r<n?r:n)}getChildIndex(t){const e=this.children.indexOf(t);if(e===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const r=this.getChildIndex(t);Oi(this.children,r,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],r=this.children.indexOf(e);if(r===-1)return null;e.parent=null,e.transform._parentID=-1,Oi(this.children,r,1),this._boundsID++,this.onChildrenChange(r),e.emit("removed",this),this.emit("childRemoved",e,this,r)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Oi(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const r=t,n=e,s=n-r;let a;if(s>0&&s<=n){a=this.children.splice(r,s);for(let h=0;h<a.length;++h)a[h].parent=null,a[h].transform&&(a[h].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let h=0;h<a.length;++h)a[h].emit("removed",this),this.emit("childRemoved",a[h],this,h);return a}else if(s===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,r=this.children.length;e<r;++e){const n=this.children[e];n._lastSortedIndex=e,!t&&n.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort($_),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const r=this.children[t];r.visible&&r.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(!(!e.visible||!e.renderable))if(e.calculateBounds(),e._mask){const r=e._mask.isMaskData?e._mask.maskObject:e._mask;r?(r.calculateBounds(),this._bounds.addBoundsMask(e._bounds,r._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const r=super.getLocalBounds(t);if(!e)for(let n=0,s=this.children.length;n<s;++n){const a=this.children[n];a.visible&&a.updateTransform()}return r}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let r,n;this.cullArea?(r=this.cullArea,n=this.worldTransform):this._render!==Jh.prototype._render&&(r=this.getBounds(!0));const s=t.projection.transform;if(s&&(n?(n=H_.copyFrom(n),n.prepend(s)):n=s),r&&e.intersects(r,n))this._render(t);else if(this.cullArea)return;for(let a=0,h=this.children.length;a<h;++a){const u=this.children[a],c=u.cullable;u.cullable=c||!this.cullArea,u.render(t),u.cullable=c}}render(t){var e;if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||(e=this.filters)!=null&&e.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let r=0,n=this.children.length;r<n;++r)this.children[r].render(t)}}renderAdvanced(t){var s,a,h;const e=this.filters,r=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let u=0;u<e.length;u++)e[u].enabled&&this._enabledFilters.push(e[u])}const n=e&&((s=this._enabledFilters)==null?void 0:s.length)||r&&(!r.isMaskData||r.enabled&&(r.autoDetect||r.type!==_e.NONE));if(n&&t.batch.flush(),e&&((a=this._enabledFilters)!=null&&a.length)&&t.filter.push(this,this._enabledFilters),r&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let u=0,c=this.children.length;u<c;++u)this.children[u].render(t)}n&&t.batch.flush(),r&&t.mask.pop(this),e&&((h=this._enabledFilters)!=null&&h.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e=typeof t=="boolean"?t:t==null?void 0:t.children,r=this.removeChildren(0,this.children.length);if(e)for(let n=0;n<r.length;++n)r[n].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;e!==0?this.scale.x=t/e:this.scale.x=1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;e!==0?this.scale.y=t/e:this.scale.y=1,this._height=t}};$f.defaultSortableChildren=!1;let ge=$f;ge.prototype.containerUpdateTransform=ge.prototype.updateTransform;Object.defineProperties(ft,{SORTABLE_CHILDREN:{get(){return ge.defaultSortableChildren},set(i){Ct("7.1.0","settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),ge.defaultSortableChildren=i}}});const Hn=new Ut,W_=new Uint16Array([0,1,2,0,2,3]);class Ie extends ge{constructor(t){super(),this._anchor=new Kr(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tintColor=new kt(16777215),this._tintRGB=null,this.tint=16777215,this.blendMode=rt.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||pt.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=W_,this.pluginName="batch",this.isSprite=!0,this._roundPixels=ft.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=qr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=qr(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,a=e.d,h=e.tx,u=e.ty,c=this.vertexData,m=t.trim,y=t.orig,v=this._anchor;let b=0,T=0,E=0,P=0;if(m?(T=m.x-v._x*y.width,b=T+m.width,P=m.y-v._y*y.height,E=P+m.height):(T=-v._x*y.width,b=T+y.width,P=-v._y*y.height,E=P+y.height),c[0]=r*T+s*P+h,c[1]=a*P+n*T+u,c[2]=r*b+s*P+h,c[3]=a*P+n*b+u,c[4]=r*b+s*E+h,c[5]=a*E+n*b+u,c[6]=r*T+s*E+h,c[7]=a*E+n*T+u,this._roundPixels){const M=ft.RESOLUTION;for(let D=0;D<c.length;++D)c[D]=Math.round(c[D]*M)/M}}calculateTrimmedVertices(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,r=t.orig,n=this._anchor,s=this.transform.worldTransform,a=s.a,h=s.b,u=s.c,c=s.d,m=s.tx,y=s.ty,v=-n._x*r.width,b=v+r.width,T=-n._y*r.height,E=T+r.height;if(e[0]=a*v+u*T+m,e[1]=c*T+h*v+y,e[2]=a*b+u*T+m,e[3]=c*T+h*b+y,e[4]=a*b+u*E+m,e[5]=c*E+h*b+y,e[6]=a*v+u*E+m,e[7]=c*E+h*v+y,this._roundPixels){const P=ft.RESOLUTION;for(let M=0;M<e.length;++M)e[M]=Math.round(e[M]*P)/P}}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return this.children.length===0?(this._localBounds||(this._localBounds=new Do),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new It),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Hn);const e=this._texture.orig.width,r=this._texture.orig.height,n=-e*this.anchor.x;let s=0;return Hn.x>=n&&Hn.x<n+e&&(s=-r*this.anchor.y,Hn.y>=s&&Hn.y<s+r)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,typeof t=="boolean"?t:t==null?void 0:t.texture){const e=typeof t=="boolean"?t:t==null?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const r=t instanceof pt?t:pt.from(t,e);return new Ie(r)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1,this._transformTrimmedID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=qr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=qr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber()}get tintValue(){return this._tintColor.toNumber()}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||pt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const $n=new Ut;class Rl extends Ie{constructor(t,e=100,r=100){super(t),this.tileTransform=new Zo,this._width=e,this._height=r,this.uvMatrix=this.texture.uvMatrix||new Pl(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;!e||!e.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,r,n)}getLocalBounds(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new It),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,$n);const e=this._width,r=this._height,n=-e*this.anchor._x;if($n.x>=n&&$n.x<n+e){const s=-r*this.anchor._y;if($n.y>=s&&$n.y<s+r)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const r=t instanceof pt?t:pt.from(t,e);return new Rl(r,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var V_=`#version 300 es
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

in vec2 vTextureCoord;

out vec4 fragmentColor;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0

    fragmentColor = texSample * uColor;
}
`,j_=`#version 300 es
#define SHADER_NAME Tiling-Sprite-300

precision lowp float;

in vec2 aVertexPosition;
in vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

out vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,z_=`#version 100
#ifdef GL_EXT_shader_texture_lod
    #extension GL_EXT_shader_texture_lod : enable
#endif
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    vec2 unclamped = coord;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    #ifdef GL_EXT_shader_texture_lod
        vec4 texSample = unclamped == coord
            ? texture2D(uSampler, coord) 
            : texture2DLodEXT(uSampler, coord, 0);
    #else
        vec4 texSample = texture2D(uSampler, coord);
    #endif

    gl_FragColor = texSample * uColor;
}
`,Oc=`#version 100
#define SHADER_NAME Tiling-Sprite-100

precision lowp float;

attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,X_=`#version 100
#define SHADER_NAME Tiling-Sprite-Simple-100

precision lowp float;

varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`;const Js=new qt;class Wf extends Jo{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new lf,this.state=Hr.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Nr.from(Oc,X_,e),this.shader=t.context.webGLVersion>1?Nr.from(j_,V_,e):Nr.from(Oc,z_,e)}render(t){const e=this.renderer,r=this.quad;let n=r.vertices;n[0]=n[6]=t._width*-t.anchor.x,n[1]=n[3]=t._height*-t.anchor.y,n[2]=n[4]=t._width*(1-t.anchor.x),n[5]=n[7]=t._height*(1-t.anchor.y);const s=t.uvRespectAnchor?t.anchor.x:0,a=t.uvRespectAnchor?t.anchor.y:0;n=r.uvs,n[0]=n[6]=-s,n[1]=n[3]=-a,n[2]=n[4]=1-s,n[5]=n[7]=1-a,r.invalidate();const h=t._texture,u=h.baseTexture,c=u.alphaMode>0,m=t.tileTransform.localTransform,y=t.uvMatrix;let v=u.isPowerOfTwo&&h.frame.width===u.width&&h.frame.height===u.height;v&&(u._glTextures[e.CONTEXT_UID]?v=u.wrapMode!==Jr.CLAMP:u.wrapMode===Jr.CLAMP&&(u.wrapMode=Jr.REPEAT));const b=v?this.simpleShader:this.shader,T=h.width,E=h.height,P=t._width,M=t._height;Js.set(m.a*T/P,m.b*T/M,m.c*E/P,m.d*E/M,m.tx/P,m.ty/M),Js.invert(),v?Js.prepend(y.mapCoord):(b.uniforms.uMapCoord=y.mapCoord.toArray(!0),b.uniforms.uClampFrame=y.uClampFrame,b.uniforms.uClampOffset=y.uClampOffset),b.uniforms.uTransform=Js.toArray(!0),b.uniforms.uColor=kt.shared.setValue(t.tint).premultiply(t.worldAlpha,c).toArray(b.uniforms.uColor),b.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),b.uniforms.uSampler=h,e.shader.bind(b),e.geometry.bind(r),this.state.blendMode=El(t.blendMode,c),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Wf.extension={name:"tilingSprite",type:ut.RendererPlugin};mt.add(Wf);const Qs=new qt,Wn=new qt,Pr=[new Ut,new Ut,new Ut,new Ut];Rl.prototype._renderCanvas=function(i){const t=this._texture;if(!t.baseTexture.valid)return;const e=i.canvasContext.activeContext,r=this.worldTransform,n=t.baseTexture,s=n.getDrawableSource(),a=n.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tintValue){this._textureID=this._texture._updateID;const v=new fs(t._frame.width,t._frame.height,a);this.tintValue!==16777215?(this._tintedCanvas=Ce.getTintedCanvas(this,this.tintValue),v.context.drawImage(this._tintedCanvas,0,0)):v.context.drawImage(s,-t._frame.x*a,-t._frame.y*a),this._cachedTint=this.tintValue,this._canvasPattern=v.context.createPattern(v.canvas,"repeat")}e.globalAlpha=this.worldAlpha,i.canvasContext.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();const h=this.tileTransform.localTransform,u=this._width,c=this._height;Qs.identity(),Wn.copyFrom(h),this.uvRespectAnchor||Wn.translate(-this.anchor.x*u,-this.anchor.y*c),Wn.scale(1/a,1/a),Qs.prepend(Wn),Qs.prepend(r),i.canvasContext.setContextTransform(Qs),e.fillStyle=this._canvasPattern;const m=this.anchor.x*-u,y=this.anchor.y*-c;Pr[0].set(m,y),Pr[1].set(m+u,y),Pr[2].set(m+u,y+c),Pr[3].set(m,y+c);for(let v=0;v<4;v++)Wn.applyInverse(Pr[v],Pr[v]);e.beginPath(),e.moveTo(Pr[0].x,Pr[0].y);for(let v=1;v<4;v++)e.lineTo(Pr[v].x,Pr[v].y);e.closePath(),e.fill()};class Y_ extends ge{constructor(t=1500,e,r=16384,n=!1){super();const s=16384;r>s&&(r=s),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=r,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=rt.NORMAL,this.autoResize=n,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tintColor=new kt(0),this.tintRgb=new Float32Array(3),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t),this._tintColor.toRgbArray(this.tintRgb)}render(t){!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",()=>this.onChildrenChange(0))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}class Lc{constructor(t,e,r){this.geometry=new fi,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(let n=0;n<t.length;++n){let s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||Et.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new xe(Xd(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let a=0;a<this.dynamicProperties.length;++a){const h=this.dynamicProperties[a];h.offset=e,e+=h.size,this.dynamicStride+=h.size}const r=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(r),this.dynamicDataUint32=new Uint32Array(r),this.dynamicBuffer=new xe(this.dynamicData,!1,!1);let n=0;this.staticStride=0;for(let a=0;a<this.staticProperties.length;++a){const h=this.staticProperties[a];h.offset=n,n+=h.size,this.staticStride+=h.size}const s=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(s),this.staticDataUint32=new Uint32Array(s),this.staticBuffer=new xe(this.staticData,!0,!1);for(let a=0;a<this.dynamicProperties.length;++a){const h=this.dynamicProperties[a];t.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===Et.UNSIGNED_BYTE,h.type,this.dynamicStride*4,h.offset*4)}for(let a=0;a<this.staticProperties.length;++a){const h=this.staticProperties[a];t.addAttribute(h.attributeName,this.staticBuffer,0,h.type===Et.UNSIGNED_BYTE,h.type,this.staticStride*4,h.offset*4)}}uploadDynamic(t,e,r){for(let n=0;n<this.dynamicProperties.length;n++){const s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===Et.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,r){for(let n=0;n<this.staticProperties.length;n++){const s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===Et.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}var q_=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,K_=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`;class Vf extends Jo{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new qt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Et.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Nr.from(K_,q_,{}),this.state=Hr.for2d()}render(t){const e=t.children,r=t._maxSize,n=t._batchSize,s=this.renderer;let a=e.length;if(a===0)return;a>r&&!t.autoResize&&(a=r);let h=t._buffers;h||(h=t._buffers=this.generateBuffers(t));const u=e[0]._texture.baseTexture,c=u.alphaMode>0;this.state.blendMode=El(t.blendMode,c),s.state.set(this.state);const m=s.gl,y=t.worldTransform.copyTo(this.tempMatrix);y.prepend(s.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=y.toArray(!0),this.shader.uniforms.uColor=kt.shared.setValue(t.tintRgb).premultiply(t.worldAlpha,c).toArray(this.shader.uniforms.uColor),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);let v=!1;for(let b=0,T=0;b<a;b+=n,T+=1){let E=a-b;E>n&&(E=n),T>=h.length&&h.push(this._generateOneMoreBuffer(t));const P=h[T];P.uploadDynamic(e,b,E);const M=t._bufferUpdateIDs[T]||0;v=v||P._updateID<M,v&&(P._updateID=t._updateID,P.uploadStatic(e,b,E)),s.geometry.bind(P.geometry),m.drawElements(m.TRIANGLES,E*6,m.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],r=t._maxSize,n=t._batchSize,s=t._properties;for(let a=0;a<r;a+=n)e.push(new Lc(this.properties,s,n));return e}_generateOneMoreBuffer(t){const e=t._batchSize,r=t._properties;return new Lc(this.properties,r,e)}uploadVertices(t,e,r,n,s,a){let h=0,u=0,c=0,m=0;for(let y=0;y<r;++y){const v=t[e+y],b=v._texture,T=v.scale.x,E=v.scale.y,P=b.trim,M=b.orig;P?(u=P.x-v.anchor.x*M.width,h=u+P.width,m=P.y-v.anchor.y*M.height,c=m+P.height):(h=M.width*(1-v.anchor.x),u=M.width*-v.anchor.x,c=M.height*(1-v.anchor.y),m=M.height*-v.anchor.y),n[a]=u*T,n[a+1]=m*E,n[a+s]=h*T,n[a+s+1]=m*E,n[a+s*2]=h*T,n[a+s*2+1]=c*E,n[a+s*3]=u*T,n[a+s*3+1]=c*E,a+=s*4}}uploadPosition(t,e,r,n,s,a){for(let h=0;h<r;h++){const u=t[e+h].position;n[a]=u.x,n[a+1]=u.y,n[a+s]=u.x,n[a+s+1]=u.y,n[a+s*2]=u.x,n[a+s*2+1]=u.y,n[a+s*3]=u.x,n[a+s*3+1]=u.y,a+=s*4}}uploadRotation(t,e,r,n,s,a){for(let h=0;h<r;h++){const u=t[e+h].rotation;n[a]=u,n[a+s]=u,n[a+s*2]=u,n[a+s*3]=u,a+=s*4}}uploadUvs(t,e,r,n,s,a){for(let h=0;h<r;++h){const u=t[e+h]._texture._uvs;u?(n[a]=u.x0,n[a+1]=u.y0,n[a+s]=u.x1,n[a+s+1]=u.y1,n[a+s*2]=u.x2,n[a+s*2+1]=u.y2,n[a+s*3]=u.x3,n[a+s*3+1]=u.y3,a+=s*4):(n[a]=0,n[a+1]=0,n[a+s]=0,n[a+s+1]=0,n[a+s*2]=0,n[a+s*2+1]=0,n[a+s*3]=0,n[a+s*3+1]=0,a+=s*4)}}uploadTint(t,e,r,n,s,a){for(let h=0;h<r;++h){const u=t[e+h],c=kt.shared.setValue(u._tintRGB).toPremultiplied(u.alpha,u.texture.baseTexture.alphaMode>0);n[a]=c,n[a+s]=c,n[a+s*2]=c,n[a+s*3]=c,a+=s*4}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}Vf.extension={name:"particle",type:ut.RendererPlugin};mt.add(Vf);Y_.prototype.renderCanvas=function(i){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable)return;const t=i.canvasContext.activeContext,e=this.worldTransform;let r=!0,n=0,s=0,a=0,h=0;i.canvasContext.setBlendMode(this.blendMode),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(let u=0;u<this.children.length;++u){const c=this.children[u];if(!c.visible||!c._texture.valid)continue;const m=c._texture.frame;if(t.globalAlpha=this.worldAlpha*c.alpha,c.rotation%(Math.PI*2)===0)r&&(i.canvasContext.setContextTransform(e,!1,1),r=!1),n=c.anchor.x*(-m.width*c.scale.x)+c.position.x+.5,s=c.anchor.y*(-m.height*c.scale.y)+c.position.y+.5,a=m.width*c.scale.x,h=m.height*c.scale.y;else{r||(r=!0),c.displayObjectUpdateTransform();const b=c.worldTransform;i.canvasContext.setContextTransform(b,this.roundPixels,1),n=c.anchor.x*-m.width+.5,s=c.anchor.y*-m.height+.5,a=m.width,h=m.height}const y=c._texture.baseTexture.resolution,v=i.canvasContext.activeResolution;t.drawImage(c._texture.baseTexture.getDrawableSource(),m.x*y,m.y*y,m.width*y,m.height*y,n*v,s*v,a*v,h*v)}};ge.prototype._renderCanvas=function(i){};ge.prototype.renderCanvas=function(i){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){this._mask&&i.mask.pushMask(this._mask),this._renderCanvas(i);for(let t=0,e=this.children.length;t<e;++t)this.children[t].renderCanvas(i);this._mask&&i.mask.popMask(i)}};ae.prototype.renderCanvas=function(i){};var ea=(i=>(i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",i))(ea||{});const to={willReadFrequently:!0},Mr=class bt{static get experimentalLetterSpacingSupported(){let t=bt._experimentalLetterSpacingSupported;if(t!==void 0){const e=ft.ADAPTER.getCanvasRenderingContext2D().prototype;t=bt._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,r,n,s,a,h,u,c){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=a,this.lineHeight=h,this.maxLineWidth=u,this.fontProperties=c}static measureText(t,e,r,n=bt._canvas){r=r??e.wordWrap;const s=e.toFontString(),a=bt.measureFont(s);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const h=n.getContext("2d",to);h.font=s;const u=(r?bt.wordWrap(t,e,n):t).split(/(?:\r\n|\r|\n)/),c=new Array(u.length);let m=0;for(let T=0;T<u.length;T++){const E=bt._measureText(u[T],e.letterSpacing,h);c[T]=E,m=Math.max(m,E)}let y=m+e.strokeThickness;e.dropShadow&&(y+=e.dropShadowDistance);const v=e.lineHeight||a.fontSize+e.strokeThickness;let b=Math.max(v,a.fontSize+e.strokeThickness*2)+e.leading+(u.length-1)*(v+e.leading);return e.dropShadow&&(b+=e.dropShadowDistance),new bt(t,e,y,b,u,c,v+e.leading,m,a)}static _measureText(t,e,r){let n=!1;bt.experimentalLetterSpacingSupported&&(bt.experimentalLetterSpacing?(r.letterSpacing=`${e}px`,r.textLetterSpacing=`${e}px`,n=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));let s=r.measureText(t).width;return s>0&&(n?s-=e:s+=(bt.graphemeSegmenter(t).length-1)*e),s}static wordWrap(t,e,r=bt._canvas){const n=r.getContext("2d",to);let s=0,a="",h="";const u=Object.create(null),{letterSpacing:c,whiteSpace:m}=e,y=bt.collapseSpaces(m),v=bt.collapseNewlines(m);let b=!y;const T=e.wordWrapWidth+c,E=bt.tokenize(t);for(let P=0;P<E.length;P++){let M=E[P];if(bt.isNewline(M)){if(!v){h+=bt.addLine(a),b=!y,a="",s=0;continue}M=" "}if(y){const R=bt.isBreakingSpace(M),N=bt.isBreakingSpace(a[a.length-1]);if(R&&N)continue}const D=bt.getFromCache(M,c,u,n);if(D>T)if(a!==""&&(h+=bt.addLine(a),a="",s=0),bt.canBreakWords(M,e.breakWords)){const R=bt.wordWrapSplit(M);for(let N=0;N<R.length;N++){let Y=R[N],X=Y,K=1;for(;R[N+K];){const j=R[N+K];if(!bt.canBreakChars(X,j,M,N,e.breakWords))Y+=j;else break;X=j,K++}N+=K-1;const q=bt.getFromCache(Y,c,u,n);q+s>T&&(h+=bt.addLine(a),b=!1,a="",s=0),a+=Y,s+=q}}else{a.length>0&&(h+=bt.addLine(a),a="",s=0);const R=P===E.length-1;h+=bt.addLine(M,!R),b=!1,a="",s=0}else D+s>T&&(b=!1,h+=bt.addLine(a),a="",s=0),(a.length>0||!bt.isBreakingSpace(M)||b)&&(a+=M,s+=D)}return h+=bt.addLine(a,!1),h}static addLine(t,e=!0){return t=bt.trimRight(t),t=e?`${t}
`:t,t}static getFromCache(t,e,r,n){let s=r[t];return typeof s!="number"&&(s=bt._measureText(t,e,n)+e,r[t]=s),s}static collapseSpaces(t){return t==="normal"||t==="pre-line"}static collapseNewlines(t){return t==="normal"}static trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const r=t[e];if(!bt.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static isNewline(t){return typeof t!="string"?!1:bt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:bt._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let r="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const s=t[n],a=t[n+1];if(bt.isBreakingSpace(s,a)||bt.isNewline(s)){r!==""&&(e.push(r),r=""),e.push(s);continue}r+=s}return r!==""&&e.push(r),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,r,n,s){return!0}static wordWrapSplit(t){return bt.graphemeSegmenter(t)}static measureFont(t){if(bt._fonts[t])return bt._fonts[t];const e={ascent:0,descent:0,fontSize:0},r=bt._canvas,n=bt._context;n.font=t;const s=bt.METRICS_STRING+bt.BASELINE_SYMBOL,a=Math.ceil(n.measureText(s).width);let h=Math.ceil(n.measureText(bt.BASELINE_SYMBOL).width);const u=Math.ceil(bt.HEIGHT_MULTIPLIER*h);if(h=h*bt.BASELINE_MULTIPLIER|0,a===0||u===0)return bt._fonts[t]=e,e;r.width=a,r.height=u,n.fillStyle="#f00",n.fillRect(0,0,a,u),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,h);const c=n.getImageData(0,0,a,u).data,m=c.length,y=a*4;let v=0,b=0,T=!1;for(v=0;v<h;++v){for(let E=0;E<y;E+=4)if(c[b+E]!==255){T=!0;break}if(!T)b+=y;else break}for(e.ascent=h-v,b=m-y,T=!1,v=u;v>h;--v){for(let E=0;E<y;E+=4)if(c[b+E]!==255){T=!0;break}if(!T)b-=y;else break}return e.descent=v-h,e.fontSize=e.ascent+e.descent,bt._fonts[t]=e,e}static clearMetrics(t=""){t?delete bt._fonts[t]:bt._fonts={}}static get _canvas(){var t;if(!bt.__canvas){let e;try{const r=new OffscreenCanvas(0,0);if((t=r.getContext("2d",to))!=null&&t.measureText)return bt.__canvas=r,r;e=ft.ADAPTER.createCanvas()}catch{e=ft.ADAPTER.createCanvas()}e.width=e.height=10,bt.__canvas=e}return bt.__canvas}static get _context(){return bt.__context||(bt.__context=bt._canvas.getContext("2d",to)),bt.__context}};Mr.METRICS_STRING="|ÉqÅ",Mr.BASELINE_SYMBOL="M",Mr.BASELINE_MULTIPLIER=1.4,Mr.HEIGHT_MULTIPLIER=2,Mr.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>[...i.segment(t)].map(e=>e.segment)}return i=>[...i]})(),Mr.experimentalLetterSpacing=!1,Mr._fonts={},Mr._newlines=[10,13],Mr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let ai=Mr;const Z_=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],jf=class qn{constructor(t){this.styleID=0,this.reset(),nh(this,t,t)}clone(){const t={};return nh(t,this,qn.defaultStyle),new qn(t)}reset(){nh(this,qn.defaultStyle,qn.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=ih(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=ih(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){J_(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=ih(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t=typeof this.fontSize=="number"?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let r=e.length-1;r>=0;r--){let n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!Z_.includes(n)&&(n=`"${n}"`),e[r]=n}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};jf.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ea.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let pi=jf;function ih(i){const t=kt.shared,e=r=>{const n=t.setValue(r);return n.alpha===1?n.toHex():n.toRgbaString()};return Array.isArray(i)?i.map(e):e(i)}function J_(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(let e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function nh(i,t,e){for(const r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}const Q_={texture:!0,children:!1,baseTexture:!0},zf=class Qh extends Ie{constructor(t,e,r){let n=!1;r||(r=ft.ADAPTER.createCanvas(),n=!0),r.width=3,r.height=3;const s=pt.from(r);s.orig=new It,s.trim=new It,super(s),this._ownCanvas=n,this.canvas=r,this.context=r.getContext("2d",{willReadFrequently:!0}),this._resolution=Qh.defaultResolution??ft.RESOLUTION,this._autoResolution=Qh.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return ai.experimentalLetterSpacing}static set experimentalLetterSpacing(t){Ct("7.1.0","Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),ai.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const r=this.context,n=ai.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=n.width,a=n.height,h=n.lines,u=n.lineHeight,c=n.lineWidths,m=n.maxLineWidth,y=n.fontProperties;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,s)+e.padding*2)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,a)+e.padding*2)*this._resolution),r.scale(this._resolution,this._resolution),r.clearRect(0,0,this.canvas.width,this.canvas.height),r.font=this._font,r.lineWidth=e.strokeThickness,r.textBaseline=e.textBaseline,r.lineJoin=e.lineJoin,r.miterLimit=e.miterLimit;let v,b;const T=e.dropShadow?2:1;for(let E=0;E<T;++E){const P=e.dropShadow&&E===0,M=P?Math.ceil(Math.max(1,a)+e.padding*2):0,D=M*this._resolution;if(P){r.fillStyle="black",r.strokeStyle="black";const N=e.dropShadowColor,Y=e.dropShadowBlur*this._resolution,X=e.dropShadowDistance*this._resolution;r.shadowColor=kt.shared.setValue(N).setAlpha(e.dropShadowAlpha).toRgbaString(),r.shadowBlur=Y,r.shadowOffsetX=Math.cos(e.dropShadowAngle)*X,r.shadowOffsetY=Math.sin(e.dropShadowAngle)*X+D}else r.fillStyle=this._generateFillStyle(e,h,n),r.strokeStyle=e.stroke,r.shadowColor="black",r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0;let R=(u-y.fontSize)/2;u-y.fontSize<0&&(R=0);for(let N=0;N<h.length;N++)v=e.strokeThickness/2,b=e.strokeThickness/2+N*u+y.ascent+R,e.align==="right"?v+=m-c[N]:e.align==="center"&&(v+=(m-c[N])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(h[N],v+e.padding,b+e.padding-M,!0),e.fill&&this.drawLetterSpacing(h[N],v+e.padding,b+e.padding-M)}this.updateTexture()}drawLetterSpacing(t,e,r,n=!1){const s=this._style.letterSpacing;let a=!1;if(ai.experimentalLetterSpacingSupported&&(ai.experimentalLetterSpacing?(this.context.letterSpacing=`${s}px`,this.context.textLetterSpacing=`${s}px`,a=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),s===0||a){n?this.context.strokeText(t,e,r):this.context.fillText(t,e,r);return}let h=e;const u=ai.graphemeSegmenter(t);let c=this.context.measureText(t).width,m=0;for(let y=0;y<u.length;++y){const v=u[y];n?this.context.strokeText(v,h,r):this.context.fillText(v,h,r);let b="";for(let T=y+1;T<u.length;++T)b+=u[T];m=this.context.measureText(b).width,h+=c-m+s,c=m}}updateTexture(){const t=this.canvas;if(this._style.trim){const a=qd(t);a.data&&(t.width=a.width,t.height=a.height,this.context.putImageData(a.data,0,0))}const e=this._texture,r=this._style,n=r.trim?0:r.padding,s=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-n,e.trim.y=-n,e.orig.width=e._frame.width-n*2,e.orig.height=e._frame.height-n*2,this._onTextureUpdate(),s.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),this._textureID===-1&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,r){const n=t.fill;if(Array.isArray(n)){if(n.length===1)return n[0]}else return n;let s;const a=t.dropShadow?t.dropShadowDistance:0,h=t.padding||0,u=this.canvas.width/this._resolution-a-h*2,c=this.canvas.height/this._resolution-a-h*2,m=n.slice(),y=t.fillGradientStops.slice();if(!y.length){const v=m.length+1;for(let b=1;b<v;++b)y.push(b/v)}if(m.unshift(n[0]),y.unshift(0),m.push(n[n.length-1]),y.push(1),t.fillGradientType===ea.LINEAR_VERTICAL){s=this.context.createLinearGradient(u/2,h,u/2,c+h);const v=r.fontProperties.fontSize+t.strokeThickness;for(let b=0;b<e.length;b++){const T=r.lineHeight*(b-1)+v,E=r.lineHeight*b;let P=E;b>0&&T>E&&(P=(E+T)/2);const M=E+v,D=r.lineHeight*(b+1);let R=M;b+1<e.length&&D<M&&(R=(M+D)/2);const N=(R-P)/c;for(let Y=0;Y<m.length;Y++){let X=0;typeof y[Y]=="number"?X=y[Y]:X=Y/m.length;let K=Math.min(1,Math.max(0,P/c+X*N));K=Number(K.toFixed(5)),s.addColorStop(K,m[Y])}}}else{s=this.context.createLinearGradient(h,c/2,u+h,c/2);const v=m.length+1;let b=1;for(let T=0;T<m.length;T++){let E;typeof y[T]=="number"?E=y[T]:E=b/v,s.addColorStop(E,m[T]),b++}}return s}destroy(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},Q_,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=qr(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=qr(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},t instanceof pi?this._style=t:this._style=new pi(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};zf.defaultAutoResolution=!0;let Ml=zf;Ml.prototype._renderCanvas=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),Ie.prototype._renderCanvas.call(this,i)};const Xf=new qt;ae.prototype._cacheAsBitmap=!1;ae.prototype._cacheData=null;ae.prototype._cacheAsBitmapResolution=null;ae.prototype._cacheAsBitmapMultisample=null;class tx{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(ae.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(i){i!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(i){i!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=i,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(i){if(this._cacheAsBitmap===i)return;this._cacheAsBitmap=i;let t;i?(this._cacheData||(this._cacheData=new tx),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}});ae.prototype._renderCached=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(i),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(i))};ae.prototype._initCachedDisplayObject=function(i){var v,b;if((v=this._cacheData)!=null&&v.sprite)return;const t=this.alpha;this.alpha=1,i.batch.flush();const e=this.getLocalBounds(new It,!0);if((b=this.filters)!=null&&b.length){const T=this.filters[0].padding;e.pad(T)}const r=this.cacheAsBitmapResolution||i.resolution;e.ceil(r),e.width=Math.max(e.width,1/r),e.height=Math.max(e.height,1/r);const n=i.renderTexture.current,s=i.renderTexture.sourceFrame.clone(),a=i.renderTexture.destinationFrame.clone(),h=i.projection.transform,u=_r.create({width:e.width,height:e.height,resolution:r,multisample:this.cacheAsBitmapMultisample??i.multisample}),c=`cacheAsBitmap_${di()}`;this._cacheData.textureCacheId=c,Rt.addToCache(u.baseTexture,c),pt.addToCache(u,c);const m=this.transform.localTransform.copyTo(Xf).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,i.render(this,{renderTexture:u,clear:!0,transform:m,skipUpdateTransform:!1}),i.framebuffer.blit(),i.projection.transform=h,i.renderTexture.bind(n,s,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=t;const y=new Ie(u);y.transform.worldTransform=this.transform.worldTransform,y.anchor.x=-(e.x/e.width),y.anchor.y=-(e.y/e.height),y.alpha=t,y._bounds=this._bounds,this._cacheData.sprite=y,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=y.containsPoint.bind(y)};ae.prototype._renderCachedCanvas=function(i){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(i),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(i))};ae.prototype._initCachedDisplayObjectCanvas=function(i){var m;if((m=this._cacheData)!=null&&m.sprite)return;const t=this.getLocalBounds(new It,!0),e=this.alpha;this.alpha=1;const r=i.canvasContext.activeContext,n=i._projTransform,s=this.cacheAsBitmapResolution||i.resolution;t.ceil(s),t.width=Math.max(t.width,1/s),t.height=Math.max(t.height,1/s);const a=_r.create({width:t.width,height:t.height,resolution:s}),h=`cacheAsBitmap_${di()}`;this._cacheData.textureCacheId=h,Rt.addToCache(a.baseTexture,h),pt.addToCache(a,h);const u=Xf;this.transform.localTransform.copyTo(u),u.invert(),u.tx-=t.x,u.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,i.render(this,{renderTexture:a,clear:!0,transform:u,skipUpdateTransform:!1}),i.canvasContext.activeContext=r,i._projTransform=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const c=new Ie(a);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-(t.x/t.width),c.anchor.y=-(t.y/t.height),c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=i._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)};ae.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};ae.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};ae.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Rt.removeFromCache(this._cacheData.textureCacheId),pt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};ae.prototype._cacheAsBitmapDestroy=function(i){this.cacheAsBitmap=!1,this.destroy(i)};ae.prototype.name=null;ge.prototype.getChildByName=function(i,t){for(let e=0,r=this.children.length;e<r;e++)if(this.children[e].name===i)return this.children[e];if(t)for(let e=0,r=this.children.length;e<r;e++){const n=this.children[e];if(!n.getChildByName)continue;const s=n.getChildByName(i,!0);if(s)return s}return null};ae.prototype.getGlobalPosition=function(i=new Ut,t=!1){return this.parent?this.parent.toGlobal(this.position,i,t):(i.x=this.position.x,i.y=this.position.y),i};var ex=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`;class rx extends Ne{constructor(t=1){super(B_,ex,{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}const ix={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},nx=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function sx(i){const t=ix[i],e=t.length;let r=nx,n="";const s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;";let a;for(let h=0;h<i;h++){let u=s.replace("%index%",h.toString());a=h,h>=e&&(a=i-h-1),u=u.replace("%value%",t[a].toString()),n+=u,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}const ox=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function ax(i,t){const e=Math.ceil(i/2);let r=ox,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let a=0;a<i;a++){let h=s.replace("%index%",a.toString());h=h.replace("%sampleIndex%",`${a-(e-1)}.0`),n+=h,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}class tl extends Ne{constructor(t,e=8,r=4,n=Ne.defaultResolution,s=5){const a=ax(s,t),h=sx(s);super(a,h),this.horizontal=t,this.resolution=n,this._quality=0,this.quality=r,this.blur=e}apply(t,e,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/e.width):this.uniforms.strength=1/r.height*(r.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,e,r,n);else{const s=t.getFilterTexture(),a=t.renderer;let h=e,u=s;this.state.blend=!1,t.applyFilter(this,h,u,Dr.CLEAR);for(let c=1;c<this.passes-1;c++){t.bindAndClear(h,Dr.BLIT),this.uniforms.uSampler=u;const m=u;u=h,h=m,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,u,r,n),t.returnFilterTexture(s)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class hx extends Ne{constructor(t=8,e=4,r=Ne.defaultResolution,n=5){super(),this._repeatEdgePixels=!1,this.blurXFilter=new tl(!0,t,e,r,n),this.blurYFilter=new tl(!1,t,e,r,n),this.resolution=r,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,r,n){const s=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(s&&a){const h=t.getFilterTexture();this.blurXFilter.apply(t,e,h,Dr.CLEAR),this.blurYFilter.apply(t,h,r,n),t.returnFilterTexture(h)}else a?this.blurYFilter.apply(t,e,r,n):this.blurXFilter.apply(t,e,r,n)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}var lx=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`;class el extends Ne{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Mf,lx,t),this.alpha=1}_loadMatrix(t,e=!1){let r=t;e&&(this._multiply(r,this.uniforms.m,t),r=this._colorMatrix(r)),this.uniforms.m=r}_multiply(t,e,r){return t[0]=e[0]*r[0]+e[1]*r[5]+e[2]*r[10]+e[3]*r[15],t[1]=e[0]*r[1]+e[1]*r[6]+e[2]*r[11]+e[3]*r[16],t[2]=e[0]*r[2]+e[1]*r[7]+e[2]*r[12]+e[3]*r[17],t[3]=e[0]*r[3]+e[1]*r[8]+e[2]*r[13]+e[3]*r[18],t[4]=e[0]*r[4]+e[1]*r[9]+e[2]*r[14]+e[3]*r[19]+e[4],t[5]=e[5]*r[0]+e[6]*r[5]+e[7]*r[10]+e[8]*r[15],t[6]=e[5]*r[1]+e[6]*r[6]+e[7]*r[11]+e[8]*r[16],t[7]=e[5]*r[2]+e[6]*r[7]+e[7]*r[12]+e[8]*r[17],t[8]=e[5]*r[3]+e[6]*r[8]+e[7]*r[13]+e[8]*r[18],t[9]=e[5]*r[4]+e[6]*r[9]+e[7]*r[14]+e[8]*r[19]+e[9],t[10]=e[10]*r[0]+e[11]*r[5]+e[12]*r[10]+e[13]*r[15],t[11]=e[10]*r[1]+e[11]*r[6]+e[12]*r[11]+e[13]*r[16],t[12]=e[10]*r[2]+e[11]*r[7]+e[12]*r[12]+e[13]*r[17],t[13]=e[10]*r[3]+e[11]*r[8]+e[12]*r[13]+e[13]*r[18],t[14]=e[10]*r[4]+e[11]*r[9]+e[12]*r[14]+e[13]*r[19]+e[14],t[15]=e[15]*r[0]+e[16]*r[5]+e[17]*r[10]+e[18]*r[15],t[16]=e[15]*r[1]+e[16]*r[6]+e[17]*r[11]+e[18]*r[16],t[17]=e[15]*r[2]+e[16]*r[7]+e[17]*r[12]+e[18]*r[17],t[18]=e[15]*r[3]+e[16]*r[8]+e[17]*r[13]+e[18]*r[18],t[19]=e[15]*r[4]+e[16]*r[9]+e[17]*r[14]+e[18]*r[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const r=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}tint(t,e){const[r,n,s]=kt.shared.setValue(t).toArray(),a=[r,0,0,0,0,0,n,0,0,0,0,0,s,0,0,0,0,0,1,0];this._loadMatrix(a,e)}greyscale(t,e){const r=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(r,e)}blackAndWhite(t){const e=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(e,t)}hue(t,e){t=(t||0)/180*Math.PI;const r=Math.cos(t),n=Math.sin(t),s=Math.sqrt,a=1/3,h=s(a),u=r+(1-r)*a,c=a*(1-r)-h*n,m=a*(1-r)+h*n,y=a*(1-r)+h*n,v=r+a*(1-r),b=a*(1-r)-h*n,T=a*(1-r)-h*n,E=a*(1-r)+h*n,P=r+a*(1-r),M=[u,c,m,0,0,y,v,b,0,0,T,E,P,0,0,0,0,0,1,0];this._loadMatrix(M,e)}contrast(t,e){const r=(t||0)+1,n=-.5*(r-1),s=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(s,e)}saturate(t=0,e){const r=t*2/3+1,n=(r-1)*-.5,s=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(s,e)}desaturate(){this.saturate(-1)}negative(t){const e=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(e,t)}sepia(t){const e=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(e,t)}technicolor(t){const e=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(e,t)}polaroid(t){const e=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(e,t)}toBGR(t){const e=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(e,t)}kodachrome(t){const e=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(e,t)}browni(t){const e=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(e,t)}vintage(t){const e=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(e,t)}colorTone(t,e,r,n,s){t=t||.2,e=e||.15,r=r||16770432,n=n||3375104;const a=kt.shared,[h,u,c]=a.setValue(r).toArray(),[m,y,v]=a.setValue(n).toArray(),b=[.3,.59,.11,0,0,h,u,c,t,0,m,y,v,e,0,h-m,u-y,c-v,0,0];this._loadMatrix(b,s)}night(t,e){t=t||.1;const r=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(r,e)}predator(t,e){const r=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(r,e)}lsd(t){const e=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(e,t)}reset(){const t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}el.prototype.grayscale=el.prototype.greyscale;var ux=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,cx=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`;class dx extends Ne{constructor(t,e){const r=new qt;t.renderable=!1,super(cx,ux,{mapSampler:t._texture,filterMatrix:r,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=r,e==null&&(e=20),this.scale=new Ut(e,e)}apply(t,e,r,n){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const s=this.maskSprite.worldTransform,a=Math.sqrt(s.a*s.a+s.b*s.b),h=Math.sqrt(s.c*s.c+s.d*s.d);a!==0&&h!==0&&(this.uniforms.rotation[0]=s.a/a,this.uniforms.rotation[1]=s.b/a,this.uniforms.rotation[2]=s.c/h,this.uniforms.rotation[3]=s.d/h),t.applyFilter(this,e,r,n)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}}var fx=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputSize;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,px=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`;class mx extends Ne{constructor(){super(px,fx)}}var gx=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`;class yx extends Ne{constructor(t=.5,e=Math.random()){super(Mf,gx,{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}const kc={AlphaFilter:rx,BlurFilter:hx,BlurFilterPass:tl,ColorMatrixFilter:el,DisplacementFilter:dx,FXAAFilter:mx,NoiseFilter:yx};Object.entries(kc).forEach(([i,t])=>{Object.defineProperty(kc,i,{get(){return Ct("7.1.0",`filters.${i} has moved to ${i}`),t}})});class vx{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this.tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this.tickerAdded||!this.domElement||(qe.system.add(this.tickerUpdate,this,Ni.INTERACTION),this.tickerAdded=!0)}removeTickerListener(){this.tickerAdded&&(qe.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)}pointerMoved(){this._didMove=!0}update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events.rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY}))}tickerUpdate(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())}}const hi=new vx;class ys{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ys.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new Ut,this.page=new Ut,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,r,n,s){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Oo extends ys{constructor(){super(...arguments),this.client=new Ut,this.movement=new Ut,this.offset=new Ut,this.global=new Ut,this.screen=new Ut}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,r,n,s,a,h,u,c,m,y,v,b,T,E){throw new Error("Method not implemented.")}}class dr extends Oo{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class cn extends Oo{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}cn.DOM_DELTA_PIXEL=0,cn.DOM_DELTA_LINE=1,cn.DOM_DELTA_PAGE=2;const _x=2048,xx=new Ut,sh=new Ut;class bx{constructor(t){this.dispatch=new _n,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((r,n)=>r.priority-n.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let r=0,n=e.length;r<n;r++)e[r].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){hi.pauseUpdate=!0;const r=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",n=this[r](this.rootTarget,this.rootTarget.eventMode,xx.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let n=0,s=r.length-1;n<s;n++)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let n=r.length-2;n>=0;n--)if(t.currentTarget=r[n],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const n=Array.isArray(e)?e:[e];for(let s=r.length-1;s>=0;s--)n.forEach(a=>{t.currentTarget=r[s],this.notifyTarget(t,a)})}propagationPath(t){const e=[t];for(let r=0;r<_x&&t!==this.rootTarget;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestMoveRecursive(t,e,r,n,s,a=!1){let h=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(hi.pauseUpdate=!1),t.interactiveChildren&&t.children){const m=t.children;for(let y=m.length-1;y>=0;y--){const v=m[y],b=this.hitTestMoveRecursive(v,this._isInteractive(e)?e:v.eventMode,r,n,s,a||s(t,r));if(b){if(b.length>0&&!b[b.length-1].parent)continue;const T=t.isInteractive();(b.length>0||T)&&(T&&this._allInteractiveElements.push(t),b.push(t)),this._hitElements.length===0&&(this._hitElements=b),h=!0}}}const u=this._isInteractive(e),c=t.isInteractive();return u&&c&&this._allInteractiveElements.push(t),a||this._hitElements.length>0?null:h?this._hitElements:u&&!s(t,r)&&n(t,r)?c?[t]:[]:null}hitTestRecursive(t,e,r,n,s){if(this._interactivePrune(t)||s(t,r))return null;if((t.eventMode==="dynamic"||e==="dynamic")&&(hi.pauseUpdate=!1),t.interactiveChildren&&t.children){const u=t.children;for(let c=u.length-1;c>=0;c--){const m=u[c],y=this.hitTestRecursive(m,this._isInteractive(e)?e:m.eventMode,r,n,s);if(y){if(y.length>0&&!y[y.length-1].parent)continue;const v=t.isInteractive();return(y.length>0||v)&&y.push(t),y}}}const a=this._isInteractive(e),h=t.isInteractive();return a&&n(t,r)?h?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!!(!t||t.isMask||!t.visible||!t.renderable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren||t.isMask)}hitPruneFn(t,e){var r;if(t.hitArea&&(t.worldTransform.applyInverse(e,sh),!t.hitArea.contains(sh.x,sh.y)))return!0;if(t._mask){const n=t._mask.isMaskData?t._mask.maskObject:t._mask;if(n&&!((r=n.containsPoint)!=null&&r.call(n,e)))return!0}return!1}hitTestFn(t,e){return t.eventMode==="passive"?!1:t.hitArea?!0:t.containsPoint?t.containsPoint(e):!1}notifyTarget(t,e){var s,a;e=e??t.type;const r=`on${e}`;(a=(s=t.currentTarget)[r])==null||a.call(s,t);const n=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,n),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),e.pointerType==="touch")this.dispatchEvent(e,"touchstart");else if(e.pointerType==="mouse"||e.pointerType==="pen"){const n=e.button===2;this.dispatchEvent(e,n?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var u,c;if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const e=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r=e.pointerType==="mouse"||e.pointerType==="pen",n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.overTargets);if(((u=n.overTargets)==null?void 0:u.length)>0&&s!==e.target){const m=t.type==="mousemove"?"mouseout":"pointerout",y=this.createPointerEvent(t,m,s);if(this.dispatchEvent(y,"pointerout"),r&&this.dispatchEvent(y,"mouseout"),!e.composedPath().includes(s)){const v=this.createPointerEvent(t,"pointerleave",s);for(v.eventPhase=v.AT_TARGET;v.target&&!e.composedPath().includes(v.target);)v.currentTarget=v.target,this.notifyTarget(v),r&&this.notifyTarget(v,"mouseleave"),v.target=v.target.parent;this.freeEvent(v)}this.freeEvent(y)}if(s!==e.target){const m=t.type==="mousemove"?"mouseover":"pointerover",y=this.clonePointerEvent(e,m);this.dispatchEvent(y,"pointerover"),r&&this.dispatchEvent(y,"mouseover");let v=s==null?void 0:s.parent;for(;v&&v!==this.rootTarget.parent&&v!==e.target;)v=v.parent;if(!v||v===this.rootTarget.parent){const b=this.clonePointerEvent(e,"pointerenter");for(b.eventPhase=b.AT_TARGET;b.target&&b.target!==s&&b.target!==this.rootTarget.parent;)b.currentTarget=b.target,this.notifyTarget(b),r&&this.notifyTarget(b,"mouseenter"),b.target=b.target.parent;this.freeEvent(b)}this.freeEvent(y)}const a=[],h=this.enableGlobalMoveEvents??!0;this.moveOnAll?a.push("pointermove"):this.dispatchEvent(e,"pointermove"),h&&a.push("globalpointermove"),e.pointerType==="touch"&&(this.moveOnAll?a.splice(1,0,"touchmove"):this.dispatchEvent(e,"touchmove"),h&&a.push("globaltouchmove")),r&&(this.moveOnAll?a.splice(1,0,"mousemove"):this.dispatchEvent(e,"mousemove"),h&&a.push("globalmousemove"),this.cursor=(c=e.target)==null?void 0:c.cursor),a.length>0&&this.all(e,a),this._allInteractiveElements.length=0,this._hitElements.length=0,n.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){var a;if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.createPointerEvent(t),n=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),n&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(a=r.target)==null?void 0:a.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;e.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId);if(e.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",n=this.findMountedTarget(e.overTargets),s=this.createPointerEvent(t,"pointerout",n);this.dispatchEvent(s),r&&this.dispatchEvent(s,"mouseout");const a=this.createPointerEvent(t,"pointerleave",n);for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),r&&this.notifyTarget(a,"mouseleave"),a.target=a.target.parent;e.overTargets=null,this.freeEvent(s),this.freeEvent(a)}this.cursor=null}mapPointerUp(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const h=r.button===2;this.dispatchEvent(r,h?"rightup":"mouseup")}const n=this.trackingData(t.pointerId),s=this.findMountedTarget(n.pressTargetsByButton[t.button]);let a=s;if(s&&!r.composedPath().includes(s)){let h=s;for(;h&&!r.composedPath().includes(h);){if(r.currentTarget=h,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const u=r.button===2;this.notifyTarget(r,u?"rightupoutside":"mouseupoutside")}h=h.parent}delete n.pressTargetsByButton[t.button],a=h}if(a){const h=this.clonePointerEvent(r,"click");h.target=a,h.path=null,n.clicksByButton[t.button]||(n.clicksByButton[t.button]={clickCount:0,target:h.target,timeStamp:e});const u=n.clicksByButton[t.button];if(u.target===h.target&&e-u.timeStamp<200?++u.clickCount:u.clickCount=1,u.target=h.target,u.timeStamp=e,h.detail=u.clickCount,h.pointerType==="mouse"){const c=h.button===2;this.dispatchEvent(h,c?"rightclick":"click")}else h.pointerType==="touch"&&this.dispatchEvent(h,"tap");this.dispatchEvent(h,"pointertap"),this.freeEvent(h)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof dr)){console.warn("EventBoundary cannot map a non-pointer event as a pointer event");return}const e=this.trackingData(t.pointerId),r=this.findMountedTarget(e.pressTargetsByButton[t.button]),n=this.createPointerEvent(t);if(r){let s=r;for(;s;)n.currentTarget=s,this.notifyTarget(n,"pointerupoutside"),n.pointerType==="touch"?this.notifyTarget(n,"touchendoutside"):(n.pointerType==="mouse"||n.pointerType==="pen")&&this.notifyTarget(n,n.button===2?"rightupoutside":"mouseupoutside"),s=s.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(n)}mapWheel(t){if(!(t instanceof cn)){console.warn("EventBoundary cannot map a non-wheel event as a wheel event");return}const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let r=1;r<t.length&&t[r].parent===e;r++)e=t[r];return e}createPointerEvent(t,e,r){const n=this.allocateEvent(dr);return this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.nativeEvent=t.nativeEvent,n.originalEvent=t,n.target=r??this.hitTest(n.global.x,n.global.y)??this._hitElements[0],typeof e=="string"&&(n.type=e),n}createWheelEvent(t){const e=this.allocateEvent(cn);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const r=this.allocateEvent(dr);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=e??r.type,r}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof dr&&e instanceof dr&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Oo&&e instanceof Oo&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.shiftKey=t.shiftKey,e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const r=t.currentTarget._events[e];if(r&&t.currentTarget.isInteractive())if("fn"in r)r.once&&t.currentTarget.removeListener(e,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let n=0,s=r.length;n<s&&!t.propagationImmediatelyStopped;n++)r[n].once&&t.currentTarget.removeListener(e,r[n].fn,void 0,!0),r[n].fn.call(r[n].context,t)}}const Tx=1,wx={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},rl=class il{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new bx(null),hi.init(this),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new dr(null),this.rootWheelEvent=new cn(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...il.defaultEventFeatures},{set:(e,r,n)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=n),e[r]=n,!0)}),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{view:e,resolution:r}=this.renderer;this.setTargetElement(e),this.resolution=r,il._defaultEventMode=t.eventMode??"auto",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":e&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":e&&Object.assign(this.domElement.style,r);break}else e&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this.rootPointerEvent}onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,n=e.length;r<n;r++){const s=e[r],a=this.bootstrapEvent(this.rootPointerEvent,s);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,hi.pointerMoved();const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const r=e!==this.domElement?"outside":"",n=this.normalizeToPointerData(t);for(let s=0,a=n.length;s<a;s++){const h=this.bootstrapEvent(this.rootPointerEvent,n[s]);h.type+=r,this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const e=this.normalizeToPointerData(t);for(let r=0,n=e.length;r<n;r++){const s=this.bootstrapEvent(this.rootPointerEvent,e[r]);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,hi.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;hi.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;hi.removeTickerListener();const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,r){const n=this.domElement.isConnected?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0},s=1/this.resolution;t.x=(e-n.left)*(this.domElement.width/n.width)*s,t.y=(r-n.top)*(this.domElement.height/n.height)*s}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,n=t.changedTouches.length;r<n;r++){const s=t.changedTouches[r];typeof s.button>"u"&&(s.button=0),typeof s.buttons>"u"&&(s.buttons=1),typeof s.isPrimary>"u"&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof s.width>"u"&&(s.width=s.radiusX||1),typeof s.height>"u"&&(s.height=s.radiusY||1),typeof s.tiltX>"u"&&(s.tiltX=0),typeof s.tiltY>"u"&&(s.tiltY=0),typeof s.pointerType>"u"&&(s.pointerType="touch"),typeof s.pointerId>"u"&&(s.pointerId=s.identifier||0),typeof s.pressure>"u"&&(s.pressure=s.force||.5),typeof s.twist>"u"&&(s.twist=0),typeof s.tangentialPressure>"u"&&(s.tangentialPressure=0),typeof s.layerX>"u"&&(s.layerX=s.offsetX=s.clientX),typeof s.layerY>"u"&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=Tx),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,e.push(r)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=wx[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}};rl.extension={name:"events",type:[ut.RendererSystem,ut.CanvasRendererSystem]},rl.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let nl=rl;mt.add(nl);function Nc(i){return i==="dynamic"||i==="static"}const Ax={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,_internalInteractive:void 0,get interactive(){return this._internalInteractive??Nc(nl.defaultEventMode)},set interactive(i){Ct("7.2.0","Setting interactive is deprecated, use eventMode = 'none'/'passive'/'auto'/'static'/'dynamic' instead."),this._internalInteractive=i,this.eventMode=i?"static":"auto"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??nl.defaultEventMode},set eventMode(i){this._internalInteractive=Nc(i),this._internalEventMode=i},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof e=="object"?e.signal:void 0,s=typeof e=="object"?e.once===!0:!1,a=typeof t=="function"?void 0:t;i=r?`${i}capture`:i;const h=typeof t=="function"?t:t.handleEvent,u=this;n&&n.addEventListener("abort",()=>{u.off(i,h,a)}),s?u.once(i,h,a):u.on(i,h,a)},removeEventListener(i,t,e){const r=typeof e=="boolean"&&e||typeof e=="object"&&e.capture,n=typeof t=="function"?void 0:t;i=r?`${i}capture`:i,t=typeof t=="function"?t:t.handleEvent,this.off(i,t,n)},dispatchEvent(i){if(!(i instanceof ys))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return i.defaultPrevented=!1,i.path=null,i.target=this,i.manager.dispatchEvent(i),!i.defaultPrevented}};ae.mixin(Ax);const Ex={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};ae.mixin(Ex);const Sx=9,eo=100,Cx=0,Px=0,Uc=2,Gc=1,Rx=-1e3,Mx=-1e3,Ix=2;class Yf{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(Lr.tablet||Lr.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width=`${eo}px`,e.style.height=`${eo}px`,e.style.position="absolute",e.style.top=`${Cx}px`,e.style.left=`${Px}px`,e.style.zIndex=Uc.toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width=`${Gc}px`,t.style.height=`${Gc}px`,t.style.position="absolute",t.style.top=`${Rx}px`,t.style.left=`${Mx}px`,t.style.zIndex=Ix.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),(t=this.renderer.view.parentNode)==null||t.appendChild(this.div))}deactivate(){var t;!this._isActive||this._isMobileAccessibility||(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),(t=this.div.parentNode)==null||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.isInteractive()&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}update(){const t=performance.now();if(Lr.android.device&&t<this.androidUpdateCount||(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen))return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:r,width:n,height:s}=this.renderer.view.getBoundingClientRect(),{width:a,height:h,resolution:u}=this.renderer,c=n/a*u,m=s/h*u;let y=this.div;y.style.left=`${e}px`,y.style.top=`${r}px`,y.style.width=`${a}px`,y.style.height=`${h}px`;for(let v=0;v<this.children.length;v++){const b=this.children[v];if(b.renderId!==this.renderId)b._accessibleActive=!1,Oi(this.children,v,1),this.div.removeChild(b._accessibleDiv),this.pool.push(b._accessibleDiv),b._accessibleDiv=null,v--;else{y=b._accessibleDiv;let T=b.hitArea;const E=b.worldTransform;b.hitArea?(y.style.left=`${(E.tx+T.x*E.a)*c}px`,y.style.top=`${(E.ty+T.y*E.d)*m}px`,y.style.width=`${T.width*E.a*c}px`,y.style.height=`${T.height*E.d*m}px`):(T=b.getBounds(),this.capHitArea(T),y.style.left=`${T.x*c}px`,y.style.top=`${T.y*m}px`,y.style.width=`${T.width*c}px`,y.style.height=`${T.height*m}px`,y.title!==b.accessibleTitle&&b.accessibleTitle!==null&&(y.title=b.accessibleTitle),y.getAttribute("aria-label")!==b.accessibleHint&&b.accessibleHint!==null&&y.setAttribute("aria-label",b.accessibleHint)),(b.accessibleTitle!==y.title||b.tabIndex!==y.tabIndex)&&(y.title=b.accessibleTitle,y.tabIndex=b.tabIndex,this.debug&&this.updateDebugHTML(y))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:r}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>r&&(t.height=r-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=`${eo}px`,e.style.height=`${eo}px`,e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Uc.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:r}=t.target,n=this.renderer.events.rootBoundary,s=Object.assign(new ys(n),{target:r});n.rootTarget=this.renderer.lastObjectRendered,e.forEach(a=>n.dispatchEvent(s,a))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode===Sx&&this.activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}Yf.extension={name:"accessibility",type:[ut.RendererPlugin,ut.CanvasRendererPlugin]};mt.add(Yf);const qf=class sl{constructor(t){this.stage=new ge,t=Object.assign({forceCanvas:!1},t),this.renderer=M_(t),sl._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render(this.stage)}get view(){var t;return(t=this.renderer)==null?void 0:t.view}get screen(){var t;return(t=this.renderer)==null?void 0:t.screen}destroy(t,e){const r=sl._plugins.slice(0);r.reverse(),r.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};qf._plugins=[];let Il=qf;mt.handleByList(ut.Application,Il._plugins);class Kf{static init(t){Object.defineProperty(this,"resizeTo",{set(e){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=e,e&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this.cancelResize();let e,r;if(this._resizeTo===globalThis.window)e=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:s}=this._resizeTo;e=n,r=s}this.renderer.resize(e,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Kf.extension=ut.Application;mt.add(Kf);const Hc={loader:ut.LoadParser,resolver:ut.ResolveParser,cache:ut.CacheParser,detection:ut.DetectionParser};mt.handle(ut.Asset,i=>{const t=i.ref;Object.entries(Hc).filter(([e])=>!!t[e]).forEach(([e,r])=>mt.add(Object.assign(t[e],{extension:t[e].extension??r})))},i=>{const t=i.ref;Object.keys(Hc).filter(e=>!!t[e]).forEach(e=>mt.remove(t[e]))});class Fx{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let r=0;r<e;r++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function bn(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function gi(i,t){const e=i.split("?")[0],r=be.extname(e).toLowerCase();return Array.isArray(t)?t.includes(r):r===t}const fr=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(r=>typeof r=="string"||e?t(r):r):i),ol=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i};function Zf(i,t,e,r,n){const s=t[e];for(let a=0;a<s.length;a++){const h=s[a];e<t.length-1?Zf(i.replace(r[e],h),t,e+1,r,n):n.push(i.replace(r[e],h))}}function Bx(i){const t=/\{(.*?)\}/g,e=i.match(t),r=[];if(e){const n=[];e.forEach(s=>{const a=s.substring(1,s.length-1).split(",");n.push(a)}),Zf(i,n,0,e,r)}else r.push(i);return r}const Lo=i=>!Array.isArray(i);class Dx{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||console.warn(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const r=fr(t);let n;for(let h=0;h<this.parsers.length;h++){const u=this.parsers[h];if(u.test(e)){n=u.getCacheableAssets(r,e);break}}n||(n={},r.forEach(h=>{n[h]=e}));const s=Object.keys(n),a={cacheKeys:s,keys:r};if(r.forEach(h=>{this._cacheMap.set(h,a)}),s.forEach(h=>{this._cache.has(h)&&this._cache.get(h)!==e&&console.warn("[Cache] already has key:",h),this._cache.set(h,n[h])}),e instanceof pt){const h=e;r.forEach(u=>{h.baseTexture!==pt.EMPTY.baseTexture&&Rt.addToCache(h.baseTexture,u),pt.addToCache(h,u)})}}remove(t){if(!this._cacheMap.has(t)){console.warn(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(r=>{this._cache.delete(r)}),e.keys.forEach(r=>{this._cacheMap.delete(r)})}get parsers(){return this._parsers}}const Bi=new Dx;class Ox{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,r)=>(this._parsersValidated=!1,t[e]=r,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const r={promise:null,parser:null};return r.promise=(async()=>{var a,h;let n=null,s=null;if(e.loadParser&&(s=this._parserHash[e.loadParser],s||console.warn(`[Assets] specified load parser "${e.loadParser}" not found while loading ${t}`)),!s){for(let u=0;u<this.parsers.length;u++){const c=this.parsers[u];if(c.load&&((a=c.test)!=null&&a.call(c,t,e,this))){s=c;break}}if(!s)return console.warn(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await s.load(t,e,this),r.parser=s;for(let u=0;u<this.parsers.length;u++){const c=this.parsers[u];c.parse&&c.parse&&await((h=c.testParse)==null?void 0:h.call(c,n,e,this))&&(n=await c.parse(n,e,this)||n,r.parser=c)}return n})(),r}async load(t,e){this._parsersValidated||this._validateParsers();let r=0;const n={},s=Lo(t),a=fr(t,c=>({alias:[c],src:c})),h=a.length,u=a.map(async c=>{const m=be.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[m]||(this.promiseCache[m]=this._getLoadPromiseAndParser(m,c)),n[c.src]=await this.promiseCache[m].promise,e&&e(++r/h)}catch(y){throw delete this.promiseCache[m],delete n[c.src],new Error(`[Loader.load] Failed to load ${m}.
${y}`)}});return await Promise.all(u),s?n[a[0].src]:n}async unload(t){const e=fr(t,r=>({alias:[r],src:r})).map(async r=>{var a,h;const n=be.toAbsolute(r.src),s=this.promiseCache[n];if(s){const u=await s.promise;delete this.promiseCache[n],(h=(a=s.parser)==null?void 0:a.unload)==null||h.call(a,u,r,this)}});await Promise.all(e)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name).reduce((t,e)=>(t[e.name]&&console.warn(`[Assets] loadParser name conflict "${e.name}"`),{...t,[e.name]:e}),{})}}var xr=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(xr||{});const Lx=".json",kx="application/json",Nx={extension:{type:ut.LoadParser,priority:xr.Low},name:"loadJson",test(i){return bn(i,kx)||gi(i,Lx)},async load(i){return await(await ft.ADAPTER.fetch(i)).json()}};mt.add(Nx);const Ux=".txt",Gx="text/plain",Hx={name:"loadTxt",extension:{type:ut.LoadParser,priority:xr.Low},test(i){return bn(i,Gx)||gi(i,Ux)},async load(i){return await(await ft.ADAPTER.fetch(i)).text()}};mt.add(Hx);const $x=["normal","bold","100","200","300","400","500","600","700","800","900"],Wx=[".ttf",".otf",".woff",".woff2"],Vx=["font/ttf","font/otf","font/woff","font/woff2"],jx=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function zx(i){const t=be.extname(i),e=be.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(s=>s.charAt(0).toUpperCase()+s.slice(1));let r=e.length>0;for(const s of e)if(!s.match(jx)){r=!1;break}let n=e.join(" ");return r||(n=`"${n.replace(/[\\"]/g,"\\$&")}"`),n}const Xx=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function Yx(i){return Xx.test(i)?i:encodeURI(i)}const qx={extension:{type:ut.LoadParser,priority:xr.Low},name:"loadWebFont",test(i){return bn(i,Vx)||gi(i,Wx)},async load(i,t){var r,n,s;const e=ft.ADAPTER.getFontFaceSet();if(e){const a=[],h=((r=t.data)==null?void 0:r.family)??zx(i),u=((s=(n=t.data)==null?void 0:n.weights)==null?void 0:s.filter(m=>$x.includes(m)))??["normal"],c=t.data??{};for(let m=0;m<u.length;m++){const y=u[m],v=new FontFace(h,`url(${Yx(i)})`,{...c,weight:y});await v.load(),e.add(v),a.push(v)}return a.length===1?a[0]:a}return console.warn("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){(Array.isArray(i)?i:[i]).forEach(t=>ft.ADAPTER.getFontFaceSet().delete(t))}};mt.add(qx);const Kx=`(function() {
  "use strict";
  const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
  async function checkImageBitmap() {
    try {
      if (typeof createImageBitmap != "function")
        return !1;
      const imageBlob = await (await fetch(WHITE_PNG)).blob(), imageBitmap = await createImageBitmap(imageBlob);
      return imageBitmap.width === 1 && imageBitmap.height === 1;
    } catch {
      return !1;
    }
  }
  checkImageBitmap().then((result) => {
    self.postMessage(result);
  });
})();
`;let dn=null,al=class{constructor(){dn||(dn=URL.createObjectURL(new Blob([Kx],{type:"application/javascript"}))),this.worker=new Worker(dn)}};al.revokeObjectURL=function(){dn&&(URL.revokeObjectURL(dn),dn=null)};const Zx=`(function() {
  "use strict";
  async function loadImageBitmap(url) {
    const response = await fetch(url);
    if (!response.ok)
      throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
    const imageBlob = await response.blob();
    return await createImageBitmap(imageBlob);
  }
  self.onmessage = async (event) => {
    try {
      const imageBitmap = await loadImageBitmap(event.data.data[0]);
      self.postMessage({
        data: imageBitmap,
        uuid: event.data.uuid,
        id: event.data.id
      }, [imageBitmap]);
    } catch (e) {
      self.postMessage({
        error: e,
        uuid: event.data.uuid,
        id: event.data.id
      });
    }
  };
})();
`;let fn=null;class Jf{constructor(){fn||(fn=URL.createObjectURL(new Blob([Zx],{type:"application/javascript"}))),this.worker=new Worker(fn)}}Jf.revokeObjectURL=function(){fn&&(URL.revokeObjectURL(fn),fn=null)};let $c=0,oh;class Jx{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new al;e.addEventListener("message",r=>{e.terminate(),al.revokeObjectURL(),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){oh===void 0&&(oh=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<oh&&(this._createdWorkers++,t=new Jf().worker,t.addEventListener("message",e=>{this.complete(e.data),this.returnWorker(e.target),this.next()})),t}returnWorker(t){this.workerPool.push(t)}complete(t){t.error!==void 0?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const r=new Promise((n,s)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:s})});return this.next(),r}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),r=e.id;this.resolveHash[$c]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:$c++,id:r})}}const Wc=new Jx;function vs(i,t,e){i.resource.internal=!0;const r=new pt(i),n=()=>{delete t.promiseCache[e],Bi.has(e)&&Bi.remove(e)};return r.baseTexture.once("destroyed",()=>{e in t.promiseCache&&(console.warn("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),n())}),r.once("destroyed",()=>{i.destroyed||(console.warn("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),r}const Qx=[".jpeg",".jpg",".png",".webp",".avif"],t1=["image/jpeg","image/png","image/webp","image/avif"];async function e1(i){const t=await ft.ADAPTER.fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const e=await t.blob();return await createImageBitmap(e)}const ra={name:"loadTextures",extension:{type:ut.LoadParser,priority:xr.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return bn(i,t1)||gi(i,Qx)},async load(i,t,e){var h;const r=globalThis.createImageBitmap&&this.config.preferCreateImageBitmap;let n;r?this.config.preferWorkers&&await Wc.isImageBitmapSupported()?n=await Wc.loadImageBitmap(i):n=await e1(i):n=await new Promise((u,c)=>{const m=new Image;m.crossOrigin=this.config.crossOrigin,m.src=i,m.complete?u(m):(m.onload=()=>u(m),m.onerror=y=>c(y))});const s={...t.data};s.resolution??(s.resolution=Gr(i)),r&&((h=s.resourceOptions)==null?void 0:h.ownsImageBitmap)===void 0&&(s.resourceOptions={...s.resourceOptions},s.resourceOptions.ownsImageBitmap=!0);const a=new Rt(n,s);return a.resource.src=i,vs(a,e,i)},unload(i){i.destroy(!0)}};mt.add(ra);const r1=".svg",i1="image/svg+xml",n1={extension:{type:ut.LoadParser,priority:xr.High},name:"loadSVG",test(i){return bn(i,i1)||gi(i,r1)},async testParse(i){return Yh.test(i)},async parse(i,t,e){var s;const r=new Yh(i,(s=t==null?void 0:t.data)==null?void 0:s.resourceOptions);await r.load();const n=new Rt(r,{resolution:Gr(i),...t==null?void 0:t.data});return n.resource.src=t.src,vs(n,e,t.src)},async load(i,t){return(await ft.ADAPTER.fetch(i)).text()},unload:ra.unload};mt.add(n1);const s1=[".mp4",".m4v",".webm",".ogv"],o1=["video/mp4","video/webm","video/ogg"],a1={name:"loadVideo",extension:{type:ut.LoadParser,priority:xr.High},config:{defaultAutoPlay:!0,defaultUpdateFPS:0,defaultLoop:!1,defaultMuted:!1,defaultPlaysinline:!0},test(i){return bn(i,o1)||gi(i,s1)},async load(i,t,e){var a;let r;const n=await(await ft.ADAPTER.fetch(i)).blob(),s=URL.createObjectURL(n);try{const h={autoPlay:this.config.defaultAutoPlay,updateFPS:this.config.defaultUpdateFPS,loop:this.config.defaultLoop,muted:this.config.defaultMuted,playsinline:this.config.defaultPlaysinline,...(a=t==null?void 0:t.data)==null?void 0:a.resourceOptions,autoLoad:!0},u=new kf(s,h);await u.load();const c=new Rt(u,{alphaMode:await Ud(),resolution:Gr(i),...t==null?void 0:t.data});c.resource.src=i,r=vs(c,e,i),r.baseTexture.once("destroyed",()=>{URL.revokeObjectURL(s)})}catch(h){throw URL.revokeObjectURL(s),h}return r},unload(i){i.destroy(!0)}};mt.add(a1);class h1{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`).join("&")}}getAlias(t){const{alias:e,name:r,src:n,srcs:s}=t;return fr(e||r||n||s,a=>typeof a=="string"?a:Array.isArray(a)?a.map(h=>(h==null?void 0:h.src)??(h==null?void 0:h.srcs)??h):a!=null&&a.src||a!=null&&a.srcs?a.src??a.srcs:a,!0)}addManifest(t){this._manifest&&console.warn("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const r=[];Array.isArray(e)?e.forEach(n=>{const s=n.src??n.srcs,a=n.alias??n.name;let h;if(typeof a=="string"){const u=this._createBundleAssetId(t,a);r.push(u),h=[a,u]}else{const u=a.map(c=>this._createBundleAssetId(t,c));r.push(...u),h=[...a,...u]}this.add({...n,alias:h,src:s})}):Object.keys(e).forEach(n=>{const s=[n,this._createBundleAssetId(t,n)];if(typeof e[n]=="string")this.add({alias:s,src:e[n]});else if(Array.isArray(e[n]))this.add({alias:s,src:e[n]});else{const a=e[n],h=a.src??a.srcs;this.add({...a,alias:s,src:Array.isArray(h)?h:[h]})}r.push(...s)}),this._bundles[t]=r}add(t,e,r,n,s){const a=[];typeof t=="string"||Array.isArray(t)&&typeof t[0]=="string"?(Ct("7.2.0",`Assets.add now uses an object instead of individual parameters.
Please use Assets.add({ alias, src, data, format, loadParser }) instead.`),a.push({alias:t,src:e,data:r,format:n,loadParser:s})):Array.isArray(t)?a.push(...t):a.push(t);let h;h=u=>{this.hasKey(u)&&console.warn(`[Resolver] already has key: ${u} overwriting`)},fr(a).forEach(u=>{const{src:c,srcs:m}=u;let{data:y,format:v,loadParser:b}=u;const T=fr(c||m).map(M=>typeof M=="string"?Bx(M):Array.isArray(M)?M:[M]),E=this.getAlias(u);Array.isArray(E)?E.forEach(h):h(E);const P=[];T.forEach(M=>{M.forEach(D=>{let R={};if(typeof D!="object"){R.src=D;for(let N=0;N<this._parsers.length;N++){const Y=this._parsers[N];if(Y.test(D)){R=Y.parse(D);break}}}else y=D.data??y,v=D.format??v,b=D.loadParser??b,R={...R,...D};if(!E)throw new Error(`[Resolver] alias is undefined for this asset: ${R.src}`);R=this.buildResolvedAsset(R,{aliases:E,data:y,format:v,loadParser:b}),P.push(R)})}),E.forEach(M=>{this._assetMap[M]=P})})}resolveBundle(t){const e=Lo(t);t=fr(t);const r={};return t.forEach(n=>{const s=this._bundles[n];if(s){const a=this.resolve(s),h={};for(const u in a){const c=a[u];h[this._extractAssetIdFromBundle(n,u)]=c}r[n]=h}}),e?r[t[0]]:r}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const r={};for(const n in e)r[n]=e[n].src;return r}return e.src}resolve(t){const e=Lo(t);t=fr(t);const r={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let s=this._assetMap[n];const a=s[0],h=this._getPreferredOrder(s);h==null||h.priority.forEach(u=>{h.params[u].forEach(c=>{const m=s.filter(y=>y[u]?y[u]===c:!1);m.length&&(s=m)})}),this._resolverHash[n]=s[0]??a}else this._resolverHash[n]=this.buildResolvedAsset({alias:[n],src:n},{});r[n]=this._resolverHash[n]}),e?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const r=t[0],n=this._preferredOrder.find(s=>s.params.format.includes(r.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}buildResolvedAsset(t,e){const{aliases:r,data:n,loadParser:s,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=be.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=s??t.loadParser,t.format=a??t.format??be.extname(t.src).slice(1),t.srcs=t.src,t.name=t.alias,t}}class l1{constructor(){this._detections=[],this._initialized=!1,this.resolver=new h1,this.loader=new Ox,this.cache=Bi,this._backgroundLoader=new Fx(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var s,a;if(this._initialized){console.warn("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let h=t.manifest;typeof h=="string"&&(h=await this.load(h)),this.resolver.addManifest(h)}const e=((s=t.texturePreference)==null?void 0:s.resolution)??1,r=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(a=t.texturePreference)==null?void 0:a.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:r}}),t.preferences&&this.setPreferences(t.preferences)}add(t,e,r,n,s){this.resolver.add(t,e,r,n,s)}async load(t,e){this._initialized||await this.init();const r=Lo(t),n=fr(t).map(h=>{if(typeof h!="string"){const u=this.resolver.getAlias(h);return u.some(c=>!this.resolver.hasKey(c))&&this.add(h),Array.isArray(u)?u[0]:u}return this.resolver.hasKey(h)||this.add({alias:h,src:h}),h}),s=this.resolver.resolve(n),a=await this._mapLoadToResolve(s,e);return r?a[n[0]]:a}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let r=!1;typeof t=="string"&&(r=!0,t=[t]);const n=this.resolver.resolveBundle(t),s={},a=Object.keys(n);let h=0,u=0;const c=()=>{e==null||e(++h/u)},m=a.map(y=>{const v=n[y];return u+=Object.keys(v).length,this._mapLoadToResolve(v,c).then(b=>{s[y]=b})});return await Promise.all(m),r?s[t[0]]:s}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(r=>{this._backgroundLoader.add(Object.values(r))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Bi.get(t);const e={};for(let r=0;r<t.length;r++)e[r]=Bi.get(t[r]);return e}async _mapLoadToResolve(t,e){const r=Object.values(t),n=Object.keys(t);this._backgroundLoader.active=!1;const s=await this.loader.load(r,e);this._backgroundLoader.active=!0;const a={};return r.forEach((h,u)=>{const c=s[h.src],m=[h.src];h.alias&&m.push(...h.alias),a[n[u]]=c,Bi.set(m,c)}),a}async unload(t){this._initialized||await this.init();const e=fr(t).map(n=>typeof n!="string"?n.src:n),r=this.resolver.resolve(e);await this._unloadFromResolved(r)}async unloadBundle(t){this._initialized||await this.init(),t=fr(t);const e=this.resolver.resolveBundle(t),r=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(r)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(r=>{Bi.remove(r.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const r of t.detections)t.skipDetections||await r.test()?e=await r.add(e):t.skipDetections||(e=await r.remove(e));return e=e.filter((r,n)=>e.indexOf(r)===n),e}get detections(){return this._detections}get preferWorkers(){return ra.config.preferWorkers}set preferWorkers(t){Ct("7.2.0","Assets.prefersWorkers is deprecated, use Assets.setPreferences({ preferWorkers: true }) instead."),this.setPreferences({preferWorkers:t})}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(r=>r in t).forEach(r=>{e.config[r]=t[r]})})}}const ro=new l1;mt.handleByList(ut.LoadParser,ro.loader.parsers).handleByList(ut.ResolveParser,ro.resolver.parsers).handleByList(ut.CacheParser,ro.cache.parsers).handleByList(ut.DetectionParser,ro.detections);const u1={extension:ut.CacheParser,test:i=>Array.isArray(i)&&i.every(t=>t instanceof pt),getCacheableAssets:(i,t)=>{const e={};return i.forEach(r=>{t.forEach((n,s)=>{e[r+(s===0?"":s+1)]=n})}),e}};mt.add(u1);async function Qf(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const c1={extension:{type:ut.DetectionParser,priority:1},test:async()=>Qf("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")};mt.add(c1);const d1={extension:{type:ut.DetectionParser,priority:0},test:async()=>Qf("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};mt.add(d1);const Vc=["png","jpg","jpeg"],f1={extension:{type:ut.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...Vc],remove:async i=>i.filter(t=>!Vc.includes(t))};mt.add(f1);const p1="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Fl(i){return p1?!1:document.createElement("video").canPlayType(i)!==""}const m1={extension:{type:ut.DetectionParser,priority:0},test:async()=>Fl("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")};mt.add(m1);const g1={extension:{type:ut.DetectionParser,priority:0},test:async()=>Fl("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")};mt.add(g1);const y1={extension:{type:ut.DetectionParser,priority:0},test:async()=>Fl("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")};mt.add(y1);const v1={extension:ut.ResolveParser,test:ra.test,parse:i=>{var t;return{resolution:parseFloat(((t=ft.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:be.extname(i).slice(1),src:i}}};mt.add(v1);var Me=(i=>(i[i.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",i[i.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",i[i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",i[i.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",i[i.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",i[i.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",i[i.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",i[i.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",i[i.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",i[i.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",i[i.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",i[i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",i[i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",i[i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",i[i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",i[i.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",i[i.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",i[i.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35987]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",i[i.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",i[i.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",i[i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",i[i.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",i[i.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",i))(Me||{});const ko={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35987:1,34798:1,37808:1,36492:1,36493:1,36494:1,36495:1};let Ir,tn;function jc(){tn={bptc:Ir.getExtension("EXT_texture_compression_bptc"),astc:Ir.getExtension("WEBGL_compressed_texture_astc"),etc:Ir.getExtension("WEBGL_compressed_texture_etc"),s3tc:Ir.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:Ir.getExtension("WEBGL_compressed_texture_s3tc_srgb"),pvrtc:Ir.getExtension("WEBGL_compressed_texture_pvrtc")||Ir.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:Ir.getExtension("WEBGL_compressed_texture_etc1"),atc:Ir.getExtension("WEBGL_compressed_texture_atc")}}const _1={extension:{type:ut.DetectionParser,priority:2},test:async()=>{const i=ft.ADAPTER.createCanvas().getContext("webgl");return i?(Ir=i,!0):(console.warn("WebGL not available for compressed textures."),!1)},add:async i=>{tn||jc();const t=[];for(const e in tn)tn[e]&&t.push(e);return[...t,...i]},remove:async i=>(tn||jc(),i.filter(t=>!(t in tn)))};mt.add(_1);class x1 extends Ko{constructor(t,e={width:1,height:1,autoLoad:!0}){let r,n;typeof t=="string"?(r=t,n=new Uint8Array):(r=null,n=t),super(n,e),this.origin=r,this.buffer=n?new Oh(n):null,this._load=null,this.loaded=!1,this.origin!==null&&e.autoLoad!==!1&&this.load(),this.origin===null&&this.buffer&&(this._load=Promise.resolve(this),this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}load(){return this._load?this._load:(this._load=fetch(this.origin).then(t=>t.blob()).then(t=>t.arrayBuffer()).then(t=>(this.data=new Uint32Array(t),this.buffer=new Oh(t),this.loaded=!0,this.onBlobLoaded(t),this.update(),this)),this._load)}}class Li extends x1{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=Li._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||Li._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,r){const n=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;n.pixelStorei(n.UNPACK_ALIGNMENT,4);for(let s=0,a=this.levels;s<a;s++){const{levelID:h,levelWidth:u,levelHeight:c,levelBuffer:m}=this._levelBuffers[s];n.compressedTexImage2D(n.TEXTURE_2D,h,this.format,u,c,0,m)}return!0}onBlobLoaded(){this._levelBuffers=Li._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=35916&&t<=35919)return"s3tc_sRGB";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t===36196)return"etc1";if(t===35986||t===35987||t===34798)return"atc";if(t>=36492&&t<=36495)return"bptc";if(t===37808)return"astc";throw new Error(`Invalid (compressed) texture format given: ${t}`)}static _createLevelBuffers(t,e,r,n,s,a,h){const u=new Array(r);let c=t.byteOffset,m=a,y=h,v=m+n-1&~(n-1),b=y+s-1&~(s-1),T=v*b*ko[e];for(let E=0;E<r;E++)u[E]={levelID:E,levelWidth:r>1?m:v,levelHeight:r>1?y:b,levelBuffer:new Uint8Array(t.buffer,c,T)},c+=T,m=m>>1||1,y=y>>1||1,v=m+n-1&~(n-1),b=y+s-1&~(s-1),T=v*b*ko[e];return u}}const ah=4,io=124,b1=32,zc=20,T1=542327876,no={SIZE:1,FLAGS:2,HEIGHT:3,WIDTH:4,MIPMAP_COUNT:7,PIXEL_FORMAT:19},w1={SIZE:0,FLAGS:1,FOURCC:2,RGB_BITCOUNT:3,R_BIT_MASK:4,G_BIT_MASK:5,B_BIT_MASK:6,A_BIT_MASK:7},so={DXGI_FORMAT:0,RESOURCE_DIMENSION:1,MISC_FLAG:2,ARRAY_SIZE:3,MISC_FLAGS2:4},A1=1,E1=2,S1=4,C1=64,P1=512,R1=131072,M1=827611204,I1=861165636,F1=894720068,B1=808540228,D1=4,O1={[M1]:Me.COMPRESSED_RGBA_S3TC_DXT1_EXT,[I1]:Me.COMPRESSED_RGBA_S3TC_DXT3_EXT,[F1]:Me.COMPRESSED_RGBA_S3TC_DXT5_EXT},L1={70:Me.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:Me.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:Me.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:Me.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:Me.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:Me.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:Me.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:Me.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:Me.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,96:Me.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,95:Me.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,98:Me.COMPRESSED_RGBA_BPTC_UNORM_EXT,99:Me.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT};function k1(i){const t=new Uint32Array(i);if(t[0]!==T1)throw new Error("Invalid DDS file magic word");const e=new Uint32Array(i,0,io/Uint32Array.BYTES_PER_ELEMENT),r=e[no.HEIGHT],n=e[no.WIDTH],s=e[no.MIPMAP_COUNT],a=new Uint32Array(i,no.PIXEL_FORMAT*Uint32Array.BYTES_PER_ELEMENT,b1/Uint32Array.BYTES_PER_ELEMENT),h=a[A1];if(h&S1){const u=a[w1.FOURCC];if(u!==B1){const D=O1[u],R=ah+io,N=new Uint8Array(i,R);return[new Li(N,{format:D,width:n,height:r,levels:s})]}const c=ah+io,m=new Uint32Array(t.buffer,c,zc/Uint32Array.BYTES_PER_ELEMENT),y=m[so.DXGI_FORMAT],v=m[so.RESOURCE_DIMENSION],b=m[so.MISC_FLAG],T=m[so.ARRAY_SIZE],E=L1[y];if(E===void 0)throw new Error(`DDSParser cannot parse texture data with DXGI format ${y}`);if(b===D1)throw new Error("DDSParser does not support cubemap textures");if(v===6)throw new Error("DDSParser does not supported 3D texture data");const P=new Array,M=ah+io+zc;if(T===1)P.push(new Uint8Array(i,M));else{const D=ko[E];let R=0,N=n,Y=r;for(let K=0;K<s;K++){const q=Math.max(1,N+3&-4),j=Math.max(1,Y+3&-4),st=q*j*D;R+=st,N=N>>>1,Y=Y>>>1}let X=M;for(let K=0;K<T;K++)P.push(new Uint8Array(i,X,R)),X+=R}return P.map(D=>new Li(D,{format:E,width:n,height:r,levels:s}))}throw h&C1?new Error("DDSParser does not support uncompressed texture data."):h&P1?new Error("DDSParser does not supported YUV uncompressed texture data."):h&R1?new Error("DDSParser does not support single-channel (lumninance) texture data!"):h&E1?new Error("DDSParser does not support single-channel (alpha) texture data!"):new Error("DDSParser failed to load a texture file due to an unknown reason!")}const Xc=[171,75,84,88,32,49,49,187,13,10,26,10],N1=67305985,ur={FILE_IDENTIFIER:0,ENDIANNESS:12,GL_TYPE:16,GL_TYPE_SIZE:20,GL_FORMAT:24,GL_INTERNAL_FORMAT:28,GL_BASE_INTERNAL_FORMAT:32,PIXEL_WIDTH:36,PIXEL_HEIGHT:40,PIXEL_DEPTH:44,NUMBER_OF_ARRAY_ELEMENTS:48,NUMBER_OF_FACES:52,NUMBER_OF_MIPMAP_LEVELS:56,BYTES_OF_KEY_VALUE_DATA:60},hl=64,Yc={[Et.UNSIGNED_BYTE]:1,[Et.UNSIGNED_SHORT]:2,[Et.INT]:4,[Et.UNSIGNED_INT]:4,[Et.FLOAT]:4,[Et.HALF_FLOAT]:8},U1={[at.RGBA]:4,[at.RGB]:3,[at.RG]:2,[at.RED]:1,[at.LUMINANCE]:1,[at.LUMINANCE_ALPHA]:2,[at.ALPHA]:1},G1={[Et.UNSIGNED_SHORT_4_4_4_4]:2,[Et.UNSIGNED_SHORT_5_5_5_1]:2,[Et.UNSIGNED_SHORT_5_6_5]:2};function H1(i,t,e=!1){const r=new DataView(t);if(!$1(i,r))return null;const n=r.getUint32(ur.ENDIANNESS,!0)===N1,s=r.getUint32(ur.GL_TYPE,n),a=r.getUint32(ur.GL_FORMAT,n),h=r.getUint32(ur.GL_INTERNAL_FORMAT,n),u=r.getUint32(ur.PIXEL_WIDTH,n),c=r.getUint32(ur.PIXEL_HEIGHT,n)||1,m=r.getUint32(ur.PIXEL_DEPTH,n)||1,y=r.getUint32(ur.NUMBER_OF_ARRAY_ELEMENTS,n)||1,v=r.getUint32(ur.NUMBER_OF_FACES,n),b=r.getUint32(ur.NUMBER_OF_MIPMAP_LEVELS,n),T=r.getUint32(ur.BYTES_OF_KEY_VALUE_DATA,n);if(c===0||m!==1)throw new Error("Only 2D textures are supported");if(v!==1)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(y!==1)throw new Error("WebGL does not support array textures");const E=4,P=4,M=u+3&-4,D=c+3&-4,R=new Array(y);let N=u*c;s===0&&(N=M*D);let Y;if(s!==0?Yc[s]?Y=Yc[s]*U1[a]:Y=G1[s]:Y=ko[h],Y===void 0)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const X=e?V1(r,T,n):null;let K=N*Y,q=u,j=c,st=M,yt=D,$=hl+T;for(let H=0;H<b;H++){const z=r.getUint32($,n);let vt=$+4;for(let Pt=0;Pt<y;Pt++){let dt=R[Pt];dt||(dt=R[Pt]=new Array(b)),dt[H]={levelID:H,levelWidth:b>1||s!==0?q:st,levelHeight:b>1||s!==0?j:yt,levelBuffer:new Uint8Array(t,vt,K)},vt+=K}$+=z+4,$=$%4!==0?$+4-$%4:$,q=q>>1||1,j=j>>1||1,st=q+E-1&~(E-1),yt=j+P-1&~(P-1),K=st*yt*Y}return s!==0?{uncompressed:R.map(H=>{let z=H[0].levelBuffer,vt=!1;return s===Et.FLOAT?z=new Float32Array(H[0].levelBuffer.buffer,H[0].levelBuffer.byteOffset,H[0].levelBuffer.byteLength/4):s===Et.UNSIGNED_INT?(vt=!0,z=new Uint32Array(H[0].levelBuffer.buffer,H[0].levelBuffer.byteOffset,H[0].levelBuffer.byteLength/4)):s===Et.INT&&(vt=!0,z=new Int32Array(H[0].levelBuffer.buffer,H[0].levelBuffer.byteOffset,H[0].levelBuffer.byteLength/4)),{resource:new Ko(z,{width:H[0].levelWidth,height:H[0].levelHeight}),type:s,format:vt?W1(a):a}}),kvData:X}:{compressed:R.map(H=>new Li(null,{format:h,width:u,height:c,levels:b,levelBuffers:H})),kvData:X}}function $1(i,t){for(let e=0;e<Xc.length;e++)if(t.getUint8(e)!==Xc[e])return console.error(`${i} is not a valid *.ktx file!`),!1;return!0}function W1(i){switch(i){case at.RGBA:return at.RGBA_INTEGER;case at.RGB:return at.RGB_INTEGER;case at.RG:return at.RG_INTEGER;case at.RED:return at.RED_INTEGER;default:return i}}function V1(i,t,e){const r=new Map;let n=0;for(;n<t;){const s=i.getUint32(hl+n,e),a=hl+n+4,h=3-(s+3)%4;if(s===0||s>t-n){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let u=0;for(;u<s&&i.getUint8(a+u)!==0;u++);if(u===-1){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const c=new TextDecoder().decode(new Uint8Array(i.buffer,a,u)),m=new DataView(i.buffer,a+u+1,s-u-1);r.set(c,m),n+=4+s+h}return r}const j1={extension:{type:ut.LoadParser,priority:xr.High},name:"loadDDS",test(i){return gi(i,".dds")},async load(i,t,e){const r=await(await ft.ADAPTER.fetch(i)).arrayBuffer(),n=k1(r).map(s=>{const a=new Rt(s,{mipmap:Ur.OFF,alphaMode:He.NO_PREMULTIPLIED_ALPHA,resolution:Gr(i),...t.data});return vs(a,e,i)});return n.length===1?n[0]:n},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};mt.add(j1);const z1={extension:{type:ut.LoadParser,priority:xr.High},name:"loadKTX",test(i){return gi(i,".ktx")},async load(i,t,e){const r=await(await ft.ADAPTER.fetch(i)).arrayBuffer(),{compressed:n,uncompressed:s,kvData:a}=H1(i,r),h=n??s,u={mipmap:Ur.OFF,alphaMode:He.NO_PREMULTIPLIED_ALPHA,resolution:Gr(i),...t.data},c=h.map(m=>{h===s&&Object.assign(u,{type:m.type,format:m.format});const y=m.resource??m,v=new Rt(y,u);return v.ktxKeyValueData=a,vs(v,e,i)});return c.length===1?c[0]:c},unload(i){Array.isArray(i)?i.forEach(t=>t.destroy(!0)):i.destroy(!0)}};mt.add(z1);const X1=["s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"],Y1={extension:ut.ResolveParser,test:i=>{const t=be.extname(i).slice(1);return["basis","ktx","dds"].includes(t)},parse:i=>{var r,n;const t=i.split("."),e=t.pop();if(["ktx","dds"].includes(e)){const s=t.pop();if(X1.includes(s))return{resolution:parseFloat(((r=ft.RETINA_PREFIX.exec(i))==null?void 0:r[1])??"1"),format:s,src:i}}return{resolution:parseFloat(((n=ft.RETINA_PREFIX.exec(i))==null?void 0:n[1])??"1"),format:e,src:i}}};mt.add(Y1);const oo=new It,q1=4,tp=class Kn{constructor(t){this.renderer=t,this._rendererPremultipliedAlpha=!1}contextChange(){var e;const t=(e=this.renderer)==null?void 0:e.gl.getContextAttributes();this._rendererPremultipliedAlpha=!!(t&&t.alpha&&t.premultipliedAlpha)}async image(t,e,r,n){const s=new Image;return s.src=await this.base64(t,e,r,n),s}async base64(t,e,r,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((a,h)=>{s.toBlob(u=>{if(!u){h(new Error("ICanvas.toBlob failed!"));return}const c=new FileReader;c.onload=()=>a(c.result),c.onerror=h,c.readAsDataURL(u)},e,r)});if(s.toDataURL!==void 0)return s.toDataURL(e,r);if(s.convertToBlob!==void 0){const a=await s.convertToBlob({type:e,quality:r});return new Promise((h,u)=>{const c=new FileReader;c.onload=()=>h(c.result),c.onerror=u,c.readAsDataURL(a)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:r,width:n,height:s,flipY:a,premultipliedAlpha:h}=this._rawPixels(t,e);a&&Kn._flipY(r,n,s),h&&Kn._unpremultiplyAlpha(r);const u=new fs(n,s,1),c=new ImageData(new Uint8ClampedArray(r.buffer),n,s);return u.context.putImageData(c,0,0),u.canvas}pixels(t,e){const{pixels:r,width:n,height:s,flipY:a,premultipliedAlpha:h}=this._rawPixels(t,e);return a&&Kn._flipY(r,n,s),h&&Kn._unpremultiplyAlpha(r),r}_rawPixels(t,e){const r=this.renderer;if(!r)throw new Error("The Extract has already been destroyed");let n,s=!1,a=!1,h,u=!1;t&&(t instanceof _r?h=t:(h=r.generateTexture(t,{region:e,resolution:r.resolution,multisample:r.multisample}),u=!0,e&&(oo.width=e.width,oo.height=e.height,e=oo)));const c=r.gl;if(h){if(n=h.baseTexture.resolution,e=e??h.frame,s=!1,a=h.baseTexture.alphaMode>0&&h.baseTexture.format===at.RGBA,!u){r.renderTexture.bind(h);const b=h.framebuffer.glFramebuffers[r.CONTEXT_UID];b.blitFramebuffer&&r.framebuffer.bind(b.blitFramebuffer)}}else n=r.resolution,e||(e=oo,e.width=r.width/n,e.height=r.height/n),s=!0,a=this._rendererPremultipliedAlpha,r.renderTexture.bind();const m=Math.max(Math.round(e.width*n),1),y=Math.max(Math.round(e.height*n),1),v=new Uint8Array(q1*m*y);return c.readPixels(Math.round(e.x*n),Math.round(e.y*n),m,y,c.RGBA,c.UNSIGNED_BYTE,v),u&&(h==null||h.destroy(!0)),{pixels:v,width:m,height:y,flipY:s,premultipliedAlpha:a}}destroy(){this.renderer=null}static _flipY(t,e,r){const n=e<<2,s=r>>1,a=new Uint8Array(n);for(let h=0;h<s;h++){const u=h*n,c=(r-h-1)*n;a.set(t.subarray(u,u+n)),t.copyWithin(u,c,c+n),t.set(a,c)}}static _unpremultiplyAlpha(t){t instanceof Uint8ClampedArray&&(t=new Uint8Array(t.buffer));const e=t.length;for(let r=0;r<e;r+=4){const n=t[r+3];if(n!==0){const s=255.001/n;t[r]=t[r]*s+.5,t[r+1]=t[r+1]*s+.5,t[r+2]=t[r+2]*s+.5}}}};tp.extension={name:"extract",type:ut.RendererSystem};let K1=tp;mt.add(K1);const No={build(i){const t=i.points;let e,r,n,s,a,h;if(i.type===ne.CIRC){const T=i.shape;e=T.x,r=T.y,a=h=T.radius,n=s=0}else if(i.type===ne.ELIP){const T=i.shape;e=T.x,r=T.y,a=T.width,h=T.height,n=s=0}else{const T=i.shape,E=T.width/2,P=T.height/2;e=T.x+E,r=T.y+P,a=h=Math.max(0,Math.min(T.radius,Math.min(E,P))),n=E-a,s=P-h}if(!(a>=0&&h>=0&&n>=0&&s>=0)){t.length=0;return}const u=Math.ceil(2.3*Math.sqrt(a+h)),c=u*8+(n?4:0)+(s?4:0);if(t.length=c,c===0)return;if(u===0){t.length=8,t[0]=t[6]=e+n,t[1]=t[3]=r+s,t[2]=t[4]=e-n,t[5]=t[7]=r-s;return}let m=0,y=u*4+(n?2:0)+2,v=y,b=c;{const T=n+a,E=s,P=e+T,M=e-T,D=r+E;if(t[m++]=P,t[m++]=D,t[--y]=D,t[--y]=M,s){const R=r-E;t[v++]=M,t[v++]=R,t[--b]=R,t[--b]=P}}for(let T=1;T<u;T++){const E=Math.PI/2*(T/u),P=n+Math.cos(E)*a,M=s+Math.sin(E)*h,D=e+P,R=e-P,N=r+M,Y=r-M;t[m++]=D,t[m++]=N,t[--y]=N,t[--y]=R,t[v++]=R,t[v++]=Y,t[--b]=Y,t[--b]=D}{const T=n,E=s+h,P=e+T,M=e-T,D=r+E,R=r-E;t[m++]=P,t[m++]=D,t[--b]=R,t[--b]=P,n&&(t[m++]=M,t[m++]=D,t[--b]=R,t[--b]=M)}},triangulate(i,t){const e=i.points,r=t.points,n=t.indices;if(e.length===0)return;let s=r.length/2;const a=s;let h,u;if(i.type!==ne.RREC){const m=i.shape;h=m.x,u=m.y}else{const m=i.shape;h=m.x+m.width/2,u=m.y+m.height/2}const c=i.matrix;r.push(i.matrix?c.a*h+c.c*u+c.tx:h,i.matrix?c.b*h+c.d*u+c.ty:u),s++,r.push(e[0],e[1]);for(let m=2;m<e.length;m+=2)r.push(e[m],e[m+1]),n.push(s++,a,s);n.push(a+1,a,s)}};function qc(i,t=!1){const e=i.length;if(e<6)return;let r=0;for(let n=0,s=i[e-2],a=i[e-1];n<e;n+=2){const h=i[n],u=i[n+1];r+=(h-s)*(u+a),s=h,a=u}if(!t&&r>0||t&&r<=0){const n=e/2;for(let s=n+n%2;s<e;s+=2){const a=e-s-2,h=e-s-1,u=s,c=s+1;[i[a],i[u]]=[i[u],i[a]],[i[h],i[c]]=[i[c],i[h]]}}}const ep={build(i){i.points=i.shape.points.slice()},triangulate(i,t){let e=i.points;const r=i.holes,n=t.points,s=t.indices;if(e.length>=6){qc(e,!1);const a=[];for(let c=0;c<r.length;c++){const m=r[c];qc(m.points,!0),a.push(e.length/2),e=e.concat(m.points)}const h=md(e,a,2);if(!h)return;const u=n.length/2;for(let c=0;c<h.length;c+=3)s.push(h[c]+u),s.push(h[c+1]+u),s.push(h[c+2]+u);for(let c=0;c<e.length;c++)n.push(e[c])}}},Z1={build(i){const t=i.shape,e=t.x,r=t.y,n=t.width,s=t.height,a=i.points;a.length=0,n>=0&&s>=0&&a.push(e,r,e+n,r,e+n,r+s,e,r+s)},triangulate(i,t){const e=i.points,r=t.points;if(e.length===0)return;const n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}},J1={build(i){No.build(i)},triangulate(i,t){No.triangulate(i,t)}};var Ye=(i=>(i.MITER="miter",i.BEVEL="bevel",i.ROUND="round",i))(Ye||{}),ui=(i=>(i.BUTT="butt",i.ROUND="round",i.SQUARE="square",i))(ui||{});const yn={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(i,t=20){if(!this.adaptive||!i||isNaN(i))return t;let e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}};class Kc{static curveTo(t,e,r,n,s,a){const h=a[a.length-2],u=a[a.length-1]-e,c=h-t,m=n-e,y=r-t,v=Math.abs(u*y-c*m);if(v<1e-8||s===0)return(a[a.length-2]!==t||a[a.length-1]!==e)&&a.push(t,e),null;const b=u*u+c*c,T=m*m+y*y,E=u*m+c*y,P=s*Math.sqrt(b)/v,M=s*Math.sqrt(T)/v,D=P*E/b,R=M*E/T,N=P*y+M*c,Y=P*m+M*u,X=c*(M+D),K=u*(M+D),q=y*(P+R),j=m*(P+R),st=Math.atan2(K-Y,X-N),yt=Math.atan2(j-Y,q-N);return{cx:N+t,cy:Y+e,radius:s,startAngle:st,endAngle:yt,anticlockwise:c*m>y*u}}static arc(t,e,r,n,s,a,h,u,c){const m=h-a,y=yn._segmentsCount(Math.abs(m)*s,Math.ceil(Math.abs(m)/Ro)*40),v=m/(y*2),b=v*2,T=Math.cos(v),E=Math.sin(v),P=y-1,M=P%1/P;for(let D=0;D<=P;++D){const R=D+M*D,N=v+a+b*R,Y=Math.cos(N),X=-Math.sin(N);c.push((T*Y+E*X)*s+r,(T*-X+E*Y)*s+n)}}}class Q1{constructor(){this.reset()}begin(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class Bl{static curveLength(t,e,r,n,s,a,h,u){let c=0,m=0,y=0,v=0,b=0,T=0,E=0,P=0,M=0,D=0,R=0,N=t,Y=e;for(let X=1;X<=10;++X)m=X/10,y=m*m,v=y*m,b=1-m,T=b*b,E=T*b,P=E*t+3*T*m*r+3*b*y*s+v*h,M=E*e+3*T*m*n+3*b*y*a+v*u,D=N-P,R=Y-M,N=P,Y=M,c+=Math.sqrt(D*D+R*R);return c}static curveTo(t,e,r,n,s,a,h){const u=h[h.length-2],c=h[h.length-1];h.length-=2;const m=yn._segmentsCount(Bl.curveLength(u,c,t,e,r,n,s,a));let y=0,v=0,b=0,T=0,E=0;h.push(u,c);for(let P=1,M=0;P<=m;++P)M=P/m,y=1-M,v=y*y,b=v*y,T=M*M,E=T*M,h.push(b*u+3*v*M*t+3*y*T*r+E*s,b*c+3*v*M*e+3*y*T*n+E*a)}}function Zc(i,t,e,r,n,s,a,h){const u=i-e*n,c=t-r*n,m=i+e*s,y=t+r*s;let v,b;a?(v=r,b=-e):(v=-r,b=e);const T=u+v,E=c+b,P=m+v,M=y+b;return h.push(T,E,P,M),2}function Ei(i,t,e,r,n,s,a,h){const u=e-i,c=r-t;let m=Math.atan2(u,c),y=Math.atan2(n-i,s-t);h&&m<y?m+=Math.PI*2:!h&&m>y&&(y+=Math.PI*2);let v=m;const b=y-m,T=Math.abs(b),E=Math.sqrt(u*u+c*c),P=(15*T*Math.sqrt(E)/Math.PI>>0)+1,M=b/P;if(v+=M,h){a.push(i,t,e,r);for(let D=1,R=v;D<P;D++,R+=M)a.push(i,t,i+Math.sin(R)*E,t+Math.cos(R)*E);a.push(i,t,n,s)}else{a.push(e,r,i,t);for(let D=1,R=v;D<P;D++,R+=M)a.push(i+Math.sin(R)*E,t+Math.cos(R)*E,i,t);a.push(n,s,i,t)}return P*2}function tb(i,t){const e=i.shape;let r=i.points||e.points.slice();const n=t.closePointEps;if(r.length===0)return;const s=i.lineStyle,a=new Ut(r[0],r[1]),h=new Ut(r[r.length-2],r[r.length-1]),u=e.type!==ne.POLY||e.closeStroke,c=Math.abs(a.x-h.x)<n&&Math.abs(a.y-h.y)<n;if(u){r=r.slice(),c&&(r.pop(),r.pop(),h.set(r[r.length-2],r[r.length-1]));const dt=(a.x+h.x)*.5,St=(h.y+a.y)*.5;r.unshift(dt,St),r.push(dt,St)}const m=t.points,y=r.length/2;let v=r.length;const b=m.length/2,T=s.width/2,E=T*T,P=s.miterLimit*s.miterLimit;let M=r[0],D=r[1],R=r[2],N=r[3],Y=0,X=0,K=-(D-N),q=M-R,j=0,st=0,yt=Math.sqrt(K*K+q*q);K/=yt,q/=yt,K*=T,q*=T;const $=s.alignment,H=(1-$)*2,z=$*2;u||(s.cap===ui.ROUND?v+=Ei(M-K*(H-z)*.5,D-q*(H-z)*.5,M-K*H,D-q*H,M+K*z,D+q*z,m,!0)+2:s.cap===ui.SQUARE&&(v+=Zc(M,D,K,q,H,z,!0,m))),m.push(M-K*H,D-q*H,M+K*z,D+q*z);for(let dt=1;dt<y-1;++dt){M=r[(dt-1)*2],D=r[(dt-1)*2+1],R=r[dt*2],N=r[dt*2+1],Y=r[(dt+1)*2],X=r[(dt+1)*2+1],K=-(D-N),q=M-R,yt=Math.sqrt(K*K+q*q),K/=yt,q/=yt,K*=T,q*=T,j=-(N-X),st=R-Y,yt=Math.sqrt(j*j+st*st),j/=yt,st/=yt,j*=T,st*=T;const St=R-M,Kt=D-N,lt=R-Y,ct=X-N,Mt=St*lt+Kt*ct,Dt=Kt*lt-ct*St,Gt=Dt<0;if(Math.abs(Dt)<.001*Math.abs(Mt)){m.push(R-K*H,N-q*H,R+K*z,N+q*z),Mt>=0&&(s.join===Ye.ROUND?v+=Ei(R,N,R-K*H,N-q*H,R-j*H,N-st*H,m,!1)+4:v+=2,m.push(R-j*z,N-st*z,R+j*H,N+st*H));continue}const zt=(-K+M)*(-q+N)-(-K+R)*(-q+D),Nt=(-j+Y)*(-st+N)-(-j+R)*(-st+X),Zt=(St*Nt-lt*zt)/Dt,te=(ct*zt-Kt*Nt)/Dt,de=(Zt-R)*(Zt-R)+(te-N)*(te-N),Qt=R+(Zt-R)*H,se=N+(te-N)*H,ue=R-(Zt-R)*z,he=N-(te-N)*z,$e=Math.min(St*St+Kt*Kt,lt*lt+ct*ct),Te=Gt?H:z,br=$e+Te*Te*E,Tn=de<=br;let Tr=s.join;if(Tr===Ye.MITER&&de/E>P&&(Tr=Ye.BEVEL),Tn)switch(Tr){case Ye.MITER:{m.push(Qt,se,ue,he);break}case Ye.BEVEL:{Gt?m.push(Qt,se,R+K*z,N+q*z,Qt,se,R+j*z,N+st*z):m.push(R-K*H,N-q*H,ue,he,R-j*H,N-st*H,ue,he),v+=2;break}case Ye.ROUND:{Gt?(m.push(Qt,se,R+K*z,N+q*z),v+=Ei(R,N,R+K*z,N+q*z,R+j*z,N+st*z,m,!0)+4,m.push(Qt,se,R+j*z,N+st*z)):(m.push(R-K*H,N-q*H,ue,he),v+=Ei(R,N,R-K*H,N-q*H,R-j*H,N-st*H,m,!1)+4,m.push(R-j*H,N-st*H,ue,he));break}}else{switch(m.push(R-K*H,N-q*H,R+K*z,N+q*z),Tr){case Ye.MITER:{Gt?m.push(ue,he,ue,he):m.push(Qt,se,Qt,se),v+=2;break}case Ye.ROUND:{Gt?v+=Ei(R,N,R+K*z,N+q*z,R+j*z,N+st*z,m,!0)+2:v+=Ei(R,N,R-K*H,N-q*H,R-j*H,N-st*H,m,!1)+2;break}}m.push(R-j*H,N-st*H,R+j*z,N+st*z),v+=2}}M=r[(y-2)*2],D=r[(y-2)*2+1],R=r[(y-1)*2],N=r[(y-1)*2+1],K=-(D-N),q=M-R,yt=Math.sqrt(K*K+q*q),K/=yt,q/=yt,K*=T,q*=T,m.push(R-K*H,N-q*H,R+K*z,N+q*z),u||(s.cap===ui.ROUND?v+=Ei(R-K*(H-z)*.5,N-q*(H-z)*.5,R-K*H,N-q*H,R+K*z,N+q*z,m,!1)+2:s.cap===ui.SQUARE&&(v+=Zc(R,N,K,q,H,z,!1,m)));const vt=t.indices,Pt=yn.epsilon*yn.epsilon;for(let dt=b;dt<v+b-2;++dt)M=m[dt*2],D=m[dt*2+1],R=m[(dt+1)*2],N=m[(dt+1)*2+1],Y=m[(dt+2)*2],X=m[(dt+2)*2+1],!(Math.abs(M*(N-X)+R*(X-D)+Y*(D-N))<Pt)&&vt.push(dt,dt+1,dt+2)}function eb(i,t){let e=0;const r=i.shape,n=i.points||r.points,s=r.type!==ne.POLY||r.closeStroke;if(n.length===0)return;const a=t.points,h=t.indices,u=n.length/2,c=a.length/2;let m=c;for(a.push(n[0],n[1]),e=1;e<u;e++)a.push(n[e*2],n[e*2+1]),h.push(m,m+1),m++;s&&h.push(m,c)}function Jc(i,t){i.lineStyle.native?eb(i,t):tb(i,t)}class Dl{static curveLength(t,e,r,n,s,a){const h=t-2*r+s,u=e-2*n+a,c=2*r-2*t,m=2*n-2*e,y=4*(h*h+u*u),v=4*(h*c+u*m),b=c*c+m*m,T=2*Math.sqrt(y+v+b),E=Math.sqrt(y),P=2*y*E,M=2*Math.sqrt(b),D=v/E;return(P*T+E*v*(T-M)+(4*b*y-v*v)*Math.log((2*E+D+T)/(D+M)))/(4*P)}static curveTo(t,e,r,n,s){const a=s[s.length-2],h=s[s.length-1],u=yn._segmentsCount(Dl.curveLength(a,h,t,e,r,n));let c=0,m=0;for(let y=1;y<=u;++y){const v=y/u;c=a+(t-a)*v,m=h+(e-h)*v,s.push(c+(t+(r-t)*v-c)*v,m+(e+(n-e)*v-m)*v)}}}const hh={[ne.POLY]:ep,[ne.CIRC]:No,[ne.ELIP]:No,[ne.RECT]:Z1,[ne.RREC]:J1},Qc=[],ao=[];class Uo{constructor(t,e=null,r=null,n=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type}clone(){return new Uo(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const qi=new Ut,rp=class ip extends Qd{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Do,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),ao.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Qc.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,r=null,n=null){const s=new Uo(t,e,r,n);return this.graphicsData.push(s),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const r=new Uo(t,null,null,e),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let r=0;r<e.length;++r){const n=e[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(t,qi):qi.copyFrom(t),n.shape.contains(qi.x,qi.y))){let s=!1;if(n.holes){for(let a=0;a<n.holes.length;a++)if(n.holes[a].shape.contains(qi.x,qi.y)){s=!0;break}}if(!s)return!0}}return!1}updateBatches(){if(!this.graphicsData.length){this.batchable=!0;return}if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let r=null,n=null;this.batches.length>0&&(r=this.batches[this.batches.length-1],n=r.style);for(let u=this.shapeIndex;u<e.length;u++){this.shapeIndex++;const c=e[u],m=c.fillStyle,y=c.lineStyle;hh[c.type].build(c),c.matrix&&this.transformPoints(c.points,c.matrix),(m.visible||y.visible)&&this.processHoles(c.holes);for(let v=0;v<2;v++){const b=v===0?m:y;if(!b.visible)continue;const T=b.texture.baseTexture,E=this.indices.length,P=this.points.length/2;T.wrapMode=Jr.REPEAT,v===0?this.processFill(c):this.processLine(c);const M=this.points.length/2-P;M!==0&&(r&&!this._compareStyles(n,b)&&(r.end(E,P),r=null),r||(r=Qc.pop()||new Q1,r.begin(b,E,P),this.batches.push(r),n=b),this.addUvs(this.points,t,b.texture,P,M,b.matrix))}}const s=this.indices.length,a=this.points.length/2;if(r&&r.end(s,a),this.batches.length===0){this.batchable=!0;return}const h=a>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&h===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=h?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e||t.texture.baseTexture!==e.texture.baseTexture||t.color+t.alpha!==e.color+e.alpha||!!t.native!=!!e.native)}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const r=this.graphicsData[t],n=r.fillStyle,s=r.lineStyle;if(n&&!n.texture.baseTexture.valid||s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,r=t.length;e<r;e++){const n=t[e];for(let s=0;s<n.size;s++){const a=n.start+s;this.indicesUint16[a]=this.indicesUint16[a]-n.attribStart}}}isBatchable(){if(this.points.length>65535*2)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<ip.BATCHABLE_SIZE*2}buildDrawCalls(){let t=++Rt._globalBatch;for(let y=0;y<this.drawCalls.length;y++)this.drawCalls[y].texArray.clear(),ao.push(this.drawCalls[y]);this.drawCalls.length=0;const e=this.colors,r=this.textureIds;let n=ao.pop();n||(n=new Nh,n.texArray=new $h),n.texArray.count=0,n.start=0,n.size=0,n.type=pr.TRIANGLES;let s=0,a=null,h=0,u=!1,c=pr.TRIANGLES,m=0;this.drawCalls.push(n);for(let y=0;y<this.batches.length;y++){const v=this.batches[y],b=8,T=v.style,E=T.texture.baseTexture;u!==!!T.native&&(u=!!T.native,c=u?pr.LINES:pr.TRIANGLES,a=null,s=b,t++),a!==E&&(a=E,E._batchEnabled!==t&&(s===b&&(t++,s=0,n.size>0&&(n=ao.pop(),n||(n=new Nh,n.texArray=new $h),this.drawCalls.push(n)),n.start=m,n.size=0,n.texArray.count=0,n.type=c),E.touched=1,E._batchEnabled=t,E._batchLocation=s,E.wrapMode=Jr.REPEAT,n.texArray.elements[n.texArray.count++]=E,s++)),n.size+=v.size,m+=v.size,h=E._batchLocation,this.addColors(e,T.color,T.alpha,v.attribSize,v.attribStart),this.addTextureIds(r,h,v.attribSize,v.attribStart)}Rt._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,r=this.colors,n=this.textureIds,s=new ArrayBuffer(t.length*3*4),a=new Float32Array(s),h=new Uint32Array(s);let u=0;for(let c=0;c<t.length/2;c++)a[u++]=t[c*2],a[u++]=t[c*2+1],a[u++]=e[c*2],a[u++]=e[c*2+1],h[u++]=r[c],a[u++]=n[c];this._buffer.update(s),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?ep.triangulate(t,this):hh[t.type].triangulate(t,this)}processLine(t){Jc(t,this);for(let e=0;e<t.holes.length;e++)Jc(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const r=t[e];hh[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let r=0;r<t.length/2;r++){const n=t[r*2],s=t[r*2+1];t[r*2]=e.a*n+e.c*s+e.tx,t[r*2+1]=e.b*n+e.d*s+e.ty}}addColors(t,e,r,n,s=0){const a=kt.shared.setValue(e).toLittleEndianNumber(),h=kt.shared.setValue(a).toPremultiplied(r);t.length=Math.max(t.length,s+n);for(let u=0;u<n;u++)t[s+u]=h}addTextureIds(t,e,r,n=0){t.length=Math.max(t.length,n+r);for(let s=0;s<r;s++)t[n+s]=e}addUvs(t,e,r,n,s,a=null){let h=0;const u=e.length,c=r.frame;for(;h<s;){let y=t[(n+h)*2],v=t[(n+h)*2+1];if(a){const b=a.a*y+a.c*v+a.tx;v=a.b*y+a.d*v+a.ty,y=b}h++,e.push(y/c.width,v/c.height)}const m=r.baseTexture;(c.width<m.width||c.height<m.height)&&this.adjustUvs(e,r,u,s)}adjustUvs(t,e,r,n){const s=e.baseTexture,a=1e-6,h=r+n*2,u=e.frame,c=u.width/s.width,m=u.height/s.height;let y=u.x/u.width,v=u.y/u.height,b=Math.floor(t[r]+a),T=Math.floor(t[r+1]+a);for(let E=r+2;E<h;E+=2)b=Math.min(b,Math.floor(t[E]+a)),T=Math.min(T,Math.floor(t[E+1]+a));y-=b,v-=T;for(let E=r;E<h;E+=2)t[E]=(t[E]+y)*c,t[E+1]=(t[E+1]+v)*m}};rp.BATCHABLE_SIZE=100;let rb=rp;class ia{constructor(){this.color=16777215,this.alpha=1,this.texture=pt.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new ia;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=pt.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class Ol extends ia{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=ui.BUTT,this.join=Ye.MITER,this.miterLimit=10}clone(){const t=new Ol;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1,this.cap=ui.BUTT,this.join=Ye.MITER,this.miterLimit=10}}const lh={},ll=class xo extends ge{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new ia,this._lineStyle=new Ol,this._matrix=null,this._holeMode=!1,this.state=Hr.for2d(),this._geometry=t||new rb,this._geometry.refCount++,this._transformID=-1,this._tintColor=new kt(16777215),this.blendMode=rt.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new xo(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tintColor.value}set tint(t){this._tintColor.setValue(t)}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,r,n=.5,s=!1){return typeof t=="number"&&(t={width:t,color:e,alpha:r,alignment:n,native:s}),this.lineTextureStyle(t)}lineTextureStyle(t){const e={width:0,texture:pt.WHITE,color:t!=null&&t.texture?16777215:0,matrix:null,alignment:.5,native:!1,cap:ui.BUTT,join:Ye.MITER,miterLimit:10};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.width>0&&t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:r},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new ci,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new ci,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const r=this.currentPath.points,n=r[r.length-2],s=r[r.length-1];return(n!==t||s!==e)&&r.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,r,n){this._initCurve();const s=this.currentPath.points;return s.length===0&&this.moveTo(0,0),Dl.curveTo(t,e,r,n,s),this}bezierCurveTo(t,e,r,n,s,a){return this._initCurve(),Bl.curveTo(t,e,r,n,s,a,this.currentPath.points),this}arcTo(t,e,r,n,s){this._initCurve(t,e);const a=this.currentPath.points,h=Kc.curveTo(t,e,r,n,s,a);if(h){const{cx:u,cy:c,radius:m,startAngle:y,endAngle:v,anticlockwise:b}=h;this.arc(u,c,m,y,v,b)}return this}arc(t,e,r,n,s,a=!1){if(n===s)return this;if(!a&&s<=n?s+=Ro:a&&n<=s&&(n+=Ro),s-n===0)return this;const h=t+Math.cos(n)*r,u=e+Math.sin(n)*r,c=this._geometry.closePointEps;let m=this.currentPath?this.currentPath.points:null;if(m){const y=Math.abs(m[m.length-2]-h),v=Math.abs(m[m.length-1]-u);y<c&&v<c||m.push(h,u)}else this.moveTo(h,u),m=this.currentPath.points;return Kc.arc(h,u,t,e,r,n,s,a,m),this}beginFill(t=0,e){return this.beginTextureFill({texture:pt.WHITE,color:t,alpha:e})}normalizeColor(t){const e=kt.shared.setValue(t.color??0);t.color=e.toNumber(),t.alpha??(t.alpha=e.alpha)}beginTextureFill(t){const e={texture:pt.WHITE,color:16777215,matrix:null};t=Object.assign(e,t),this.normalizeColor(t),this.currentPath&&this.startPoly();const r=t.alpha>0;return r?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:r},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,r,n){return this.drawShape(new It(t,e,r,n))}drawRoundedRect(t,e,r,n,s){return this.drawShape(new gs(t,e,r,n,s))}drawCircle(t,e,r){return this.drawShape(new ps(t,e,r))}drawEllipse(t,e,r,n){return this.drawShape(new ms(t,e,r,n))}drawPolygon(...t){let e,r=!0;const n=t[0];n.points?(r=n.closeStroke,e=n.points):Array.isArray(t[0])?e=t[0]:e=t;const s=new ci(e);return s.closeStroke=r,this.drawShape(s),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===ne.RECT&&!t[0].matrix&&!t[0].holes.length&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,r=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=r,this.vertexData=new Float32Array(t.points);for(let n=0;n<r;n++){const s=t.batches[n],a=s.style.color,h=new Float32Array(this.vertexData.buffer,s.attribStart*4*2,s.attribSize*2),u=new Float32Array(t.uvsFloat32.buffer,s.attribStart*4*2,s.attribSize*2),c=new Uint16Array(t.indicesUint16.buffer,s.start*2,s.size),m={vertexData:h,blendMode:e,indices:c,uvs:u,_batchRGB:kt.shared.setValue(a).toRgbArray(),_tintRGB:a,_texture:s.style.texture,alpha:s.style.alpha,worldAlpha:1};this.batches[n]=m}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,r=this.batches.length;e<r;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),r=this._geometry,n=this.worldAlpha,s=e.uniforms,a=r.drawCalls;s.translationMatrix=this.transform.worldTransform,kt.shared.setValue(this._tintColor).premultiply(n).toArray(s.tint),t.shader.bind(e),t.geometry.bind(r,e),t.state.set(this.state);for(let h=0,u=a.length;h<u;h++)this._renderDrawCallDirect(t,r.drawCalls[h])}_renderDrawCallDirect(t,e){const{texArray:r,type:n,size:s,start:a}=e,h=r.count;for(let u=0;u<h;u++)t.texture.bind(r.elements[u],u);t.geometry.draw(n,s,a)}_resolveDirectShader(t){let e=this.shader;const r=this.pluginName;if(!e){if(!lh[r]){const{maxTextures:n}=t.plugins[r],s=new Int32Array(n);for(let u=0;u<n;u++)s[u]=u;const a={tint:new Float32Array([1,1,1,1]),translationMatrix:new qt,default:vr.from({uSamplers:s},!0)},h=t.plugins[r]._shader.program;lh[r]=new Nr(h,a)}e=lh[r]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:r,maxX:n,maxY:s}=t.bounds;this._bounds.addFrame(this.transform,e,r,n,s)}containsPoint(t){return this.worldTransform.applyInverse(t,xo._TEMP_POINT),this._geometry.containsPoint(xo._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this._tintColor.toNumber();for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e._tintRGB=kt.shared.setValue(this._tintColor).multiply(e._batchRGB).toLittleEndianNumber()}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,r=e.a,n=e.b,s=e.c,a=e.d,h=e.tx,u=e.ty,c=this._geometry.points,m=this.vertexData;let y=0;for(let v=0;v<c.length;v+=2){const b=c[v],T=c[v+1];m[y++]=r*b+s*T+h,m[y++]=a*T+n*b+u}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};ll.curves=yn,ll._TEMP_POINT=new Ut;let yi=ll;class ib{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const uh=new Ut,td=new ci,np=class sp extends ge{constructor(t,e,r,n=pr.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=r||Hr.for2d(),this.drawMode=n,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=ft.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get tintValue(){return this.shader.tintValue}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===pr.TRIANGLES&&e.length<sp.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,r=this.shader;r.uvMatrix&&(r.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=r._tintRGB,this._texture=r.texture;const n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,r=t._updateID;if(r===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const n=this.transform.worldTransform,s=n.a,a=n.b,h=n.c,u=n.d,c=n.tx,m=n.ty,y=this.vertexData;for(let v=0;v<y.length/2;v++){const b=e[v*2],T=e[v*2+1];y[v*2]=s*b+h*T+c,y[v*2+1]=a*b+u*T+m}if(this._roundPixels){const v=ft.RESOLUTION;for(let b=0;b<y.length;++b)y[b]=Math.round(y[b]*v)/v}this.vertexDirty=r}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ib(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,uh);const e=this.geometry.getBuffer("aVertexPosition").data,r=td.points,n=this.geometry.getIndex().data,s=n.length,a=this.drawMode===4?3:1;for(let h=0;h+2<s;h+=a){const u=n[h]*2,c=n[h+1]*2,m=n[h+2]*2;if(r[0]=e[u],r[1]=e[u+1],r[2]=e[c],r[3]=e[c+1],r[4]=e[m],r[5]=e[m+1],td.contains(uh.x,uh.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};np.BATCHABLE_SIZE=100;let Ue=np;class na extends fi{constructor(t,e,r){super();const n=new xe(t),s=new xe(e,!0),a=new xe(r,!0,!0);this.addAttribute("aVertexPosition",n,2,!1,Et.FLOAT).addAttribute("aTextureCoord",s,2,!1,Et.FLOAT).addIndex(a),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}var nb=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,sb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`;class vn extends Nr{constructor(t,e){const r={uSampler:t,alpha:1,uTextureMatrix:qt.IDENTITY,uColor:new Float32Array([1,1,1,1])};e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e),e.uniforms&&Object.assign(r,e.uniforms),super(e.program||Zr.from(sb,nb),r),this._colorDirty=!1,this.uvMatrix=new Pl(t),this.batchable=e.program===void 0,this.pluginName=e.pluginName,this._tintColor=new kt(e.tint),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this.tint&&(this._tintColor.setValue(t),this._tintRGB=this._tintColor.toLittleEndianNumber(),this._colorDirty=!0)}get tint(){return this._tintColor.value}get tintValue(){return this._tintColor.toNumber()}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture.alphaMode;kt.shared.setValue(this._tintColor).premultiply(this._alpha,t).toArray(this.uniforms.uColor)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ob extends na{constructor(t=100,e=100,r=10,n=10){super(),this.segWidth=r,this.segHeight=n,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],r=[],n=[],s=this.segWidth-1,a=this.segHeight-1,h=this.width/s,u=this.height/a;for(let m=0;m<t;m++){const y=m%this.segWidth,v=m/this.segWidth|0;e.push(y*h,v*u),r.push(y/s,v/a)}const c=s*a;for(let m=0;m<c;m++){const y=m%s,v=m/s|0,b=v*this.segWidth+y,T=v*this.segWidth+y+1,E=(v+1)*this.segWidth+y,P=(v+1)*this.segWidth+y+1;n.push(b,T,E,T,P,E)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class ab extends na{constructor(t=200,e,r=0){super(new Float32Array(e.length*4),new Float32Array(e.length*4),new Uint16Array((e.length-1)*6)),this.points=e,this._width=t,this.textureScale=r,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),n=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(t.length*4),r.data=new Float32Array(t.length*4),n.data=new Uint16Array((t.length-1)*6));const s=r.data,a=n.data;s[0]=0,s[1]=0,s[2]=0,s[3]=1;let h=0,u=t[0];const c=this._width*this.textureScale,m=t.length;for(let v=0;v<m;v++){const b=v*4;if(this.textureScale>0){const T=u.x-t[v].x,E=u.y-t[v].y,P=Math.sqrt(T*T+E*E);u=t[v],h+=P/c}else h=v/(m-1);s[b]=h,s[b+1]=0,s[b+2]=h,s[b+3]=1}let y=0;for(let v=0;v<m-1;v++){const b=v*2;a[y++]=b,a[y++]=b+1,a[y++]=b+2,a[y++]=b+2,a[y++]=b+1,a[y++]=b+3}r.update(),n.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e=t[0],r,n=0,s=0;const a=this.buffers[0].data,h=t.length,u=this.textureScale>0?this.textureScale*this._width/2:this._width/2;for(let c=0;c<h;c++){const m=t[c],y=c*4;c<t.length-1?r=t[c+1]:r=m,s=-(r.x-e.x),n=r.y-e.y;const v=Math.sqrt(n*n+s*s);v<1e-6?(n=0,s=0):(n/=v,s/=v,n*=u,s*=u),a[y]=m.x+n,a[y+1]=m.y+s,a[y+2]=m.x-n,a[y+3]=m.y-s,e=m}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class hb extends Ue{constructor(t,e,r){const n=new ob(t.width,t.height,e,r),s=new vn(pt.WHITE);super(n,s),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:r}=this.shader.texture;this.autoResize&&(t.width!==e||t.height!==r)&&(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}const ho=10;class sa extends hb{constructor(t,e,r,n,s){var a,h,u,c;super(pt.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e??((a=t.defaultBorders)==null?void 0:a.left)??ho,this._rightWidth=n??((h=t.defaultBorders)==null?void 0:h.right)??ho,this._topHeight=r??((u=t.defaultBorders)==null?void 0:u.top)??ho,this._bottomHeight=s??((c=t.defaultBorders)==null?void 0:c.bottom)??ho,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,r=this._topHeight+this._bottomHeight,n=this._height>r?1:this._height/r;return Math.min(e,n)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const r=1/this._origWidth,n=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=r*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-r*this._rightWidth,e[9]=e[11]=e[13]=e[15]=n*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}class lb extends Ue{constructor(t=pt.EMPTY,e,r,n,s){const a=new na(e,r,n);a.getBuffer("aVertexPosition").static=!1;const h=new vn(t);super(a,h,null,s),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class ub extends Ue{constructor(t,e,r=0){const n=new ab(t.height,e,r),s=new vn(t);r>0&&(t.baseTexture.wrapMode=Jr.REPEAT),super(n,s),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}class cb{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function db(i,t){var r;let e=!1;if((r=i==null?void 0:i._textures)!=null&&r.length){for(let n=0;n<i._textures.length;n++)if(i._textures[n]instanceof pt){const s=i._textures[n].baseTexture;t.includes(s)||(t.push(s),e=!0)}}return e}function fb(i,t){if(i.baseTexture instanceof Rt){const e=i.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function pb(i,t){if(i._texture&&i._texture instanceof pt){const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function mb(i,t){return t instanceof Ml?(t.updateText(!0),!0):!1}function gb(i,t){if(t instanceof pi){const e=t.toFontString();return ai.measureFont(e),!0}return!1}function yb(i,t){if(i instanceof Ml){t.includes(i.style)||t.push(i.style),t.includes(i)||t.push(i);const e=i._texture.baseTexture;return t.includes(e)||t.push(e),!0}return!1}function vb(i,t){return i instanceof pi?(t.includes(i)||t.push(i),!0):!1}const op=class ap{constructor(t){this.limiter=new cb(ap.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(yb),this.registerFindHook(vb),this.registerFindHook(db),this.registerFindHook(fb),this.registerFindHook(pb),this.registerUploadHook(mb),this.registerUploadHook(gb)}upload(t){return new Promise(e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,qe.system.addOnce(this.tick,this,Ni.UTILITY))):e()})}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed){for(let r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)qe.system.addOnce(this.tick,this,Ni.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,r=t.length;e<r;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof ge)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&qe.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};op.uploadsPerFrame=4;let Go=op;Object.defineProperties(ft,{UPLOADS_PER_FRAME:{get(){return Go.uploadsPerFrame},set(i){Ct("7.1.0","settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),Go.uploadsPerFrame=i}}});function hp(i,t){return t instanceof Rt?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function _b(i,t){if(!(t instanceof yi))return!1;const{geometry:e}=t;t.finishPoly(),e.updateBatches();const{batches:r}=e;for(let n=0;n<r.length;n++){const{texture:s}=r[n].style;s&&hp(i,s.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function xb(i,t){return i instanceof yi?(t.push(i),!0):!1}class lp extends Go{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(xb),this.registerUploadHook(hp),this.registerUploadHook(_b)}}lp.extension={name:"prepare",type:ut.RendererSystem};mt.add(lp);const up=class Zn{constructor(t,e,r){this.linkedSheets=[],(t instanceof Rt||t instanceof pt)&&(t={texture:t,data:e,resolutionFilename:r});const{texture:n,data:s,resolutionFilename:a=null,cachePrefix:h=""}=t;this.cachePrefix=h,this._texture=n instanceof pt?n:null,this.baseTexture=n instanceof Rt?n:this._texture.baseTexture,this.textures={},this.animations={},this.data=s;const u=this.baseTexture.resource;this.resolution=this._updateResolution(a||(u?u.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let r=Gr(t,null);return r===null&&(r=typeof e=="number"?e:parseFloat(e??"1")),r!==1&&this.baseTexture.setResolution(r),r}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Zn.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const r=Zn.BATCH_SIZE;for(;e-t<r&&e<this._frameKeys.length;){const n=this._frameKeys[e],s=this._frames[n],a=s.frame;if(a){let h=null,u=null;const c=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,m=new It(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);s.rotated?h=new It(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):h=new It(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(u=new It(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[n]=new pt(this.baseTexture,h,m,u,s.rotated?2:0,s.anchor,s.borders),pt.addToCache(this.textures[n],this.cachePrefix+n.toString())}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let r=0;r<t[e].length;r++){const n=t[e][r];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Zn.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Zn.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};up.BATCH_SIZE=1e3;let ed=up;const bb=["jpg","png","jpeg","avif","webp","s3tc","s3tc_sRGB","etc","etc1","pvrtc","atc","astc","bptc"];function cp(i,t,e){const r={};if(i.forEach(n=>{r[n]=t}),Object.keys(t.textures).forEach(n=>{r[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=be.dirname(i[0]);t.linkedSheets.forEach((s,a)=>{Object.assign(r,cp([`${n}/${t.data.meta.related_multi_packs[a]}`],s,!0))})}return r}const Tb={extension:ut.Asset,cache:{test:i=>i instanceof ed,getCacheableAssets:(i,t)=>cp(i,t,!1)},resolver:{test:i=>{const t=i.split("?")[0].split("."),e=t.pop(),r=t.pop();return e==="json"&&bb.includes(r)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=ft.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",extension:{type:ut.LoadParser,priority:xr.Normal},async testParse(i,t){return be.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var m,y;const{texture:r,imageFilename:n,cachePrefix:s}=(t==null?void 0:t.data)??{};let a=be.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let h;if(r&&r.baseTexture)h=r;else{const v=ol(a+(n??i.meta.image),t.src);h=(await e.load([v]))[v]}const u=new ed({texture:h.baseTexture,data:i,resolutionFilename:t.src,cachePrefix:s});await u.parse();const c=(m=i==null?void 0:i.meta)==null?void 0:m.related_multi_packs;if(Array.isArray(c)){const v=[];for(const T of c){if(typeof T!="string")continue;let E=a+T;(y=t.data)!=null&&y.ignoreMultiPack||(E=ol(E,t.src),v.push(e.load({src:E,data:{ignoreMultiPack:!0}})))}const b=await Promise.all(v);u.linkedSheets=b,b.forEach(T=>{T.linkedSheets=[u].concat(u.linkedSheets.filter(E=>E!==T))})}return u},unload(i){i.destroy(!0)}}};mt.add(Tb);class Ho{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class bo{static test(t){return typeof t=="string"&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const s in e){const a=e[s].match(/^[a-z]+/gm)[0],h=e[s].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),u={};for(const c in h){const m=h[c].split("="),y=m[0],v=m[1].replace(/"/gm,""),b=parseFloat(v),T=isNaN(b)?v:b;u[y]=T}r[a].push(u)}const n=new Ho;return r.info.forEach(s=>n.info.push({face:s.face,size:parseInt(s.size,10)})),r.common.forEach(s=>n.common.push({lineHeight:parseInt(s.lineHeight,10)})),r.page.forEach(s=>n.page.push({id:parseInt(s.id,10),file:s.file})),r.char.forEach(s=>n.char.push({id:parseInt(s.id,10),page:parseInt(s.page,10),x:parseInt(s.x,10),y:parseInt(s.y,10),width:parseInt(s.width,10),height:parseInt(s.height,10),xoffset:parseInt(s.xoffset,10),yoffset:parseInt(s.yoffset,10),xadvance:parseInt(s.xadvance,10)})),r.kerning.forEach(s=>n.kerning.push({first:parseInt(s.first,10),second:parseInt(s.second,10),amount:parseInt(s.amount,10)})),r.distanceField.forEach(s=>n.distanceField.push({distanceRange:parseInt(s.distanceRange,10),fieldType:s.fieldType})),n}}class ul{static test(t){const e=t;return typeof t!="string"&&"getElementsByTagName"in t&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null}static parse(t){const e=new Ho,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),h=t.getElementsByTagName("kerning"),u=t.getElementsByTagName("distanceField");for(let c=0;c<r.length;c++)e.info.push({face:r[c].getAttribute("face"),size:parseInt(r[c].getAttribute("size"),10)});for(let c=0;c<n.length;c++)e.common.push({lineHeight:parseInt(n[c].getAttribute("lineHeight"),10)});for(let c=0;c<s.length;c++)e.page.push({id:parseInt(s[c].getAttribute("id"),10)||0,file:s[c].getAttribute("file")});for(let c=0;c<a.length;c++){const m=a[c];e.char.push({id:parseInt(m.getAttribute("id"),10),page:parseInt(m.getAttribute("page"),10)||0,x:parseInt(m.getAttribute("x"),10),y:parseInt(m.getAttribute("y"),10),width:parseInt(m.getAttribute("width"),10),height:parseInt(m.getAttribute("height"),10),xoffset:parseInt(m.getAttribute("xoffset"),10),yoffset:parseInt(m.getAttribute("yoffset"),10),xadvance:parseInt(m.getAttribute("xadvance"),10)})}for(let c=0;c<h.length;c++)e.kerning.push({first:parseInt(h[c].getAttribute("first"),10),second:parseInt(h[c].getAttribute("second"),10),amount:parseInt(h[c].getAttribute("amount"),10)});for(let c=0;c<u.length;c++)e.distanceField.push({fieldType:u[c].getAttribute("fieldType"),distanceRange:parseInt(u[c].getAttribute("distanceRange"),10)});return e}}class cl{static test(t){return typeof t=="string"&&t.includes("<font>")?ul.test(ft.ADAPTER.parseXML(t)):!1}static parse(t){return ul.parse(ft.ADAPTER.parseXML(t))}}const ch=[bo,ul,cl];function wb(i){for(let t=0;t<ch.length;t++)if(ch[t].test(i))return ch[t];return null}function Ab(i,t,e,r,n,s){const a=e.fill;if(Array.isArray(a)){if(a.length===1)return a[0]}else return a;let h;const u=e.dropShadow?e.dropShadowDistance:0,c=e.padding||0,m=i.width/r-u-c*2,y=i.height/r-u-c*2,v=a.slice(),b=e.fillGradientStops.slice();if(!b.length){const T=v.length+1;for(let E=1;E<T;++E)b.push(E/T)}if(v.unshift(a[0]),b.unshift(0),v.push(a[a.length-1]),b.push(1),e.fillGradientType===ea.LINEAR_VERTICAL){h=t.createLinearGradient(m/2,c,m/2,y+c);let T=0;const E=(s.fontProperties.fontSize+e.strokeThickness)/y;for(let P=0;P<n.length;P++){const M=s.lineHeight*P;for(let D=0;D<v.length;D++){let R=0;typeof b[D]=="number"?R=b[D]:R=D/v.length;const N=M/y+R*E;let Y=Math.max(T,N);Y=Math.min(Y,1),h.addColorStop(Y,v[D]),T=Y}}}else{h=t.createLinearGradient(c,y/2,m+c,y/2);const T=v.length+1;let E=1;for(let P=0;P<v.length;P++){let M;typeof b[P]=="number"?M=b[P]:M=E/T,h.addColorStop(M,v[P]),E++}}return h}function Eb(i,t,e,r,n,s,a){const h=e.text,u=e.fontProperties;t.translate(r,n),t.scale(s,s);const c=a.strokeThickness/2,m=-(a.strokeThickness/2);if(t.font=a.toFontString(),t.lineWidth=a.strokeThickness,t.textBaseline=a.textBaseline,t.lineJoin=a.lineJoin,t.miterLimit=a.miterLimit,t.fillStyle=Ab(i,t,a,s,[h],e),t.strokeStyle=a.stroke,a.dropShadow){const y=a.dropShadowColor,v=a.dropShadowBlur*s,b=a.dropShadowDistance*s;t.shadowColor=kt.shared.setValue(y).setAlpha(a.dropShadowAlpha).toRgbaString(),t.shadowBlur=v,t.shadowOffsetX=Math.cos(a.dropShadowAngle)*b,t.shadowOffsetY=Math.sin(a.dropShadowAngle)*b}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;a.stroke&&a.strokeThickness&&t.strokeText(h,c,m+e.lineHeight-u.descent),a.fill&&t.fillText(h,c,m+e.lineHeight-u.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function To(i){return i.codePointAt?i.codePointAt(0):i.charCodeAt(0)}function dp(i){return Array.from?Array.from(i):i.split("")}function Sb(i){typeof i=="string"&&(i=[i]);const t=[];for(let e=0,r=i.length;e<r;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);const s=n[0].charCodeAt(0),a=n[1].charCodeAt(0);if(a<s)throw new Error("[BitmapFont]: Invalid character range.");for(let h=s,u=a;h<=u;h++)t.push(String.fromCharCode(h))}else t.push(...dp(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}const si=class Fr{constructor(t,e,r){var m;const[n]=t.info,[s]=t.common,[a]=t.page,[h]=t.distanceField,u=Gr(a.file),c={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/u,this.chars={},this.pageTextures=c;for(let y=0;y<t.page.length;y++){const{id:v,file:b}=t.page[y];c[v]=e instanceof Array?e[y]:e[b],h!=null&&h.fieldType&&h.fieldType!=="none"&&(c[v].baseTexture.alphaMode=He.NO_PREMULTIPLIED_ALPHA,c[v].baseTexture.mipmap=Ur.OFF)}for(let y=0;y<t.char.length;y++){const{id:v,page:b}=t.char[y];let{x:T,y:E,width:P,height:M,xoffset:D,yoffset:R,xadvance:N}=t.char[y];T/=u,E/=u,P/=u,M/=u,D/=u,R/=u,N/=u;const Y=new It(T+c[b].frame.x/u,E+c[b].frame.y/u,P,M);this.chars[v]={xOffset:D,yOffset:R,xAdvance:N,kerning:{},texture:new pt(c[b].baseTexture,Y),page:b}}for(let y=0;y<t.kerning.length;y++){let{first:v,second:b,amount:T}=t.kerning[y];v/=u,b/=u,T/=u,this.chars[b]&&(this.chars[b].kerning[v]=T)}this.distanceFieldRange=h==null?void 0:h.distanceRange,this.distanceFieldType=((m=h==null?void 0:h.fieldType)==null?void 0:m.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,r){let n;if(t instanceof Ho)n=t;else{const a=wb(t);if(!a)throw new Error("Unrecognized data format for font.");n=a.parse(t)}e instanceof pt&&(e=[e]);const s=new Fr(n,e,r);return Fr.available[s.font]=s,s}static uninstall(t){const e=Fr.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete Fr.available[t]}static from(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:n,padding:s,resolution:a,textureWidth:h,textureHeight:u,...c}=Object.assign({},Fr.defaultOptions,r),m=Sb(n),y=e instanceof pi?e:new pi(e),v=h,b=new Ho;b.info[0]={face:y.fontFamily,size:y.fontSize},b.common[0]={lineHeight:y.fontSize};let T=0,E=0,P,M,D,R=0;const N=[];for(let X=0;X<m.length;X++){P||(P=ft.ADAPTER.createCanvas(),P.width=h,P.height=u,M=P.getContext("2d"),D=new Rt(P,{resolution:a,...c}),N.push(new pt(D)),b.page.push({id:N.length-1,file:""}));const K=m[X],q=ai.measureText(K,y,!1,P),j=q.width,st=Math.ceil(q.height),yt=Math.ceil((y.fontStyle==="italic"?2:1)*j);if(E>=u-st*a){if(E===0)throw new Error(`[BitmapFont] textureHeight ${u}px is too small (fontFamily: '${y.fontFamily}', fontSize: ${y.fontSize}px, char: '${K}')`);--X,P=null,M=null,D=null,E=0,T=0,R=0;continue}if(R=Math.max(st+q.fontProperties.descent,R),yt*a+T>=v){if(T===0)throw new Error(`[BitmapFont] textureWidth ${h}px is too small (fontFamily: '${y.fontFamily}', fontSize: ${y.fontSize}px, char: '${K}')`);--X,E+=R*a,E=Math.ceil(E),T=0,R=0;continue}Eb(P,M,q,T,E,a,y);const $=To(q.text);b.char.push({id:$,page:N.length-1,x:T/a,y:E/a,width:yt,height:st,xoffset:0,yoffset:0,xadvance:j-(y.dropShadow?y.dropShadowDistance:0)-(y.stroke?y.strokeThickness:0)}),T+=(yt+2*s)*a,T=Math.ceil(T)}if(!(r!=null&&r.skipKerning))for(let X=0,K=m.length;X<K;X++){const q=m[X];for(let j=0;j<K;j++){const st=m[j],yt=M.measureText(q).width,$=M.measureText(st).width,H=M.measureText(q+st).width-(yt+$);H&&b.kerning.push({first:To(q),second:To(st),amount:H})}}const Y=new Fr(b,N,!0);return Fr.available[t]!==void 0&&Fr.uninstall(t),Fr.available[t]=Y,Y}};si.ALPHA=[["a","z"],["A","Z"]," "],si.NUMERIC=[["0","9"]],si.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],si.ASCII=[[" ","~"]],si.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:si.ALPHANUMERIC},si.available={};let oi=si;var Cb=`// Pixi texture info\r
varying vec2 vTextureCoord;\r
uniform sampler2D uSampler;\r
\r
// Tint\r
uniform vec4 uColor;\r
\r
// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r
uniform float uFWidth;\r
\r
void main(void) {\r
\r
  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r
  vec4 texColor = texture2D(uSampler, vTextureCoord);\r
\r
  // MSDF\r
  float median = texColor.r + texColor.g + texColor.b -\r
                  min(texColor.r, min(texColor.g, texColor.b)) -\r
                  max(texColor.r, max(texColor.g, texColor.b));\r
  // SDF\r
  median = min(median, texColor.a);\r
\r
  float screenPxDistance = uFWidth * (median - 0.5);\r
  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r
  if (median < 0.01) {\r
    alpha = 0.0;\r
  } else if (median > 0.99) {\r
    alpha = 1.0;\r
  }\r
\r
  // Gamma correction for coverage-like alpha\r
  float luma = dot(uColor.rgb, vec3(0.299, 0.587, 0.114));\r
  float gamma = mix(1.0, 1.0 / 2.2, luma);\r
  float coverage = pow(uColor.a * alpha, gamma);  \r
\r
  // NPM Textures, NPM outputs\r
  gl_FragColor = vec4(uColor.rgb, coverage);\r
}\r
`,Pb=`// Mesh material default fragment\r
attribute vec2 aVertexPosition;\r
attribute vec2 aTextureCoord;\r
\r
uniform mat3 projectionMatrix;\r
uniform mat3 translationMatrix;\r
uniform mat3 uTextureMatrix;\r
\r
varying vec2 vTextureCoord;\r
\r
void main(void)\r
{\r
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r
}\r
`;const rd=[],id=[],nd=[],Rb=class fp extends ge{constructor(t,e={}){super();const{align:r,tint:n,maxWidth:s,letterSpacing:a,fontName:h,fontSize:u}=Object.assign({},fp.styleDefaults,e);if(!oi.available[h])throw new Error(`Missing BitmapFont "${h}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=r,this._tintColor=new kt(n),this._font=void 0,this._fontName=h,this._fontSize=u,this.text=t,this._maxWidth=s,this._maxLineHeight=0,this._letterSpacing=a,this._anchor=new Kr(()=>{this.dirty=!0},this,0,0),this._roundPixels=ft.ROUND_PIXELS,this.dirty=!0,this._resolution=ft.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var yt;const t=oi.available[this._fontName],e=this.fontSize,r=e/t.size,n=new Ut,s=[],a=[],h=[],u=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",c=dp(u),m=this._maxWidth*t.size/e,y=t.distanceFieldType==="none"?rd:id;let v=null,b=0,T=0,E=0,P=-1,M=0,D=0,R=0,N=0;for(let $=0;$<c.length;$++){const H=c[$],z=To(H);if(/(?:\s)/.test(H)&&(P=$,M=b,N++),H==="\r"||H===`
`){a.push(b),h.push(-1),T=Math.max(T,b),++E,++D,n.x=0,n.y+=t.lineHeight,v=null,N=0;continue}const vt=t.chars[z];if(!vt)continue;v&&vt.kerning[v]&&(n.x+=vt.kerning[v]);const Pt=nd.pop()||{texture:pt.EMPTY,line:0,charCode:0,prevSpaces:0,position:new Ut};Pt.texture=vt.texture,Pt.line=E,Pt.charCode=z,Pt.position.x=Math.round(n.x+vt.xOffset+this._letterSpacing/2),Pt.position.y=Math.round(n.y+vt.yOffset),Pt.prevSpaces=N,s.push(Pt),b=Pt.position.x+Math.max(vt.xAdvance-vt.xOffset,vt.texture.orig.width),n.x+=vt.xAdvance+this._letterSpacing,R=Math.max(R,vt.yOffset+vt.texture.height),v=z,P!==-1&&m>0&&n.x>m&&(++D,Oi(s,1+P-D,1+$-P),$=P,P=-1,a.push(M),h.push(s.length>0?s[s.length-1].prevSpaces:0),T=Math.max(T,M),E++,n.x=0,n.y+=t.lineHeight,v=null,N=0)}const Y=c[c.length-1];Y!=="\r"&&Y!==`
`&&(/(?:\s)/.test(Y)&&(b=M),a.push(b),T=Math.max(T,b),h.push(-1));const X=[];for(let $=0;$<=E;$++){let H=0;this._align==="right"?H=T-a[$]:this._align==="center"?H=(T-a[$])/2:this._align==="justify"&&(H=h[$]<0?0:(T-a[$])/h[$]),X.push(H)}const K=s.length,q={},j=[],st=this._activePagesMeshData;y.push(...st);for(let $=0;$<K;$++){const H=s[$].texture,z=H.baseTexture.uid;if(!q[z]){let vt=y.pop();if(!vt){const dt=new na;let St,Kt;t.distanceFieldType==="none"?(St=new vn(pt.EMPTY),Kt=rt.NORMAL):(St=new vn(pt.EMPTY,{program:Zr.from(Pb,Cb),uniforms:{uFWidth:0}}),Kt=rt.NORMAL_NPM);const lt=new Ue(dt,St);lt.blendMode=Kt,vt={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:lt,vertices:null,uvs:null,indices:null}}vt.index=0,vt.indexCount=0,vt.vertexCount=0,vt.uvsCount=0,vt.total=0;const{_textureCache:Pt}=this;Pt[z]=Pt[z]||new pt(H.baseTexture),vt.mesh.texture=Pt[z],vt.mesh.tint=this._tintColor.value,j.push(vt),q[z]=vt}q[z].total++}for(let $=0;$<st.length;$++)j.includes(st[$])||this.removeChild(st[$].mesh);for(let $=0;$<j.length;$++)j[$].mesh.parent!==this&&this.addChild(j[$].mesh);this._activePagesMeshData=j;for(const $ in q){const H=q[$],z=H.total;if(!(((yt=H.indices)==null?void 0:yt.length)>6*z)||H.vertices.length<Ue.BATCHABLE_SIZE*2)H.vertices=new Float32Array(4*2*z),H.uvs=new Float32Array(4*2*z),H.indices=new Uint16Array(6*z);else{const vt=H.total,Pt=H.vertices;for(let dt=vt*4*2;dt<Pt.length;dt++)Pt[dt]=0}H.mesh.size=6*z}for(let $=0;$<K;$++){const H=s[$];let z=H.position.x+X[H.line]*(this._align==="justify"?H.prevSpaces:1);this._roundPixels&&(z=Math.round(z));const vt=z*r,Pt=H.position.y*r,dt=H.texture,St=q[dt.baseTexture.uid],Kt=dt.frame,lt=dt._uvs,ct=St.index++;St.indices[ct*6+0]=0+ct*4,St.indices[ct*6+1]=1+ct*4,St.indices[ct*6+2]=2+ct*4,St.indices[ct*6+3]=0+ct*4,St.indices[ct*6+4]=2+ct*4,St.indices[ct*6+5]=3+ct*4,St.vertices[ct*8+0]=vt,St.vertices[ct*8+1]=Pt,St.vertices[ct*8+2]=vt+Kt.width*r,St.vertices[ct*8+3]=Pt,St.vertices[ct*8+4]=vt+Kt.width*r,St.vertices[ct*8+5]=Pt+Kt.height*r,St.vertices[ct*8+6]=vt,St.vertices[ct*8+7]=Pt+Kt.height*r,St.uvs[ct*8+0]=lt.x0,St.uvs[ct*8+1]=lt.y0,St.uvs[ct*8+2]=lt.x1,St.uvs[ct*8+3]=lt.y1,St.uvs[ct*8+4]=lt.x2,St.uvs[ct*8+5]=lt.y2,St.uvs[ct*8+6]=lt.x3,St.uvs[ct*8+7]=lt.y3}this._textWidth=T*r,this._textHeight=(n.y+t.lineHeight)*r;for(const $ in q){const H=q[$];if(this.anchor.x!==0||this.anchor.y!==0){let dt=0;const St=this._textWidth*this.anchor.x,Kt=this._textHeight*this.anchor.y;for(let lt=0;lt<H.total;lt++)H.vertices[dt++]-=St,H.vertices[dt++]-=Kt,H.vertices[dt++]-=St,H.vertices[dt++]-=Kt,H.vertices[dt++]-=St,H.vertices[dt++]-=Kt,H.vertices[dt++]-=St,H.vertices[dt++]-=Kt}this._maxLineHeight=R*r;const z=H.mesh.geometry.getBuffer("aVertexPosition"),vt=H.mesh.geometry.getBuffer("aTextureCoord"),Pt=H.mesh.geometry.getIndex();z.data=H.vertices,vt.data=H.uvs,Pt.data=H.indices,z.update(),vt.update(),Pt.update()}for(let $=0;$<s.length;$++)nd.push(s[$]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:r,size:n}=oi.available[this._fontName];if(r!=="none"){const{a:s,b:a,c:h,d:u}=this.worldTransform,c=Math.sqrt(s*s+a*a),m=Math.sqrt(h*h+u*u),y=(Math.abs(c)+Math.abs(m))/2,v=this.fontSize/n,b=t._view.resolution;for(const T of this._activePagesMeshData)T.mesh.shader.uniforms.uFWidth=y*e*v*b}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=oi.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tintColor.value}set tint(t){if(this.tint!==t){this._tintColor.setValue(t);for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!oi.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??oi.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,r=oi.available[this._fontName].distanceFieldType==="none"?rd:id;r.push(...this._activePagesMeshData);for(const n of this._activePagesMeshData)this.removeChild(n.mesh);this._activePagesMeshData=[],r.filter(n=>e[n.mesh.texture.baseTexture.uid]).forEach(n=>{n.mesh.texture=pt.EMPTY});for(const n in e)e[n].destroy(),delete e[n];this._font=null,this._tintColor=null,this._textureCache=null,super.destroy(t)}};Rb.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Mb=[".xml",".fnt"],Ib={extension:{type:ut.LoadParser,priority:xr.Normal},name:"loadBitmapFont",test(i){return Mb.includes(be.extname(i).toLowerCase())},async testParse(i){return bo.test(i)||cl.test(i)},async parse(i,t,e){const r=bo.test(i)?bo.parse(i):cl.parse(i),{src:n}=t,{page:s}=r,a=[];for(let c=0;c<s.length;++c){const m=s[c].file;let y=be.join(be.dirname(n),m);y=ol(y,n),a.push(y)}const h=await e.load(a),u=a.map(c=>h[c]);return oi.install(r,u,!0)},async load(i,t){return(await ft.ADAPTER.fetch(i)).text()},unload(i){i.destroy()}};mt.add(Ib);const dl=class en extends pi{constructor(){super(...arguments),this._fonts=[],this._overrides=[],this._stylesheet="",this.fontsDirty=!1}static from(t){return new en(Object.keys(en.defaultOptions).reduce((e,r)=>({...e,[r]:t[r]}),{}))}cleanFonts(){this._fonts.length>0&&(this._fonts.forEach(t=>{URL.revokeObjectURL(t.src),t.refs--,t.refs===0&&(t.fontFace&&document.fonts.delete(t.fontFace),delete en.availableFonts[t.originalUrl])}),this.fontFamily="Arial",this._fonts.length=0,this.styleID++,this.fontsDirty=!0)}loadFont(t,e={}){const{availableFonts:r}=en;if(r[t]){const n=r[t];return this._fonts.push(n),n.refs++,this.styleID++,this.fontsDirty=!0,Promise.resolve()}return ft.ADAPTER.fetch(t).then(n=>n.blob()).then(async n=>new Promise((s,a)=>{const h=URL.createObjectURL(n),u=new FileReader;u.onload=()=>s([h,u.result]),u.onerror=a,u.readAsDataURL(n)})).then(async([n,s])=>{const a=Object.assign({family:be.basename(t,be.extname(t)),weight:"normal",style:"normal",display:"auto",src:n,dataSrc:s,refs:1,originalUrl:t,fontFace:null},e);r[t]=a,this._fonts.push(a),this.styleID++;const h=new FontFace(a.family,`url(${a.src})`,{weight:a.weight,style:a.style,display:a.display});a.fontFace=h,await h.load(),document.fonts.add(h),await document.fonts.ready,this.styleID++,this.fontsDirty=!0})}addOverride(...t){const e=t.filter(r=>!this._overrides.includes(r));e.length>0&&(this._overrides.push(...e),this.styleID++)}removeOverride(...t){const e=t.filter(r=>this._overrides.includes(r));e.length>0&&(this._overrides=this._overrides.filter(r=>!e.includes(r)),this.styleID++)}toCSS(t){return[`transform: scale(${t})`,"transform-origin: top left","display: inline-block",`color: ${this.normalizeColor(this.fill)}`,`font-size: ${this.fontSize}px`,`font-family: ${this.fontFamily}`,`font-weight: ${this.fontWeight}`,`font-style: ${this.fontStyle}`,`font-variant: ${this.fontVariant}`,`letter-spacing: ${this.letterSpacing}px`,`text-align: ${this.align}`,`padding: ${this.padding}px`,`white-space: ${this.whiteSpace}`,...this.lineHeight?[`line-height: ${this.lineHeight}px`]:[],...this.wordWrap?[`word-wrap: ${this.breakWords?"break-all":"break-word"}`,`max-width: ${this.wordWrapWidth}px`]:[],...this.strokeThickness?[`-webkit-text-stroke-width: ${this.strokeThickness}px`,`-webkit-text-stroke-color: ${this.normalizeColor(this.stroke)}`,`text-stroke-width: ${this.strokeThickness}px`,`text-stroke-color: ${this.normalizeColor(this.stroke)}`,"paint-order: stroke"]:[],...this.dropShadow?[this.dropShadowToCSS()]:[],...this._overrides].join(";")}toGlobalCSS(){return this._fonts.reduce((t,e)=>`${t}
            @font-face {
                font-family: "${e.family}";
                src: url('${e.dataSrc}');
                font-weight: ${e.weight};
                font-style: ${e.style};
                font-display: ${e.display};
            }`,this._stylesheet)}get stylesheet(){return this._stylesheet}set stylesheet(t){this._stylesheet!==t&&(this._stylesheet=t,this.styleID++)}normalizeColor(t){return Array.isArray(t)&&(t=jd(t)),typeof t=="number"?Vd(t):t}dropShadowToCSS(){let t=this.normalizeColor(this.dropShadowColor);const e=this.dropShadowAlpha,r=Math.round(Math.cos(this.dropShadowAngle)*this.dropShadowDistance),n=Math.round(Math.sin(this.dropShadowAngle)*this.dropShadowDistance);t.startsWith("#")&&e<1&&(t+=(e*255|0).toString(16).padStart(2,"0"));const s=`${r}px ${n}px`;return this.dropShadowBlur>0?`text-shadow: ${s} ${this.dropShadowBlur}px ${t}`:`text-shadow: ${s} ${t}`}reset(){Object.assign(this,en.defaultOptions)}onBeforeDraw(){const{fontsDirty:t}=this;return this.fontsDirty=!1,this.isSafari&&this._fonts.length>0&&t?new Promise(e=>setTimeout(e,100)):Promise.resolve()}get isSafari(){const{userAgent:t}=ft.ADAPTER.getNavigator();return/^((?!chrome|android).)*safari/i.test(t)}set fillGradientStops(t){console.warn("[HTMLTextStyle] fillGradientStops is not supported by HTMLText")}get fillGradientStops(){return super.fillGradientStops}set fillGradientType(t){console.warn("[HTMLTextStyle] fillGradientType is not supported by HTMLText")}get fillGradientType(){return super.fillGradientType}set miterLimit(t){console.warn("[HTMLTextStyle] miterLimit is not supported by HTMLText")}get miterLimit(){return super.miterLimit}set trim(t){console.warn("[HTMLTextStyle] trim is not supported by HTMLText")}get trim(){return super.trim}set textBaseline(t){console.warn("[HTMLTextStyle] textBaseline is not supported by HTMLText")}get textBaseline(){return super.textBaseline}set leading(t){console.warn("[HTMLTextStyle] leading is not supported by HTMLText")}get leading(){return super.leading}set lineJoin(t){console.warn("[HTMLTextStyle] lineJoin is not supported by HTMLText")}get lineJoin(){return super.lineJoin}};dl.availableFonts={},dl.defaultOptions={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,padding:0,stroke:"black",strokeThickness:0,whiteSpace:"normal",wordWrap:!1,wordWrapWidth:100};let dh=dl;const lo=class rn extends Ie{constructor(t="",e={}){super(pt.EMPTY),this._text=null,this._style=null,this._autoResolution=!0,this.localStyleID=-1,this.dirty=!1,this._updateID=0,this.ownsStyle=!1;const r=new Image,n=pt.from(r,{scaleMode:ft.SCALE_MODE,resourceOptions:{autoLoad:!1}});n.orig=new It,n.trim=new It,this.texture=n;const s="http://www.w3.org/2000/svg",a="http://www.w3.org/1999/xhtml",h=document.createElementNS(s,"svg"),u=document.createElementNS(s,"foreignObject"),c=document.createElementNS(a,"div"),m=document.createElementNS(a,"style");u.setAttribute("width","10000"),u.setAttribute("height","10000"),u.style.overflow="hidden",h.appendChild(u),this.maxWidth=rn.defaultMaxWidth,this.maxHeight=rn.defaultMaxHeight,this._domElement=c,this._styleElement=m,this._svgRoot=h,this._foreignObject=u,this._foreignObject.appendChild(m),this._foreignObject.appendChild(c),this._image=r,this._loadImage=new Image,this._autoResolution=rn.defaultAutoResolution,this._resolution=rn.defaultResolution??ft.RESOLUTION,this.text=t,this.style=e}measureText(t){var m,y;const{text:e,style:r,resolution:n}=Object.assign({text:this._text,style:this._style,resolution:this._resolution},t);Object.assign(this._domElement,{innerHTML:e,style:r.toCSS(n)}),this._styleElement.textContent=r.toGlobalCSS(),document.body.appendChild(this._svgRoot);const s=this._domElement.getBoundingClientRect();this._svgRoot.remove();const{width:a,height:h}=s;(a>this.maxWidth||h>this.maxHeight)&&console.warn("[HTMLText] Large expanse of text, increase HTMLText.maxWidth or HTMLText.maxHeight property.");const u=Math.min(this.maxWidth,Math.ceil(a)),c=Math.min(this.maxHeight,Math.ceil(h));return this._svgRoot.setAttribute("width",u.toString()),this._svgRoot.setAttribute("height",c.toString()),e!==this._text&&(this._domElement.innerHTML=this._text),r!==this._style&&(Object.assign(this._domElement,{style:(m=this._style)==null?void 0:m.toCSS(n)}),this._styleElement.textContent=(y=this._style)==null?void 0:y.toGlobalCSS()),{width:u+r.padding*2,height:c+r.padding*2}}async updateText(t=!0){const{style:e,_image:r,_loadImage:n}=this;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;const{width:s,height:a}=this.measureText();r.width=n.width=Math.ceil(Math.max(1,s)),r.height=n.height=Math.ceil(Math.max(1,a)),this._updateID++;const h=this._updateID;await new Promise(u=>{n.onload=async()=>{if(h<this._updateID){u();return}await e.onBeforeDraw(),r.src=n.src,n.onload=null,n.src="",this.updateTexture(),u()};const c=new XMLSerializer().serializeToString(this._svgRoot);n.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(c)}`})}get source(){return this._image}updateTexture(){const{style:t,texture:e,_image:r,resolution:n}=this,{padding:s}=t,{baseTexture:a}=e;e.trim.width=e._frame.width=r.width/n,e.trim.height=e._frame.height=r.height/n,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-s*2,e.orig.height=e._frame.height-s*2,this._onTextureUpdate(),a.setRealSize(r.width,r.height,n),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}_renderCanvas(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._renderCanvas(t)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds(t)}_calculateBounds(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_onStyleChange(){this.dirty=!0}destroy(t){var r,n,s,a,h;typeof t=="boolean"&&(t={children:t}),t=Object.assign({},rn.defaultDestroyOptions,t),super.destroy(t);const e=null;this.ownsStyle&&((r=this._style)==null||r.cleanFonts()),this._style=e,(n=this._svgRoot)==null||n.remove(),this._svgRoot=e,(s=this._domElement)==null||s.remove(),this._domElement=e,(a=this._foreignObject)==null||a.remove(),this._foreignObject=e,(h=this._styleElement)==null||h.remove(),this._styleElement=e,this._loadImage.src="",this._loadImage.onload=null,this._loadImage=e,this._image.src="",this._image=e}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._image.width/this.resolution}set width(t){this.updateText(!0);const e=qr(this.scale.x)||1;this.scale.x=e*t/this._image.width/this.resolution,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._image.height/this.resolution}set height(t){this.updateText(!0);const e=qr(this.scale.y)||1;this.scale.y=e*t/this._image.height/this.resolution,this._height=t}get style(){return this._style}set style(t){this._style!==t&&(t=t||{},t instanceof dh?(this.ownsStyle=!1,this._style=t):t instanceof pi?(console.warn("[HTMLText] Cloning TextStyle, if this is not what you want, use HTMLTextStyle"),this.ownsStyle=!0,this._style=dh.from(t)):(this.ownsStyle=!0,this._style=new dh(t)),this.localStyleID=-1,this.dirty=!0)}get text(){return this._text}set text(t){t=String(t===""||t===null||t===void 0?" ":t),t=this.sanitiseText(t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}sanitiseText(t){return t.replace(/<br>/gi,"<br/>").replace(/<hr>/gi,"<hr/>").replace(/&nbsp;/gi,"&#160;")}};lo.defaultDestroyOptions={texture:!0,children:!1,baseTexture:!0},lo.defaultMaxWidth=2024,lo.defaultMaxHeight=2024,lo.defaultAutoResolution=!0;const ni=new It;class pp{constructor(t){this.renderer=t}async image(t,e,r,n){const s=new Image;return s.src=await this.base64(t,e,r,n),s}async base64(t,e,r,n){const s=this.canvas(t,n);if(s.toBlob!==void 0)return new Promise((a,h)=>{s.toBlob(u=>{if(!u){h(new Error("ICanvas.toBlob failed!"));return}const c=new FileReader;c.onload=()=>a(c.result),c.onerror=h,c.readAsDataURL(u)},e,r)});if(s.toDataURL!==void 0)return s.toDataURL(e,r);if(s.convertToBlob!==void 0){const a=await s.convertToBlob({type:e,quality:r});return new Promise((h,u)=>{const c=new FileReader;c.onload=()=>h(c.result),c.onerror=u,c.readAsDataURL(a)})}throw new Error("CanvasExtract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t,e){const r=this.renderer;if(!r)throw new Error("The CanvasExtract has already been destroyed");let n,s,a;t&&(t instanceof _r?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution}),e&&(ni.width=e.width,ni.height=e.height,e=ni))),a?(n=a.baseTexture._canvasRenderTarget.context,s=a.baseTexture._canvasRenderTarget.resolution,e=e??a.frame):(n=r.canvasContext.rootContext,s=r._view.resolution,e||(e=ni,e.width=r.width/s,e.height=r.height/s));const h=Math.round(e.x*s),u=Math.round(e.y*s),c=Math.max(Math.round(e.width*s),1),m=Math.max(Math.round(e.height*s),1),y=new fs(c,m,1),v=n.getImageData(h,u,c,m);return y.context.putImageData(v,0,0),y.canvas}pixels(t,e){const r=this.renderer;if(!r)throw new Error("The CanvasExtract has already been destroyed");let n,s,a;t&&(t instanceof _r?a=t:(a=r.generateTexture(t,{region:e,resolution:r.resolution}),e&&(ni.width=e.width,ni.height=e.height,e=ni))),a?(n=a.baseTexture._canvasRenderTarget.context,s=a.baseTexture._canvasRenderTarget.resolution,e=e??a.frame):(n=r.canvasContext.rootContext,s=r.resolution,e||(e=ni,e.width=r.width/s,e.height=r.height/s));const h=Math.round(e.x*s),u=Math.round(e.y*s),c=Math.max(Math.round(e.width*s),1),m=Math.max(Math.round(e.height*s),1);return n.getImageData(h,u,c,m).data}destroy(){this.renderer=null}}pp.extension={name:"extract",type:ut.CanvasRendererSystem};mt.add(pp);let fh;const Vn=new qt;yi.prototype.generateCanvasTexture=function(i,t=1){const e=this.getLocalBounds(new It);e.width=Math.max(e.width,1/t),e.height=Math.max(e.height,1/t);const r=_r.create({width:e.width,height:e.height,scaleMode:i,resolution:t});fh||(fh=new ta),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(Vn),Vn.invert(),Vn.tx-=e.x,Vn.ty-=e.y,fh.render(this,{renderTexture:r,clear:!0,transform:Vn});const n=pt.from(r.baseTexture._canvasRenderTarget.canvas,{scaleMode:i});return n.baseTexture.setResolution(t),n};yi.prototype.cachedGraphicsData=[];yi.prototype._renderCanvas=function(i){this.isMask!==!0&&(this.finishPoly(),i.plugins.graphics.render(this))};class ls{static offsetPolygon(t,e){const r=[],n=t.length;e=ls.isPolygonClockwise(t)?e:-1*e;for(let s=0;s<n;s+=2){let a=s-2;a<0&&(a+=n);const h=(s+2)%n;let u=t[s]-t[a],c=t[s+1]-t[a+1],m=Math.sqrt(u*u+c*c);u/=m,c/=m,u*=e,c*=e;const y=-c,v=u,b=[t[a]+y,t[a+1]+v],T=[t[s]+y,t[s+1]+v];let E=t[h]-t[s],P=t[h+1]-t[s+1];m=Math.sqrt(E*E+P*P),E/=m,P/=m,E*=e,P*=e;const M=-P,D=E,R=[t[s]+M,t[s+1]+D],N=[t[h]+M,t[h+1]+D],Y=ls.findIntersection(b[0],b[1],T[0],T[1],R[0],R[1],N[0],N[1]);Y&&r.push(...Y)}return r}static findIntersection(t,e,r,n,s,a,h,u){const c=(u-a)*(r-t)-(h-s)*(n-e),m=(h-s)*(e-a)-(u-a)*(t-s),y=(r-t)*(e-a)-(n-e)*(t-s);if(c===0)return m===0&&y===0?[(t+r)/2,(e+n)/2]:null;const v=m/c;return[t+v*(r-t),e+v*(n-e)]}static isPolygonClockwise(t){let e=0;for(let r=0,n=t.length-2;r<t.length;n=r,r+=2)e+=(t[r]-t[n])*(t[r+1]+t[n+1]);return e>0}}class mp{constructor(t){this._svgMatrix=null,this._tempMatrix=new qt,this.renderer=t}_calcCanvasStyle(t,e){let r;return t.texture&&t.texture.baseTexture!==pt.WHITE.baseTexture?t.texture.valid?(r=Ce.getTintedPattern(t.texture,e),this.setPatternTransform(r,t.matrix||qt.IDENTITY)):r="#808080":r=`#${`00000${(e|0).toString(16)}`.slice(-6)}`,r}render(t){const e=this.renderer,r=e.canvasContext.activeContext,n=t.worldAlpha,s=t.transform.worldTransform;e.canvasContext.setContextTransform(s),e.canvasContext.setBlendMode(t.blendMode);const a=t.geometry.graphicsData;let h,u;const c=kt.shared.setValue(t.tint).toArray();for(let m=0;m<a.length;m++){const y=a[m],v=y.shape,b=y.fillStyle,T=y.lineStyle,E=y.fillStyle.color|0,P=y.lineStyle.color|0;if(y.matrix&&e.canvasContext.setContextTransform(s.copyTo(this._tempMatrix).append(y.matrix)),b.visible&&(h=this._calcCanvasStyle(b,kt.shared.setValue(E).multiply(c).toNumber())),T.visible&&(u=this._calcCanvasStyle(T,kt.shared.setValue(P).multiply(c).toNumber())),r.lineWidth=T.width,r.lineCap=T.cap,r.lineJoin=T.join,r.miterLimit=T.miterLimit,y.type===ne.POLY){r.beginPath();const M=v;let D=M.points;const R=y.holes;let N,Y,X,K,q;r.moveTo(D[0],D[1]);for(let j=2;j<D.length;j+=2)r.lineTo(D[j],D[j+1]);if(M.closeStroke&&r.closePath(),R.length>0){q=[],N=0,X=D[0],K=D[1];for(let j=2;j+2<D.length;j+=2)N+=(D[j]-X)*(D[j+3]-K)-(D[j+2]-X)*(D[j+1]-K);for(let j=0;j<R.length;j++)if(D=R[j].shape.points,!!D){Y=0,X=D[0],K=D[1];for(let st=2;st+2<D.length;st+=2)Y+=(D[st]-X)*(D[st+3]-K)-(D[st+2]-X)*(D[st+1]-K);if(Y*N<0){r.moveTo(D[0],D[1]);for(let st=2;st<D.length;st+=2)r.lineTo(D[st],D[st+1])}else{r.moveTo(D[D.length-2],D[D.length-1]);for(let st=D.length-4;st>=0;st-=2)r.lineTo(D[st],D[st+1])}R[j].shape.closeStroke&&r.closePath(),q[j]=Y*N<0}}b.visible&&(r.globalAlpha=b.alpha*n,r.fillStyle=h,r.fill()),T.visible&&this.paintPolygonStroke(M,T,u,R,q,n,r)}else if(y.type===ne.RECT){const M=v;if(b.visible&&(r.globalAlpha=b.alpha*n,r.fillStyle=h,r.fillRect(M.x,M.y,M.width,M.height)),T.visible){const D=T.width*(.5-(1-T.alignment)),R=M.width+2*D,N=M.height+2*D;r.globalAlpha=T.alpha*n,r.strokeStyle=u,r.strokeRect(M.x-D,M.y-D,R,N)}}else if(y.type===ne.CIRC){const M=v;if(r.beginPath(),r.arc(M.x,M.y,M.radius,0,2*Math.PI),r.closePath(),b.visible&&(r.globalAlpha=b.alpha*n,r.fillStyle=h,r.fill()),T.visible){if(T.alignment!==.5){const D=T.width*(.5-(1-T.alignment));r.beginPath(),r.arc(M.x,M.y,M.radius+D,0,2*Math.PI),r.closePath()}r.globalAlpha=T.alpha*n,r.strokeStyle=u,r.stroke()}}else if(y.type===ne.ELIP){const M=v,D=T.alignment===1;if(D||this.paintEllipse(M,b,T,h,n,r),T.visible){if(T.alignment!==.5){const R=.5522848,N=T.width*(.5-(1-T.alignment)),Y=(M.width+N)*2,X=(M.height+N)*2,K=M.x-Y/2,q=M.y-X/2,j=Y/2*R,st=X/2*R,yt=K+Y,$=q+X,H=K+Y/2,z=q+X/2;r.beginPath(),r.moveTo(K,z),r.bezierCurveTo(K,z-st,H-j,q,H,q),r.bezierCurveTo(H+j,q,yt,z-st,yt,z),r.bezierCurveTo(yt,z+st,H+j,$,H,$),r.bezierCurveTo(H-j,$,K,z+st,K,z),r.closePath()}r.globalAlpha=T.alpha*n,r.strokeStyle=u,r.stroke()}D&&this.paintEllipse(M,b,T,h,n,r)}else if(y.type===ne.RREC){const M=v,D=T.alignment===1;if(D||this.paintRoundedRectangle(M,b,T,h,n,r),T.visible){if(T.alignment!==.5){const R=M.width,N=M.height,Y=T.width*(.5-(1-T.alignment)),X=M.x-Y,K=M.y-Y,q=M.width+2*Y,j=M.height+2*Y,st=Y*(T.alignment>=1?Math.min(q/R,j/N):Math.min(R/q,N/j));let yt=M.radius+st;const $=Math.min(q,j)/2;yt=yt>$?$:yt,r.beginPath(),r.moveTo(X,K+yt),r.lineTo(X,K+j-yt),r.quadraticCurveTo(X,K+j,X+yt,K+j),r.lineTo(X+q-yt,K+j),r.quadraticCurveTo(X+q,K+j,X+q,K+j-yt),r.lineTo(X+q,K+yt),r.quadraticCurveTo(X+q,K,X+q-yt,K),r.lineTo(X+yt,K),r.quadraticCurveTo(X,K,X,K+yt),r.closePath()}r.globalAlpha=T.alpha*n,r.strokeStyle=u,r.stroke()}D&&this.paintRoundedRectangle(M,b,T,h,n,r)}}}paintPolygonStroke(t,e,r,n,s,a,h){if(e.alignment!==.5){const u=e.width*(.5-(1-e.alignment));let c=ls.offsetPolygon(t.points,u),m;h.beginPath(),h.moveTo(c[0],c[1]);for(let y=2;y<c.length;y+=2)h.lineTo(c[y],c[y+1]);t.closeStroke&&h.closePath();for(let y=0;y<n.length;y++){if(m=n[y].shape.points,c=ls.offsetPolygon(m,u),s[y]){h.moveTo(c[0],c[1]);for(let v=2;v<c.length;v+=2)h.lineTo(c[v],c[v+1])}else{h.moveTo(c[c.length-2],c[c.length-1]);for(let v=c.length-4;v>=0;v-=2)h.lineTo(c[v],c[v+1])}n[y].shape.closeStroke&&h.closePath()}}h.globalAlpha=e.alpha*a,h.strokeStyle=r,h.stroke()}paintEllipse(t,e,r,n,s,a){const h=t.width*2,u=t.height*2,c=t.x-h/2,m=t.y-u/2,y=.5522848,v=h/2*y,b=u/2*y,T=c+h,E=m+u,P=c+h/2,M=m+u/2;r.alignment===0&&a.save(),a.beginPath(),a.moveTo(c,M),a.bezierCurveTo(c,M-b,P-v,m,P,m),a.bezierCurveTo(P+v,m,T,M-b,T,M),a.bezierCurveTo(T,M+b,P+v,E,P,E),a.bezierCurveTo(P-v,E,c,M+b,c,M),a.closePath(),r.alignment===0&&a.clip(),e.visible&&(a.globalAlpha=e.alpha*s,a.fillStyle=n,a.fill()),r.alignment===0&&a.restore()}paintRoundedRectangle(t,e,r,n,s,a){const h=t.x,u=t.y,c=t.width,m=t.height;let y=t.radius;const v=Math.min(c,m)/2;y=y>v?v:y,r.alignment===0&&a.save(),a.beginPath(),a.moveTo(h,u+y),a.lineTo(h,u+m-y),a.quadraticCurveTo(h,u+m,h+y,u+m),a.lineTo(h+c-y,u+m),a.quadraticCurveTo(h+c,u+m,h+c,u+m-y),a.lineTo(h+c,u+y),a.quadraticCurveTo(h+c,u,h+c-y,u),a.lineTo(h+y,u),a.quadraticCurveTo(h,u,h,u+y),a.closePath(),r.alignment===0&&a.clip(),e.visible&&(a.globalAlpha=e.alpha*s,a.fillStyle=n,a.fill()),r.alignment===0&&a.restore()}setPatternTransform(t,e){if(this._svgMatrix!==!1){if(!this._svgMatrix){const r=document.createElementNS("http://www.w3.org/2000/svg","svg");if(r!=null&&r.createSVGMatrix&&(this._svgMatrix=r.createSVGMatrix()),!this._svgMatrix||!t.setTransform){this._svgMatrix=!1;return}}this._svgMatrix.a=e.a,this._svgMatrix.b=e.b,this._svgMatrix.c=e.c,this._svgMatrix.d=e.d,this._svgMatrix.e=e.tx,this._svgMatrix.f=e.ty,t.setTransform(this._svgMatrix.inverse())}}destroy(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null}}mp.extension={name:"graphics",type:ut.CanvasRendererPlugin};mt.add(mp);Object.defineProperties(ft,{MESH_CANVAS_PADDING:{get(){return Ue.defaultCanvasPadding},set(i){Ct("7.1.0","settings.MESH_CANVAS_PADDING is deprecated, use Mesh.defaultCanvasPadding"),Ue.defaultCanvasPadding=i}}});vn.prototype._renderCanvas=function(i,t){i.plugins.mesh.render(t)};sa.prototype._cachedTint=16777215;sa.prototype._tintedCanvas=null;sa.prototype._canvasUvs=null;sa.prototype._renderCanvas=function(i){const t=i.canvasContext.activeContext,e=this.worldTransform,r=this.tintValue!==16777215,n=this.texture;if(!n.valid)return;r&&this._cachedTint!==this.tintValue&&(this._cachedTint=this.tintValue,this._tintedCanvas=Ce.getTintedCanvas(this,this.tintValue));const s=r?this._tintedCanvas:n.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);const a=this.vertices,h=this._canvasUvs,u=r?0:n.frame.x,c=r?0:n.frame.y,m=u+n.frame.width,y=c+n.frame.height;h[0]=u,h[1]=u+this._leftWidth,h[2]=m-this._rightWidth,h[3]=m,h[4]=c,h[5]=c+this._topHeight,h[6]=y-this._bottomHeight,h[7]=y;for(let v=0;v<8;v++)h[v]*=n.baseTexture.resolution;t.globalAlpha=this.worldAlpha,i.canvasContext.setBlendMode(this.blendMode),i.canvasContext.setContextTransform(e,this.roundPixels);for(let v=0;v<3;v++)for(let b=0;b<3;b++){const T=b*2+v*8,E=Math.max(1,h[b+1]-h[b]),P=Math.max(1,h[v+5]-h[v+4]),M=Math.max(1,a[T+10]-a[T]),D=Math.max(1,a[T+11]-a[T+1]);t.drawImage(s,h[b],h[v+4],E,P,a[T],a[T+1],M,D)}};let sd=!1;Ue.prototype._cachedTint=16777215;Ue.prototype._tintedCanvas=null;Ue.prototype._cachedTexture=null;Ue.prototype._renderCanvas=function(i){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(i,this):sd||(sd=!0,globalThis.console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))};Ue.prototype._canvasPadding=null;Ue.defaultCanvasPadding=0;Object.defineProperty(Ue.prototype,"canvasPadding",{get(){return this._canvasPadding??Ue.defaultCanvasPadding},set(i){this._canvasPadding=i}});lb.prototype._renderCanvas=function(i){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(i,this)};ub.prototype._renderCanvas=function(i){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(i,this)};class gp{constructor(t){this.renderer=t}render(t){const e=this.renderer,r=t.worldTransform;e.canvasContext.activeContext.globalAlpha=t.worldAlpha,e.canvasContext.setBlendMode(t.blendMode),e.canvasContext.setContextTransform(r,t.roundPixels),t.drawMode!==pr.TRIANGLES?this._renderTriangleMesh(t):this._renderTriangles(t)}_renderTriangleMesh(t){const e=t.geometry.buffers[0].data.length;for(let r=0;r<e-2;r++){const n=r*2;this._renderDrawTriangle(t,n,n+2,n+4)}}_renderTriangles(t){const e=t.geometry.getIndex().data,r=e.length;for(let n=0;n<r;n+=3){const s=e[n]*2,a=e[n+1]*2,h=e[n+2]*2;this._renderDrawTriangle(t,s,a,h)}}_renderDrawTriangle(t,e,r,n){var St;const s=this.renderer.canvasContext.activeContext,a=t.geometry.buffers[0].data,{uvs:h,texture:u}=t;if(!u.valid)return;const c=t.tintValue!==16777215,m=u.baseTexture,y=m.width,v=m.height;t._cachedTexture&&t._cachedTexture.baseTexture!==m&&(t._cachedTint=16777215,(St=t._cachedTexture)==null||St.destroy(),t._cachedTexture=null,t._tintedCanvas=null),c&&t._cachedTint!==t.tintValue&&(t._cachedTint=t.tintValue,t._cachedTexture=t._cachedTexture||new pt(m),t._tintedCanvas=Ce.getTintedCanvas({texture:t._cachedTexture},t.tintValue));const b=c?t._tintedCanvas:m.getDrawableSource(),T=h[e]*m.width,E=h[r]*m.width,P=h[n]*m.width,M=h[e+1]*m.height,D=h[r+1]*m.height,R=h[n+1]*m.height;let N=a[e],Y=a[r],X=a[n],K=a[e+1],q=a[r+1],j=a[n+1];const st=t.canvasPadding/this.renderer.canvasContext.activeResolution;if(st>0){const{a:Kt,b:lt,c:ct,d:Mt}=t.worldTransform,Dt=(N+Y+X)/3,Gt=(K+q+j)/3;let zt=N-Dt,Nt=K-Gt,Zt=Kt*zt+ct*Nt,te=lt*zt+Mt*Nt,de=Math.sqrt(Zt*Zt+te*te),Qt=1+st/de;N=Dt+zt*Qt,K=Gt+Nt*Qt,zt=Y-Dt,Nt=q-Gt,Zt=Kt*zt+ct*Nt,te=lt*zt+Mt*Nt,de=Math.sqrt(Zt*Zt+te*te),Qt=1+st/de,Y=Dt+zt*Qt,q=Gt+Nt*Qt,zt=X-Dt,Nt=j-Gt,Zt=Kt*zt+ct*Nt,te=lt*zt+Mt*Nt,de=Math.sqrt(Zt*Zt+te*te),Qt=1+st/de,X=Dt+zt*Qt,j=Gt+Nt*Qt}s.save(),s.beginPath(),s.moveTo(N,K),s.lineTo(Y,q),s.lineTo(X,j),s.closePath(),s.clip();const yt=T*D+M*P+E*R-D*P-M*E-T*R,$=N*D+M*X+Y*R-D*X-M*Y-N*R,H=T*Y+N*P+E*X-Y*P-N*E-T*X,z=T*D*X+M*Y*P+N*E*R-N*D*P-M*E*X-T*Y*R,vt=K*D+M*j+q*R-D*j-M*q-K*R,Pt=T*q+K*P+E*j-q*P-K*E-T*j,dt=T*D*j+M*q*P+K*E*R-K*D*P-M*E*j-T*q*R;s.transform($/yt,vt/yt,H/yt,Pt/yt,z/yt,dt/yt),s.drawImage(b,0,0,y*m.resolution,v*m.resolution,0,0,y,v),s.restore(),this.renderer.canvasContext.invalidateBlendMode()}renderMeshFlat(t){const e=this.renderer.canvasContext.activeContext,r=t.geometry.getBuffer("aVertexPosition").data,n=r.length/2;e.beginPath();for(let s=1;s<n-2;++s){const a=s*2,h=r[a],u=r[a+1],c=r[a+2],m=r[a+3],y=r[a+4],v=r[a+5];e.moveTo(h,u),e.lineTo(c,m),e.lineTo(y,v)}e.fillStyle="#FF0000",e.fill(),e.closePath()}destroy(){this.renderer=null}}gp.extension={name:"mesh",type:ut.CanvasRendererPlugin};mt.add(gp);const od=16;function Fb(i,t){const e=i;if(t instanceof Rt){const r=t.source,n=r.width===0?e.canvas.width:Math.min(e.canvas.width,r.width),s=r.height===0?e.canvas.height:Math.min(e.canvas.height,r.height);return e.ctx.drawImage(r,0,0,n,s,0,0,e.canvas.width,e.canvas.height),!0}return!1}class yp extends Go{constructor(t){super(t),this.uploadHookHelper=this,this.canvas=ft.ADAPTER.createCanvas(od,od),this.ctx=this.canvas.getContext("2d"),this.registerUploadHook(Fb)}destroy(){super.destroy(),this.ctx=null,this.canvas=null}}yp.extension={name:"prepare",type:ut.CanvasRendererSystem};mt.add(yp);Ie.prototype._tintedCanvas=null;Ie.prototype._renderCanvas=function(i){i.plugins.sprite.render(this)};const ad=new qt;class vp{constructor(t){this.renderer=t}render(t){const e=t._texture,r=this.renderer,n=r.canvasContext.activeContext,s=r.canvasContext.activeResolution;if(!e.valid)return;const a=e._frame.width,h=e._frame.height;let u=e._frame.width,c=e._frame.height;e.trim&&(u=e.trim.width,c=e.trim.height);let m=t.transform.worldTransform,y=0,v=0;const b=e.baseTexture.getDrawableSource();if(e.orig.width<=0||e.orig.height<=0||!e.valid||!b)return;r.canvasContext.setBlendMode(t.blendMode,!0),n.globalAlpha=t.worldAlpha;const T=e.baseTexture.scaleMode===mr.LINEAR,E=r.canvasContext.smoothProperty;E&&n[E]!==T&&(n[E]=T),e.trim?(y=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,v=e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(y=(.5-t.anchor.x)*e.orig.width,v=(.5-t.anchor.y)*e.orig.height),e.rotate&&(m.copyTo(ad),m=ad,oe.matrixAppendRotationInv(m,e.rotate,y,v),y=0,v=0),y-=u/2,v-=c/2,r.canvasContext.setContextTransform(m,t.roundPixels,1),t.roundPixels&&(y=y|0,v=v|0);const P=e.baseTexture.resolution,M=r.canvasContext._outerBlend;M&&(n.save(),n.beginPath(),n.rect(y*s,v*s,u*s,c*s),n.clip()),t.tint!==16777215?((t._cachedTint!==t.tintValue||t._tintedCanvas.tintId!==t._texture._updateID)&&(t._cachedTint=t.tintValue,t._tintedCanvas=Ce.getTintedCanvas(t,t.tintValue)),n.drawImage(t._tintedCanvas,0,0,Math.floor(a*P),Math.floor(h*P),Math.floor(y*s),Math.floor(v*s),Math.floor(u*s),Math.floor(c*s))):n.drawImage(b,e._frame.x*P,e._frame.y*P,Math.floor(a*P),Math.floor(h*P),Math.floor(y*s),Math.floor(v*s),Math.floor(u*s),Math.floor(c*s)),M&&n.restore(),r.canvasContext.setBlendMode(rt.NORMAL)}destroy(){this.renderer=null}}vp.extension={name:"sprite",type:ut.CanvasRendererPlugin};mt.add(vp);var fl=(()=>{var i=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(i=i||__filename),function(t={}){var e=t,r,n;e.ready=new Promise((o,l)=>{r=o,n=l}),function(o){o.pe=o.pe||[],o.pe.push(function(){o.MakeSWCanvasSurface=function(l){var d=l,g=typeof OffscreenCanvas<"u"&&d instanceof OffscreenCanvas;if(!(typeof HTMLCanvasElement<"u"&&d instanceof HTMLCanvasElement||g||(d=document.getElementById(l),d)))throw"Canvas with id "+l+" was not found";return(l=o.MakeSurface(d.width,d.height))&&(l.ie=d),l},o.MakeCanvasSurface||(o.MakeCanvasSurface=o.MakeSWCanvasSurface),o.MakeSurface=function(l,d){var g={width:l,height:d,colorType:o.ColorType.RGBA_8888,alphaType:o.AlphaType.Unpremul,colorSpace:o.ColorSpace.SRGB},x=l*d*4,S=o._malloc(x);return(g=o.Surface._makeRasterDirect(g,S,4*l))&&(g.ie=null,g.cg=l,g.Zf=d,g.ag=x,g.Cf=S,g.getCanvas().clear(o.TRANSPARENT)),g},o.MakeRasterDirectSurface=function(l,d,g){return o.Surface._makeRasterDirect(l,d.byteOffset,g)},o.Surface.prototype.flush=function(l){if(o.je(this.he),this._flush(),this.ie){var d=new Uint8ClampedArray(o.HEAPU8.buffer,this.Cf,this.ag);d=new ImageData(d,this.cg,this.Zf),l?this.ie.getContext("2d").putImageData(d,0,0,l[0],l[1],l[2]-l[0],l[3]-l[1]):this.ie.getContext("2d").putImageData(d,0,0)}},o.Surface.prototype.dispose=function(){this.Cf&&o._free(this.Cf),this.delete()},o.je=o.je||function(){},o.tf=o.tf||function(){return null}})}(e),function(o){o.pe=o.pe||[],o.pe.push(function(){function l(C,I,k){return C&&C.hasOwnProperty(I)?C[I]:k}function d(C){var I=Ti(er);return er[I]=C,I}function g(C){return C.naturalHeight||C.videoHeight||C.displayHeight||C.height}function x(C){return C.naturalWidth||C.videoWidth||C.displayWidth||C.width}function S(C,I,k,tt){return C.bindTexture(C.TEXTURE_2D,I),tt||k.alphaType!==o.AlphaType.Premul||C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),I}function L(C,I,k){k||I.alphaType!==o.AlphaType.Premul||C.pixelStorei(C.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),C.bindTexture(C.TEXTURE_2D,null)}o.GetWebGLContext=function(C,I){if(!C)throw"null canvas passed into makeWebGLContext";var k={alpha:l(I,"alpha",1),depth:l(I,"depth",1),stencil:l(I,"stencil",8),antialias:l(I,"antialias",0),premultipliedAlpha:l(I,"premultipliedAlpha",1),preserveDrawingBuffer:l(I,"preserveDrawingBuffer",0),preferLowPowerToHighPerformance:l(I,"preferLowPowerToHighPerformance",0),failIfMajorPerformanceCaveat:l(I,"failIfMajorPerformanceCaveat",0),enableExtensionsByDefault:l(I,"enableExtensionsByDefault",1),explicitSwapControl:l(I,"explicitSwapControl",0),renderViaOffscreenBackBuffer:l(I,"renderViaOffscreenBackBuffer",0)};if(k.majorVersion=I&&I.majorVersion?I.majorVersion:typeof WebGL2RenderingContext<"u"?2:1,k.explicitSwapControl)throw"explicitSwapControl is not supported";return C=Vp(C,k),C?(eu(C),Bt.De.getExtension("WEBGL_debug_renderer_info"),C):0},o.deleteContext=function(C){Bt===Er[C]&&(Bt=null),typeof JSEvents=="object"&&JSEvents.Vg(Er[C].De.canvas),Er[C]&&Er[C].De.canvas&&(Er[C].De.canvas.Xf=void 0),Er[C]=null},o._setTextureCleanup({deleteTexture:function(C,I){var k=er[I];k&&Er[C].De.deleteTexture(k),er[I]=null}}),o.MakeWebGLContext=function(C){if(!this.je(C))return null;var I=this._MakeGrContext();if(!I)return null;I.he=C;var k=I.delete.bind(I);return I.delete=(function(){o.je(this.he),k()}).bind(I),Bt.Gf=I},o.MakeGrContext=o.MakeWebGLContext,o.GrDirectContext.prototype.getResourceCacheLimitBytes=function(){o.je(this.he),this._getResourceCacheLimitBytes()},o.GrDirectContext.prototype.getResourceCacheUsageBytes=function(){o.je(this.he),this._getResourceCacheUsageBytes()},o.GrDirectContext.prototype.releaseResourcesAndAbandonContext=function(){o.je(this.he),this._releaseResourcesAndAbandonContext()},o.GrDirectContext.prototype.setResourceCacheLimitBytes=function(C){o.je(this.he),this._setResourceCacheLimitBytes(C)},o.MakeOnScreenGLSurface=function(C,I,k,tt,it,_t){return!this.je(C.he)||(I=it===void 0||_t===void 0?this._MakeOnScreenGLSurface(C,I,k,tt):this._MakeOnScreenGLSurface(C,I,k,tt,it,_t),!I)?null:(I.he=C.he,I)},o.MakeRenderTarget=function(){var C=arguments[0];if(!this.je(C.he))return null;if(arguments.length===3){var I=this._MakeRenderTargetWH(C,arguments[1],arguments[2]);if(!I)return null}else if(arguments.length===2){if(I=this._MakeRenderTargetII(C,arguments[1]),!I)return null}else return null;return I.he=C.he,I},o.MakeWebGLCanvasSurface=function(C,I,k){I=I||null;var tt=C,it=typeof OffscreenCanvas<"u"&&tt instanceof OffscreenCanvas;if(!(typeof HTMLCanvasElement<"u"&&tt instanceof HTMLCanvasElement||it||(tt=document.getElementById(C),tt)))throw"Canvas with id "+C+" was not found";if(C=this.GetWebGLContext(tt,k),!C||0>C)throw"failed to create webgl context: err "+C;return C=this.MakeWebGLContext(C),I=this.MakeOnScreenGLSurface(C,tt.width,tt.height,I),I||(I=tt.cloneNode(!0),tt.parentNode.replaceChild(I,tt),I.classList.add("ck-replaced"),o.MakeSWCanvasSurface(I))},o.MakeCanvasSurface=o.MakeWebGLCanvasSurface,o.Surface.prototype.makeImageFromTexture=function(C,I){return o.je(this.he),C=d(C),(I=this._makeImageFromTexture(this.he,C,I))&&(I.jf=C),I},o.Surface.prototype.makeImageFromTextureSource=function(C,I,k){I||(I={height:g(C),width:x(C),colorType:o.ColorType.RGBA_8888,alphaType:k?o.AlphaType.Premul:o.AlphaType.Unpremul}),I.colorSpace||(I.colorSpace=o.ColorSpace.SRGB),o.je(this.he);var tt=Bt.De;return k=S(tt,tt.createTexture(),I,k),Bt.version===2?tt.texImage2D(tt.TEXTURE_2D,0,tt.RGBA,I.width,I.height,0,tt.RGBA,tt.UNSIGNED_BYTE,C):tt.texImage2D(tt.TEXTURE_2D,0,tt.RGBA,tt.RGBA,tt.UNSIGNED_BYTE,C),L(tt,I),this._resetContext(),this.makeImageFromTexture(k,I)},o.Surface.prototype.updateTextureFromSource=function(C,I,k){if(C.jf){o.je(this.he);var tt=C.getImageInfo(),it=Bt.De,_t=S(it,er[C.jf],tt,k);Bt.version===2?it.texImage2D(it.TEXTURE_2D,0,it.RGBA,x(I),g(I),0,it.RGBA,it.UNSIGNED_BYTE,I):it.texImage2D(it.TEXTURE_2D,0,it.RGBA,it.RGBA,it.UNSIGNED_BYTE,I),L(it,tt,k),this._resetContext(),er[C.jf]=null,C.jf=d(_t),tt.colorSpace=C.getColorSpace(),I=this._makeImageFromTexture(this.he,C.jf,tt),k=C.ge.oe,it=C.ge.ve,C.ge.oe=I.ge.oe,C.ge.ve=I.ge.ve,I.ge.oe=k,I.ge.ve=it,I.delete(),tt.colorSpace.delete()}},o.MakeLazyImageFromTextureSource=function(C,I,k){I||(I={height:g(C),width:x(C),colorType:o.ColorType.RGBA_8888,alphaType:k?o.AlphaType.Premul:o.AlphaType.Unpremul}),I.colorSpace||(I.colorSpace=o.ColorSpace.SRGB);var tt={makeTexture:function(){var it=Bt,_t=it.De,W=S(_t,_t.createTexture(),I,k);return it.version===2?_t.texImage2D(_t.TEXTURE_2D,0,_t.RGBA,I.width,I.height,0,_t.RGBA,_t.UNSIGNED_BYTE,C):_t.texImage2D(_t.TEXTURE_2D,0,_t.RGBA,_t.RGBA,_t.UNSIGNED_BYTE,C),L(_t,I,k),d(W)},freeSrc:function(){}};return C.constructor.name==="VideoFrame"&&(tt.freeSrc=function(){C.close()}),o.Image._makeFromGenerator(I,tt)},o.je=function(C){return C?eu(C):!1},o.tf=function(){return Bt&&Bt.Gf&&!Bt.Gf.isDeleted()?Bt.Gf:null}})}(e),function(o){function l(p,f,_,A,B){for(var G=0;G<p.length;G++)f[G*_+(G*B+A+_)%_]=p[G];return f}function d(p){for(var f=p*p,_=Array(f);f--;)_[f]=f%(p+1)===0?1:0;return _}function g(p){return p?p.constructor===Float32Array&&p.length===4:!1}function x(p){return(C(255*p[3])<<24|C(255*p[0])<<16|C(255*p[1])<<8|C(255*p[2])<<0)>>>0}function S(p){if(p&&p._ck)return p;if(p instanceof Float32Array){for(var f=Math.floor(p.length/4),_=new Uint32Array(f),A=0;A<f;A++)_[A]=x(p.slice(4*A,4*(A+1)));return _}if(p instanceof Uint32Array)return p;if(p instanceof Array&&p[0]instanceof Float32Array)return p.map(x)}function L(p){if(p===void 0)return 1;var f=parseFloat(p);return p&&p.indexOf("%")!==-1?f/100:f}function C(p){return Math.round(Math.max(0,Math.min(p||0,255)))}function I(p,f){f&&f._ck||o._free(p)}function k(p,f,_){if(!p||!p.length)return Ht;if(p&&p._ck)return p.byteOffset;var A=o[f].BYTES_PER_ELEMENT;return _||(_=o._malloc(p.length*A)),o[f].set(p,_/A),_}function tt(p){var f={ze:Ht,count:p.length,colorType:o.ColorType.RGBA_F32};if(p instanceof Float32Array)f.ze=k(p,"HEAPF32"),f.count=p.length/4;else if(p instanceof Uint32Array)f.ze=k(p,"HEAPU32"),f.colorType=o.ColorType.RGBA_8888;else if(p instanceof Array){if(p&&p.length){for(var _=o._malloc(16*p.length),A=0,B=_/4,G=0;G<p.length;G++)for(var J=0;4>J;J++)o.HEAPF32[B+A]=p[G][J],A++;p=_}else p=Ht;f.ze=p}else throw"Invalid argument to copyFlexibleColorArray, Not a color array "+typeof p;return f}function it(p){if(!p)return Ht;var f=va.toTypedArray();if(p.length){if(p.length===6||p.length===9)return k(p,"HEAPF32",Wr),p.length===6&&o.HEAPF32.set(gm,6+Wr/4),Wr;if(p.length===16)return f[0]=p[0],f[1]=p[1],f[2]=p[3],f[3]=p[4],f[4]=p[5],f[5]=p[7],f[6]=p[12],f[7]=p[13],f[8]=p[15],Wr;throw"invalid matrix size"}if(p.m11===void 0)throw"invalid matrix argument";return f[0]=p.m11,f[1]=p.m21,f[2]=p.m41,f[3]=p.m12,f[4]=p.m22,f[5]=p.m42,f[6]=p.m14,f[7]=p.m24,f[8]=p.m44,Wr}function _t(p){if(!p)return Ht;var f=_a.toTypedArray();if(p.length){if(p.length!==16&&p.length!==6&&p.length!==9)throw"invalid matrix size";return p.length===16?k(p,"HEAPF32",$i):(f.fill(0),f[0]=p[0],f[1]=p[1],f[3]=p[2],f[4]=p[3],f[5]=p[4],f[7]=p[5],f[10]=1,f[12]=p[6],f[13]=p[7],f[15]=p[8],p.length===6&&(f[12]=0,f[13]=0,f[15]=1),$i)}if(p.m11===void 0)throw"invalid matrix argument";return f[0]=p.m11,f[1]=p.m21,f[2]=p.m31,f[3]=p.m41,f[4]=p.m12,f[5]=p.m22,f[6]=p.m32,f[7]=p.m42,f[8]=p.m13,f[9]=p.m23,f[10]=p.m33,f[11]=p.m43,f[12]=p.m14,f[13]=p.m24,f[14]=p.m34,f[15]=p.m44,$i}function W(p,f){return k(p,"HEAPF32",f||Sr)}function xt(p,f,_,A){var B=xa.toTypedArray();return B[0]=p,B[1]=f,B[2]=_,B[3]=A,Sr}function Ot(p){for(var f=new Float32Array(4),_=0;4>_;_++)f[_]=o.HEAPF32[p/4+_];return f}function Ft(p,f){return k(p,"HEAPF32",f||ee)}function Ge(p,f){return k(p,"HEAPF32",f||wa)}function Re(){for(var p=0,f=0;f<arguments.length-1;f+=2)p+=arguments[f]*arguments[f+1];return p}function In(p,f,_){for(var A=Array(p.length),B=0;B<_;B++)for(var G=0;G<_;G++){for(var J=0,ht=0;ht<_;ht++)J+=p[_*B+ht]*f[_*ht+G];A[B*_+G]=J}return A}function Fn(p,f){for(var _=In(f[0],f[1],p),A=2;A<f.length;)_=In(_,f[A],p),A++;return _}o.Color=function(p,f,_,A){return A===void 0&&(A=1),o.Color4f(C(p)/255,C(f)/255,C(_)/255,A)},o.ColorAsInt=function(p,f,_,A){return A===void 0&&(A=255),(C(A)<<24|C(p)<<16|C(f)<<8|C(_)<<0&268435455)>>>0},o.Color4f=function(p,f,_,A){return A===void 0&&(A=1),Float32Array.of(p,f,_,A)},Object.defineProperty(o,"TRANSPARENT",{get:function(){return o.Color4f(0,0,0,0)}}),Object.defineProperty(o,"BLACK",{get:function(){return o.Color4f(0,0,0,1)}}),Object.defineProperty(o,"WHITE",{get:function(){return o.Color4f(1,1,1,1)}}),Object.defineProperty(o,"RED",{get:function(){return o.Color4f(1,0,0,1)}}),Object.defineProperty(o,"GREEN",{get:function(){return o.Color4f(0,1,0,1)}}),Object.defineProperty(o,"BLUE",{get:function(){return o.Color4f(0,0,1,1)}}),Object.defineProperty(o,"YELLOW",{get:function(){return o.Color4f(1,1,0,1)}}),Object.defineProperty(o,"CYAN",{get:function(){return o.Color4f(0,1,1,1)}}),Object.defineProperty(o,"MAGENTA",{get:function(){return o.Color4f(1,0,1,1)}}),o.getColorComponents=function(p){return[Math.floor(255*p[0]),Math.floor(255*p[1]),Math.floor(255*p[2]),p[3]]},o.parseColorString=function(p,f){if(p=p.toLowerCase(),p.startsWith("#")){switch(f=255,p.length){case 9:f=parseInt(p.slice(7,9),16);case 7:var _=parseInt(p.slice(1,3),16),A=parseInt(p.slice(3,5),16),B=parseInt(p.slice(5,7),16);break;case 5:f=17*parseInt(p.slice(4,5),16);case 4:_=17*parseInt(p.slice(1,2),16),A=17*parseInt(p.slice(2,3),16),B=17*parseInt(p.slice(3,4),16)}return o.Color(_,A,B,f/255)}return p.startsWith("rgba")?(p=p.slice(5,-1),p=p.split(","),o.Color(+p[0],+p[1],+p[2],L(p[3]))):p.startsWith("rgb")?(p=p.slice(4,-1),p=p.split(","),o.Color(+p[0],+p[1],+p[2],L(p[3]))):p.startsWith("gray(")||p.startsWith("hsl")||!f||(p=f[p],p===void 0)?o.BLACK:p},o.multiplyByAlpha=function(p,f){return p=p.slice(),p[3]=Math.max(0,Math.min(p[3]*f,1)),p},o.Malloc=function(p,f){var _=o._malloc(f*p.BYTES_PER_ELEMENT);return{_ck:!0,length:f,byteOffset:_,Pe:null,subarray:function(A,B){return A=this.toTypedArray().subarray(A,B),A._ck=!0,A},toTypedArray:function(){return this.Pe&&this.Pe.length?this.Pe:(this.Pe=new p(o.HEAPU8.buffer,_,f),this.Pe._ck=!0,this.Pe)}}},o.Free=function(p){o._free(p.byteOffset),p.byteOffset=Ht,p.toTypedArray=null,p.Pe=null};var Wr=Ht,va,$i=Ht,_a,Sr=Ht,xa,Le,ee=Ht,wu,Vr=Ht,ba,Wi=Ht,Au,Ta=Ht,ks,Bn=Ht,Eu,wa=Ht,Su,Cu=Ht,gm=Float32Array.of(0,0,1),Ht=0;o.onRuntimeInitialized=function(){function p(f,_,A,B,G,J,ht){J||(J=4*B.width,B.colorType===o.ColorType.RGBA_F16?J*=2:B.colorType===o.ColorType.RGBA_F32&&(J*=4));var Tt=J*B.height,At=G?G.byteOffset:o._malloc(Tt);if(ht?!f._readPixels(B,At,J,_,A,ht):!f._readPixels(B,At,J,_,A))return G||o._free(At),null;if(G)return G.toTypedArray();switch(B.colorType){case o.ColorType.RGBA_8888:case o.ColorType.RGBA_F16:f=new Uint8Array(o.HEAPU8.buffer,At,Tt).slice();break;case o.ColorType.RGBA_F32:f=new Float32Array(o.HEAPU8.buffer,At,Tt).slice();break;default:return null}return o._free(At),f}xa=o.Malloc(Float32Array,4),Sr=xa.byteOffset,_a=o.Malloc(Float32Array,16),$i=_a.byteOffset,va=o.Malloc(Float32Array,9),Wr=va.byteOffset,Eu=o.Malloc(Float32Array,12),wa=Eu.byteOffset,Su=o.Malloc(Float32Array,12),Cu=Su.byteOffset,Le=o.Malloc(Float32Array,4),ee=Le.byteOffset,wu=o.Malloc(Float32Array,4),Vr=wu.byteOffset,ba=o.Malloc(Float32Array,3),Wi=ba.byteOffset,Au=o.Malloc(Float32Array,3),Ta=Au.byteOffset,ks=o.Malloc(Int32Array,4),Bn=ks.byteOffset,o.ColorSpace.SRGB=o.ColorSpace._MakeSRGB(),o.ColorSpace.DISPLAY_P3=o.ColorSpace._MakeDisplayP3(),o.ColorSpace.ADOBE_RGB=o.ColorSpace._MakeAdobeRGB(),o.GlyphRunFlags={IsWhiteSpace:o._GlyphRunFlags_isWhiteSpace},o.Path.MakeFromCmds=function(f){var _=k(f,"HEAPF32"),A=o.Path._MakeFromCmds(_,f.length);return I(_,f),A},o.Path.MakeFromVerbsPointsWeights=function(f,_,A){var B=k(f,"HEAPU8"),G=k(_,"HEAPF32"),J=k(A,"HEAPF32"),ht=o.Path._MakeFromVerbsPointsWeights(B,f.length,G,_.length,J,A&&A.length||0);return I(B,f),I(G,_),I(J,A),ht},o.Path.prototype.addArc=function(f,_,A){return f=Ft(f),this._addArc(f,_,A),this},o.Path.prototype.addCircle=function(f,_,A,B){return this._addCircle(f,_,A,!!B),this},o.Path.prototype.addOval=function(f,_,A){return A===void 0&&(A=1),f=Ft(f),this._addOval(f,!!_,A),this},o.Path.prototype.addPath=function(){var f=Array.prototype.slice.call(arguments),_=f[0],A=!1;if(typeof f[f.length-1]=="boolean"&&(A=f.pop()),f.length===1)this._addPath(_,1,0,0,0,1,0,0,0,1,A);else if(f.length===2)f=f[1],this._addPath(_,f[0],f[1],f[2],f[3],f[4],f[5],f[6]||0,f[7]||0,f[8]||1,A);else if(f.length===7||f.length===10)this._addPath(_,f[1],f[2],f[3],f[4],f[5],f[6],f[7]||0,f[8]||0,f[9]||1,A);else return null;return this},o.Path.prototype.addPoly=function(f,_){var A=k(f,"HEAPF32");return this._addPoly(A,f.length/2,_),I(A,f),this},o.Path.prototype.addRect=function(f,_){return f=Ft(f),this._addRect(f,!!_),this},o.Path.prototype.addRRect=function(f,_){return f=Ge(f),this._addRRect(f,!!_),this},o.Path.prototype.addVerbsPointsWeights=function(f,_,A){var B=k(f,"HEAPU8"),G=k(_,"HEAPF32"),J=k(A,"HEAPF32");this._addVerbsPointsWeights(B,f.length,G,_.length,J,A&&A.length||0),I(B,f),I(G,_),I(J,A)},o.Path.prototype.arc=function(f,_,A,B,G,J){return f=o.LTRBRect(f-A,_-A,f+A,_+A),G=(G-B)/Math.PI*180-360*!!J,J=new o.Path,J.addArc(f,B/Math.PI*180,G),this.addPath(J,!0),J.delete(),this},o.Path.prototype.arcToOval=function(f,_,A,B){return f=Ft(f),this._arcToOval(f,_,A,B),this},o.Path.prototype.arcToRotated=function(f,_,A,B,G,J,ht){return this._arcToRotated(f,_,A,!!B,!!G,J,ht),this},o.Path.prototype.arcToTangent=function(f,_,A,B,G){return this._arcToTangent(f,_,A,B,G),this},o.Path.prototype.close=function(){return this._close(),this},o.Path.prototype.conicTo=function(f,_,A,B,G){return this._conicTo(f,_,A,B,G),this},o.Path.prototype.computeTightBounds=function(f){this._computeTightBounds(ee);var _=Le.toTypedArray();return f?(f.set(_),f):_.slice()},o.Path.prototype.cubicTo=function(f,_,A,B,G,J){return this._cubicTo(f,_,A,B,G,J),this},o.Path.prototype.dash=function(f,_,A){return this._dash(f,_,A)?this:null},o.Path.prototype.getBounds=function(f){this._getBounds(ee);var _=Le.toTypedArray();return f?(f.set(_),f):_.slice()},o.Path.prototype.lineTo=function(f,_){return this._lineTo(f,_),this},o.Path.prototype.moveTo=function(f,_){return this._moveTo(f,_),this},o.Path.prototype.offset=function(f,_){return this._transform(1,0,f,0,1,_,0,0,1),this},o.Path.prototype.quadTo=function(f,_,A,B){return this._quadTo(f,_,A,B),this},o.Path.prototype.rArcTo=function(f,_,A,B,G,J,ht){return this._rArcTo(f,_,A,B,G,J,ht),this},o.Path.prototype.rConicTo=function(f,_,A,B,G){return this._rConicTo(f,_,A,B,G),this},o.Path.prototype.rCubicTo=function(f,_,A,B,G,J){return this._rCubicTo(f,_,A,B,G,J),this},o.Path.prototype.rLineTo=function(f,_){return this._rLineTo(f,_),this},o.Path.prototype.rMoveTo=function(f,_){return this._rMoveTo(f,_),this},o.Path.prototype.rQuadTo=function(f,_,A,B){return this._rQuadTo(f,_,A,B),this},o.Path.prototype.stroke=function(f){return f=f||{},f.width=f.width||1,f.miter_limit=f.miter_limit||4,f.cap=f.cap||o.StrokeCap.Butt,f.join=f.join||o.StrokeJoin.Miter,f.precision=f.precision||1,this._stroke(f)?this:null},o.Path.prototype.transform=function(){if(arguments.length===1){var f=arguments[0];this._transform(f[0],f[1],f[2],f[3],f[4],f[5],f[6]||0,f[7]||0,f[8]||1)}else if(arguments.length===6||arguments.length===9)f=arguments,this._transform(f[0],f[1],f[2],f[3],f[4],f[5],f[6]||0,f[7]||0,f[8]||1);else throw"transform expected to take 1 or 9 arguments. Got "+arguments.length;return this},o.Path.prototype.trim=function(f,_,A){return this._trim(f,_,!!A)?this:null},o.Image.prototype.encodeToBytes=function(f,_){var A=o.tf();return f=f||o.ImageFormat.PNG,_=_||100,A?this._encodeToBytes(f,_,A):this._encodeToBytes(f,_)},o.Image.prototype.makeShaderCubic=function(f,_,A,B,G){return G=it(G),this._makeShaderCubic(f,_,A,B,G)},o.Image.prototype.makeShaderOptions=function(f,_,A,B,G){return G=it(G),this._makeShaderOptions(f,_,A,B,G)},o.Image.prototype.readPixels=function(f,_,A,B,G){var J=o.tf();return p(this,f,_,A,B,G,J)},o.Canvas.prototype.clear=function(f){o.je(this.he),f=W(f),this._clear(f)},o.Canvas.prototype.clipRRect=function(f,_,A){o.je(this.he),f=Ge(f),this._clipRRect(f,_,A)},o.Canvas.prototype.clipRect=function(f,_,A){o.je(this.he),f=Ft(f),this._clipRect(f,_,A)},o.Canvas.prototype.concat=function(f){o.je(this.he),f=_t(f),this._concat(f)},o.Canvas.prototype.drawArc=function(f,_,A,B,G){o.je(this.he),f=Ft(f),this._drawArc(f,_,A,B,G)},o.Canvas.prototype.drawAtlas=function(f,_,A,B,G,J,ht){if(f&&B&&_&&A&&_.length===A.length){o.je(this.he),G||(G=o.BlendMode.SrcOver);var Tt=k(_,"HEAPF32"),At=k(A,"HEAPF32"),Wt=A.length/4,$t=k(S(J),"HEAPU32");if(ht&&"B"in ht&&"C"in ht)this._drawAtlasCubic(f,At,Tt,$t,Wt,G,ht.B,ht.C,B);else{let O=o.FilterMode.Linear,Q=o.MipmapMode.None;ht&&(O=ht.filter,"mipmap"in ht&&(Q=ht.mipmap)),this._drawAtlasOptions(f,At,Tt,$t,Wt,G,O,Q,B)}I(Tt,_),I(At,A),I($t,J)}},o.Canvas.prototype.drawCircle=function(f,_,A,B){o.je(this.he),this._drawCircle(f,_,A,B)},o.Canvas.prototype.drawColor=function(f,_){o.je(this.he),f=W(f),_!==void 0?this._drawColor(f,_):this._drawColor(f)},o.Canvas.prototype.drawColorInt=function(f,_){o.je(this.he),this._drawColorInt(f,_||o.BlendMode.SrcOver)},o.Canvas.prototype.drawColorComponents=function(f,_,A,B,G){o.je(this.he),f=xt(f,_,A,B),G!==void 0?this._drawColor(f,G):this._drawColor(f)},o.Canvas.prototype.drawDRRect=function(f,_,A){o.je(this.he),f=Ge(f,wa),_=Ge(_,Cu),this._drawDRRect(f,_,A)},o.Canvas.prototype.drawImage=function(f,_,A,B){o.je(this.he),this._drawImage(f,_,A,B||null)},o.Canvas.prototype.drawImageCubic=function(f,_,A,B,G,J){o.je(this.he),this._drawImageCubic(f,_,A,B,G,J||null)},o.Canvas.prototype.drawImageOptions=function(f,_,A,B,G,J){o.je(this.he),this._drawImageOptions(f,_,A,B,G,J||null)},o.Canvas.prototype.drawImageNine=function(f,_,A,B,G){o.je(this.he),_=k(_,"HEAP32",Bn),A=Ft(A),this._drawImageNine(f,_,A,B,G||null)},o.Canvas.prototype.drawImageRect=function(f,_,A,B,G){o.je(this.he),Ft(_,ee),Ft(A,Vr),this._drawImageRect(f,ee,Vr,B,!!G)},o.Canvas.prototype.drawImageRectCubic=function(f,_,A,B,G,J){o.je(this.he),Ft(_,ee),Ft(A,Vr),this._drawImageRectCubic(f,ee,Vr,B,G,J||null)},o.Canvas.prototype.drawImageRectOptions=function(f,_,A,B,G,J){o.je(this.he),Ft(_,ee),Ft(A,Vr),this._drawImageRectOptions(f,ee,Vr,B,G,J||null)},o.Canvas.prototype.drawLine=function(f,_,A,B,G){o.je(this.he),this._drawLine(f,_,A,B,G)},o.Canvas.prototype.drawOval=function(f,_){o.je(this.he),f=Ft(f),this._drawOval(f,_)},o.Canvas.prototype.drawPaint=function(f){o.je(this.he),this._drawPaint(f)},o.Canvas.prototype.drawParagraph=function(f,_,A){o.je(this.he),this._drawParagraph(f,_,A)},o.Canvas.prototype.drawPatch=function(f,_,A,B,G){if(24>f.length)throw"Need 12 cubic points";if(_&&4>_.length)throw"Need 4 colors";if(A&&8>A.length)throw"Need 4 shader coordinates";o.je(this.he);const J=k(f,"HEAPF32"),ht=_?k(S(_),"HEAPU32"):Ht,Tt=A?k(A,"HEAPF32"):Ht;B||(B=o.BlendMode.Modulate),this._drawPatch(J,ht,Tt,B,G),I(Tt,A),I(ht,_),I(J,f)},o.Canvas.prototype.drawPath=function(f,_){o.je(this.he),this._drawPath(f,_)},o.Canvas.prototype.drawPicture=function(f){o.je(this.he),this._drawPicture(f)},o.Canvas.prototype.drawPoints=function(f,_,A){o.je(this.he);var B=k(_,"HEAPF32");this._drawPoints(f,B,_.length/2,A),I(B,_)},o.Canvas.prototype.drawRRect=function(f,_){o.je(this.he),f=Ge(f),this._drawRRect(f,_)},o.Canvas.prototype.drawRect=function(f,_){o.je(this.he),f=Ft(f),this._drawRect(f,_)},o.Canvas.prototype.drawRect4f=function(f,_,A,B,G){o.je(this.he),this._drawRect4f(f,_,A,B,G)},o.Canvas.prototype.drawShadow=function(f,_,A,B,G,J,ht){o.je(this.he);var Tt=k(G,"HEAPF32"),At=k(J,"HEAPF32");_=k(_,"HEAPF32",Wi),A=k(A,"HEAPF32",Ta),this._drawShadow(f,_,A,B,Tt,At,ht),I(Tt,G),I(At,J)},o.getShadowLocalBounds=function(f,_,A,B,G,J,ht){return f=it(f),A=k(A,"HEAPF32",Wi),B=k(B,"HEAPF32",Ta),this._getShadowLocalBounds(f,_,A,B,G,J,ee)?(_=Le.toTypedArray(),ht?(ht.set(_),ht):_.slice()):null},o.Canvas.prototype.drawTextBlob=function(f,_,A,B){o.je(this.he),this._drawTextBlob(f,_,A,B)},o.Canvas.prototype.drawVertices=function(f,_,A){o.je(this.he),this._drawVertices(f,_,A)},o.Canvas.prototype.getDeviceClipBounds=function(f){this._getDeviceClipBounds(Bn);var _=ks.toTypedArray();return f?f.set(_):f=_.slice(),f},o.Canvas.prototype.quickReject=function(f){return f=Ft(f),this._quickReject(f)},o.Canvas.prototype.getLocalToDevice=function(){this._getLocalToDevice($i);for(var f=$i,_=Array(16),A=0;16>A;A++)_[A]=o.HEAPF32[f/4+A];return _},o.Canvas.prototype.getTotalMatrix=function(){this._getTotalMatrix(Wr);for(var f=Array(9),_=0;9>_;_++)f[_]=o.HEAPF32[Wr/4+_];return f},o.Canvas.prototype.makeSurface=function(f){return f=this._makeSurface(f),f.he=this.he,f},o.Canvas.prototype.readPixels=function(f,_,A,B,G){return o.je(this.he),p(this,f,_,A,B,G)},o.Canvas.prototype.saveLayer=function(f,_,A,B,G){return _=Ft(_),this._saveLayer(f||null,_,A||null,B||0,G||o.TileMode.Clamp)},o.Canvas.prototype.writePixels=function(f,_,A,B,G,J,ht,Tt){if(f.byteLength%(_*A))throw"pixels length must be a multiple of the srcWidth * srcHeight";o.je(this.he);var At=f.byteLength/(_*A);J=J||o.AlphaType.Unpremul,ht=ht||o.ColorType.RGBA_8888,Tt=Tt||o.ColorSpace.SRGB;var Wt=At*_;return At=k(f,"HEAPU8"),_=this._writePixels({width:_,height:A,colorType:ht,alphaType:J,colorSpace:Tt},At,Wt,B,G),I(At,f),_},o.ColorFilter.MakeBlend=function(f,_,A){return f=W(f),A=A||o.ColorSpace.SRGB,o.ColorFilter._MakeBlend(f,_,A)},o.ColorFilter.MakeMatrix=function(f){if(!f||f.length!==20)throw"invalid color matrix";var _=k(f,"HEAPF32"),A=o.ColorFilter._makeMatrix(_);return I(_,f),A},o.ContourMeasure.prototype.getPosTan=function(f,_){return this._getPosTan(f,ee),f=Le.toTypedArray(),_?(_.set(f),_):f.slice()},o.ImageFilter.prototype.getOutputBounds=function(f,_,A){return f=Ft(f,ee),_=it(_),this._getOutputBounds(f,_,Bn),_=ks.toTypedArray(),A?(A.set(_),A):_.slice()},o.ImageFilter.MakeDropShadow=function(f,_,A,B,G,J){return G=W(G,Sr),o.ImageFilter._MakeDropShadow(f,_,A,B,G,J)},o.ImageFilter.MakeDropShadowOnly=function(f,_,A,B,G,J){return G=W(G,Sr),o.ImageFilter._MakeDropShadowOnly(f,_,A,B,G,J)},o.ImageFilter.MakeImage=function(f,_,A,B){if(A=Ft(A,ee),B=Ft(B,Vr),"B"in _&&"C"in _)return o.ImageFilter._MakeImageCubic(f,_.B,_.C,A,B);const G=_.filter;let J=o.MipmapMode.None;return"mipmap"in _&&(J=_.mipmap),o.ImageFilter._MakeImageOptions(f,G,J,A,B)},o.ImageFilter.MakeMatrixTransform=function(f,_,A){if(f=it(f),"B"in _&&"C"in _)return o.ImageFilter._MakeMatrixTransformCubic(f,_.B,_.C,A);const B=_.filter;let G=o.MipmapMode.None;return"mipmap"in _&&(G=_.mipmap),o.ImageFilter._MakeMatrixTransformOptions(f,B,G,A)},o.Paint.prototype.getColor=function(){return this._getColor(Sr),Ot(Sr)},o.Paint.prototype.setColor=function(f,_){_=_||null,f=W(f),this._setColor(f,_)},o.Paint.prototype.setColorComponents=function(f,_,A,B,G){G=G||null,f=xt(f,_,A,B),this._setColor(f,G)},o.Path.prototype.getPoint=function(f,_){return this._getPoint(f,ee),f=Le.toTypedArray(),_?(_[0]=f[0],_[1]=f[1],_):f.slice(0,2)},o.Picture.prototype.makeShader=function(f,_,A,B,G){return B=it(B),G=Ft(G),this._makeShader(f,_,A,B,G)},o.Picture.prototype.cullRect=function(f){this._cullRect(ee);var _=Le.toTypedArray();return f?(f.set(_),f):_.slice()},o.PictureRecorder.prototype.beginRecording=function(f,_){return f=Ft(f),this._beginRecording(f,!!_)},o.Surface.prototype.getCanvas=function(){var f=this._getCanvas();return f.he=this.he,f},o.Surface.prototype.makeImageSnapshot=function(f){return o.je(this.he),f=k(f,"HEAP32",Bn),this._makeImageSnapshot(f)},o.Surface.prototype.makeSurface=function(f){return o.je(this.he),f=this._makeSurface(f),f.he=this.he,f},o.Surface.prototype.bg=function(f,_){return this.ef||(this.ef=this.getCanvas()),requestAnimationFrame((function(){o.je(this.he),f(this.ef),this.flush(_)}).bind(this))},o.Surface.prototype.requestAnimationFrame||(o.Surface.prototype.requestAnimationFrame=o.Surface.prototype.bg),o.Surface.prototype.Yf=function(f,_){this.ef||(this.ef=this.getCanvas()),requestAnimationFrame((function(){o.je(this.he),f(this.ef),this.flush(_),this.dispose()}).bind(this))},o.Surface.prototype.drawOnce||(o.Surface.prototype.drawOnce=o.Surface.prototype.Yf),o.PathEffect.MakeDash=function(f,_){if(_||(_=0),!f.length||f.length%2===1)throw"Intervals array must have even length";var A=k(f,"HEAPF32");return _=o.PathEffect._MakeDash(A,f.length,_),I(A,f),_},o.PathEffect.MakeLine2D=function(f,_){return _=it(_),o.PathEffect._MakeLine2D(f,_)},o.PathEffect.MakePath2D=function(f,_){return f=it(f),o.PathEffect._MakePath2D(f,_)},o.Shader.MakeColor=function(f,_){return _=_||null,f=W(f),o.Shader._MakeColor(f,_)},o.Shader.Blend=o.Shader.MakeBlend,o.Shader.Color=o.Shader.MakeColor,o.Shader.MakeLinearGradient=function(f,_,A,B,G,J,ht,Tt){Tt=Tt||null;var At=tt(A),Wt=k(B,"HEAPF32");ht=ht||0,J=it(J);var $t=Le.toTypedArray();return $t.set(f),$t.set(_,2),f=o.Shader._MakeLinearGradient(ee,At.ze,At.colorType,Wt,At.count,G,ht,J,Tt),I(At.ze,A),B&&I(Wt,B),f},o.Shader.MakeRadialGradient=function(f,_,A,B,G,J,ht,Tt){Tt=Tt||null;var At=tt(A),Wt=k(B,"HEAPF32");return ht=ht||0,J=it(J),f=o.Shader._MakeRadialGradient(f[0],f[1],_,At.ze,At.colorType,Wt,At.count,G,ht,J,Tt),I(At.ze,A),B&&I(Wt,B),f},o.Shader.MakeSweepGradient=function(f,_,A,B,G,J,ht,Tt,At,Wt){Wt=Wt||null;var $t=tt(A),O=k(B,"HEAPF32");return ht=ht||0,Tt=Tt||0,At=At||360,J=it(J),f=o.Shader._MakeSweepGradient(f,_,$t.ze,$t.colorType,O,$t.count,G,Tt,At,ht,J,Wt),I($t.ze,A),B&&I(O,B),f},o.Shader.MakeTwoPointConicalGradient=function(f,_,A,B,G,J,ht,Tt,At,Wt){Wt=Wt||null;var $t=tt(G),O=k(J,"HEAPF32");At=At||0,Tt=it(Tt);var Q=Le.toTypedArray();return Q.set(f),Q.set(A,2),f=o.Shader._MakeTwoPointConicalGradient(ee,_,B,$t.ze,$t.colorType,O,$t.count,ht,At,Tt,Wt),I($t.ze,G),J&&I(O,J),f},o.Vertices.prototype.bounds=function(f){this._bounds(ee);var _=Le.toTypedArray();return f?(f.set(_),f):_.slice()},o.pe&&o.pe.forEach(function(f){f()})},o.computeTonalColors=function(p){var f=k(p.ambient,"HEAPF32"),_=k(p.spot,"HEAPF32");this._computeTonalColors(f,_);var A={ambient:Ot(f),spot:Ot(_)};return I(f,p.ambient),I(_,p.spot),A},o.LTRBRect=function(p,f,_,A){return Float32Array.of(p,f,_,A)},o.XYWHRect=function(p,f,_,A){return Float32Array.of(p,f,p+_,f+A)},o.LTRBiRect=function(p,f,_,A){return Int32Array.of(p,f,_,A)},o.XYWHiRect=function(p,f,_,A){return Int32Array.of(p,f,p+_,f+A)},o.RRectXY=function(p,f,_){return Float32Array.of(p[0],p[1],p[2],p[3],f,_,f,_,f,_,f,_)},o.MakeAnimatedImageFromEncoded=function(p){p=new Uint8Array(p);var f=o._malloc(p.byteLength);return o.HEAPU8.set(p,f),(p=o._decodeAnimatedImage(f,p.byteLength))?p:null},o.MakeImageFromEncoded=function(p){p=new Uint8Array(p);var f=o._malloc(p.byteLength);return o.HEAPU8.set(p,f),(p=o._decodeImage(f,p.byteLength))?p:null};var Dn=null;o.MakeImageFromCanvasImageSource=function(p){var f=p.width,_=p.height;Dn||(Dn=document.createElement("canvas")),Dn.width=f,Dn.height=_;var A=Dn.getContext("2d",{willReadFrequently:!0});return A.drawImage(p,0,0),p=A.getImageData(0,0,f,_),o.MakeImage({width:f,height:_,alphaType:o.AlphaType.Unpremul,colorType:o.ColorType.RGBA_8888,colorSpace:o.ColorSpace.SRGB},p.data,4*f)},o.MakeImage=function(p,f,_){var A=o._malloc(f.length);return o.HEAPU8.set(f,A),o._MakeImage(p,A,f.length,_)},o.MakeVertices=function(p,f,_,A,B,G){var J=B&&B.length||0,ht=0;return _&&_.length&&(ht|=1),A&&A.length&&(ht|=2),G===void 0||G||(ht|=4),p=new o._VerticesBuilder(p,f.length/2,J,ht),k(f,"HEAPF32",p.positions()),p.texCoords()&&k(_,"HEAPF32",p.texCoords()),p.colors()&&k(S(A),"HEAPU32",p.colors()),p.indices()&&k(B,"HEAPU16",p.indices()),p.detach()},o.Matrix={},o.Matrix.identity=function(){return d(3)},o.Matrix.invert=function(p){var f=p[0]*p[4]*p[8]+p[1]*p[5]*p[6]+p[2]*p[3]*p[7]-p[2]*p[4]*p[6]-p[1]*p[3]*p[8]-p[0]*p[5]*p[7];return f?[(p[4]*p[8]-p[5]*p[7])/f,(p[2]*p[7]-p[1]*p[8])/f,(p[1]*p[5]-p[2]*p[4])/f,(p[5]*p[6]-p[3]*p[8])/f,(p[0]*p[8]-p[2]*p[6])/f,(p[2]*p[3]-p[0]*p[5])/f,(p[3]*p[7]-p[4]*p[6])/f,(p[1]*p[6]-p[0]*p[7])/f,(p[0]*p[4]-p[1]*p[3])/f]:null},o.Matrix.mapPoints=function(p,f){for(var _=0;_<f.length;_+=2){var A=f[_],B=f[_+1],G=p[6]*A+p[7]*B+p[8],J=p[3]*A+p[4]*B+p[5];f[_]=(p[0]*A+p[1]*B+p[2])/G,f[_+1]=J/G}return f},o.Matrix.multiply=function(){return Fn(3,arguments)},o.Matrix.rotated=function(p,f,_){f=f||0,_=_||0;var A=Math.sin(p);return p=Math.cos(p),[p,-A,Re(A,_,1-p,f),A,p,Re(-A,f,1-p,_),0,0,1]},o.Matrix.scaled=function(p,f,_,A){_=_||0,A=A||0;var B=l([p,f],d(3),3,0,1);return l([_-p*_,A-f*A],B,3,2,0)},o.Matrix.skewed=function(p,f,_,A){_=_||0,A=A||0;var B=l([p,f],d(3),3,1,-1);return l([-p*_,-f*A],B,3,2,0)},o.Matrix.translated=function(p,f){return l(arguments,d(3),3,2,0)},o.Vector={},o.Vector.dot=function(p,f){return p.map(function(_,A){return _*f[A]}).reduce(function(_,A){return _+A})},o.Vector.lengthSquared=function(p){return o.Vector.dot(p,p)},o.Vector.length=function(p){return Math.sqrt(o.Vector.lengthSquared(p))},o.Vector.mulScalar=function(p,f){return p.map(function(_){return _*f})},o.Vector.add=function(p,f){return p.map(function(_,A){return _+f[A]})},o.Vector.sub=function(p,f){return p.map(function(_,A){return _-f[A]})},o.Vector.dist=function(p,f){return o.Vector.length(o.Vector.sub(p,f))},o.Vector.normalize=function(p){return o.Vector.mulScalar(p,1/o.Vector.length(p))},o.Vector.cross=function(p,f){return[p[1]*f[2]-p[2]*f[1],p[2]*f[0]-p[0]*f[2],p[0]*f[1]-p[1]*f[0]]},o.M44={},o.M44.identity=function(){return d(4)},o.M44.translated=function(p){return l(p,d(4),4,3,0)},o.M44.scaled=function(p){return l(p,d(4),4,0,1)},o.M44.rotated=function(p,f){return o.M44.rotatedUnitSinCos(o.Vector.normalize(p),Math.sin(f),Math.cos(f))},o.M44.rotatedUnitSinCos=function(p,f,_){var A=p[0],B=p[1];p=p[2];var G=1-_;return[G*A*A+_,G*A*B-f*p,G*A*p+f*B,0,G*A*B+f*p,G*B*B+_,G*B*p-f*A,0,G*A*p-f*B,G*B*p+f*A,G*p*p+_,0,0,0,0,1]},o.M44.lookat=function(p,f,_){f=o.Vector.normalize(o.Vector.sub(f,p)),_=o.Vector.normalize(_),_=o.Vector.normalize(o.Vector.cross(f,_));var A=o.M44.identity();return l(_,A,4,0,0),l(o.Vector.cross(_,f),A,4,1,0),l(o.Vector.mulScalar(f,-1),A,4,2,0),l(p,A,4,3,0),p=o.M44.invert(A),p===null?o.M44.identity():p},o.M44.perspective=function(p,f,_){var A=1/(f-p);return _/=2,_=Math.cos(_)/Math.sin(_),[_,0,0,0,0,_,0,0,0,0,(f+p)*A,2*f*p*A,0,0,-1,1]},o.M44.rc=function(p,f,_){return p[4*f+_]},o.M44.multiply=function(){return Fn(4,arguments)},o.M44.invert=function(p){var f=p[0],_=p[4],A=p[8],B=p[12],G=p[1],J=p[5],ht=p[9],Tt=p[13],At=p[2],Wt=p[6],$t=p[10],O=p[14],Q=p[3],Lt=p[7],re=p[11];p=p[15];var ye=f*J-_*G,je=f*ht-A*G,rr=f*Tt-B*G,hr=_*ht-A*J,ie=_*Tt-B*J,ot=A*Tt-B*ht,w=At*Lt-Wt*Q,F=At*re-$t*Q,V=At*p-O*Q,Z=Wt*re-$t*Lt,et=Wt*p-O*Lt,nt=$t*p-O*re,wt=ye*nt-je*et+rr*Z+hr*V-ie*F+ot*w,Vt=1/wt;return wt===0||Vt===1/0?null:(ye*=Vt,je*=Vt,rr*=Vt,hr*=Vt,ie*=Vt,ot*=Vt,w*=Vt,F*=Vt,V*=Vt,Z*=Vt,et*=Vt,nt*=Vt,f=[J*nt-ht*et+Tt*Z,ht*V-G*nt-Tt*F,G*et-J*V+Tt*w,J*F-G*Z-ht*w,A*et-_*nt-B*Z,f*nt-A*V+B*F,_*V-f*et-B*w,f*Z-_*F+A*w,Lt*ot-re*ie+p*hr,re*rr-Q*ot-p*je,Q*ie-Lt*rr+p*ye,Lt*je-Q*hr-re*ye,$t*ie-Wt*ot-O*hr,At*ot-$t*rr+O*je,Wt*rr-At*ie-O*ye,At*hr-Wt*je+$t*ye],f.every(function(Be){return!isNaN(Be)&&Be!==1/0&&Be!==-1/0})?f:null)},o.M44.transpose=function(p){return[p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]]},o.M44.mustInvert=function(p){if(p=o.M44.invert(p),p===null)throw"Matrix not invertible";return p},o.M44.setupCamera=function(p,f,_){var A=o.M44.lookat(_.eye,_.coa,_.up);return _=o.M44.perspective(_.near,_.far,_.angle),f=[(p[2]-p[0])/2,(p[3]-p[1])/2,f],p=o.M44.multiply(o.M44.translated([(p[0]+p[2])/2,(p[1]+p[3])/2,0]),o.M44.scaled(f)),o.M44.multiply(p,_,A,o.M44.mustInvert(p))},o.ColorMatrix={},o.ColorMatrix.identity=function(){var p=new Float32Array(20);return p[0]=1,p[6]=1,p[12]=1,p[18]=1,p},o.ColorMatrix.scaled=function(p,f,_,A){var B=new Float32Array(20);return B[0]=p,B[6]=f,B[12]=_,B[18]=A,B};var ym=[[6,7,11,12],[0,10,2,12],[0,1,5,6]];o.ColorMatrix.rotated=function(p,f,_){var A=o.ColorMatrix.identity();return p=ym[p],A[p[0]]=_,A[p[1]]=f,A[p[2]]=-f,A[p[3]]=_,A},o.ColorMatrix.postTranslate=function(p,f,_,A,B){return p[4]+=f,p[9]+=_,p[14]+=A,p[19]+=B,p},o.ColorMatrix.concat=function(p,f){for(var _=new Float32Array(20),A=0,B=0;20>B;B+=5){for(var G=0;4>G;G++)_[A++]=p[B]*f[G]+p[B+1]*f[G+5]+p[B+2]*f[G+10]+p[B+3]*f[G+15];_[A++]=p[B]*f[4]+p[B+1]*f[9]+p[B+2]*f[14]+p[B+3]*f[19]+p[B+4]}return _},function(p){p.pe=p.pe||[],p.pe.push(function(){function f(O){return O&&(O.dir=O.dir===0?p.TextDirection.RTL:p.TextDirection.LTR),O}function _(O){if(!O||!O.length)return[];for(var Q=[],Lt=0;Lt<O.length;Lt+=5){var re=p.LTRBRect(O[Lt],O[Lt+1],O[Lt+2],O[Lt+3]),ye=p.TextDirection.LTR;O[Lt+4]===0&&(ye=p.TextDirection.RTL),Q.push({rect:re,dir:ye})}return p._free(O.byteOffset),Q}function A(O){return O=O||{},O.weight===void 0&&(O.weight=p.FontWeight.Normal),O.width=O.width||p.FontWidth.Normal,O.slant=O.slant||p.FontSlant.Upright,O}function B(O){if(!O||!O.length)return Ht;for(var Q=[],Lt=0;Lt<O.length;Lt++){var re=G(O[Lt]);Q.push(re)}return k(Q,"HEAPU32")}function G(O){if(Tt[O])return Tt[O];var Q=tr(O)+1,Lt=p._malloc(Q);return Qe(O,j,Lt,Q),Tt[O]=Lt}function J(O){if(O._colorPtr=W(O.color),O._foregroundColorPtr=Ht,O._backgroundColorPtr=Ht,O._decorationColorPtr=Ht,O.foregroundColor&&(O._foregroundColorPtr=W(O.foregroundColor,At)),O.backgroundColor&&(O._backgroundColorPtr=W(O.backgroundColor,Wt)),O.decorationColor&&(O._decorationColorPtr=W(O.decorationColor,$t)),Array.isArray(O.fontFamilies)&&O.fontFamilies.length?(O._fontFamiliesPtr=B(O.fontFamilies),O._fontFamiliesLen=O.fontFamilies.length):(O._fontFamiliesPtr=Ht,O._fontFamiliesLen=0),O.locale){var Q=O.locale;O._localePtr=G(Q),O._localeLen=tr(Q)}else O._localePtr=Ht,O._localeLen=0;if(Array.isArray(O.shadows)&&O.shadows.length){Q=O.shadows;var Lt=Q.map(function(ie){return ie.color||p.BLACK}),re=Q.map(function(ie){return ie.blurRadius||0});O._shadowLen=Q.length;for(var ye=p._malloc(8*Q.length),je=ye/4,rr=0;rr<Q.length;rr++){var hr=Q[rr].offset||[0,0];p.HEAPF32[je]=hr[0],p.HEAPF32[je+1]=hr[1],je+=2}O._shadowColorsPtr=tt(Lt).ze,O._shadowOffsetsPtr=ye,O._shadowBlurRadiiPtr=k(re,"HEAPF32")}else O._shadowLen=0,O._shadowColorsPtr=Ht,O._shadowOffsetsPtr=Ht,O._shadowBlurRadiiPtr=Ht;Array.isArray(O.fontFeatures)&&O.fontFeatures.length?(Q=O.fontFeatures,Lt=Q.map(function(ie){return ie.name}),re=Q.map(function(ie){return ie.value}),O._fontFeatureLen=Q.length,O._fontFeatureNamesPtr=B(Lt),O._fontFeatureValuesPtr=k(re,"HEAPU32")):(O._fontFeatureLen=0,O._fontFeatureNamesPtr=Ht,O._fontFeatureValuesPtr=Ht),Array.isArray(O.fontVariations)&&O.fontVariations.length?(Q=O.fontVariations,Lt=Q.map(function(ie){return ie.axis}),re=Q.map(function(ie){return ie.value}),O._fontVariationLen=Q.length,O._fontVariationAxesPtr=B(Lt),O._fontVariationValuesPtr=k(re,"HEAPF32")):(O._fontVariationLen=0,O._fontVariationAxesPtr=Ht,O._fontVariationValuesPtr=Ht)}function ht(O){p._free(O._fontFamiliesPtr),p._free(O._shadowColorsPtr),p._free(O._shadowOffsetsPtr),p._free(O._shadowBlurRadiiPtr),p._free(O._fontFeatureNamesPtr),p._free(O._fontFeatureValuesPtr),p._free(O._fontVariationAxesPtr),p._free(O._fontVariationValuesPtr)}p.Paragraph.prototype.getRectsForRange=function(O,Q,Lt,re){return O=this._getRectsForRange(O,Q,Lt,re),_(O)},p.Paragraph.prototype.getRectsForPlaceholders=function(){var O=this._getRectsForPlaceholders();return _(O)},p.Paragraph.prototype.getGlyphInfoAt=function(O){return f(this._getGlyphInfoAt(O))},p.Paragraph.prototype.getClosestGlyphInfoAtCoordinate=function(O,Q){return f(this._getClosestGlyphInfoAtCoordinate(O,Q))},p.TypefaceFontProvider.prototype.registerFont=function(O,Q){if(O=p.Typeface.MakeTypefaceFromData(O),!O)return null;Q=G(Q),this._registerFont(O,Q)},p.ParagraphStyle=function(O){if(O.disableHinting=O.disableHinting||!1,O.ellipsis){var Q=O.ellipsis;O._ellipsisPtr=G(Q),O._ellipsisLen=tr(Q)}else O._ellipsisPtr=Ht,O._ellipsisLen=0;return O.heightMultiplier==null&&(O.heightMultiplier=-1),O.maxLines=O.maxLines||0,O.replaceTabCharacters=O.replaceTabCharacters||!1,Q=(Q=O.strutStyle)||{},Q.strutEnabled=Q.strutEnabled||!1,Q.strutEnabled&&Array.isArray(Q.fontFamilies)&&Q.fontFamilies.length?(Q._fontFamiliesPtr=B(Q.fontFamilies),Q._fontFamiliesLen=Q.fontFamilies.length):(Q._fontFamiliesPtr=Ht,Q._fontFamiliesLen=0),Q.fontStyle=A(Q.fontStyle),Q.fontSize==null&&(Q.fontSize=-1),Q.heightMultiplier==null&&(Q.heightMultiplier=-1),Q.halfLeading=Q.halfLeading||!1,Q.leading=Q.leading||0,Q.forceStrutHeight=Q.forceStrutHeight||!1,O.strutStyle=Q,O.textAlign=O.textAlign||p.TextAlign.Start,O.textDirection=O.textDirection||p.TextDirection.LTR,O.textHeightBehavior=O.textHeightBehavior||p.TextHeightBehavior.All,O.textStyle=p.TextStyle(O.textStyle),O.applyRoundingHack=O.applyRoundingHack!==!1,O},p.TextStyle=function(O){return O.color||(O.color=p.BLACK),O.decoration=O.decoration||0,O.decorationThickness=O.decorationThickness||0,O.decorationStyle=O.decorationStyle||p.DecorationStyle.Solid,O.textBaseline=O.textBaseline||p.TextBaseline.Alphabetic,O.fontSize==null&&(O.fontSize=-1),O.letterSpacing=O.letterSpacing||0,O.wordSpacing=O.wordSpacing||0,O.heightMultiplier==null&&(O.heightMultiplier=-1),O.halfLeading=O.halfLeading||!1,O.fontStyle=A(O.fontStyle),O};var Tt={},At=p._malloc(16),Wt=p._malloc(16),$t=p._malloc(16);p.ParagraphBuilder.Make=function(O,Q){return J(O.textStyle),Q=p.ParagraphBuilder._Make(O,Q),ht(O.textStyle),Q},p.ParagraphBuilder.MakeFromFontProvider=function(O,Q){return J(O.textStyle),Q=p.ParagraphBuilder._MakeFromFontProvider(O,Q),ht(O.textStyle),Q},p.ParagraphBuilder.MakeFromFontCollection=function(O,Q){return J(O.textStyle),Q=p.ParagraphBuilder._MakeFromFontCollection(O,Q),ht(O.textStyle),Q},p.ParagraphBuilder.ShapeText=function(O,Q,Lt){let re=0;for(const ye of Q)re+=ye.length;if(re!==O.length)throw"Accumulated block lengths must equal text.length";return p.ParagraphBuilder._ShapeText(O,Q,Lt)},p.ParagraphBuilder.prototype.pushStyle=function(O){J(O),this._pushStyle(O),ht(O)},p.ParagraphBuilder.prototype.pushPaintStyle=function(O,Q,Lt){J(O),this._pushPaintStyle(O,Q,Lt),ht(O)},p.ParagraphBuilder.prototype.addPlaceholder=function(O,Q,Lt,re,ye){Lt=Lt||p.PlaceholderAlignment.Baseline,re=re||p.TextBaseline.Alphabetic,this._addPlaceholder(O||0,Q||0,Lt,re,ye||0)},p.ParagraphBuilder.prototype.setWordsUtf8=function(O){var Q=k(O,"HEAPU32");this._setWordsUtf8(Q,O&&O.length||0),I(Q,O)},p.ParagraphBuilder.prototype.setWordsUtf16=function(O){var Q=k(O,"HEAPU32");this._setWordsUtf16(Q,O&&O.length||0),I(Q,O)},p.ParagraphBuilder.prototype.setGraphemeBreaksUtf8=function(O){var Q=k(O,"HEAPU32");this._setGraphemeBreaksUtf8(Q,O&&O.length||0),I(Q,O)},p.ParagraphBuilder.prototype.setGraphemeBreaksUtf16=function(O){var Q=k(O,"HEAPU32");this._setGraphemeBreaksUtf16(Q,O&&O.length||0),I(Q,O)},p.ParagraphBuilder.prototype.setLineBreaksUtf8=function(O){var Q=k(O,"HEAPU32");this._setLineBreaksUtf8(Q,O&&O.length||0),I(Q,O)},p.ParagraphBuilder.prototype.setLineBreaksUtf16=function(O){var Q=k(O,"HEAPU32");this._setLineBreaksUtf16(Q,O&&O.length||0),I(Q,O)}})}(e),o.MakeManagedAnimation=function(p,f,_,A,B){if(!o._MakeManagedAnimation)throw"Not compiled with MakeManagedAnimation";if(_||(_=""),!f)return o._MakeManagedAnimation(p,0,Ht,Ht,Ht,_,A,B);for(var G=[],J=[],ht=[],Tt=Object.keys(f||{}),At=0;At<Tt.length;At++){var Wt=Tt[At],$t=new Uint8Array(f[Wt]),O=o._malloc($t.byteLength);o.HEAPU8.set($t,O),J.push(O),ht.push($t.byteLength),$t=tr(Wt)+1,O=o._malloc($t),Qe(Wt,j,O,$t),G.push(O)}return f=k(G,"HEAPU32"),J=k(J,"HEAPU32"),ht=k(ht,"HEAPU32"),p=o._MakeManagedAnimation(p,Tt.length,f,J,ht,_,A,B),o._free(f),o._free(J),o._free(ht),p},o.Qg=function(p){return p.text=p.text||"",p.textSize=p.textSize||0,p.minTextSize=p.minTextSize||0,p.maxTextSize=p.maxTextSize||Number.MAX_VALUE,p.strokeWidth=p.strokeWidth||0,p.lineHeight=p.lineHeight||0,p.lineShift=p.lineShift||0,p.ascent=p.ascent||0,p.maxLines=p.maxLines||0,p.horizAlign=p.horizAlign||o.TextAlign.Left,p.vertAlign=p.vertAlign||o.Rg.Top,p.strokeJoin=p.strokeJoin||o.StrokeJoin.Miter,p.direction=p.direction||o.TextDirection.LTR,p.linebreak=p.linebreak||o.LineBreakType.HardLineBreak,p.resize=p.resize||o.Pg.None,p.fillColor||(p.fillColor=o.TRANSPARENT),p.strokeColor||(p.strokeColor=o.TRANSPARENT),p.boundingBox||(p.boundingBox=[0,0,0,0]),p},function(p){p.pe=p.pe||[],p.pe.push(function(){p.Animation.prototype.render=function(f,_){Ft(_,ee),this._render(f,ee)},p.Animation.prototype.size=function(f){this._size(ee);var _=Le.toTypedArray();return f?(f[0]=_[0],f[1]=_[1],f):_.slice(0,2)},p.ManagedAnimation&&(p.ManagedAnimation.prototype.render=function(f,_){Ft(_,ee),this._render(f,ee)},p.ManagedAnimation.prototype.seek=function(f,_){return this._seek(f,ee),f=Le.toTypedArray(),_?(_.set(f),_):f.slice()},p.ManagedAnimation.prototype.seekFrame=function(f,_){return this._seekFrame(f,ee),f=Le.toTypedArray(),_?(_.set(f),_):f.slice()},p.ManagedAnimation.prototype.setColor=function(f,_){return _=W(_),this._setColor(f,_)},p.ManagedAnimation.prototype.setColorSlot=function(f,_){return _=W(_),this._setColorSlot(f,_)},p.ManagedAnimation.prototype.getColorSlot=function(f){return this._getColorSlot(f,Sr),f=Ot(Sr),f[0]==-1?null:f},p.ManagedAnimation.prototype.setVec2Slot=function(f,_){return k(_,"HEAPF32",Wi),this._setVec2Slot(f,Wi)},p.ManagedAnimation.prototype.getVec2Slot=function(f){return this._getVec2Slot(f,Wi),f=ba.toTypedArray(),f[2]===-1?null:f.slice(0,2)},p.ManagedAnimation.prototype.setTextSlot=function(f,_){var A=W(_.fillColor,Sr),B=W(_.strokeColor,ee),G=Ft(_.boundingBox,Vr);return _._fillColorPtr=A,_._strokeColorPtr=B,_._boundingBoxPtr=G,this._setTextSlot(f,_)},p.ManagedAnimation.prototype.setTransform=function(f,_,A,B,G,J,ht){return _=k([_[0],_[1],A[0],A[1],B[0],B[1],G,J,ht],"HEAPF32",Wr),this._setTransform(f,_)},p.ManagedAnimation.prototype.size=function(f){this._size(ee);var _=Le.toTypedArray();return f?(f[0]=_[0],f[1]=_[1],f):_.slice(0,2)})})}(e),o.pe=o.pe||[],o.pe.push(function(){o.Path.prototype.op=function(p,f){return this._op(p,f)?this:null},o.Path.prototype.simplify=function(){return this._simplify()?this:null}}),o.pe=o.pe||[],o.pe.push(function(){o.Canvas.prototype.drawText=function(p,f,_,A,B){var G=tr(p),J=o._malloc(G+1);Qe(p,j,J,G+1),this._drawSimpleText(J,G,f,_,B,A),o._free(J)},o.Canvas.prototype.drawGlyphs=function(p,f,_,A,B,G){if(!(2*p.length<=f.length))throw"Not enough positions for the array of gyphs";o.je(this.he);const J=k(p,"HEAPU16"),ht=k(f,"HEAPF32");this._drawGlyphs(p.length,J,ht,_,A,B,G),I(ht,f),I(J,p)},o.Font.prototype.getGlyphBounds=function(p,f,_){var A=k(p,"HEAPU16"),B=o._malloc(16*p.length);return this._getGlyphWidthBounds(A,p.length,Ht,B,f||null),f=new Float32Array(o.HEAPU8.buffer,B,4*p.length),I(A,p),_?(_.set(f),o._free(B),_):(p=Float32Array.from(f),o._free(B),p)},o.Font.prototype.getGlyphIDs=function(p,f,_){f||(f=p.length);var A=tr(p)+1,B=o._malloc(A);return Qe(p,j,B,A),p=o._malloc(2*f),f=this._getGlyphIDs(B,A-1,f,p),o._free(B),0>f?(o._free(p),null):(B=new Uint16Array(o.HEAPU8.buffer,p,f),_?(_.set(B),o._free(p),_):(_=Uint16Array.from(B),o._free(p),_))},o.Font.prototype.getGlyphIntercepts=function(p,f,_,A){var B=k(p,"HEAPU16"),G=k(f,"HEAPF32");return this._getGlyphIntercepts(B,p.length,!(p&&p._ck),G,f.length,!(f&&f._ck),_,A)},o.Font.prototype.getGlyphWidths=function(p,f,_){var A=k(p,"HEAPU16"),B=o._malloc(4*p.length);return this._getGlyphWidthBounds(A,p.length,B,Ht,f||null),f=new Float32Array(o.HEAPU8.buffer,B,p.length),I(A,p),_?(_.set(f),o._free(B),_):(p=Float32Array.from(f),o._free(B),p)},o.FontMgr.FromData=function(){if(!arguments.length)return null;var p=arguments;if(p.length===1&&Array.isArray(p[0])&&(p=arguments[0]),!p.length)return null;for(var f=[],_=[],A=0;A<p.length;A++){var B=new Uint8Array(p[A]),G=k(B,"HEAPU8");f.push(G),_.push(B.byteLength)}return f=k(f,"HEAPU32"),_=k(_,"HEAPU32"),p=o.FontMgr._fromData(f,_,p.length),o._free(f),o._free(_),p},o.Typeface.MakeTypefaceFromData=function(p){p=new Uint8Array(p);var f=k(p,"HEAPU8");return(p=o.Typeface._MakeTypefaceFromData(f,p.byteLength))?p:null},o.Typeface.MakeFreeTypeFaceFromData=o.Typeface.MakeTypefaceFromData,o.Typeface.prototype.getGlyphIDs=function(p,f,_){f||(f=p.length);var A=tr(p)+1,B=o._malloc(A);return Qe(p,j,B,A),p=o._malloc(2*f),f=this._getGlyphIDs(B,A-1,f,p),o._free(B),0>f?(o._free(p),null):(B=new Uint16Array(o.HEAPU8.buffer,p,f),_?(_.set(B),o._free(p),_):(_=Uint16Array.from(B),o._free(p),_))},o.TextBlob.MakeOnPath=function(p,f,_,A){if(p&&p.length&&f&&f.countPoints()){if(f.countPoints()===1)return this.MakeFromText(p,_);A||(A=0);var B=_.getGlyphIDs(p);B=_.getGlyphWidths(B);var G=[];f=new o.ContourMeasureIter(f,!1,1);for(var J=f.next(),ht=new Float32Array(4),Tt=0;Tt<p.length&&J;Tt++){var At=B[Tt];if(A+=At/2,A>J.length()){if(J.delete(),J=f.next(),!J){p=p.substring(0,Tt);break}A=At/2}J.getPosTan(A,ht);var Wt=ht[2],$t=ht[3];G.push(Wt,$t,ht[0]-At/2*Wt,ht[1]-At/2*$t),A+=At/2}return p=this.MakeFromRSXform(p,G,_),J&&J.delete(),f.delete(),p}},o.TextBlob.MakeFromRSXform=function(p,f,_){var A=tr(p)+1,B=o._malloc(A);return Qe(p,j,B,A),p=k(f,"HEAPF32"),_=o.TextBlob._MakeFromRSXform(B,A-1,p,_),o._free(B),_||null},o.TextBlob.MakeFromRSXformGlyphs=function(p,f,_){var A=k(p,"HEAPU16");return f=k(f,"HEAPF32"),_=o.TextBlob._MakeFromRSXformGlyphs(A,2*p.length,f,_),I(A,p),_||null},o.TextBlob.MakeFromGlyphs=function(p,f){var _=k(p,"HEAPU16");return f=o.TextBlob._MakeFromGlyphs(_,2*p.length,f),I(_,p),f||null},o.TextBlob.MakeFromText=function(p,f){var _=tr(p)+1,A=o._malloc(_);return Qe(p,j,A,_),p=o.TextBlob._MakeFromText(A,_-1,f),o._free(A),p||null},o.MallocGlyphIDs=function(p){return o.Malloc(Uint16Array,p)}}),o.pe=o.pe||[],o.pe.push(function(){o.MakePicture=function(p){p=new Uint8Array(p);var f=o._malloc(p.byteLength);return o.HEAPU8.set(p,f),(p=o._MakePicture(f,p.byteLength))?p:null}}),o.pe=o.pe||[],o.pe.push(function(){o.RuntimeEffect.Make=function(p,f){return o.RuntimeEffect._Make(p,{onError:f||function(_){console.log("RuntimeEffect error",_)}})},o.RuntimeEffect.MakeForBlender=function(p,f){return o.RuntimeEffect._MakeForBlender(p,{onError:f||function(_){console.log("RuntimeEffect error",_)}})},o.RuntimeEffect.prototype.makeShader=function(p,f){var _=!p._ck,A=k(p,"HEAPF32");return f=it(f),this._makeShader(A,4*p.length,_,f)},o.RuntimeEffect.prototype.makeShaderWithChildren=function(p,f,_){var A=!p._ck,B=k(p,"HEAPF32");_=it(_);for(var G=[],J=0;J<f.length;J++)G.push(f[J].ge.oe);return f=k(G,"HEAPU32"),this._makeShaderWithChildren(B,4*p.length,A,f,G.length,_)},o.RuntimeEffect.prototype.makeBlender=function(p){var f=!p._ck,_=k(p,"HEAPF32");return this._makeBlender(_,4*p.length,f)}}),function(){function p(ot){for(var w=0;w<ot.length;w++)if(ot[w]!==void 0&&!Number.isFinite(ot[w]))return!1;return!0}function f(ot){var w=o.getColorComponents(ot);ot=w[0];var F=w[1],V=w[2];return w=w[3],w===1?(ot=ot.toString(16).toLowerCase(),F=F.toString(16).toLowerCase(),V=V.toString(16).toLowerCase(),ot=ot.length===1?"0"+ot:ot,F=F.length===1?"0"+F:F,V=V.length===1?"0"+V:V,"#"+ot+F+V):(w=w===0||w===1?w:w.toFixed(8),"rgba("+ot+", "+F+", "+V+", "+w+")")}function _(ot){return o.parseColorString(ot,rr)}function A(ot){if(ot=hr.exec(ot),!ot)return null;var w=parseFloat(ot[4]),F=16;switch(ot[5]){case"em":case"rem":F=16*w;break;case"pt":F=4*w/3;break;case"px":F=w;break;case"pc":F=16*w;break;case"in":F=96*w;break;case"cm":F=96*w/2.54;break;case"mm":F=96/25.4*w;break;case"q":F=96/25.4/4*w;break;case"%":F=16/75*w}return{style:ot[1],variant:ot[2],weight:ot[3],sizePx:F,family:ot[6].trim()}}function B(){ie||(ie={"Noto Mono":{"*":o.Typeface.GetDefault()},monospace:{"*":o.Typeface.GetDefault()}})}function G(ot){this.ie=ot,this.le=new o.Paint,this.le.setAntiAlias(!0),this.le.setStrokeMiter(10),this.le.setStrokeCap(o.StrokeCap.Butt),this.le.setStrokeJoin(o.StrokeJoin.Miter),this.rf="10px monospace",this.Le=new o.Font(o.Typeface.GetDefault(),10),this.Le.setSubpixel(!0),this.ye=this.Ee=o.BLACK,this.Ue=0,this.gf=o.TRANSPARENT,this.We=this.Ve=0,this.hf=this.He=1,this.ff=0,this.Te=[],this.ke=o.BlendMode.SrcOver,this.le.setStrokeWidth(this.hf),this.le.setBlendMode(this.ke),this.ne=new o.Path,this.qe=o.Matrix.identity(),this.Lf=[],this.$e=[],this.Ke=function(){this.ne.delete(),this.le.delete(),this.Le.delete(),this.$e.forEach(function(w){w.Ke()})},Object.defineProperty(this,"currentTransform",{enumerable:!0,get:function(){return{a:this.qe[0],c:this.qe[1],e:this.qe[2],b:this.qe[3],d:this.qe[4],f:this.qe[5]}},set:function(w){w.a&&this.setTransform(w.a,w.b,w.c,w.d,w.e,w.f)}}),Object.defineProperty(this,"fillStyle",{enumerable:!0,get:function(){return g(this.ye)?f(this.ye):this.ye},set:function(w){typeof w=="string"?this.ye=_(w):w.Se&&(this.ye=w)}}),Object.defineProperty(this,"font",{enumerable:!0,get:function(){return this.rf},set:function(w){var F=A(w),V=(F.style||"normal")+"|"+(F.variant||"normal")+"|"+(F.weight||"normal"),Z=F.family;B(),V=ie[Z]?ie[Z][V]||ie[Z]["*"]:o.Typeface.GetDefault(),F.typeface=V,F&&(this.Le.setSize(F.sizePx),this.Le.setTypeface(F.typeface),this.rf=w)}}),Object.defineProperty(this,"globalAlpha",{enumerable:!0,get:function(){return this.He},set:function(w){!isFinite(w)||0>w||1<w||(this.He=w)}}),Object.defineProperty(this,"globalCompositeOperation",{enumerable:!0,get:function(){switch(this.ke){case o.BlendMode.SrcOver:return"source-over";case o.BlendMode.DstOver:return"destination-over";case o.BlendMode.Src:return"copy";case o.BlendMode.Dst:return"destination";case o.BlendMode.Clear:return"clear";case o.BlendMode.SrcIn:return"source-in";case o.BlendMode.DstIn:return"destination-in";case o.BlendMode.SrcOut:return"source-out";case o.BlendMode.DstOut:return"destination-out";case o.BlendMode.SrcATop:return"source-atop";case o.BlendMode.DstATop:return"destination-atop";case o.BlendMode.Xor:return"xor";case o.BlendMode.Plus:return"lighter";case o.BlendMode.Multiply:return"multiply";case o.BlendMode.Screen:return"screen";case o.BlendMode.Overlay:return"overlay";case o.BlendMode.Darken:return"darken";case o.BlendMode.Lighten:return"lighten";case o.BlendMode.ColorDodge:return"color-dodge";case o.BlendMode.ColorBurn:return"color-burn";case o.BlendMode.HardLight:return"hard-light";case o.BlendMode.SoftLight:return"soft-light";case o.BlendMode.Difference:return"difference";case o.BlendMode.Exclusion:return"exclusion";case o.BlendMode.Hue:return"hue";case o.BlendMode.Saturation:return"saturation";case o.BlendMode.Color:return"color";case o.BlendMode.Luminosity:return"luminosity"}},set:function(w){switch(w){case"source-over":this.ke=o.BlendMode.SrcOver;break;case"destination-over":this.ke=o.BlendMode.DstOver;break;case"copy":this.ke=o.BlendMode.Src;break;case"destination":this.ke=o.BlendMode.Dst;break;case"clear":this.ke=o.BlendMode.Clear;break;case"source-in":this.ke=o.BlendMode.SrcIn;break;case"destination-in":this.ke=o.BlendMode.DstIn;break;case"source-out":this.ke=o.BlendMode.SrcOut;break;case"destination-out":this.ke=o.BlendMode.DstOut;break;case"source-atop":this.ke=o.BlendMode.SrcATop;break;case"destination-atop":this.ke=o.BlendMode.DstATop;break;case"xor":this.ke=o.BlendMode.Xor;break;case"lighter":this.ke=o.BlendMode.Plus;break;case"plus-lighter":this.ke=o.BlendMode.Plus;break;case"plus-darker":throw"plus-darker is not supported";case"multiply":this.ke=o.BlendMode.Multiply;break;case"screen":this.ke=o.BlendMode.Screen;break;case"overlay":this.ke=o.BlendMode.Overlay;break;case"darken":this.ke=o.BlendMode.Darken;break;case"lighten":this.ke=o.BlendMode.Lighten;break;case"color-dodge":this.ke=o.BlendMode.ColorDodge;break;case"color-burn":this.ke=o.BlendMode.ColorBurn;break;case"hard-light":this.ke=o.BlendMode.HardLight;break;case"soft-light":this.ke=o.BlendMode.SoftLight;break;case"difference":this.ke=o.BlendMode.Difference;break;case"exclusion":this.ke=o.BlendMode.Exclusion;break;case"hue":this.ke=o.BlendMode.Hue;break;case"saturation":this.ke=o.BlendMode.Saturation;break;case"color":this.ke=o.BlendMode.Color;break;case"luminosity":this.ke=o.BlendMode.Luminosity;break;default:return}this.le.setBlendMode(this.ke)}}),Object.defineProperty(this,"imageSmoothingEnabled",{enumerable:!0,get:function(){return!0},set:function(){}}),Object.defineProperty(this,"imageSmoothingQuality",{enumerable:!0,get:function(){return"high"},set:function(){}}),Object.defineProperty(this,"lineCap",{enumerable:!0,get:function(){switch(this.le.getStrokeCap()){case o.StrokeCap.Butt:return"butt";case o.StrokeCap.Round:return"round";case o.StrokeCap.Square:return"square"}},set:function(w){switch(w){case"butt":this.le.setStrokeCap(o.StrokeCap.Butt);break;case"round":this.le.setStrokeCap(o.StrokeCap.Round);break;case"square":this.le.setStrokeCap(o.StrokeCap.Square)}}}),Object.defineProperty(this,"lineDashOffset",{enumerable:!0,get:function(){return this.ff},set:function(w){isFinite(w)&&(this.ff=w)}}),Object.defineProperty(this,"lineJoin",{enumerable:!0,get:function(){switch(this.le.getStrokeJoin()){case o.StrokeJoin.Miter:return"miter";case o.StrokeJoin.Round:return"round";case o.StrokeJoin.Bevel:return"bevel"}},set:function(w){switch(w){case"miter":this.le.setStrokeJoin(o.StrokeJoin.Miter);break;case"round":this.le.setStrokeJoin(o.StrokeJoin.Round);break;case"bevel":this.le.setStrokeJoin(o.StrokeJoin.Bevel)}}}),Object.defineProperty(this,"lineWidth",{enumerable:!0,get:function(){return this.le.getStrokeWidth()},set:function(w){0>=w||!w||(this.hf=w,this.le.setStrokeWidth(w))}}),Object.defineProperty(this,"miterLimit",{enumerable:!0,get:function(){return this.le.getStrokeMiter()},set:function(w){0>=w||!w||this.le.setStrokeMiter(w)}}),Object.defineProperty(this,"shadowBlur",{enumerable:!0,get:function(){return this.Ue},set:function(w){0>w||!isFinite(w)||(this.Ue=w)}}),Object.defineProperty(this,"shadowColor",{enumerable:!0,get:function(){return f(this.gf)},set:function(w){this.gf=_(w)}}),Object.defineProperty(this,"shadowOffsetX",{enumerable:!0,get:function(){return this.Ve},set:function(w){isFinite(w)&&(this.Ve=w)}}),Object.defineProperty(this,"shadowOffsetY",{enumerable:!0,get:function(){return this.We},set:function(w){isFinite(w)&&(this.We=w)}}),Object.defineProperty(this,"strokeStyle",{enumerable:!0,get:function(){return f(this.Ee)},set:function(w){typeof w=="string"?this.Ee=_(w):w.Se&&(this.Ee=w)}}),this.arc=function(w,F,V,Z,et,nt){Q(this.ne,w,F,V,V,0,Z,et,nt)},this.arcTo=function(w,F,V,Z,et){Wt(this.ne,w,F,V,Z,et)},this.beginPath=function(){this.ne.delete(),this.ne=new o.Path},this.bezierCurveTo=function(w,F,V,Z,et,nt){var wt=this.ne;p([w,F,V,Z,et,nt])&&(wt.isEmpty()&&wt.moveTo(w,F),wt.cubicTo(w,F,V,Z,et,nt))},this.clearRect=function(w,F,V,Z){this.le.setStyle(o.PaintStyle.Fill),this.le.setBlendMode(o.BlendMode.Clear),this.ie.drawRect(o.XYWHRect(w,F,V,Z),this.le),this.le.setBlendMode(this.ke)},this.clip=function(w,F){typeof w=="string"?(F=w,w=this.ne):w&&w.Bf&&(w=w.re),w||(w=this.ne),w=w.copy(),F&&F.toLowerCase()==="evenodd"?w.setFillType(o.FillType.EvenOdd):w.setFillType(o.FillType.Winding),this.ie.clipPath(w,o.ClipOp.Intersect,!0),w.delete()},this.closePath=function(){$t(this.ne)},this.createImageData=function(){if(arguments.length===1){var w=arguments[0];return new Tt(new Uint8ClampedArray(4*w.width*w.height),w.width,w.height)}if(arguments.length===2){w=arguments[0];var F=arguments[1];return new Tt(new Uint8ClampedArray(4*w*F),w,F)}throw"createImageData expects 1 or 2 arguments, got "+arguments.length},this.createLinearGradient=function(w,F,V,Z){if(p(arguments)){var et=new At(w,F,V,Z);return this.$e.push(et),et}},this.createPattern=function(w,F){return w=new ye(w,F),this.$e.push(w),w},this.createRadialGradient=function(w,F,V,Z,et,nt){if(p(arguments)){var wt=new je(w,F,V,Z,et,nt);return this.$e.push(wt),wt}},this.drawImage=function(w){w instanceof ht&&(w=w.Rf());var F=this.qf();if(arguments.length===3||arguments.length===5)var V=o.XYWHRect(arguments[1],arguments[2],arguments[3]||w.width(),arguments[4]||w.height()),Z=o.XYWHRect(0,0,w.width(),w.height());else if(arguments.length===9)V=o.XYWHRect(arguments[5],arguments[6],arguments[7],arguments[8]),Z=o.XYWHRect(arguments[1],arguments[2],arguments[3],arguments[4]);else throw"invalid number of args for drawImage, need 3, 5, or 9; got "+arguments.length;this.ie.drawImageRect(w,Z,V,F,!1),F.dispose()},this.ellipse=function(w,F,V,Z,et,nt,wt,Vt){Q(this.ne,w,F,V,Z,et,nt,wt,Vt)},this.qf=function(){var w=this.le.copy();if(w.setStyle(o.PaintStyle.Fill),g(this.ye)){var F=o.multiplyByAlpha(this.ye,this.He);w.setColor(F)}else F=this.ye.Se(this.qe),w.setColor(o.Color(0,0,0,this.He)),w.setShader(F);return w.dispose=function(){this.delete()},w},this.fill=function(w,F){if(typeof w=="string"?(F=w,w=this.ne):w&&w.Bf&&(w=w.re),F==="evenodd")this.ne.setFillType(o.FillType.EvenOdd);else{if(F!=="nonzero"&&F)throw"invalid fill rule";this.ne.setFillType(o.FillType.Winding)}w||(w=this.ne),F=this.qf();var V=this.Xe(F);V&&(this.ie.save(),this.Qe(),this.ie.drawPath(w,V),this.ie.restore(),V.dispose()),this.ie.drawPath(w,F),F.dispose()},this.fillRect=function(w,F,V,Z){var et=this.qf(),nt=this.Xe(et);nt&&(this.ie.save(),this.Qe(),this.ie.drawRect(o.XYWHRect(w,F,V,Z),nt),this.ie.restore(),nt.dispose()),this.ie.drawRect(o.XYWHRect(w,F,V,Z),et),et.dispose()},this.fillText=function(w,F,V){var Z=this.qf();w=o.TextBlob.MakeFromText(w,this.Le);var et=this.Xe(Z);et&&(this.ie.save(),this.Qe(),this.ie.drawTextBlob(w,F,V,et),this.ie.restore(),et.dispose()),this.ie.drawTextBlob(w,F,V,Z),w.delete(),Z.dispose()},this.getImageData=function(w,F,V,Z){return(w=this.ie.readPixels(w,F,{width:V,height:Z,colorType:o.ColorType.RGBA_8888,alphaType:o.AlphaType.Unpremul,colorSpace:o.ColorSpace.SRGB}))?new Tt(new Uint8ClampedArray(w.buffer),V,Z):null},this.getLineDash=function(){return this.Te.slice()},this.Mf=function(w){var F=o.Matrix.invert(this.qe);return o.Matrix.mapPoints(F,w),w},this.isPointInPath=function(w,F,V){var Z=arguments;if(Z.length===3)var et=this.ne;else if(Z.length===4)et=Z[0],w=Z[1],F=Z[2],V=Z[3];else throw"invalid arg count, need 3 or 4, got "+Z.length;return!isFinite(w)||!isFinite(F)||(V=V||"nonzero",V!=="nonzero"&&V!=="evenodd")?!1:(Z=this.Mf([w,F]),w=Z[0],F=Z[1],et.setFillType(V==="nonzero"?o.FillType.Winding:o.FillType.EvenOdd),et.contains(w,F))},this.isPointInStroke=function(w,F){var V=arguments;if(V.length===2)var Z=this.ne;else if(V.length===3)Z=V[0],w=V[1],F=V[2];else throw"invalid arg count, need 2 or 3, got "+V.length;return!isFinite(w)||!isFinite(F)?!1:(V=this.Mf([w,F]),w=V[0],F=V[1],Z=Z.copy(),Z.setFillType(o.FillType.Winding),Z.stroke({width:this.lineWidth,miter_limit:this.miterLimit,cap:this.le.getStrokeCap(),join:this.le.getStrokeJoin(),precision:.3}),V=Z.contains(w,F),Z.delete(),V)},this.lineTo=function(w,F){Lt(this.ne,w,F)},this.measureText=function(w){w=this.Le.getGlyphIDs(w),w=this.Le.getGlyphWidths(w);let F=0;for(const V of w)F+=V;return{width:F}},this.moveTo=function(w,F){var V=this.ne;p([w,F])&&V.moveTo(w,F)},this.putImageData=function(w,F,V,Z,et,nt,wt){if(p([F,V,Z,et,nt,wt])){if(Z===void 0)this.ie.writePixels(w.data,w.width,w.height,F,V);else if(Z=Z||0,et=et||0,nt=nt||w.width,wt=wt||w.height,0>nt&&(Z+=nt,nt=Math.abs(nt)),0>wt&&(et+=wt,wt=Math.abs(wt)),0>Z&&(nt+=Z,Z=0),0>et&&(wt+=et,et=0),!(0>=nt||0>=wt)){w=o.MakeImage({width:w.width,height:w.height,alphaType:o.AlphaType.Unpremul,colorType:o.ColorType.RGBA_8888,colorSpace:o.ColorSpace.SRGB},w.data,4*w.width);var Vt=o.XYWHRect(Z,et,nt,wt);F=o.XYWHRect(F+Z,V+et,nt,wt),V=o.Matrix.invert(this.qe),this.ie.save(),this.ie.concat(V),this.ie.drawImageRect(w,Vt,F,null,!1),this.ie.restore(),w.delete()}}},this.quadraticCurveTo=function(w,F,V,Z){var et=this.ne;p([w,F,V,Z])&&(et.isEmpty()&&et.moveTo(w,F),et.quadTo(w,F,V,Z))},this.rect=function(w,F,V,Z){var et=this.ne;w=o.XYWHRect(w,F,V,Z),p(w)&&et.addRect(w)},this.resetTransform=function(){this.ne.transform(this.qe);var w=o.Matrix.invert(this.qe);this.ie.concat(w),this.qe=this.ie.getTotalMatrix()},this.restore=function(){var w=this.Lf.pop();if(w){var F=o.Matrix.multiply(this.qe,o.Matrix.invert(w.eg));this.ne.transform(F),this.le.delete(),this.le=w.yg,this.Te=w.wg,this.hf=w.Kg,this.Ee=w.Jg,this.ye=w.fs,this.Ve=w.Hg,this.We=w.Ig,this.Ue=w.sb,this.gf=w.Gg,this.He=w.ga,this.ke=w.lg,this.ff=w.xg,this.rf=w.kg,this.ie.restore(),this.qe=this.ie.getTotalMatrix()}},this.rotate=function(w){if(isFinite(w)){var F=o.Matrix.rotated(-w);this.ne.transform(F),this.ie.rotate(w/Math.PI*180,0,0),this.qe=this.ie.getTotalMatrix()}},this.save=function(){if(this.ye.Re){var w=this.ye.Re();this.$e.push(w)}else w=this.ye;if(this.Ee.Re){var F=this.Ee.Re();this.$e.push(F)}else F=this.Ee;this.Lf.push({eg:this.qe.slice(),wg:this.Te.slice(),Kg:this.hf,Jg:F,fs:w,Hg:this.Ve,Ig:this.We,sb:this.Ue,Gg:this.gf,ga:this.He,xg:this.ff,lg:this.ke,yg:this.le.copy(),kg:this.rf}),this.ie.save()},this.scale=function(w,F){if(p(arguments)){var V=o.Matrix.scaled(1/w,1/F);this.ne.transform(V),this.ie.scale(w,F),this.qe=this.ie.getTotalMatrix()}},this.setLineDash=function(w){for(var F=0;F<w.length;F++)if(!isFinite(w[F])||0>w[F])return;w.length%2===1&&Array.prototype.push.apply(w,w),this.Te=w},this.setTransform=function(w,F,V,Z,et,nt){p(arguments)&&(this.resetTransform(),this.transform(w,F,V,Z,et,nt))},this.Qe=function(){var w=o.Matrix.invert(this.qe);this.ie.concat(w),this.ie.concat(o.Matrix.translated(this.Ve,this.We)),this.ie.concat(this.qe)},this.Xe=function(w){var F=o.multiplyByAlpha(this.gf,this.He);if(!o.getColorComponents(F)[3]||!(this.Ue||this.We||this.Ve))return null;w=w.copy(),w.setColor(F);var V=o.MaskFilter.MakeBlur(o.BlurStyle.Normal,this.Ue/2,!1);return w.setMaskFilter(V),w.dispose=function(){V.delete(),this.delete()},w},this.Df=function(){var w=this.le.copy();if(w.setStyle(o.PaintStyle.Stroke),g(this.Ee)){var F=o.multiplyByAlpha(this.Ee,this.He);w.setColor(F)}else F=this.Ee.Se(this.qe),w.setColor(o.Color(0,0,0,this.He)),w.setShader(F);if(w.setStrokeWidth(this.hf),this.Te.length){var V=o.PathEffect.MakeDash(this.Te,this.ff);w.setPathEffect(V)}return w.dispose=function(){V&&V.delete(),this.delete()},w},this.stroke=function(w){w=w?w.re:this.ne;var F=this.Df(),V=this.Xe(F);V&&(this.ie.save(),this.Qe(),this.ie.drawPath(w,V),this.ie.restore(),V.dispose()),this.ie.drawPath(w,F),F.dispose()},this.strokeRect=function(w,F,V,Z){var et=this.Df(),nt=this.Xe(et);nt&&(this.ie.save(),this.Qe(),this.ie.drawRect(o.XYWHRect(w,F,V,Z),nt),this.ie.restore(),nt.dispose()),this.ie.drawRect(o.XYWHRect(w,F,V,Z),et),et.dispose()},this.strokeText=function(w,F,V){var Z=this.Df();w=o.TextBlob.MakeFromText(w,this.Le);var et=this.Xe(Z);et&&(this.ie.save(),this.Qe(),this.ie.drawTextBlob(w,F,V,et),this.ie.restore(),et.dispose()),this.ie.drawTextBlob(w,F,V,Z),w.delete(),Z.dispose()},this.translate=function(w,F){if(p(arguments)){var V=o.Matrix.translated(-w,-F);this.ne.transform(V),this.ie.translate(w,F),this.qe=this.ie.getTotalMatrix()}},this.transform=function(w,F,V,Z,et,nt){w=[w,V,et,F,Z,nt,0,0,1],F=o.Matrix.invert(w),this.ne.transform(F),this.ie.concat(w),this.qe=this.ie.getTotalMatrix()},this.addHitRegion=function(){},this.clearHitRegions=function(){},this.drawFocusIfNeeded=function(){},this.removeHitRegion=function(){},this.scrollPathIntoView=function(){},Object.defineProperty(this,"canvas",{value:null,writable:!1})}function J(ot){this.Ef=ot,this.he=new G(ot.getCanvas()),this.sf=[],this.decodeImage=function(w){if(w=o.MakeImageFromEncoded(w),!w)throw"Invalid input";return this.sf.push(w),new ht(w)},this.loadFont=function(w,F){if(w=o.Typeface.MakeTypefaceFromData(w),!w)return null;this.sf.push(w);var V=(F.style||"normal")+"|"+(F.variant||"normal")+"|"+(F.weight||"normal");F=F.family,B(),ie[F]||(ie[F]={"*":w}),ie[F][V]=w},this.makePath2D=function(w){return w=new re(w),this.sf.push(w.re),w},this.getContext=function(w){return w==="2d"?this.he:null},this.toDataURL=function(w,F){this.Ef.flush();var V=this.Ef.makeImageSnapshot();if(V){w=w||"image/png";var Z=o.ImageFormat.PNG;if(w==="image/jpeg"&&(Z=o.ImageFormat.JPEG),F=V.encodeToBytes(Z,F||.92)){if(V.delete(),w="data:"+w+";base64,",typeof Buffer<"u")F=Buffer.from(F).toString("base64");else{V=0,Z=F.length;for(var et="",nt;V<Z;)nt=F.slice(V,Math.min(V+32768,Z)),et+=String.fromCharCode.apply(null,nt),V+=32768;F=btoa(et)}return w+F}}},this.dispose=function(){this.he.Ke(),this.sf.forEach(function(w){w.delete()}),this.Ef.dispose()}}function ht(ot){this.width=ot.width(),this.height=ot.height(),this.naturalWidth=this.width,this.naturalHeight=this.height,this.Rf=function(){return ot}}function Tt(ot,w,F){if(!w||F===0)throw new TypeError("invalid dimensions, width and height must be non-zero");if(ot.length%4)throw new TypeError("arr must be a multiple of 4");F=F||ot.length/(4*w),Object.defineProperty(this,"data",{value:ot,writable:!1}),Object.defineProperty(this,"height",{value:F,writable:!1}),Object.defineProperty(this,"width",{value:w,writable:!1})}function At(ot,w,F,V){this.te=null,this.Ae=[],this.we=[],this.addColorStop=function(Z,et){if(0>Z||1<Z||!isFinite(Z))throw"offset must be between 0 and 1 inclusively";et=_(et);var nt=this.we.indexOf(Z);if(nt!==-1)this.Ae[nt]=et;else{for(nt=0;nt<this.we.length&&!(this.we[nt]>Z);nt++);this.we.splice(nt,0,Z),this.Ae.splice(nt,0,et)}},this.Re=function(){var Z=new At(ot,w,F,V);return Z.Ae=this.Ae.slice(),Z.we=this.we.slice(),Z},this.Ke=function(){this.te&&(this.te.delete(),this.te=null)},this.Se=function(Z){var et=[ot,w,F,V];o.Matrix.mapPoints(Z,et),Z=et[0];var nt=et[1],wt=et[2];return et=et[3],this.Ke(),this.te=o.Shader.MakeLinearGradient([Z,nt],[wt,et],this.Ae,this.we,o.TileMode.Clamp)}}function Wt(ot,w,F,V,Z,et){if(p([w,F,V,Z,et])){if(0>et)throw"radii cannot be negative";ot.isEmpty()&&ot.moveTo(w,F),ot.arcToTangent(w,F,V,Z,et)}}function $t(ot){if(!ot.isEmpty()){var w=ot.getBounds();(w[3]-w[1]||w[2]-w[0])&&ot.close()}}function O(ot,w,F,V,Z,et,nt){nt=(nt-et)/Math.PI*180,et=et/Math.PI*180,w=o.LTRBRect(w-V,F-Z,w+V,F+Z),1e-5>Math.abs(Math.abs(nt)-360)?(F=nt/2,ot.arcToOval(w,et,F,!1),ot.arcToOval(w,et+F,F,!1)):ot.arcToOval(w,et,nt,!1)}function Q(ot,w,F,V,Z,et,nt,wt,Vt){if(p([w,F,V,Z,et,nt,wt])){if(0>V||0>Z)throw"radii cannot be negative";var Be=2*Math.PI,Vi=nt%Be;0>Vi&&(Vi+=Be);var On=Vi-nt;nt=Vi,wt+=On,!Vt&&wt-nt>=Be?wt=nt+Be:Vt&&nt-wt>=Be?wt=nt-Be:!Vt&&nt>wt?wt=nt+(Be-(nt-wt)%Be):Vt&&nt<wt&&(wt=nt-(Be-(wt-nt)%Be)),et?(Vt=o.Matrix.rotated(et,w,F),et=o.Matrix.rotated(-et,w,F),ot.transform(et),O(ot,w,F,V,Z,nt,wt),ot.transform(Vt)):O(ot,w,F,V,Z,nt,wt)}}function Lt(ot,w,F){p([w,F])&&(ot.isEmpty()&&ot.moveTo(w,F),ot.lineTo(w,F))}function re(ot){this.re=null,this.re=typeof ot=="string"?o.Path.MakeFromSVGString(ot):ot&&ot.Bf?ot.re.copy():new o.Path,this.Bf=function(){return this.re},this.addPath=function(w,F){F||(F={a:1,c:0,e:0,b:0,d:1,f:0}),this.re.addPath(w.re,[F.a,F.c,F.e,F.b,F.d,F.f])},this.arc=function(w,F,V,Z,et,nt){Q(this.re,w,F,V,V,0,Z,et,nt)},this.arcTo=function(w,F,V,Z,et){Wt(this.re,w,F,V,Z,et)},this.bezierCurveTo=function(w,F,V,Z,et,nt){var wt=this.re;p([w,F,V,Z,et,nt])&&(wt.isEmpty()&&wt.moveTo(w,F),wt.cubicTo(w,F,V,Z,et,nt))},this.closePath=function(){$t(this.re)},this.ellipse=function(w,F,V,Z,et,nt,wt,Vt){Q(this.re,w,F,V,Z,et,nt,wt,Vt)},this.lineTo=function(w,F){Lt(this.re,w,F)},this.moveTo=function(w,F){var V=this.re;p([w,F])&&V.moveTo(w,F)},this.quadraticCurveTo=function(w,F,V,Z){var et=this.re;p([w,F,V,Z])&&(et.isEmpty()&&et.moveTo(w,F),et.quadTo(w,F,V,Z))},this.rect=function(w,F,V,Z){var et=this.re;w=o.XYWHRect(w,F,V,Z),p(w)&&et.addRect(w)}}function ye(ot,w){switch(this.te=null,ot instanceof ht&&(ot=ot.Rf()),this.$f=ot,this._transform=o.Matrix.identity(),w===""&&(w="repeat"),w){case"repeat-x":this.Ye=o.TileMode.Repeat,this.Ze=o.TileMode.Decal;break;case"repeat-y":this.Ye=o.TileMode.Decal,this.Ze=o.TileMode.Repeat;break;case"repeat":this.Ze=this.Ye=o.TileMode.Repeat;break;case"no-repeat":this.Ze=this.Ye=o.TileMode.Decal;break;default:throw"invalid repetition mode "+w}this.setTransform=function(F){F=[F.a,F.c,F.e,F.b,F.d,F.f,0,0,1],p(F)&&(this._transform=F)},this.Re=function(){var F=new ye;return F.Ye=this.Ye,F.Ze=this.Ze,F},this.Ke=function(){this.te&&(this.te.delete(),this.te=null)},this.Se=function(){return this.Ke(),this.te=this.$f.makeShaderCubic(this.Ye,this.Ze,1/3,1/3,this._transform)}}function je(ot,w,F,V,Z,et){this.te=null,this.Ae=[],this.we=[],this.addColorStop=function(nt,wt){if(0>nt||1<nt||!isFinite(nt))throw"offset must be between 0 and 1 inclusively";wt=_(wt);var Vt=this.we.indexOf(nt);if(Vt!==-1)this.Ae[Vt]=wt;else{for(Vt=0;Vt<this.we.length&&!(this.we[Vt]>nt);Vt++);this.we.splice(Vt,0,nt),this.Ae.splice(Vt,0,wt)}},this.Re=function(){var nt=new je(ot,w,F,V,Z,et);return nt.Ae=this.Ae.slice(),nt.we=this.we.slice(),nt},this.Ke=function(){this.te&&(this.te.delete(),this.te=null)},this.Se=function(nt){var wt=[ot,w,V,Z];o.Matrix.mapPoints(nt,wt);var Vt=wt[0],Be=wt[1],Vi=wt[2];wt=wt[3];var On=(Math.abs(nt[0])+Math.abs(nt[4]))/2;return nt=F*On,On*=et,this.Ke(),this.te=o.Shader.MakeTwoPointConicalGradient([Vt,Be],nt,[Vi,wt],On,this.Ae,this.we,o.TileMode.Clamp)}}o._testing={};var rr={aliceblue:Float32Array.of(.941,.973,1,1),antiquewhite:Float32Array.of(.98,.922,.843,1),aqua:Float32Array.of(0,1,1,1),aquamarine:Float32Array.of(.498,1,.831,1),azure:Float32Array.of(.941,1,1,1),beige:Float32Array.of(.961,.961,.863,1),bisque:Float32Array.of(1,.894,.769,1),black:Float32Array.of(0,0,0,1),blanchedalmond:Float32Array.of(1,.922,.804,1),blue:Float32Array.of(0,0,1,1),blueviolet:Float32Array.of(.541,.169,.886,1),brown:Float32Array.of(.647,.165,.165,1),burlywood:Float32Array.of(.871,.722,.529,1),cadetblue:Float32Array.of(.373,.62,.627,1),chartreuse:Float32Array.of(.498,1,0,1),chocolate:Float32Array.of(.824,.412,.118,1),coral:Float32Array.of(1,.498,.314,1),cornflowerblue:Float32Array.of(.392,.584,.929,1),cornsilk:Float32Array.of(1,.973,.863,1),crimson:Float32Array.of(.863,.078,.235,1),cyan:Float32Array.of(0,1,1,1),darkblue:Float32Array.of(0,0,.545,1),darkcyan:Float32Array.of(0,.545,.545,1),darkgoldenrod:Float32Array.of(.722,.525,.043,1),darkgray:Float32Array.of(.663,.663,.663,1),darkgreen:Float32Array.of(0,.392,0,1),darkgrey:Float32Array.of(.663,.663,.663,1),darkkhaki:Float32Array.of(.741,.718,.42,1),darkmagenta:Float32Array.of(.545,0,.545,1),darkolivegreen:Float32Array.of(.333,.42,.184,1),darkorange:Float32Array.of(1,.549,0,1),darkorchid:Float32Array.of(.6,.196,.8,1),darkred:Float32Array.of(.545,0,0,1),darksalmon:Float32Array.of(.914,.588,.478,1),darkseagreen:Float32Array.of(.561,.737,.561,1),darkslateblue:Float32Array.of(.282,.239,.545,1),darkslategray:Float32Array.of(.184,.31,.31,1),darkslategrey:Float32Array.of(.184,.31,.31,1),darkturquoise:Float32Array.of(0,.808,.82,1),darkviolet:Float32Array.of(.58,0,.827,1),deeppink:Float32Array.of(1,.078,.576,1),deepskyblue:Float32Array.of(0,.749,1,1),dimgray:Float32Array.of(.412,.412,.412,1),dimgrey:Float32Array.of(.412,.412,.412,1),dodgerblue:Float32Array.of(.118,.565,1,1),firebrick:Float32Array.of(.698,.133,.133,1),floralwhite:Float32Array.of(1,.98,.941,1),forestgreen:Float32Array.of(.133,.545,.133,1),fuchsia:Float32Array.of(1,0,1,1),gainsboro:Float32Array.of(.863,.863,.863,1),ghostwhite:Float32Array.of(.973,.973,1,1),gold:Float32Array.of(1,.843,0,1),goldenrod:Float32Array.of(.855,.647,.125,1),gray:Float32Array.of(.502,.502,.502,1),green:Float32Array.of(0,.502,0,1),greenyellow:Float32Array.of(.678,1,.184,1),grey:Float32Array.of(.502,.502,.502,1),honeydew:Float32Array.of(.941,1,.941,1),hotpink:Float32Array.of(1,.412,.706,1),indianred:Float32Array.of(.804,.361,.361,1),indigo:Float32Array.of(.294,0,.51,1),ivory:Float32Array.of(1,1,.941,1),khaki:Float32Array.of(.941,.902,.549,1),lavender:Float32Array.of(.902,.902,.98,1),lavenderblush:Float32Array.of(1,.941,.961,1),lawngreen:Float32Array.of(.486,.988,0,1),lemonchiffon:Float32Array.of(1,.98,.804,1),lightblue:Float32Array.of(.678,.847,.902,1),lightcoral:Float32Array.of(.941,.502,.502,1),lightcyan:Float32Array.of(.878,1,1,1),lightgoldenrodyellow:Float32Array.of(.98,.98,.824,1),lightgray:Float32Array.of(.827,.827,.827,1),lightgreen:Float32Array.of(.565,.933,.565,1),lightgrey:Float32Array.of(.827,.827,.827,1),lightpink:Float32Array.of(1,.714,.757,1),lightsalmon:Float32Array.of(1,.627,.478,1),lightseagreen:Float32Array.of(.125,.698,.667,1),lightskyblue:Float32Array.of(.529,.808,.98,1),lightslategray:Float32Array.of(.467,.533,.6,1),lightslategrey:Float32Array.of(.467,.533,.6,1),lightsteelblue:Float32Array.of(.69,.769,.871,1),lightyellow:Float32Array.of(1,1,.878,1),lime:Float32Array.of(0,1,0,1),limegreen:Float32Array.of(.196,.804,.196,1),linen:Float32Array.of(.98,.941,.902,1),magenta:Float32Array.of(1,0,1,1),maroon:Float32Array.of(.502,0,0,1),mediumaquamarine:Float32Array.of(.4,.804,.667,1),mediumblue:Float32Array.of(0,0,.804,1),mediumorchid:Float32Array.of(.729,.333,.827,1),mediumpurple:Float32Array.of(.576,.439,.859,1),mediumseagreen:Float32Array.of(.235,.702,.443,1),mediumslateblue:Float32Array.of(.482,.408,.933,1),mediumspringgreen:Float32Array.of(0,.98,.604,1),mediumturquoise:Float32Array.of(.282,.82,.8,1),mediumvioletred:Float32Array.of(.78,.082,.522,1),midnightblue:Float32Array.of(.098,.098,.439,1),mintcream:Float32Array.of(.961,1,.98,1),mistyrose:Float32Array.of(1,.894,.882,1),moccasin:Float32Array.of(1,.894,.71,1),navajowhite:Float32Array.of(1,.871,.678,1),navy:Float32Array.of(0,0,.502,1),oldlace:Float32Array.of(.992,.961,.902,1),olive:Float32Array.of(.502,.502,0,1),olivedrab:Float32Array.of(.42,.557,.137,1),orange:Float32Array.of(1,.647,0,1),orangered:Float32Array.of(1,.271,0,1),orchid:Float32Array.of(.855,.439,.839,1),palegoldenrod:Float32Array.of(.933,.91,.667,1),palegreen:Float32Array.of(.596,.984,.596,1),paleturquoise:Float32Array.of(.686,.933,.933,1),palevioletred:Float32Array.of(.859,.439,.576,1),papayawhip:Float32Array.of(1,.937,.835,1),peachpuff:Float32Array.of(1,.855,.725,1),peru:Float32Array.of(.804,.522,.247,1),pink:Float32Array.of(1,.753,.796,1),plum:Float32Array.of(.867,.627,.867,1),powderblue:Float32Array.of(.69,.878,.902,1),purple:Float32Array.of(.502,0,.502,1),rebeccapurple:Float32Array.of(.4,.2,.6,1),red:Float32Array.of(1,0,0,1),rosybrown:Float32Array.of(.737,.561,.561,1),royalblue:Float32Array.of(.255,.412,.882,1),saddlebrown:Float32Array.of(.545,.271,.075,1),salmon:Float32Array.of(.98,.502,.447,1),sandybrown:Float32Array.of(.957,.643,.376,1),seagreen:Float32Array.of(.18,.545,.341,1),seashell:Float32Array.of(1,.961,.933,1),sienna:Float32Array.of(.627,.322,.176,1),silver:Float32Array.of(.753,.753,.753,1),skyblue:Float32Array.of(.529,.808,.922,1),slateblue:Float32Array.of(.416,.353,.804,1),slategray:Float32Array.of(.439,.502,.565,1),slategrey:Float32Array.of(.439,.502,.565,1),snow:Float32Array.of(1,.98,.98,1),springgreen:Float32Array.of(0,1,.498,1),steelblue:Float32Array.of(.275,.51,.706,1),tan:Float32Array.of(.824,.706,.549,1),teal:Float32Array.of(0,.502,.502,1),thistle:Float32Array.of(.847,.749,.847,1),tomato:Float32Array.of(1,.388,.278,1),transparent:Float32Array.of(0,0,0,0),turquoise:Float32Array.of(.251,.878,.816,1),violet:Float32Array.of(.933,.51,.933,1),wheat:Float32Array.of(.961,.871,.702,1),white:Float32Array.of(1,1,1,1),whitesmoke:Float32Array.of(.961,.961,.961,1),yellow:Float32Array.of(1,1,0,1),yellowgreen:Float32Array.of(.604,.804,.196,1)};o._testing.parseColor=_,o._testing.colorToString=f;var hr=RegExp("(italic|oblique|normal|)\\s*(small-caps|normal|)\\s*(bold|bolder|lighter|[1-9]00|normal|)\\s*([\\d\\.]+)(px|pt|pc|in|cm|mm|%|em|ex|ch|rem|q)(.+)"),ie;o._testing.parseFontString=A,o.MakeCanvas=function(ot,w){return(ot=o.MakeSurface(ot,w))?new J(ot):null},o.ImageData=function(){if(arguments.length===2){var ot=arguments[0],w=arguments[1];return new Tt(new Uint8ClampedArray(4*ot*w),ot,w)}if(arguments.length===3){var F=arguments[0];if(F.prototype.constructor!==Uint8ClampedArray)throw new TypeError("bytes must be given as a Uint8ClampedArray");if(ot=arguments[1],w=arguments[2],F%4)throw new TypeError("bytes must be given in a multiple of 4");if(F%ot)throw new TypeError("bytes must divide evenly by width");if(w&&w!==F/(4*ot))throw new TypeError("invalid height given");return new Tt(F,ot,F/(4*ot))}throw new TypeError("invalid number of arguments - takes 2 or 3, saw "+arguments.length)}}()}(e);var s=Object.assign({},e),a="./this.program",h=(o,l)=>{throw l},u=typeof window=="object",c=typeof importScripts=="function",m=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",y="",v,b,T;if(m){var E=require("fs"),P=require("path");y=c?P.dirname(y)+"/":__dirname+"/",v=(o,l)=>(o=o.startsWith("file://")?new URL(o):P.normalize(o),E.readFileSync(o,l?void 0:"utf8")),T=o=>(o=v(o,!0),o.buffer||(o=new Uint8Array(o)),o),b=(o,l,d,g=!0)=>{o=o.startsWith("file://")?new URL(o):P.normalize(o),E.readFile(o,g?void 0:"utf8",(x,S)=>{x?d(x):l(g?S.buffer:S)})},!e.thisProgram&&1<process.argv.length&&(a=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),h=(o,l)=>{throw process.exitCode=o,l},e.inspect=()=>"[Emscripten Module object]"}else(u||c)&&(c?y=self.location.href:typeof document<"u"&&document.currentScript&&(y=document.currentScript.src),i&&(y=i),y.indexOf("blob:")!==0?y=y.substr(0,y.replace(/[?#].*/,"").lastIndexOf("/")+1):y="",v=o=>{var l=new XMLHttpRequest;return l.open("GET",o,!1),l.send(null),l.responseText},c&&(T=o=>{var l=new XMLHttpRequest;return l.open("GET",o,!1),l.responseType="arraybuffer",l.send(null),new Uint8Array(l.response)}),b=(o,l,d)=>{var g=new XMLHttpRequest;g.open("GET",o,!0),g.responseType="arraybuffer",g.onload=()=>{g.status==200||g.status==0&&g.response?l(g.response):d()},g.onerror=d,g.send(null)});var M=e.print||console.log.bind(console),D=e.printErr||console.error.bind(console);Object.assign(e,s),s=null,e.thisProgram&&(a=e.thisProgram),e.quit&&(h=e.quit);var R;e.wasmBinary&&(R=e.wasmBinary);var N=e.noExitRuntime||!0;typeof WebAssembly!="object"&&Gt("no native wasm support detected");var Y,X,K=!1,q,j,st,yt,$,H,z,vt;function Pt(){var o=Y.buffer;e.HEAP8=q=new Int8Array(o),e.HEAP16=st=new Int16Array(o),e.HEAP32=$=new Int32Array(o),e.HEAPU8=j=new Uint8Array(o),e.HEAPU16=yt=new Uint16Array(o),e.HEAPU32=H=new Uint32Array(o),e.HEAPF32=z=new Float32Array(o),e.HEAPF64=vt=new Float64Array(o)}var dt,St=[],Kt=[],lt=[];function ct(){var o=e.preRun.shift();St.unshift(o)}var Mt=0,Dt=null;function Gt(o){throw e.onAbort&&e.onAbort(o),o="Aborted("+o+")",D(o),K=!0,o=new WebAssembly.RuntimeError(o+". Build with -sASSERTIONS for more info."),n(o),o}function zt(o){return o.startsWith("data:application/octet-stream;base64,")}var Nt;if(Nt="canvaskit.wasm",!zt(Nt)){var Zt=Nt;Nt=e.locateFile?e.locateFile(Zt,y):y+Zt}function te(o){if(o==Nt&&R)return new Uint8Array(R);if(T)return T(o);throw"both async and sync fetching of the wasm failed"}function de(o){if(!R&&(u||c)){if(typeof fetch=="function"&&!o.startsWith("file://"))return fetch(o,{credentials:"same-origin"}).then(l=>{if(!l.ok)throw"failed to load wasm binary file at '"+o+"'";return l.arrayBuffer()}).catch(()=>te(o));if(b)return new Promise((l,d)=>{b(o,g=>l(new Uint8Array(g)),d)})}return Promise.resolve().then(()=>te(o))}function Qt(o,l,d){return de(o).then(g=>WebAssembly.instantiate(g,l)).then(g=>g).then(d,g=>{D("failed to asynchronously prepare wasm: "+g),Gt(g)})}function se(o,l){var d=Nt;return R||typeof WebAssembly.instantiateStreaming!="function"||zt(d)||d.startsWith("file://")||m||typeof fetch!="function"?Qt(d,o,l):fetch(d,{credentials:"same-origin"}).then(g=>WebAssembly.instantiateStreaming(g,o).then(l,function(x){return D("wasm streaming compile failed: "+x),D("falling back to ArrayBuffer instantiation"),Qt(d,o,l)}))}function ue(o){this.name="ExitStatus",this.message=`Program terminated with exit(${o})`,this.status=o}var he=o=>{for(;0<o.length;)o.shift()(e)},$e=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Te=(o,l,d)=>{var g=l+d;for(d=l;o[d]&&!(d>=g);)++d;if(16<d-l&&o.buffer&&$e)return $e.decode(o.subarray(l,d));for(g="";l<d;){var x=o[l++];if(x&128){var S=o[l++]&63;if((x&224)==192)g+=String.fromCharCode((x&31)<<6|S);else{var L=o[l++]&63;x=(x&240)==224?(x&15)<<12|S<<6|L:(x&7)<<18|S<<12|L<<6|o[l++]&63,65536>x?g+=String.fromCharCode(x):(x-=65536,g+=String.fromCharCode(55296|x>>10,56320|x&1023))}}else g+=String.fromCharCode(x)}return g},br={};function Tn(o){for(;o.length;){var l=o.pop();o.pop()(l)}}function Tr(o){return this.fromWireType($[o>>2])}var Gi={},vi={},_s={},Ll=void 0;function xs(o){throw new Ll(o)}function sr(o,l,d){function g(C){C=d(C),C.length!==o.length&&xs("Mismatched type converter count");for(var I=0;I<o.length;++I)wr(o[I],C[I])}o.forEach(function(C){_s[C]=l});var x=Array(l.length),S=[],L=0;l.forEach((C,I)=>{vi.hasOwnProperty(C)?x[I]=vi[C]:(S.push(C),Gi.hasOwnProperty(C)||(Gi[C]=[]),Gi[C].push(()=>{x[I]=vi[C],++L,L===S.length&&g(x)}))}),S.length===0&&g(x)}function bs(o){switch(o){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${o}`)}}var kl=void 0;function fe(o){for(var l="";j[o];)l+=kl[j[o++]];return l}var Hi=void 0;function Xt(o){throw new Hi(o)}function bp(o,l,d={}){var g=l.name;if(o||Xt(`type "${g}" must have a positive integer typeid pointer`),vi.hasOwnProperty(o)){if(d.tg)return;Xt(`Cannot register type '${g}' twice`)}vi[o]=l,delete _s[o],Gi.hasOwnProperty(o)&&(l=Gi[o],delete Gi[o],l.forEach(x=>x()))}function wr(o,l,d={}){if(!("argPackAdvance"in l))throw new TypeError("registerType registeredInstance requires argPackAdvance");bp(o,l,d)}function oa(o){Xt(o.ge.se.me.name+" instance already deleted")}var aa=!1;function Nl(){}function Ul(o){--o.count.value,o.count.value===0&&(o.ve?o.Ce.Je(o.ve):o.se.me.Je(o.oe))}function Gl(o,l,d){return l===d?o:d.xe===void 0?null:(o=Gl(o,l,d.xe),o===null?null:d.hg(o))}var Hl={},wn=[];function ha(){for(;wn.length;){var o=wn.pop();o.ge.cf=!1,o.delete()}}var An=void 0,En={};function Tp(o,l){for(l===void 0&&Xt("ptr should not be undefined");o.xe;)l=o.nf(l),o=o.xe;return En[l]}function Ts(o,l){return l.se&&l.oe||xs("makeClassHandle requires ptr and ptrType"),!!l.Ce!=!!l.ve&&xs("Both smartPtrType and smartPtr must be specified"),l.count={value:1},Sn(Object.create(o,{ge:{value:l}}))}function Sn(o){return typeof FinalizationRegistry>"u"?(Sn=l=>l,o):(aa=new FinalizationRegistry(l=>{Ul(l.ge)}),Sn=l=>{var d=l.ge;return d.ve&&aa.register(l,{ge:d},l),l},Nl=l=>{aa.unregister(l)},Sn(o))}function ri(){}function $l(o){if(o===void 0)return"_unknown";o=o.replace(/[^a-zA-Z0-9_]/g,"$");var l=o.charCodeAt(0);return 48<=l&&57>=l?`_${o}`:o}function la(o,l){return o=$l(o),{[o]:function(){return l.apply(this,arguments)}}[o]}function ua(o,l,d){if(o[l].ue===void 0){var g=o[l];o[l]=function(){return o[l].ue.hasOwnProperty(arguments.length)||Xt(`Function '${d}' called with an invalid number of arguments (${arguments.length}) - expects one of (${o[l].ue})!`),o[l].ue[arguments.length].apply(this,arguments)},o[l].ue=[],o[l].ue[g.af]=g}}function ca(o,l,d){e.hasOwnProperty(o)?((d===void 0||e[o].ue!==void 0&&e[o].ue[d]!==void 0)&&Xt(`Cannot register public name '${o}' twice`),ua(e,o,o),e.hasOwnProperty(d)&&Xt(`Cannot register multiple overloads of a function with the same number of arguments (${d})!`),e[o].ue[d]=l):(e[o]=l,d!==void 0&&(e[o].Ug=d))}function wp(o,l,d,g,x,S,L,C){this.name=o,this.constructor=l,this.df=d,this.Je=g,this.xe=x,this.mg=S,this.nf=L,this.hg=C,this.Ag=[]}function da(o,l,d){for(;l!==d;)l.nf||Xt(`Expected null or instance of ${d.name}, got an instance of ${l.name}`),o=l.nf(o),l=l.xe;return o}function Ap(o,l){return l===null?(this.Hf&&Xt(`null is not a valid ${this.name}`),0):(l.ge||Xt(`Cannot pass "${pa(l)}" as a ${this.name}`),l.ge.oe||Xt(`Cannot pass deleted object as a pointer of type ${this.name}`),da(l.ge.oe,l.ge.se.me,this.me))}function Ep(o,l){if(l===null){if(this.Hf&&Xt(`null is not a valid ${this.name}`),this.vf){var d=this.If();return o!==null&&o.push(this.Je,d),d}return 0}if(l.ge||Xt(`Cannot pass "${pa(l)}" as a ${this.name}`),l.ge.oe||Xt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.uf&&l.ge.se.uf&&Xt(`Cannot convert argument of type ${l.ge.Ce?l.ge.Ce.name:l.ge.se.name} to parameter type ${this.name}`),d=da(l.ge.oe,l.ge.se.me,this.me),this.vf)switch(l.ge.ve===void 0&&Xt("Passing raw pointer to smart pointer is illegal"),this.Fg){case 0:l.ge.Ce===this?d=l.ge.ve:Xt(`Cannot convert argument of type ${l.ge.Ce?l.ge.Ce.name:l.ge.se.name} to parameter type ${this.name}`);break;case 1:d=l.ge.ve;break;case 2:if(l.ge.Ce===this)d=l.ge.ve;else{var g=l.clone();d=this.Bg(d,Je(function(){g.delete()})),o!==null&&o.push(this.Je,d)}break;default:Xt("Unsupporting sharing policy")}return d}function Sp(o,l){return l===null?(this.Hf&&Xt(`null is not a valid ${this.name}`),0):(l.ge||Xt(`Cannot pass "${pa(l)}" as a ${this.name}`),l.ge.oe||Xt(`Cannot pass deleted object as a pointer of type ${this.name}`),l.ge.se.uf&&Xt(`Cannot convert argument of type ${l.ge.se.name} to parameter type ${this.name}`),da(l.ge.oe,l.ge.se.me,this.me))}function Ar(o,l,d,g,x,S,L,C,I,k,tt){this.name=o,this.me=l,this.Hf=d,this.uf=g,this.vf=x,this.zg=S,this.Fg=L,this.Tf=C,this.If=I,this.Bg=k,this.Je=tt,x||l.xe!==void 0?this.toWireType=Ep:(this.toWireType=g?Ap:Sp,this.Be=null)}function Wl(o,l,d){e.hasOwnProperty(o)||xs("Replacing nonexistant public symbol"),e[o].ue!==void 0&&d!==void 0?e[o].ue[d]=l:(e[o]=l,e[o].af=d)}var Cp=(o,l)=>{var d=[];return function(){if(d.length=0,Object.assign(d,arguments),o.includes("j")){var g=e["dynCall_"+o];g=d&&d.length?g.apply(null,[l].concat(d)):g.call(null,l)}else g=dt.get(l).apply(null,d);return g}};function Fe(o,l){o=fe(o);var d=o.includes("j")?Cp(o,l):dt.get(l);return typeof d!="function"&&Xt(`unknown function pointer with signature ${o}: ${l}`),d}var Vl=void 0;function jl(o){o=bu(o);var l=fe(o);return $r(o),l}function Cn(o,l){function d(S){x[S]||vi[S]||(_s[S]?_s[S].forEach(d):(g.push(S),x[S]=!0))}var g=[],x={};throw l.forEach(d),new Vl(`${o}: `+g.map(jl).join([", "]))}function ws(o,l,d,g,x){var S=l.length;2>S&&Xt("argTypes array size mismatch! Must at least get return value and 'this' types!");var L=l[1]!==null&&d!==null,C=!1;for(d=1;d<l.length;++d)if(l[d]!==null&&l[d].Be===void 0){C=!0;break}var I=l[0].name!=="void",k=S-2,tt=Array(k),it=[],_t=[];return function(){if(arguments.length!==k&&Xt(`function ${o} called with ${arguments.length} arguments, expected ${k} args!`),_t.length=0,it.length=L?2:1,it[0]=x,L){var W=l[1].toWireType(_t,this);it[1]=W}for(var xt=0;xt<k;++xt)tt[xt]=l[xt+2].toWireType(_t,arguments[xt]),it.push(tt[xt]);if(xt=g.apply(null,it),C)Tn(_t);else for(var Ot=L?1:2;Ot<l.length;Ot++){var Ft=Ot===1?W:tt[Ot-2];l[Ot].Be!==null&&l[Ot].Be(Ft)}return W=I?l[0].fromWireType(xt):void 0,W}}function As(o,l){for(var d=[],g=0;g<o;g++)d.push(H[l+4*g>>2]);return d}function zl(){this.Ie=[void 0],this.Qf=[]}var Ke=new zl;function fa(o){o>=Ke.kf&&--Ke.get(o).Uf===0&&Ke.sg(o)}var Ze=o=>(o||Xt("Cannot use deleted val. handle = "+o),Ke.get(o).value),Je=o=>{switch(o){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Ke.rg({Uf:1,value:o})}};function Pp(o,l,d){switch(l){case 0:return function(g){return this.fromWireType((d?q:j)[g])};case 1:return function(g){return this.fromWireType((d?st:yt)[g>>1])};case 2:return function(g){return this.fromWireType((d?$:H)[g>>2])};default:throw new TypeError("Unknown integer type: "+o)}}function Pn(o,l){var d=vi[o];return d===void 0&&Xt(l+" has unknown type "+jl(o)),d}function pa(o){if(o===null)return"null";var l=typeof o;return l==="object"||l==="array"||l==="function"?o.toString():""+o}function Rp(o,l){switch(l){case 2:return function(d){return this.fromWireType(z[d>>2])};case 3:return function(d){return this.fromWireType(vt[d>>3])};default:throw new TypeError("Unknown float type: "+o)}}function Mp(o,l,d){switch(l){case 0:return d?function(g){return q[g]}:function(g){return j[g]};case 1:return d?function(g){return st[g>>1]}:function(g){return yt[g>>1]};case 2:return d?function(g){return $[g>>2]}:function(g){return H[g>>2]};default:throw new TypeError("Unknown integer type: "+o)}}var Qe=(o,l,d,g)=>{if(!(0<g))return 0;var x=d;g=d+g-1;for(var S=0;S<o.length;++S){var L=o.charCodeAt(S);if(55296<=L&&57343>=L){var C=o.charCodeAt(++S);L=65536+((L&1023)<<10)|C&1023}if(127>=L){if(d>=g)break;l[d++]=L}else{if(2047>=L){if(d+1>=g)break;l[d++]=192|L>>6}else{if(65535>=L){if(d+2>=g)break;l[d++]=224|L>>12}else{if(d+3>=g)break;l[d++]=240|L>>18,l[d++]=128|L>>12&63}l[d++]=128|L>>6&63}l[d++]=128|L&63}}return l[d]=0,d-x},tr=o=>{for(var l=0,d=0;d<o.length;++d){var g=o.charCodeAt(d);127>=g?l++:2047>=g?l+=2:55296<=g&&57343>=g?(l+=4,++d):l+=3}return l},Xl=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Ip=(o,l)=>{for(var d=o>>1,g=d+l/2;!(d>=g)&&yt[d];)++d;if(d<<=1,32<d-o&&Xl)return Xl.decode(j.subarray(o,d));for(d="",g=0;!(g>=l/2);++g){var x=st[o+2*g>>1];if(x==0)break;d+=String.fromCharCode(x)}return d},Fp=(o,l,d)=>{if(d===void 0&&(d=2147483647),2>d)return 0;d-=2;var g=l;d=d<2*o.length?d/2:o.length;for(var x=0;x<d;++x)st[l>>1]=o.charCodeAt(x),l+=2;return st[l>>1]=0,l-g},Bp=o=>2*o.length,Dp=(o,l)=>{for(var d=0,g="";!(d>=l/4);){var x=$[o+4*d>>2];if(x==0)break;++d,65536<=x?(x-=65536,g+=String.fromCharCode(55296|x>>10,56320|x&1023)):g+=String.fromCharCode(x)}return g},Op=(o,l,d)=>{if(d===void 0&&(d=2147483647),4>d)return 0;var g=l;d=g+d-4;for(var x=0;x<o.length;++x){var S=o.charCodeAt(x);if(55296<=S&&57343>=S){var L=o.charCodeAt(++x);S=65536+((S&1023)<<10)|L&1023}if($[l>>2]=S,l+=4,l+4>d)break}return $[l>>2]=0,l-g},Lp=o=>{for(var l=0,d=0;d<o.length;++d){var g=o.charCodeAt(d);55296<=g&&57343>=g&&++d,l+=4}return l},kp={};function Es(o){var l=kp[o];return l===void 0?fe(o):l}var Ss=[];function Yl(){function o(l){l.$$$embind_global$$$=l;var d=typeof $$$embind_global$$$=="object"&&l.$$$embind_global$$$==l;return d||delete l.$$$embind_global$$$,d}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof global=="object"&&o(global)?$$$embind_global$$$=global:typeof self=="object"&&o(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Np(o){var l=Ss.length;return Ss.push(o),l}function Up(o,l){for(var d=Array(o),g=0;g<o;++g)d[g]=Pn(H[l+4*g>>2],"parameter "+g);return d}var ql=[];function Gp(o){var l=Array(o+1);return function(d,g,x){l[0]=d;for(var S=0;S<o;++S){var L=Pn(H[g+4*S>>2],"parameter "+S);l[S+1]=L.readValueFromPointer(x),x+=L.argPackAdvance}return d=new(d.bind.apply(d,l)),Je(d)}}var Kl={},_i=o=>{var l=tr(o)+1,d=Os(l);return d&&Qe(o,j,d,l),d};function Hp(o){var l=o.getExtension("ANGLE_instanced_arrays");l&&(o.vertexAttribDivisor=function(d,g){l.vertexAttribDivisorANGLE(d,g)},o.drawArraysInstanced=function(d,g,x,S){l.drawArraysInstancedANGLE(d,g,x,S)},o.drawElementsInstanced=function(d,g,x,S,L){l.drawElementsInstancedANGLE(d,g,x,S,L)})}function $p(o){var l=o.getExtension("OES_vertex_array_object");l&&(o.createVertexArray=function(){return l.createVertexArrayOES()},o.deleteVertexArray=function(d){l.deleteVertexArrayOES(d)},o.bindVertexArray=function(d){l.bindVertexArrayOES(d)},o.isVertexArray=function(d){return l.isVertexArrayOES(d)})}function Wp(o){var l=o.getExtension("WEBGL_draw_buffers");l&&(o.drawBuffers=function(d,g){l.drawBuffersWEBGL(d,g)})}var Zl=1,Cs=[],or=[],Ps=[],Rn=[],er=[],ar=[],Rs=[],Er=[],We=[],xi=[],bi=[],Jl={},Ql={},tu=4;function Yt(o){Ms||(Ms=o)}function Ti(o){for(var l=Zl++,d=o.length;d<l;d++)o[d]=null;return l}function Vp(o,l){o.kf||(o.kf=o.getContext,o.getContext=function(g,x){return x=o.kf(g,x),g=="webgl"==x instanceof WebGLRenderingContext?x:null});var d=1<l.majorVersion?o.getContext("webgl2",l):o.getContext("webgl",l);return d?jp(d,l):0}function jp(o,l){var d=Ti(Er),g={handle:d,attributes:l,version:l.majorVersion,De:o};return o.canvas&&(o.canvas.Xf=g),Er[d]=g,(typeof l.ig>"u"||l.ig)&&zp(g),d}function eu(o){return Bt=Er[o],e.Sg=U=Bt&&Bt.De,!(o&&!U)}function zp(o){if(o||(o=Bt),!o.ug){o.ug=!0;var l=o.De;Hp(l),$p(l),Wp(l),l.Of=l.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),l.Sf=l.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),2<=o.version&&(l.Fe=l.getExtension("EXT_disjoint_timer_query_webgl2")),(2>o.version||!l.Fe)&&(l.Fe=l.getExtension("EXT_disjoint_timer_query")),l.Tg=l.getExtension("WEBGL_multi_draw"),(l.getSupportedExtensions()||[]).forEach(function(d){d.includes("lose_context")||d.includes("debug")||l.getExtension(d)})}}var Bt,Ms;function ru(o,l){U.bindFramebuffer(o,Ps[l])}function iu(o){U.bindVertexArray(Rs[o])}function nu(o){U.clear(o)}function su(o,l,d,g){U.clearColor(o,l,d,g)}function ou(o){U.clearStencil(o)}function au(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2];U.deleteVertexArray(Rs[g]),Rs[g]=null}}var Is=[];function hu(o,l,d,g){U.drawElements(o,l,d,g)}function wi(o,l,d,g){for(var x=0;x<o;x++){var S=U[d](),L=S&&Ti(g);S?(S.name=L,g[L]=S):Yt(1282),$[l+4*x>>2]=L}}function lu(o,l){wi(o,l,"createVertexArray",Rs)}function uu(o,l){H[o>>2]=l,H[o+4>>2]=(l-H[o>>2])/4294967296}function cu(o,l,d){if(l){var g=void 0;switch(o){case 36346:g=1;break;case 36344:d!=0&&d!=1&&Yt(1280);return;case 34814:case 36345:g=0;break;case 34466:var x=U.getParameter(34467);g=x?x.length:0;break;case 33309:if(2>Bt.version){Yt(1282);return}g=2*(U.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(2>Bt.version){Yt(1280);return}g=o==33307?3:0}if(g===void 0)switch(x=U.getParameter(o),typeof x){case"number":g=x;break;case"boolean":g=x?1:0;break;case"string":Yt(1280);return;case"object":if(x===null)switch(o){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:g=0;break;default:Yt(1280);return}else{if(x instanceof Float32Array||x instanceof Uint32Array||x instanceof Int32Array||x instanceof Array){for(o=0;o<x.length;++o)switch(d){case 0:$[l+4*o>>2]=x[o];break;case 2:z[l+4*o>>2]=x[o];break;case 4:q[l+o>>0]=x[o]?1:0}return}try{g=x.name|0}catch(S){Yt(1280),D("GL_INVALID_ENUM in glGet"+d+"v: Unknown object returned from WebGL getParameter("+o+")! (error: "+S+")");return}}break;default:Yt(1280),D("GL_INVALID_ENUM in glGet"+d+"v: Native code calling glGet"+d+"v("+o+") and it returns "+x+" of type "+typeof x+"!");return}switch(d){case 1:uu(l,g);break;case 0:$[l>>2]=g;break;case 2:z[l>>2]=g;break;case 4:q[l>>0]=g?1:0}}else Yt(1281)}function du(o,l){cu(o,l,0)}function fu(o,l,d){if(d){o=We[o],l=2>Bt.version?U.Fe.getQueryObjectEXT(o,l):U.getQueryParameter(o,l);var g;typeof l=="boolean"?g=l?1:0:g=l,uu(d,g)}else Yt(1281)}function pu(o){var l=Jl[o];if(!l){switch(o){case 7939:l=U.getSupportedExtensions()||[],l=l.concat(l.map(function(g){return"GL_"+g})),l=_i(l.join(" "));break;case 7936:case 7937:case 37445:case 37446:(l=U.getParameter(o))||Yt(1280),l=l&&_i(l);break;case 7938:l=U.getParameter(7938),l=2<=Bt.version?"OpenGL ES 3.0 ("+l+")":"OpenGL ES 2.0 ("+l+")",l=_i(l);break;case 35724:l=U.getParameter(35724);var d=l.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);d!==null&&(d[1].length==3&&(d[1]+="0"),l="OpenGL ES GLSL ES "+d[1]+" ("+l+")"),l=_i(l);break;default:Yt(1280)}Jl[o]=l}return l}function mu(o,l){if(2>Bt.version)return Yt(1282),0;var d=Ql[o];if(d)return 0>l||l>=d.length?(Yt(1281),0):d[l];switch(o){case 7939:return d=U.getSupportedExtensions()||[],d=d.concat(d.map(function(g){return"GL_"+g})),d=d.map(function(g){return _i(g)}),d=Ql[o]=d,0>l||l>=d.length?(Yt(1281),0):d[l];default:return Yt(1280),0}}function gu(o){return o.slice(-1)=="]"&&o.lastIndexOf("[")}function Fs(o){return o-=5120,o==0?q:o==1?j:o==2?st:o==4?$:o==6?z:o==5||o==28922||o==28520||o==30779||o==30782?H:yt}function ma(o,l,d,g,x){o=Fs(o);var S=31-Math.clz32(o.BYTES_PER_ELEMENT),L=tu;return o.subarray(x>>S,x+g*(d*({5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[l-6402]||1)*(1<<S)+L-1&-L)>>S)}function Jt(o){var l=U.fg;if(l){var d=l.mf[o];return typeof d=="number"&&(l.mf[o]=d=U.getUniformLocation(l,l.Vf[o]+(0<d?"["+d+"]":""))),d}Yt(1282)}var ii=[],Mn=[],ga={},yu=()=>{if(!ya){var o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:a||"./this.program"},l;for(l in ga)ga[l]===void 0?delete o[l]:o[l]=ga[l];var d=[];for(l in o)d.push(`${l}=${o[l]}`);ya=d}return ya},ya,Xp=[null,[],[]],Bs=o=>o%4===0&&(o%100!==0||o%400===0),vu=[31,29,31,30,31,30,31,31,30,31,30,31],_u=[31,28,31,30,31,30,31,31,30,31,30,31];function Yp(o){var l=Array(tr(o)+1);return Qe(o,l,0,l.length),l}var qp=(o,l,d,g)=>{function x(W,xt,Ot){for(W=typeof W=="number"?W.toString():W||"";W.length<xt;)W=Ot[0]+W;return W}function S(W,xt){return x(W,xt,"0")}function L(W,xt){function Ot(Ge){return 0>Ge?-1:0<Ge?1:0}var Ft;return(Ft=Ot(W.getFullYear()-xt.getFullYear()))===0&&(Ft=Ot(W.getMonth()-xt.getMonth()))===0&&(Ft=Ot(W.getDate()-xt.getDate())),Ft}function C(W){switch(W.getDay()){case 0:return new Date(W.getFullYear()-1,11,29);case 1:return W;case 2:return new Date(W.getFullYear(),0,3);case 3:return new Date(W.getFullYear(),0,2);case 4:return new Date(W.getFullYear(),0,1);case 5:return new Date(W.getFullYear()-1,11,31);case 6:return new Date(W.getFullYear()-1,11,30)}}function I(W){var xt=W.Ne;for(W=new Date(new Date(W.Oe+1900,0,1).getTime());0<xt;){var Ot=W.getMonth(),Ft=(Bs(W.getFullYear())?vu:_u)[Ot];if(xt>Ft-W.getDate())xt-=Ft-W.getDate()+1,W.setDate(1),11>Ot?W.setMonth(Ot+1):(W.setMonth(0),W.setFullYear(W.getFullYear()+1));else{W.setDate(W.getDate()+xt);break}}return Ot=new Date(W.getFullYear()+1,0,4),xt=C(new Date(W.getFullYear(),0,4)),Ot=C(Ot),0>=L(xt,W)?0>=L(Ot,W)?W.getFullYear()+1:W.getFullYear():W.getFullYear()-1}var k=$[g+40>>2];g={Ng:$[g>>2],Mg:$[g+4>>2],zf:$[g+8>>2],Jf:$[g+12>>2],Af:$[g+16>>2],Oe:$[g+20>>2],Ge:$[g+24>>2],Ne:$[g+28>>2],Wg:$[g+32>>2],Lg:$[g+36>>2],Og:k&&k?Te(j,k):""},d=d?Te(j,d):"",k={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var tt in k)d=d.replace(new RegExp(tt,"g"),k[tt]);var it="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),_t="January February March April May June July August September October November December".split(" ");k={"%a":W=>it[W.Ge].substring(0,3),"%A":W=>it[W.Ge],"%b":W=>_t[W.Af].substring(0,3),"%B":W=>_t[W.Af],"%C":W=>S((W.Oe+1900)/100|0,2),"%d":W=>S(W.Jf,2),"%e":W=>x(W.Jf,2," "),"%g":W=>I(W).toString().substring(2),"%G":W=>I(W),"%H":W=>S(W.zf,2),"%I":W=>(W=W.zf,W==0?W=12:12<W&&(W-=12),S(W,2)),"%j":W=>{for(var xt=0,Ot=0;Ot<=W.Af-1;xt+=(Bs(W.Oe+1900)?vu:_u)[Ot++]);return S(W.Jf+xt,3)},"%m":W=>S(W.Af+1,2),"%M":W=>S(W.Mg,2),"%n":()=>`
`,"%p":W=>0<=W.zf&&12>W.zf?"AM":"PM","%S":W=>S(W.Ng,2),"%t":()=>"	","%u":W=>W.Ge||7,"%U":W=>S(Math.floor((W.Ne+7-W.Ge)/7),2),"%V":W=>{var xt=Math.floor((W.Ne+7-(W.Ge+6)%7)/7);if(2>=(W.Ge+371-W.Ne-2)%7&&xt++,xt)xt==53&&(Ot=(W.Ge+371-W.Ne)%7,Ot==4||Ot==3&&Bs(W.Oe)||(xt=1));else{xt=52;var Ot=(W.Ge+7-W.Ne-1)%7;(Ot==4||Ot==5&&Bs(W.Oe%400-1))&&xt++}return S(xt,2)},"%w":W=>W.Ge,"%W":W=>S(Math.floor((W.Ne+7-(W.Ge+6)%7)/7),2),"%y":W=>(W.Oe+1900).toString().substring(2),"%Y":W=>W.Oe+1900,"%z":W=>{W=W.Lg;var xt=0<=W;return W=Math.abs(W)/60,(xt?"+":"-")+("0000"+(W/60*100+W%60)).slice(-4)},"%Z":W=>W.Og,"%%":()=>"%"},d=d.replace(/%%/g,"\0\0");for(tt in k)d.includes(tt)&&(d=d.replace(new RegExp(tt,"g"),k[tt](g)));return d=d.replace(/\0\0/g,"%"),tt=Yp(d),tt.length>l?0:(q.set(tt,o),tt.length-1)};Ll=e.InternalError=class extends Error{constructor(o){super(o),this.name="InternalError"}};for(var xu=Array(256),Ds=0;256>Ds;++Ds)xu[Ds]=String.fromCharCode(Ds);kl=xu,Hi=e.BindingError=class extends Error{constructor(o){super(o),this.name="BindingError"}},ri.prototype.isAliasOf=function(o){if(!(this instanceof ri&&o instanceof ri))return!1;var l=this.ge.se.me,d=this.ge.oe,g=o.ge.se.me;for(o=o.ge.oe;l.xe;)d=l.nf(d),l=l.xe;for(;g.xe;)o=g.nf(o),g=g.xe;return l===g&&d===o},ri.prototype.clone=function(){if(this.ge.oe||oa(this),this.ge.lf)return this.ge.count.value+=1,this;var o=Sn,l=Object,d=l.create,g=Object.getPrototypeOf(this),x=this.ge;return o=o(d.call(l,g,{ge:{value:{count:x.count,cf:x.cf,lf:x.lf,oe:x.oe,se:x.se,ve:x.ve,Ce:x.Ce}}})),o.ge.count.value+=1,o.ge.cf=!1,o},ri.prototype.delete=function(){this.ge.oe||oa(this),this.ge.cf&&!this.ge.lf&&Xt("Object already scheduled for deletion"),Nl(this),Ul(this.ge),this.ge.lf||(this.ge.ve=void 0,this.ge.oe=void 0)},ri.prototype.isDeleted=function(){return!this.ge.oe},ri.prototype.deleteLater=function(){return this.ge.oe||oa(this),this.ge.cf&&!this.ge.lf&&Xt("Object already scheduled for deletion"),wn.push(this),wn.length===1&&An&&An(ha),this.ge.cf=!0,this},e.getInheritedInstanceCount=function(){return Object.keys(En).length},e.getLiveInheritedInstances=function(){var o=[],l;for(l in En)En.hasOwnProperty(l)&&o.push(En[l]);return o},e.flushPendingDeletes=ha,e.setDelayFunction=function(o){An=o,wn.length&&An&&An(ha)},Ar.prototype.ng=function(o){return this.Tf&&(o=this.Tf(o)),o},Ar.prototype.Nf=function(o){this.Je&&this.Je(o)},Ar.prototype.argPackAdvance=8,Ar.prototype.readValueFromPointer=Tr,Ar.prototype.deleteObject=function(o){o!==null&&o.delete()},Ar.prototype.fromWireType=function(o){function l(){return this.vf?Ts(this.me.df,{se:this.zg,oe:d,Ce:this,ve:o}):Ts(this.me.df,{se:this,oe:o})}var d=this.ng(o);if(!d)return this.Nf(o),null;var g=Tp(this.me,d);if(g!==void 0)return g.ge.count.value===0?(g.ge.oe=d,g.ge.ve=o,g.clone()):(g=g.clone(),this.Nf(o),g);if(g=this.me.mg(d),g=Hl[g],!g)return l.call(this);g=this.uf?g.dg:g.pointerType;var x=Gl(d,this.me,g.me);return x===null?l.call(this):this.vf?Ts(g.me.df,{se:g,oe:x,Ce:this,ve:o}):Ts(g.me.df,{se:g,oe:x})},Vl=e.UnboundTypeError=function(o,l){var d=la(l,function(g){this.name=l,this.message=g,g=Error(g).stack,g!==void 0&&(this.stack=this.toString()+`
`+g.replace(/^Error(:[^\n]*)?\n/,""))});return d.prototype=Object.create(o.prototype),d.prototype.constructor=d,d.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},d}(Error,"UnboundTypeError"),Object.assign(zl.prototype,{get(o){return this.Ie[o]},has(o){return this.Ie[o]!==void 0},rg(o){var l=this.Qf.pop()||this.Ie.length;return this.Ie[l]=o,l},sg(o){this.Ie[o]=void 0,this.Qf.push(o)}}),Ke.Ie.push({value:void 0},{value:null},{value:!0},{value:!1}),Ke.kf=Ke.Ie.length,e.count_emval_handles=function(){for(var o=0,l=Ke.kf;l<Ke.Ie.length;++l)Ke.Ie[l]!==void 0&&++o;return o};for(var U,Ve=0;32>Ve;++Ve)Is.push(Array(Ve));var Kp=new Float32Array(288);for(Ve=0;288>Ve;++Ve)ii[Ve]=Kp.subarray(0,Ve+1);var Zp=new Int32Array(288);for(Ve=0;288>Ve;++Ve)Mn[Ve]=Zp.subarray(0,Ve+1);var Jp={T:function(){return 0},Ab:()=>{},Bb:function(){return 0},xb:()=>{},yb:()=>{},U:function(){},zb:()=>{},F:function(o){var l=br[o];delete br[o];var d=l.If,g=l.Je,x=l.Pf,S=x.map(L=>L.qg).concat(x.map(L=>L.Dg));sr([o],S,L=>{var C={};return x.forEach((I,k)=>{var tt=L[k],it=I.og,_t=I.pg,W=L[k+x.length],xt=I.Cg,Ot=I.Eg;C[I.jg]={read:Ft=>tt.fromWireType(it(_t,Ft)),write:(Ft,Ge)=>{var Re=[];xt(Ot,Ft,W.toWireType(Re,Ge)),Tn(Re)}}}),[{name:l.name,fromWireType:function(I){var k={},tt;for(tt in C)k[tt]=C[tt].read(I);return g(I),k},toWireType:function(I,k){for(var tt in C)if(!(tt in k))throw new TypeError(`Missing field: "${tt}"`);var it=d();for(tt in C)C[tt].write(it,k[tt]);return I!==null&&I.push(g,it),it},argPackAdvance:8,readValueFromPointer:Tr,Be:g}]})},qb:function(){},Fb:function(o,l,d,g,x){var S=bs(d);l=fe(l),wr(o,{name:l,fromWireType:function(L){return!!L},toWireType:function(L,C){return C?g:x},argPackAdvance:8,readValueFromPointer:function(L){if(d===1)var C=q;else if(d===2)C=st;else if(d===4)C=$;else throw new TypeError("Unknown boolean type size: "+l);return this.fromWireType(C[L>>S])},Be:null})},o:function(o,l,d,g,x,S,L,C,I,k,tt,it,_t){tt=fe(tt),S=Fe(x,S),C&&(C=Fe(L,C)),k&&(k=Fe(I,k)),_t=Fe(it,_t);var W=$l(tt);ca(W,function(){Cn(`Cannot construct ${tt} due to unbound types`,[g])}),sr([o,l,d],g?[g]:[],function(xt){if(xt=xt[0],g)var Ot=xt.me,Ft=Ot.df;else Ft=ri.prototype;xt=la(W,function(){if(Object.getPrototypeOf(this)!==Ge)throw new Hi("Use 'new' to construct "+tt);if(Re.Me===void 0)throw new Hi(tt+" has no accessible constructor");var Fn=Re.Me[arguments.length];if(Fn===void 0)throw new Hi(`Tried to invoke ctor of ${tt} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(Re.Me).toString()}) parameters instead!`);return Fn.apply(this,arguments)});var Ge=Object.create(Ft,{constructor:{value:xt}});xt.prototype=Ge;var Re=new wp(tt,xt,Ge,_t,Ot,S,C,k);Re.xe&&(Re.xe.pf===void 0&&(Re.xe.pf=[]),Re.xe.pf.push(Re)),Ot=new Ar(tt,Re,!0,!1,!1),Ft=new Ar(tt+"*",Re,!1,!1,!1);var In=new Ar(tt+" const*",Re,!1,!0,!1);return Hl[o]={pointerType:Ft,dg:In},Wl(W,xt),[Ot,Ft,In]})},i:function(o,l,d,g,x,S,L){var C=As(d,g);l=fe(l),S=Fe(x,S),sr([],[o],function(I){function k(){Cn(`Cannot call ${tt} due to unbound types`,C)}I=I[0];var tt=`${I.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]);var it=I.me.constructor;return it[l]===void 0?(k.af=d-1,it[l]=k):(ua(it,l,tt),it[l].ue[d-1]=k),sr([],C,function(_t){if(_t=[_t[0],null].concat(_t.slice(1)),_t=ws(tt,_t,null,S,L),it[l].ue===void 0?(_t.af=d-1,it[l]=_t):it[l].ue[d-1]=_t,I.me.pf)for(const W of I.me.pf)W.constructor.hasOwnProperty(l)||(W.constructor[l]=_t);return[]}),[]})},C:function(o,l,d,g,x,S){var L=As(l,d);x=Fe(g,x),sr([],[o],function(C){C=C[0];var I=`constructor ${C.name}`;if(C.me.Me===void 0&&(C.me.Me=[]),C.me.Me[l-1]!==void 0)throw new Hi(`Cannot register multiple constructors with identical number of parameters (${l-1}) for class '${C.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return C.me.Me[l-1]=()=>{Cn(`Cannot construct ${C.name} due to unbound types`,L)},sr([],L,function(k){return k.splice(1,0,null),C.me.Me[l-1]=ws(I,k,null,x,S),[]}),[]})},b:function(o,l,d,g,x,S,L,C){var I=As(d,g);l=fe(l),S=Fe(x,S),sr([],[o],function(k){function tt(){Cn(`Cannot call ${it} due to unbound types`,I)}k=k[0];var it=`${k.name}.${l}`;l.startsWith("@@")&&(l=Symbol[l.substring(2)]),C&&k.me.Ag.push(l);var _t=k.me.df,W=_t[l];return W===void 0||W.ue===void 0&&W.className!==k.name&&W.af===d-2?(tt.af=d-2,tt.className=k.name,_t[l]=tt):(ua(_t,l,it),_t[l].ue[d-2]=tt),sr([],I,function(xt){return xt=ws(it,xt,k,S,L),_t[l].ue===void 0?(xt.af=d-2,_t[l]=xt):_t[l].ue[d-2]=xt,[]}),[]})},u:function(o,l,d){o=fe(o),sr([],[l],function(g){return g=g[0],e[o]=g.fromWireType(d),[]})},Eb:function(o,l){l=fe(l),wr(o,{name:l,fromWireType:function(d){var g=Ze(d);return fa(d),g},toWireType:function(d,g){return Je(g)},argPackAdvance:8,readValueFromPointer:Tr,Be:null})},m:function(o,l,d,g){function x(){}d=bs(d),l=fe(l),x.values={},wr(o,{name:l,constructor:x,fromWireType:function(S){return this.constructor.values[S]},toWireType:function(S,L){return L.value},argPackAdvance:8,readValueFromPointer:Pp(l,d,g),Be:null}),ca(l,x)},d:function(o,l,d){var g=Pn(o,"enum");l=fe(l),o=g.constructor,g=Object.create(g.constructor.prototype,{value:{value:d},constructor:{value:la(`${g.name}_${l}`,function(){})}}),o.values[d]=g,o[l]=g},X:function(o,l,d){d=bs(d),l=fe(l),wr(o,{name:l,fromWireType:function(g){return g},toWireType:function(g,x){return x},argPackAdvance:8,readValueFromPointer:Rp(l,d),Be:null})},y:function(o,l,d,g,x,S){var L=As(l,d);o=fe(o),x=Fe(g,x),ca(o,function(){Cn(`Cannot call ${o} due to unbound types`,L)},l-1),sr([],L,function(C){return C=[C[0],null].concat(C.slice(1)),Wl(o,ws(o,C,null,x,S),l-1),[]})},I:function(o,l,d,g,x){l=fe(l),x===-1&&(x=4294967295),x=bs(d);var S=C=>C;if(g===0){var L=32-8*d;S=C=>C<<L>>>L}d=l.includes("unsigned")?function(C,I){return I>>>0}:function(C,I){return I},wr(o,{name:l,fromWireType:S,toWireType:d,argPackAdvance:8,readValueFromPointer:Mp(l,x,g!==0),Be:null})},v:function(o,l,d){function g(S){S>>=2;var L=H;return new x(L.buffer,L[S+1],L[S])}var x=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][l];d=fe(d),wr(o,{name:d,fromWireType:g,argPackAdvance:8,readValueFromPointer:g},{tg:!0})},s:function(o,l,d,g,x,S,L,C,I,k,tt,it){d=fe(d),S=Fe(x,S),C=Fe(L,C),k=Fe(I,k),it=Fe(tt,it),sr([o],[l],function(_t){return _t=_t[0],[new Ar(d,_t.me,!1,!1,!0,_t,g,S,C,k,it)]})},W:function(o,l){l=fe(l);var d=l==="std::string";wr(o,{name:l,fromWireType:function(g){var x=H[g>>2],S=g+4;if(d)for(var L=S,C=0;C<=x;++C){var I=S+C;if(C==x||j[I]==0){if(L=L?Te(j,L,I-L):"",k===void 0)var k=L;else k+=String.fromCharCode(0),k+=L;L=I+1}}else{for(k=Array(x),C=0;C<x;++C)k[C]=String.fromCharCode(j[S+C]);k=k.join("")}return $r(g),k},toWireType:function(g,x){x instanceof ArrayBuffer&&(x=new Uint8Array(x));var S=typeof x=="string";S||x instanceof Uint8Array||x instanceof Uint8ClampedArray||x instanceof Int8Array||Xt("Cannot pass non-string to std::string");var L=d&&S?tr(x):x.length,C=Os(4+L+1),I=C+4;if(H[C>>2]=L,d&&S)Qe(x,j,I,L+1);else if(S)for(S=0;S<L;++S){var k=x.charCodeAt(S);255<k&&($r(I),Xt("String has UTF-16 code units that do not fit in 8 bits")),j[I+S]=k}else for(S=0;S<L;++S)j[I+S]=x[S];return g!==null&&g.push($r,C),C},argPackAdvance:8,readValueFromPointer:Tr,Be:function(g){$r(g)}})},O:function(o,l,d){if(d=fe(d),l===2)var g=Ip,x=Fp,S=Bp,L=()=>yt,C=1;else l===4&&(g=Dp,x=Op,S=Lp,L=()=>H,C=2);wr(o,{name:d,fromWireType:function(I){for(var k=H[I>>2],tt=L(),it,_t=I+4,W=0;W<=k;++W){var xt=I+4+W*l;(W==k||tt[xt>>C]==0)&&(_t=g(_t,xt-_t),it===void 0?it=_t:(it+=String.fromCharCode(0),it+=_t),_t=xt+l)}return $r(I),it},toWireType:function(I,k){typeof k!="string"&&Xt(`Cannot pass non-string to C++ string type ${d}`);var tt=S(k),it=Os(4+tt+l);return H[it>>2]=tt>>C,x(k,it+4,tt+l),I!==null&&I.push($r,it),it},argPackAdvance:8,readValueFromPointer:Tr,Be:function(I){$r(I)}})},G:function(o,l,d,g,x,S){br[o]={name:fe(l),If:Fe(d,g),Je:Fe(x,S),Pf:[]}},f:function(o,l,d,g,x,S,L,C,I,k){br[o].Pf.push({jg:fe(l),qg:d,og:Fe(g,x),pg:S,Dg:L,Cg:Fe(C,I),Eg:k})},Gb:function(o,l){l=fe(l),wr(o,{vg:!0,name:l,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},Db:()=>!0,sb:()=>{throw 1/0},D:function(o,l,d){o=Ze(o),l=Pn(l,"emval::as");var g=[],x=Je(g);return H[d>>2]=x,l.toWireType(g,o)},K:function(o,l,d,g,x){o=Ss[o],l=Ze(l),d=Es(d);var S=[];return H[g>>2]=Je(S),o(l,d,S,x)},r:function(o,l,d,g){o=Ss[o],l=Ze(l),d=Es(d),o(l,d,null,g)},c:fa,J:function(o){return o===0?Je(Yl()):(o=Es(o),Je(Yl()[o]))},p:function(o,l){var d=Up(o,l),g=d[0];l=g.name+"_$"+d.slice(1).map(function(L){return L.name}).join("_")+"$";var x=ql[l];if(x!==void 0)return x;var S=Array(o-1);return x=Np((L,C,I,k)=>{for(var tt=0,it=0;it<o-1;++it)S[it]=d[it+1].readValueFromPointer(k+tt),tt+=d[it+1].argPackAdvance;for(L=L[C].apply(L,S),it=0;it<o-1;++it)d[it+1].gg&&d[it+1].gg(S[it]);if(!g.vg)return g.toWireType(I,L)}),ql[l]=x},B:function(o,l){return o=Ze(o),l=Ze(l),Je(o[l])},n:function(o){4<o&&(Ke.get(o).Uf+=1)},L:function(o,l,d,g){o=Ze(o);var x=Kl[l];return x||(x=Gp(l),Kl[l]=x),x(o,d,g)},E:function(){return Je([])},e:function(o){return Je(Es(o))},x:function(){return Je({})},ib:function(o){return o=Ze(o),!o},z:function(o){var l=Ze(o);Tn(l),fa(o)},h:function(o,l,d){o=Ze(o),l=Ze(l),d=Ze(d),o[l]=d},g:function(o,l){return o=Pn(o,"_emval_take_value"),o=o.readValueFromPointer(l),Je(o)},ob:function(o,l,d){o=new Date(1e3*(l+2097152>>>0<4194305-!!o?(o>>>0)+4294967296*l:NaN)),$[d>>2]=o.getUTCSeconds(),$[d+4>>2]=o.getUTCMinutes(),$[d+8>>2]=o.getUTCHours(),$[d+12>>2]=o.getUTCDate(),$[d+16>>2]=o.getUTCMonth(),$[d+20>>2]=o.getUTCFullYear()-1900,$[d+24>>2]=o.getUTCDay(),$[d+28>>2]=(o.getTime()-Date.UTC(o.getUTCFullYear(),0,1,0,0,0,0))/864e5|0},mb:function(){return-52},nb:function(){},ub:(o,l,d)=>{function g(I){return(I=I.toTimeString().match(/\(([A-Za-z ]+)\)$/))?I[1]:"GMT"}var x=new Date().getFullYear(),S=new Date(x,0,1),L=new Date(x,6,1);x=S.getTimezoneOffset();var C=L.getTimezoneOffset();H[o>>2]=60*Math.max(x,C),$[l>>2]=+(x!=C),o=g(S),l=g(L),o=_i(o),l=_i(l),C<x?(H[d>>2]=o,H[d+4>>2]=l):(H[d>>2]=l,H[d+4>>2]=o)},a:()=>{Gt("")},V:function(){return Date.now()},Cb:()=>performance.now(),vd:function(o){U.activeTexture(o)},wd:function(o,l){U.attachShader(or[o],ar[l])},$b:function(o,l){U.beginQuery(o,We[l])},Vb:function(o,l){U.Fe.beginQueryEXT(o,We[l])},xd:function(o,l,d){U.bindAttribLocation(or[o],l,d?Te(j,d):"")},yd:function(o,l){o==35051?U.Ff=l:o==35052&&(U.bf=l),U.bindBuffer(o,Cs[l])},xc:ru,yc:function(o,l){U.bindRenderbuffer(o,Rn[l])},fc:function(o,l){U.bindSampler(o,xi[l])},zd:function(o,l){U.bindTexture(o,er[l])},Sc:iu,Wc:iu,_:function(o,l,d,g){U.blendColor(o,l,d,g)},$:function(o){U.blendEquation(o)},aa:function(o,l){U.blendFunc(o,l)},rc:function(o,l,d,g,x,S,L,C,I,k){U.blitFramebuffer(o,l,d,g,x,S,L,C,I,k)},ba:function(o,l,d,g){2<=Bt.version?d&&l?U.bufferData(o,j,g,d,l):U.bufferData(o,l,g):U.bufferData(o,d?j.subarray(d,d+l):l,g)},ca:function(o,l,d,g){2<=Bt.version?d&&U.bufferSubData(o,l,j,g,d):U.bufferSubData(o,l,j.subarray(g,g+d))},zc:function(o){return U.checkFramebufferStatus(o)},da:nu,ea:su,fa:ou,oc:function(o,l,d,g){return U.clientWaitSync(bi[o],l,(d>>>0)+4294967296*g)},ga:function(o,l,d,g){U.colorMask(!!o,!!l,!!d,!!g)},ha:function(o){U.compileShader(ar[o])},ia:function(o,l,d,g,x,S,L,C){2<=Bt.version?U.bf||!L?U.compressedTexImage2D(o,l,d,g,x,S,L,C):U.compressedTexImage2D(o,l,d,g,x,S,j,C,L):U.compressedTexImage2D(o,l,d,g,x,S,C?j.subarray(C,C+L):null)},ja:function(o,l,d,g,x,S,L,C,I){2<=Bt.version?U.bf||!C?U.compressedTexSubImage2D(o,l,d,g,x,S,L,C,I):U.compressedTexSubImage2D(o,l,d,g,x,S,L,j,I,C):U.compressedTexSubImage2D(o,l,d,g,x,S,L,I?j.subarray(I,I+C):null)},qc:function(o,l,d,g,x){U.copyBufferSubData(o,l,d,g,x)},ka:function(o,l,d,g,x,S,L,C){U.copyTexSubImage2D(o,l,d,g,x,S,L,C)},la:function(){var o=Ti(or),l=U.createProgram();return l.name=o,l.yf=l.wf=l.xf=0,l.Kf=1,or[o]=l,o},ma:function(o){var l=Ti(ar);return ar[l]=U.createShader(o),l},na:function(o){U.cullFace(o)},oa:function(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2],x=Cs[g];x&&(U.deleteBuffer(x),x.name=0,Cs[g]=null,g==U.Ff&&(U.Ff=0),g==U.bf&&(U.bf=0))}},Ac:function(o,l){for(var d=0;d<o;++d){var g=$[l+4*d>>2],x=Ps[g];x&&(U.deleteFramebuffer(x),x.name=0,Ps[g]=null)}},pa:function(o){if(o){var l=or[o];l?(U.deleteProgram(l),l.name=0,or[o]=null):Yt(1281)}},ac:function(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2],x=We[g];x&&(U.deleteQuery(x),We[g]=null)}},Wb:function(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2],x=We[g];x&&(U.Fe.deleteQueryEXT(x),We[g]=null)}},Bc:function(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2],x=Rn[g];x&&(U.deleteRenderbuffer(x),x.name=0,Rn[g]=null)}},gc:function(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2],x=xi[g];x&&(U.deleteSampler(x),x.name=0,xi[g]=null)}},qa:function(o){if(o){var l=ar[o];l?(U.deleteShader(l),ar[o]=null):Yt(1281)}},pc:function(o){if(o){var l=bi[o];l?(U.deleteSync(l),l.name=0,bi[o]=null):Yt(1281)}},ra:function(o,l){for(var d=0;d<o;d++){var g=$[l+4*d>>2],x=er[g];x&&(U.deleteTexture(x),x.name=0,er[g]=null)}},Tc:au,Xc:au,sa:function(o){U.depthMask(!!o)},ta:function(o){U.disable(o)},ua:function(o){U.disableVertexAttribArray(o)},va:function(o,l,d){U.drawArrays(o,l,d)},Qc:function(o,l,d,g){U.drawArraysInstanced(o,l,d,g)},Oc:function(o,l,d,g,x){U.Of.drawArraysInstancedBaseInstanceWEBGL(o,l,d,g,x)},Mc:function(o,l){for(var d=Is[o],g=0;g<o;g++)d[g]=$[l+4*g>>2];U.drawBuffers(d)},wa:hu,Rc:function(o,l,d,g,x){U.drawElementsInstanced(o,l,d,g,x)},Pc:function(o,l,d,g,x,S,L){U.Of.drawElementsInstancedBaseVertexBaseInstanceWEBGL(o,l,d,g,x,S,L)},Gc:function(o,l,d,g,x,S){hu(o,g,x,S)},xa:function(o){U.enable(o)},ya:function(o){U.enableVertexAttribArray(o)},bc:function(o){U.endQuery(o)},Xb:function(o){U.Fe.endQueryEXT(o)},lc:function(o,l){return(o=U.fenceSync(o,l))?(l=Ti(bi),o.name=l,bi[l]=o,l):0},za:function(){U.finish()},Aa:function(){U.flush()},Cc:function(o,l,d,g){U.framebufferRenderbuffer(o,l,d,Rn[g])},Dc:function(o,l,d,g,x){U.framebufferTexture2D(o,l,d,er[g],x)},Ba:function(o){U.frontFace(o)},Ca:function(o,l){wi(o,l,"createBuffer",Cs)},Ec:function(o,l){wi(o,l,"createFramebuffer",Ps)},cc:function(o,l){wi(o,l,"createQuery",We)},Yb:function(o,l){for(var d=0;d<o;d++){var g=U.Fe.createQueryEXT();if(!g){for(Yt(1282);d<o;)$[l+4*d++>>2]=0;break}var x=Ti(We);g.name=x,We[x]=g,$[l+4*d>>2]=x}},Fc:function(o,l){wi(o,l,"createRenderbuffer",Rn)},hc:function(o,l){wi(o,l,"createSampler",xi)},Da:function(o,l){wi(o,l,"createTexture",er)},Uc:lu,Yc:lu,tc:function(o){U.generateMipmap(o)},Ea:function(o,l,d){d?$[d>>2]=U.getBufferParameter(o,l):Yt(1281)},Fa:function(){var o=U.getError()||Ms;return Ms=0,o},Ga:function(o,l){cu(o,l,2)},uc:function(o,l,d,g){o=U.getFramebufferAttachmentParameter(o,l,d),(o instanceof WebGLRenderbuffer||o instanceof WebGLTexture)&&(o=o.name|0),$[g>>2]=o},Ha:du,Ia:function(o,l,d,g){o=U.getProgramInfoLog(or[o]),o===null&&(o="(unknown error)"),l=0<l&&g?Qe(o,j,g,l):0,d&&($[d>>2]=l)},Ja:function(o,l,d){if(d)if(o>=Zl)Yt(1281);else if(o=or[o],l==35716)o=U.getProgramInfoLog(o),o===null&&(o="(unknown error)"),$[d>>2]=o.length+1;else if(l==35719){if(!o.yf)for(l=0;l<U.getProgramParameter(o,35718);++l)o.yf=Math.max(o.yf,U.getActiveUniform(o,l).name.length+1);$[d>>2]=o.yf}else if(l==35722){if(!o.wf)for(l=0;l<U.getProgramParameter(o,35721);++l)o.wf=Math.max(o.wf,U.getActiveAttrib(o,l).name.length+1);$[d>>2]=o.wf}else if(l==35381){if(!o.xf)for(l=0;l<U.getProgramParameter(o,35382);++l)o.xf=Math.max(o.xf,U.getActiveUniformBlockName(o,l).length+1);$[d>>2]=o.xf}else $[d>>2]=U.getProgramParameter(o,l);else Yt(1281)},Sb:fu,Tb:fu,dc:function(o,l,d){if(d){o=U.getQueryParameter(We[o],l);var g;typeof o=="boolean"?g=o?1:0:g=o,$[d>>2]=g}else Yt(1281)},Zb:function(o,l,d){if(d){o=U.Fe.getQueryObjectEXT(We[o],l);var g;typeof o=="boolean"?g=o?1:0:g=o,$[d>>2]=g}else Yt(1281)},ec:function(o,l,d){d?$[d>>2]=U.getQuery(o,l):Yt(1281)},_b:function(o,l,d){d?$[d>>2]=U.Fe.getQueryEXT(o,l):Yt(1281)},vc:function(o,l,d){d?$[d>>2]=U.getRenderbufferParameter(o,l):Yt(1281)},Ka:function(o,l,d,g){o=U.getShaderInfoLog(ar[o]),o===null&&(o="(unknown error)"),l=0<l&&g?Qe(o,j,g,l):0,d&&($[d>>2]=l)},Pb:function(o,l,d,g){o=U.getShaderPrecisionFormat(o,l),$[d>>2]=o.rangeMin,$[d+4>>2]=o.rangeMax,$[g>>2]=o.precision},La:function(o,l,d){d?l==35716?(o=U.getShaderInfoLog(ar[o]),o===null&&(o="(unknown error)"),$[d>>2]=o?o.length+1:0):l==35720?(o=U.getShaderSource(ar[o]),$[d>>2]=o?o.length+1:0):$[d>>2]=U.getShaderParameter(ar[o],l):Yt(1281)},Ma:pu,Vc:mu,Na:function(o,l){if(l=l?Te(j,l):"",o=or[o]){var d=o,g=d.mf,x=d.Wf,S;if(!g)for(d.mf=g={},d.Vf={},S=0;S<U.getProgramParameter(d,35718);++S){var L=U.getActiveUniform(d,S),C=L.name;L=L.size;var I=gu(C);I=0<I?C.slice(0,I):C;var k=d.Kf;for(d.Kf+=L,x[I]=[L,k],C=0;C<L;++C)g[k]=C,d.Vf[k++]=I}if(d=o.mf,g=0,x=l,S=gu(l),0<S&&(g=parseInt(l.slice(S+1))>>>0,x=l.slice(0,S)),(x=o.Wf[x])&&g<x[0]&&(g+=x[1],d[g]=d[g]||U.getUniformLocation(o,l)))return g}else Yt(1281);return-1},Qb:function(o,l,d){for(var g=Is[l],x=0;x<l;x++)g[x]=$[d+4*x>>2];U.invalidateFramebuffer(o,g)},Rb:function(o,l,d,g,x,S,L){for(var C=Is[l],I=0;I<l;I++)C[I]=$[d+4*I>>2];U.invalidateSubFramebuffer(o,C,g,x,S,L)},mc:function(o){return U.isSync(bi[o])},Oa:function(o){return(o=er[o])?U.isTexture(o):0},Pa:function(o){U.lineWidth(o)},Qa:function(o){o=or[o],U.linkProgram(o),o.mf=0,o.Wf={}},Kc:function(o,l,d,g,x,S){U.Sf.multiDrawArraysInstancedBaseInstanceWEBGL(o,$,l>>2,$,d>>2,$,g>>2,H,x>>2,S)},Lc:function(o,l,d,g,x,S,L,C){U.Sf.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(o,$,l>>2,d,$,g>>2,$,x>>2,$,S>>2,H,L>>2,C)},Ra:function(o,l){o==3317&&(tu=l),U.pixelStorei(o,l)},Ub:function(o,l){U.Fe.queryCounterEXT(We[o],l)},Nc:function(o){U.readBuffer(o)},Sa:function(o,l,d,g,x,S,L){if(2<=Bt.version)if(U.Ff)U.readPixels(o,l,d,g,x,S,L);else{var C=Fs(S);U.readPixels(o,l,d,g,x,S,C,L>>31-Math.clz32(C.BYTES_PER_ELEMENT))}else(L=ma(S,x,d,g,L))?U.readPixels(o,l,d,g,x,S,L):Yt(1280)},wc:function(o,l,d,g){U.renderbufferStorage(o,l,d,g)},sc:function(o,l,d,g,x){U.renderbufferStorageMultisample(o,l,d,g,x)},ic:function(o,l,d){U.samplerParameterf(xi[o],l,d)},jc:function(o,l,d){U.samplerParameteri(xi[o],l,d)},kc:function(o,l,d){U.samplerParameteri(xi[o],l,$[d>>2])},Ta:function(o,l,d,g){U.scissor(o,l,d,g)},Ua:function(o,l,d,g){for(var x="",S=0;S<l;++S){var L=g?$[g+4*S>>2]:-1,C=$[d+4*S>>2];L=C?Te(j,C,0>L?void 0:L):"",x+=L}U.shaderSource(ar[o],x)},Va:function(o,l,d){U.stencilFunc(o,l,d)},Wa:function(o,l,d,g){U.stencilFuncSeparate(o,l,d,g)},Xa:function(o){U.stencilMask(o)},Ya:function(o,l){U.stencilMaskSeparate(o,l)},Za:function(o,l,d){U.stencilOp(o,l,d)},_a:function(o,l,d,g){U.stencilOpSeparate(o,l,d,g)},$a:function(o,l,d,g,x,S,L,C,I){if(2<=Bt.version)if(U.bf)U.texImage2D(o,l,d,g,x,S,L,C,I);else if(I){var k=Fs(C);U.texImage2D(o,l,d,g,x,S,L,C,k,I>>31-Math.clz32(k.BYTES_PER_ELEMENT))}else U.texImage2D(o,l,d,g,x,S,L,C,null);else U.texImage2D(o,l,d,g,x,S,L,C,I?ma(C,L,g,x,I):null)},ab:function(o,l,d){U.texParameterf(o,l,d)},bb:function(o,l,d){U.texParameterf(o,l,z[d>>2])},cb:function(o,l,d){U.texParameteri(o,l,d)},db:function(o,l,d){U.texParameteri(o,l,$[d>>2])},Hc:function(o,l,d,g,x){U.texStorage2D(o,l,d,g,x)},eb:function(o,l,d,g,x,S,L,C,I){if(2<=Bt.version)if(U.bf)U.texSubImage2D(o,l,d,g,x,S,L,C,I);else if(I){var k=Fs(C);U.texSubImage2D(o,l,d,g,x,S,L,C,k,I>>31-Math.clz32(k.BYTES_PER_ELEMENT))}else U.texSubImage2D(o,l,d,g,x,S,L,C,null);else k=null,I&&(k=ma(C,L,x,S,I)),U.texSubImage2D(o,l,d,g,x,S,L,C,k)},fb:function(o,l){U.uniform1f(Jt(o),l)},gb:function(o,l,d){if(2<=Bt.version)l&&U.uniform1fv(Jt(o),z,d>>2,l);else{if(288>=l)for(var g=ii[l-1],x=0;x<l;++x)g[x]=z[d+4*x>>2];else g=z.subarray(d>>2,d+4*l>>2);U.uniform1fv(Jt(o),g)}},rd:function(o,l){U.uniform1i(Jt(o),l)},sd:function(o,l,d){if(2<=Bt.version)l&&U.uniform1iv(Jt(o),$,d>>2,l);else{if(288>=l)for(var g=Mn[l-1],x=0;x<l;++x)g[x]=$[d+4*x>>2];else g=$.subarray(d>>2,d+4*l>>2);U.uniform1iv(Jt(o),g)}},td:function(o,l,d){U.uniform2f(Jt(o),l,d)},ud:function(o,l,d){if(2<=Bt.version)l&&U.uniform2fv(Jt(o),z,d>>2,2*l);else{if(144>=l)for(var g=ii[2*l-1],x=0;x<2*l;x+=2)g[x]=z[d+4*x>>2],g[x+1]=z[d+(4*x+4)>>2];else g=z.subarray(d>>2,d+8*l>>2);U.uniform2fv(Jt(o),g)}},qd:function(o,l,d){U.uniform2i(Jt(o),l,d)},pd:function(o,l,d){if(2<=Bt.version)l&&U.uniform2iv(Jt(o),$,d>>2,2*l);else{if(144>=l)for(var g=Mn[2*l-1],x=0;x<2*l;x+=2)g[x]=$[d+4*x>>2],g[x+1]=$[d+(4*x+4)>>2];else g=$.subarray(d>>2,d+8*l>>2);U.uniform2iv(Jt(o),g)}},od:function(o,l,d,g){U.uniform3f(Jt(o),l,d,g)},nd:function(o,l,d){if(2<=Bt.version)l&&U.uniform3fv(Jt(o),z,d>>2,3*l);else{if(96>=l)for(var g=ii[3*l-1],x=0;x<3*l;x+=3)g[x]=z[d+4*x>>2],g[x+1]=z[d+(4*x+4)>>2],g[x+2]=z[d+(4*x+8)>>2];else g=z.subarray(d>>2,d+12*l>>2);U.uniform3fv(Jt(o),g)}},md:function(o,l,d,g){U.uniform3i(Jt(o),l,d,g)},ld:function(o,l,d){if(2<=Bt.version)l&&U.uniform3iv(Jt(o),$,d>>2,3*l);else{if(96>=l)for(var g=Mn[3*l-1],x=0;x<3*l;x+=3)g[x]=$[d+4*x>>2],g[x+1]=$[d+(4*x+4)>>2],g[x+2]=$[d+(4*x+8)>>2];else g=$.subarray(d>>2,d+12*l>>2);U.uniform3iv(Jt(o),g)}},kd:function(o,l,d,g,x){U.uniform4f(Jt(o),l,d,g,x)},jd:function(o,l,d){if(2<=Bt.version)l&&U.uniform4fv(Jt(o),z,d>>2,4*l);else{if(72>=l){var g=ii[4*l-1],x=z;d>>=2;for(var S=0;S<4*l;S+=4){var L=d+S;g[S]=x[L],g[S+1]=x[L+1],g[S+2]=x[L+2],g[S+3]=x[L+3]}}else g=z.subarray(d>>2,d+16*l>>2);U.uniform4fv(Jt(o),g)}},Zc:function(o,l,d,g,x){U.uniform4i(Jt(o),l,d,g,x)},_c:function(o,l,d){if(2<=Bt.version)l&&U.uniform4iv(Jt(o),$,d>>2,4*l);else{if(72>=l)for(var g=Mn[4*l-1],x=0;x<4*l;x+=4)g[x]=$[d+4*x>>2],g[x+1]=$[d+(4*x+4)>>2],g[x+2]=$[d+(4*x+8)>>2],g[x+3]=$[d+(4*x+12)>>2];else g=$.subarray(d>>2,d+16*l>>2);U.uniform4iv(Jt(o),g)}},$c:function(o,l,d,g){if(2<=Bt.version)l&&U.uniformMatrix2fv(Jt(o),!!d,z,g>>2,4*l);else{if(72>=l)for(var x=ii[4*l-1],S=0;S<4*l;S+=4)x[S]=z[g+4*S>>2],x[S+1]=z[g+(4*S+4)>>2],x[S+2]=z[g+(4*S+8)>>2],x[S+3]=z[g+(4*S+12)>>2];else x=z.subarray(g>>2,g+16*l>>2);U.uniformMatrix2fv(Jt(o),!!d,x)}},ad:function(o,l,d,g){if(2<=Bt.version)l&&U.uniformMatrix3fv(Jt(o),!!d,z,g>>2,9*l);else{if(32>=l)for(var x=ii[9*l-1],S=0;S<9*l;S+=9)x[S]=z[g+4*S>>2],x[S+1]=z[g+(4*S+4)>>2],x[S+2]=z[g+(4*S+8)>>2],x[S+3]=z[g+(4*S+12)>>2],x[S+4]=z[g+(4*S+16)>>2],x[S+5]=z[g+(4*S+20)>>2],x[S+6]=z[g+(4*S+24)>>2],x[S+7]=z[g+(4*S+28)>>2],x[S+8]=z[g+(4*S+32)>>2];else x=z.subarray(g>>2,g+36*l>>2);U.uniformMatrix3fv(Jt(o),!!d,x)}},bd:function(o,l,d,g){if(2<=Bt.version)l&&U.uniformMatrix4fv(Jt(o),!!d,z,g>>2,16*l);else{if(18>=l){var x=ii[16*l-1],S=z;g>>=2;for(var L=0;L<16*l;L+=16){var C=g+L;x[L]=S[C],x[L+1]=S[C+1],x[L+2]=S[C+2],x[L+3]=S[C+3],x[L+4]=S[C+4],x[L+5]=S[C+5],x[L+6]=S[C+6],x[L+7]=S[C+7],x[L+8]=S[C+8],x[L+9]=S[C+9],x[L+10]=S[C+10],x[L+11]=S[C+11],x[L+12]=S[C+12],x[L+13]=S[C+13],x[L+14]=S[C+14],x[L+15]=S[C+15]}}else x=z.subarray(g>>2,g+64*l>>2);U.uniformMatrix4fv(Jt(o),!!d,x)}},cd:function(o){o=or[o],U.useProgram(o),U.fg=o},dd:function(o,l){U.vertexAttrib1f(o,l)},ed:function(o,l){U.vertexAttrib2f(o,z[l>>2],z[l+4>>2])},fd:function(o,l){U.vertexAttrib3f(o,z[l>>2],z[l+4>>2],z[l+8>>2])},gd:function(o,l){U.vertexAttrib4f(o,z[l>>2],z[l+4>>2],z[l+8>>2],z[l+12>>2])},Ic:function(o,l){U.vertexAttribDivisor(o,l)},Jc:function(o,l,d,g,x){U.vertexAttribIPointer(o,l,d,g,x)},hd:function(o,l,d,g,x,S){U.vertexAttribPointer(o,l,d,!!g,x,S)},id:function(o,l,d,g){U.viewport(o,l,d,g)},nc:function(o,l,d,g){U.waitSync(bi[o],l,(d>>>0)+4294967296*g)},tb:o=>{var l=j.length;if(o>>>=0,2147483648<o)return!1;for(var d=1;4>=d;d*=2){var g=l*(1+.2/d);g=Math.min(g,o+100663296);var x=Math;g=Math.max(o,g);t:{x=x.min.call(x,2147483648,g+(65536-g%65536)%65536)-Y.buffer.byteLength+65535>>>16;try{Y.grow(x),Pt();var S=1;break t}catch{}S=void 0}if(S)return!0}return!1},jb:function(){return Bt?Bt.handle:0},vb:(o,l)=>{var d=0;return yu().forEach(function(g,x){var S=l+d;for(x=H[o+4*x>>2]=S,S=0;S<g.length;++S)q[x++>>0]=g.charCodeAt(S);q[x>>0]=0,d+=g.length+1}),0},wb:(o,l)=>{var d=yu();H[o>>2]=d.length;var g=0;return d.forEach(function(x){g+=x.length+1}),H[l>>2]=g,0},Hb:o=>{N||(e.onExit&&e.onExit(o),K=!0),h(o,new ue(o))},N:()=>52,lb:function(){return 52},R:()=>52,pb:function(){return 70},S:(o,l,d,g)=>{for(var x=0,S=0;S<d;S++){var L=H[l>>2],C=H[l+4>>2];l+=8;for(var I=0;I<C;I++){var k=j[L+I],tt=Xp[o];k===0||k===10?((o===1?M:D)(Te(tt,0)),tt.length=0):tt.push(k)}x+=C}return H[g>>2]=x,0},Bd:ru,kb:nu,Ad:su,Ob:ou,M:du,Q:pu,hb:mu,Lb:um,j:Qp,q:tm,k:nm,H:im,Kb:cm,Ib:mm,Z:dm,Y:pm,P:hm,l:sm,A:rm,w:em,t:om,Jb:fm,Mb:lm,Nb:am,rb:(o,l,d,g)=>qp(o,l,d,g)};(function(){function o(d){if(X=d=d.exports,Y=X.Cd,Pt(),dt=X.Fd,Kt.unshift(X.Dd),Mt--,e.monitorRunDependencies&&e.monitorRunDependencies(Mt),Mt==0&&Dt){var g=Dt;Dt=null,g()}return d}var l={a:Jp};if(Mt++,e.monitorRunDependencies&&e.monitorRunDependencies(Mt),e.instantiateWasm)try{return e.instantiateWasm(l,o)}catch(d){D("Module.instantiateWasm callback failed with error: "+d),n(d)}return se(l,function(d){o(d.instance)}).catch(n),{}})();var Os=e._malloc=o=>(Os=e._malloc=X.Ed)(o),$r=e._free=o=>($r=e._free=X.Gd)(o),bu=o=>(bu=X.Hd)(o);e.__embind_initialize_bindings=()=>(e.__embind_initialize_bindings=X.Id)();var we=(o,l)=>(we=X.Jd)(o,l),Ae=()=>(Ae=X.Kd)(),Ee=o=>(Ee=X.Ld)(o);e.dynCall_viji=(o,l,d,g,x)=>(e.dynCall_viji=X.Md)(o,l,d,g,x),e.dynCall_vijiii=(o,l,d,g,x,S,L)=>(e.dynCall_vijiii=X.Nd)(o,l,d,g,x,S,L),e.dynCall_viiiiij=(o,l,d,g,x,S,L,C)=>(e.dynCall_viiiiij=X.Od)(o,l,d,g,x,S,L,C),e.dynCall_jiiiijiiiii=(o,l,d,g,x,S,L,C,I,k,tt,it)=>(e.dynCall_jiiiijiiiii=X.Pd)(o,l,d,g,x,S,L,C,I,k,tt,it),e.dynCall_viiij=(o,l,d,g,x,S)=>(e.dynCall_viiij=X.Qd)(o,l,d,g,x,S),e.dynCall_jii=(o,l,d)=>(e.dynCall_jii=X.Rd)(o,l,d),e.dynCall_vij=(o,l,d,g)=>(e.dynCall_vij=X.Sd)(o,l,d,g),e.dynCall_jiiiii=(o,l,d,g,x,S)=>(e.dynCall_jiiiii=X.Td)(o,l,d,g,x,S),e.dynCall_jiiiiii=(o,l,d,g,x,S,L)=>(e.dynCall_jiiiiii=X.Ud)(o,l,d,g,x,S,L),e.dynCall_jiiiiji=(o,l,d,g,x,S,L,C)=>(e.dynCall_jiiiiji=X.Vd)(o,l,d,g,x,S,L,C),e.dynCall_ji=(o,l)=>(e.dynCall_ji=X.Wd)(o,l),e.dynCall_iijj=(o,l,d,g,x,S)=>(e.dynCall_iijj=X.Xd)(o,l,d,g,x,S),e.dynCall_iiiji=(o,l,d,g,x,S)=>(e.dynCall_iiiji=X.Yd)(o,l,d,g,x,S),e.dynCall_iiji=(o,l,d,g,x)=>(e.dynCall_iiji=X.Zd)(o,l,d,g,x),e.dynCall_iijjiii=(o,l,d,g,x,S,L,C,I)=>(e.dynCall_iijjiii=X._d)(o,l,d,g,x,S,L,C,I),e.dynCall_iij=(o,l,d,g)=>(e.dynCall_iij=X.$d)(o,l,d,g),e.dynCall_vijjjii=(o,l,d,g,x,S,L,C,I,k)=>(e.dynCall_vijjjii=X.ae)(o,l,d,g,x,S,L,C,I,k),e.dynCall_jiji=(o,l,d,g,x)=>(e.dynCall_jiji=X.be)(o,l,d,g,x),e.dynCall_viijii=(o,l,d,g,x,S,L)=>(e.dynCall_viijii=X.ce)(o,l,d,g,x,S,L),e.dynCall_iiiiij=(o,l,d,g,x,S,L)=>(e.dynCall_iiiiij=X.de)(o,l,d,g,x,S,L),e.dynCall_iiiiijj=(o,l,d,g,x,S,L,C,I)=>(e.dynCall_iiiiijj=X.ee)(o,l,d,g,x,S,L,C,I),e.dynCall_iiiiiijj=(o,l,d,g,x,S,L,C,I,k)=>(e.dynCall_iiiiiijj=X.fe)(o,l,d,g,x,S,L,C,I,k);function Qp(o,l){var d=Ae();try{return dt.get(o)(l)}catch(g){if(Ee(d),g!==g+0)throw g;we(1,0)}}function tm(o,l,d){var g=Ae();try{return dt.get(o)(l,d)}catch(x){if(Ee(g),x!==x+0)throw x;we(1,0)}}function em(o,l,d,g){var x=Ae();try{dt.get(o)(l,d,g)}catch(S){if(Ee(x),S!==S+0)throw S;we(1,0)}}function rm(o,l,d){var g=Ae();try{dt.get(o)(l,d)}catch(x){if(Ee(g),x!==x+0)throw x;we(1,0)}}function im(o,l,d,g,x){var S=Ae();try{return dt.get(o)(l,d,g,x)}catch(L){if(Ee(S),L!==L+0)throw L;we(1,0)}}function nm(o,l,d,g){var x=Ae();try{return dt.get(o)(l,d,g)}catch(S){if(Ee(x),S!==S+0)throw S;we(1,0)}}function sm(o,l){var d=Ae();try{dt.get(o)(l)}catch(g){if(Ee(d),g!==g+0)throw g;we(1,0)}}function om(o,l,d,g,x){var S=Ae();try{dt.get(o)(l,d,g,x)}catch(L){if(Ee(S),L!==L+0)throw L;we(1,0)}}function am(o,l,d,g,x,S,L,C,I,k){var tt=Ae();try{dt.get(o)(l,d,g,x,S,L,C,I,k)}catch(it){if(Ee(tt),it!==it+0)throw it;we(1,0)}}function hm(o){var l=Ae();try{dt.get(o)()}catch(d){if(Ee(l),d!==d+0)throw d;we(1,0)}}function lm(o,l,d,g,x,S,L){var C=Ae();try{dt.get(o)(l,d,g,x,S,L)}catch(I){if(Ee(C),I!==I+0)throw I;we(1,0)}}function um(o){var l=Ae();try{return dt.get(o)()}catch(d){if(Ee(l),d!==d+0)throw d;we(1,0)}}function cm(o,l,d,g,x,S){var L=Ae();try{return dt.get(o)(l,d,g,x,S)}catch(C){if(Ee(L),C!==C+0)throw C;we(1,0)}}function dm(o,l,d,g,x,S,L,C){var I=Ae();try{return dt.get(o)(l,d,g,x,S,L,C)}catch(k){if(Ee(I),k!==k+0)throw k;we(1,0)}}function fm(o,l,d,g,x,S){var L=Ae();try{dt.get(o)(l,d,g,x,S)}catch(C){if(Ee(L),C!==C+0)throw C;we(1,0)}}function pm(o,l,d,g,x,S,L,C,I,k){var tt=Ae();try{return dt.get(o)(l,d,g,x,S,L,C,I,k)}catch(it){if(Ee(tt),it!==it+0)throw it;we(1,0)}}function mm(o,l,d,g,x,S,L){var C=Ae();try{return dt.get(o)(l,d,g,x,S,L)}catch(I){if(Ee(C),I!==I+0)throw I;we(1,0)}}var Ls;Dt=function o(){Ls||Tu(),Ls||(Dt=o)};function Tu(){function o(){if(!Ls&&(Ls=!0,e.calledRun=!0,!K)){if(he(Kt),r(e),e.onRuntimeInitialized&&e.onRuntimeInitialized(),e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;){var l=e.postRun.shift();lt.unshift(l)}he(lt)}}if(!(0<Mt)){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)ct();he(St),0<Mt||(e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),o()},1)):o())}}if(e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);0<e.preInit.length;)e.preInit.pop()();return Tu(),t.ready}})();typeof xp=="object"&&typeof pl=="object"?pl.exports=fl:typeof define=="function"&&define.amd&&define([],()=>fl);class Bb{constructor(t){pe(this,"canvasKit");pe(this,"paint");this.canvasKit=t,this.paint=new this.canvasKit.Paint,this.paint.setStrokeJoin(this.canvasKit.StrokeJoin.Round)}renderContainer(t,e){const r={translate:e.position,rotation:e.angle,scale:e.scale,pivot:e.pivot};if(t.save(),t.translate(r.translate.x,r.translate.y),t.translate(-r.pivot.x,-r.pivot.y),t.rotate(r.rotation,r.pivot.x,r.pivot.y),t.scale(r.scale.x,r.scale.y),e instanceof Ie)this.renderSprite(t,e);else if(e instanceof yi)this.renderGraphics(t,e);else if(e instanceof ge)for(const n of e.children??[])this.renderContainer(t,n);t.restore()}renderSprite(t,e){if(!e.texture.valid)return;const n=e.texture.baseTexture.getDrawableSource();if(!n){console.warn("Sprite source is not available for rendering.");return}const s=this.canvasKit.MakeImageFromCanvasImageSource(n);if(!s){console.warn("Failed to create Skia Image from sprite source.");return}const a=e.texture.frame,h=this.canvasKit.XYWHRect(a.x,a.y,a.width,a.height),u=this.canvasKit.XYWHRect(-e.anchor.x*a.width,-e.anchor.y*a.height,a.width,a.height);t.drawImageRect(s,h,u,this.paint),s.delete()}renderGraphics(t,e){const r=e.geometry.graphicsData;for(const n of r){const{fillStyle:s,lineStyle:a}=n;this.paint.setColor(this.convertColor(s.alpha,(s==null?void 0:s.color)??0)),this.paint.setStyle(this.canvasKit.PaintStyle.Fill),this._renderShape(t,n),a.width>0&&(this.paint.setColor(this.convertColor(a.alpha,a.color)),this.paint.setStyle(this.canvasKit.PaintStyle.Stroke),this.paint.setStrokeWidth(a.width),this._renderShape(t,n))}}_renderShape(t,e){const r=e.shape;if(r instanceof ps)t.drawCircle(r.x,r.y,r.radius,this.paint);else if(r instanceof ms)t.drawOval(this.canvasKit.XYWHRect(r.x-r.width,r.y-r.height,r.width*2,r.height*2),this.paint);else if(r instanceof ci){const n=new this.canvasKit.Path;n.addPoly(r.points,r.closeStroke),t.drawPath(n,this.paint)}else r instanceof It?t.drawRect(this.canvasKit.XYWHRect(r.x,r.y,r.width,r.height),this.paint):r instanceof gs&&t.drawRRect(this.canvasKit.RRectXY(this.canvasKit.XYWHRect(r.x,r.y,r.width,r.height),r.radius,r.radius),this.paint)}convertColor(t,e){return this.canvasKit.Color(e>>16,e>>8&255,e&255,t)}}const Qr=800,ti=600,Db=10,on=window.devicePixelRatio||1;class _p{constructor(t){pe(this,"app");pe(this,"parentElement");this.parentElement=t}}class Ob extends _p{async init(){const t=new Il({width:Qr,height:ti,eventMode:"dynamic",forceCanvas:!0,backgroundColor:16777215,resolution:on,powerPreference:"high-performance"});return this.parentElement.appendChild(t.view),this.app=t,t}renderContainer(t){this.clean(),this.app.stage.addChild(t)}clean(){this.app.stage.removeChildren()}}class Lb extends _p{constructor(){super(...arguments);pe(this,"skCanvas");pe(this,"pixiAdapter");pe(this,"surface")}async init(){const e=document.createElement("canvas");if(e.width=Qr*on,e.height=ti*on,e.id="skia-canvas",this.parentElement.appendChild(e),this.app=await fl({locateFile:r=>`./${r}`}),this.surface=this.app.MakeSWCanvasSurface("skia-canvas"),!this.surface)throw new Error("Could not create surface");return this.skCanvas=this.surface.getCanvas(),this.skCanvas.scale(on,on),this.pixiAdapter=new Bb(this.app),this.app=this.app,this.app}renderContainer(e){this.clean(),this.pixiAdapter.renderContainer(this.skCanvas,e);const r=[];for(const n of e.children??[])r.push(n);for(;r.length>0;){const n=r.shift();if(n instanceof ge)for(const s of n.children??[])r.push(s)}this.surface.flush()}clean(){this.skCanvas.clear(this.app.WHITE)}exportToPDF(e){const r=new this.app.SkWStream,n=new this.app.SkPDFDocument(r);for(const c of e){const m=n.beginPage(Qr,ti);this.pixiAdapter.renderContainer(m,c),n.endPage()}n.close();const s=r.getBuffer(),a=new Blob([s],{type:"application/pdf"}),h=URL.createObjectURL(a),u=document.createElement("a");u.href=h,u.download="output.pdf",u.click(),URL.revokeObjectURL(h)}}class Yr{static cloneContainer(t){if(t instanceof Ie){const e=new Ie(t.texture);return Yr.copyTransform(t,e),Yr.copyListeners(t,e),e}else if(t instanceof yi){const e=t.clone();return Yr.copyTransform(t,e),Yr.copyListeners(t,e),e}else if(t instanceof ge){const e=new ge;for(const r of t.children??[])e.addChild(Yr.cloneContainer(r));return Yr.copyTransform(t,e),Yr.copyListeners(t,e),e}return t}static copyListeners(t,e,r=["pointerdown","pointerup"]){for(const n of r)if(t.listeners(n))for(const s of t.listeners(n))e.on(n,s)}static copyTransform(t,e){e.scale.set(t.scale.x,t.scale.y),e.pivot.set(t.pivot.x,t.pivot.y),e.angle=t.angle,e.position.set(t.position.x,t.position.y),e instanceof Ie&&t instanceof Ie&&e.anchor.set(t.anchor.x,t.anchor.y)}}class kb{constructor(t){pe(this,"shadowPixiApp");pe(this,"app");this.app=t;const e=document.querySelector("#skia-canvas-wrapper canvas");this.shadowPixiApp=new Il({resizeTo:e,resolution:on,eventMode:"dynamic"})}initButtonClickEvents(){document.querySelector("#export-as-pdf").addEventListener("click",()=>{this.app.skiaRenderer.exportToPDF(this.app.containersManager.containers)}),document.querySelector("#generate-random-container").addEventListener("click",()=>{this.app.addRandomContainer()})}initSkiaPointerEvents(){const t=document.querySelector("#skia-canvas-wrapper canvas");this.shadowPixiApp.renderer.events.setTargetElement(t)}refresh(){this.shadowPixiApp.stage.removeChildren(),this.shadowPixiApp.stage.addChild(Yr.cloneContainer(this.app.containersManager.getSelectedContainer()))}}class Nb{constructor(){pe(this,"selectedContainer",0);pe(this,"containers",[])}addContainer(t){this.containers.push(t)}removeContainer(t){this.containers.splice(t,1)}setSelectedContainer(t){this.selectedContainer=t}getSelectedContainer(){return this.containers[this.selectedContainer]}setSelectedContainerToLast(){this.selectedContainer=this.containers.length-1}}class Ub{constructor(t,e){pe(this,"textures");pe(this,"eventCallbacks");this.textures=t,this.eventCallbacks=e}generateContainer(t=3,e=7){const r=new ge;return this.populateContainer(r,t,e),r}populateContainer(t,e,r){if(e===0)return;const n=Math.floor(Math.random()*r)+5;for(let s=0;s<n;s++)switch(Math.floor(Math.random()*7)){case 0:const h=new ge;this.applyRandomTransformations(h),this.populateContainer(h,e-1,r),t.addChild(h);break;case 1:t.addChild(this.createRandomSprite());break;default:t.addChild(this.createRandomGraphics());break}}createRandomGraphics(){const t=new yi;switch(t.lineStyle({width:Math.random()*10,color:this.getRandomColor(),join:Ye.ROUND}),t.beginFill(this.getRandomColor()),Math.floor(Math.random()*6)){case 0:t.drawRect(Math.random()*100,Math.random()*100,Math.random()*200,Math.random()*200),this.bindEventListeners(t,"rectangle");break;case 1:t.drawCircle(Math.random()*200,Math.random()*200,Math.random()*100),this.bindEventListeners(t,"circle");break;case 2:const r=3;t.drawPolygon(Array.from({length:r*2},()=>Math.random()*200)).closePath(),this.bindEventListeners(t,"polygon");break;case 3:t.drawEllipse(Math.random()*200,Math.random()*200,Math.random()*100,Math.random()*50),this.bindEventListeners(t,"ellipse");break;case 4:t.arc(Math.random()*200,Math.random()*200,Math.random()*50,0,Math.PI*Math.random()*2),this.bindEventListeners(t,"arc");break;case 5:t.moveTo(Math.random()*200,Math.random()*200),t.lineTo(Math.random()*200,Math.random()*200),this.bindEventListeners(t,"line");break}return t.endFill(),this.applyRandomTransformations(t),t}createRandomSprite(){const t=this.textures[Math.floor(Math.random()*this.textures.length)],e=new Ie(t);return e.anchor.set(.5),this.applyRandomTransformations(e),this.bindEventListeners(e,"sprite"),e}applyRandomTransformations(t){var e;t.position.set(Math.random()*400,Math.random()*400),t.rotation=Math.random()*Math.PI*2,t.scale.set(Math.random()*2,Math.random()*2),(e=t.scale)==null||e.set(Math.random()*2+.5)}getRandomColor(){return Math.floor(Math.random()*16777215)}bindEventListeners(t,e){Object.keys(this.eventCallbacks).forEach(r=>{t.on(r,this.eventCallbacks[r](e))})}}class Gb{constructor(){pe(this,"renderer");this.renderer=new Qo({width:Qr,height:ti,resolution:window.devicePixelRatio||1,forceCanvas:!0,antialias:!0,backgroundColor:16777215})}render(t,e){const r=_r.create({width:Qr,height:ti,resolution:window.devicePixelRatio||1});this.renderer.render(t,{renderTexture:r});const n=new Ie(r);this.renderer.render(n),e.getContext("2d").drawImage(this.renderer.view,0,0,Qr,ti),this.renderer.clear(),r.destroy(),n.destroy()}}function hd(i){const t=document.querySelector("#snackbars"),e=document.createElement("div");e.classList.add("snackbar"),e.innerHTML=`
        <div class="message">${i}</div>
        <button class="close" aria-label="Close" onclick="this.parentElement.remove()"></button>
    `,t.appendChild(e),setTimeout(()=>{e&&e.remove()},2e3)}class Hb{constructor(t){pe(this,"pixiRenderer");pe(this,"skiaRenderer");pe(this,"containersManager");pe(this,"containerGenerator");pe(this,"eventManager");pe(this,"thumbnailRenderer");this.pixiRenderer=new Ob(t.pixi),this.skiaRenderer=new Lb(t.skia),this.containersManager=new Nb,this.containerGenerator=new Ub([pt.from("./sprites/sprite1.png"),pt.from("./sprites/sprite2.png")],{pointerdown:e=>()=>{hd(`<b>pointerdown</b>: ${String(e).charAt(0).toUpperCase()+String(e).slice(1)}`)},pointerup:e=>()=>{hd(`<b>pointerup</b>: ${String(e).charAt(0).toUpperCase()+String(e).slice(1)}`)}}),this.eventManager=new kb(this),this.thumbnailRenderer=new Gb}async init(){try{await Promise.all([this.pixiRenderer.init(),this.skiaRenderer.init()]),this.eventManager.initButtonClickEvents(),this.eventManager.initSkiaPointerEvents()}catch(t){throw console.error("Failed to initialize application:",t),t}}addRandomContainer(){const t=this.containerGenerator.generateContainer();this.addContainer(t)}addContainer(t){this.containersManager.addContainer(t),this.containersManager.setSelectedContainerToLast(),this.clean(),this.renderSelectedContainer(),this.checkContainersLimit(),this.refreshThumbnails(!0)}checkContainersLimit(){const t=document.getElementById("generate-random-container"),e=this.containersManager.containers.length>=Db;t.disabled=e,t.classList.toggle("disabled",e)}renderSelectedContainer(){const t=this.containersManager.getSelectedContainer();t&&(this.pixiRenderer.renderContainer(t),this.skiaRenderer.renderContainer(t),this.renderComparisonContainers(),this.eventManager.refresh())}renderComparisonContainers(){const t=document.querySelector("#skia-canvas-wrapper canvas"),e=document.getElementById("comparison-canvas1"),r=document.getElementById("comparison-canvas2");[e,r].forEach(n=>{n.width=Qr,n.height=ti}),this.thumbnailRenderer.render(this.containersManager.getSelectedContainer(),e),r.getContext("2d").drawImage(t,0,0,Qr,ti)}clean(){this.pixiRenderer.clean(),this.skiaRenderer.clean()}refreshThumbnails(t=!1){const e=document.querySelector("#thumbnails ol");e.innerHTML="",this.containersManager.containers.forEach((r,n)=>{const s=document.createElement("li");n===this.containersManager.selectedContainer&&s.classList.add("selected");const a=document.createElement("canvas");a.width=Qr,a.height=ti,this.thumbnailRenderer.render(r,a),s.appendChild(a),e.appendChild(s),s.addEventListener("click",()=>{this.containersManager.setSelectedContainer(n),this.renderSelectedContainer(),this.refreshThumbnails()});const h=document.createElement("button");h.innerHTML='<span class="close"></span>',h.addEventListener("click",u=>{u.stopPropagation();const c=e.scrollTop;this.containersManager.removeContainer(n),this.containersManager.containers.length===0?this.addRandomContainer():this.containersManager.selectedContainer===this.containersManager.containers.length&&this.containersManager.setSelectedContainerToLast(),this.renderSelectedContainer(),this.refreshThumbnails(),this.checkContainersLimit(),e.scrollTop=c}),s.appendChild(h)}),t&&(e.scrollTop=e.scrollHeight)}}document.querySelector("#app").innerHTML=`
    <menu>
        <button id="generate-random-container">Generate random container</button>
        <button id="export-as-pdf">Export as PDF</button>
    </menu>
    <div>
        <aside id="thumbnails">
            <h3>Thumbnails</h3>
            <ol></ol>
        </aside>
        <main>
            <div class="canvases">
                <div class="main-canvases">
                    <div>
                        <h3>PixiJS</h3>
                        <div id="pixi-canvas-wrapper" class="canvas"></div>
                    </div>
                    <div>
                        <h3>Skia</h3>
                        <div id="skia-canvas-wrapper" class="canvas"></div>
                    </div>
                </div>
                <div class="comparison">
                    <h3>Difference highlight</h3>
                    <div class="comparison-canvases">
                        <canvas id="comparison-canvas1" class="canvas"></canvas>
                        <canvas id="comparison-canvas2" class="canvas"></canvas>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <div id="snackbars"></div>
`;const ld=new Hb({pixi:document.getElementById("pixi-canvas-wrapper"),skia:document.getElementById("skia-canvas-wrapper")});ld.init().then(()=>{ld.addRandomContainer()})});export default $b();
